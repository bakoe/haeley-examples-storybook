import Fa from"rxjs";var Ia={exports:{}};(()=>{var Pr={3659:(F,p,v)=>{v.r(p),v.d(p,{glMatrix:()=>d,mat2:()=>u,mat2d:()=>b,mat3:()=>m,mat4:()=>f,quat:()=>n,quat2:()=>i,vec2:()=>c,vec3:()=>o,vec4:()=>r});var d={};v.r(d),v.d(d,{ARRAY_TYPE:()=>a,EPSILON:()=>s,RANDOM:()=>h,equals:()=>y,setMatrixArrayType:()=>g,toRadian:()=>T});var u={};v.r(u),v.d(u,{LDU:()=>he,add:()=>xe,adjoint:()=>H,clone:()=>w,copy:()=>L,create:()=>A,determinant:()=>q,equals:()=>ve,exactEquals:()=>be,frob:()=>me,fromRotation:()=>se,fromScaling:()=>Q,fromValues:()=>j,identity:()=>D,invert:()=>W,mul:()=>ye,multiply:()=>Z,multiplyScalar:()=>ze,multiplyScalarAndAdd:()=>Ae,rotate:()=>$,scale:()=>J,set:()=>V,str:()=>ae,sub:()=>Te,subtract:()=>Y,transpose:()=>G});var b={};v.r(b),v.d(b,{add:()=>nt,clone:()=>Ge,copy:()=>Pe,create:()=>Le,determinant:()=>Ce,equals:()=>at,exactEquals:()=>De,frob:()=>it,fromRotation:()=>et,fromScaling:()=>tt,fromTranslation:()=>rt,fromValues:()=>Be,identity:()=>Ne,invert:()=>je,mul:()=>ot,multiply:()=>Xe,multiplyScalar:()=>st,multiplyScalarAndAdd:()=>Ue,rotate:()=>Je,scale:()=>Qe,set:()=>Ie,str:()=>He,sub:()=>ct,subtract:()=>$e,translate:()=>We});var m={};v.r(m),v.d(m,{add:()=>Zr,adjoint:()=>Br,clone:()=>Ee,copy:()=>we,create:()=>_e,determinant:()=>Cr,equals:()=>ei,exactEquals:()=>Qr,frob:()=>Yr,fromMat2d:()=>Xr,fromMat4:()=>ge,fromQuat:()=>Wr,fromRotation:()=>kr,fromScaling:()=>Vr,fromTranslation:()=>Ur,fromValues:()=>Or,identity:()=>Ir,invert:()=>Nr,mul:()=>ti,multiply:()=>Tt,multiplyScalar:()=>Kr,multiplyScalarAndAdd:()=>Jr,normalFromMat4:()=>Hr,projection:()=>$r,rotate:()=>Gr,scale:()=>jr,set:()=>Fr,str:()=>qr,sub:()=>ri,subtract:()=>xt,translate:()=>Dr,transpose:()=>zr});var f={};v.r(f),v.d(f,{add:()=>Bi,adjoint:()=>li,clone:()=>ni,copy:()=>si,create:()=>ii,determinant:()=>ui,equals:()=>ji,exactEquals:()=>Gi,frob:()=>Ni,fromQuat:()=>Ri,fromQuat2:()=>Ai,fromRotation:()=>Ei,fromRotationTranslation:()=>Mt,fromRotationTranslationScale:()=>Si,fromRotationTranslationScaleOrigin:()=>Mi,fromScaling:()=>bi,fromTranslation:()=>gi,fromValues:()=>ai,fromXRotation:()=>yi,fromYRotation:()=>Ti,fromZRotation:()=>xi,frustum:()=>Li,getRotation:()=>Pt,getScaling:()=>Lt,getTranslation:()=>Rt,identity:()=>At,invert:()=>hi,lookAt:()=>Fi,mul:()=>Ui,multiply:()=>St,multiplyScalar:()=>Ci,multiplyScalarAndAdd:()=>Di,ortho:()=>Oi,perspective:()=>Pi,perspectiveFromFieldOfView:()=>wi,rotate:()=>fi,rotateX:()=>pi,rotateY:()=>mi,rotateZ:()=>vi,scale:()=>_i,set:()=>oi,str:()=>zi,sub:()=>ki,subtract:()=>wt,targetTo:()=>Ii,translate:()=>di,transpose:()=>ci});var o={};v.r(o),v.d(o,{add:()=>Hi,angle:()=>_n,bezier:()=>sn,ceil:()=>$i,clone:()=>Vi,copy:()=>Xi,create:()=>ht,cross:()=>qe,dist:()=>yn,distance:()=>Nt,div:()=>En,divide:()=>zt,dot:()=>ut,equals:()=>vn,exactEquals:()=>mn,floor:()=>qi,forEach:()=>An,fromValues:()=>lt,hermite:()=>nn,inverse:()=>tn,len:()=>Gt,length:()=>Ot,lerp:()=>rn,max:()=>Zi,min:()=>Yi,mul:()=>bn,multiply:()=>It,negate:()=>en,normalize:()=>Dt,random:()=>an,rotateX:()=>ln,rotateY:()=>un,rotateZ:()=>dn,round:()=>Ki,scale:()=>Ji,scaleAndAdd:()=>Qi,set:()=>Wi,sqrDist:()=>Tn,sqrLen:()=>xn,squaredDistance:()=>Bt,squaredLength:()=>Ct,str:()=>pn,sub:()=>gn,subtract:()=>Ft,transformMat3:()=>cn,transformMat4:()=>on,transformQuat:()=>hn,zero:()=>fn});var r={};v.r(r),v.d(r,{add:()=>Wt,ceil:()=>Sn,clone:()=>Ut,copy:()=>Vt,create:()=>jt,cross:()=>In,dist:()=>kn,distance:()=>Zt,div:()=>Un,divide:()=>qt,dot:()=>Qt,equals:()=>rr,exactEquals:()=>tr,floor:()=>Mn,forEach:()=>Hn,fromValues:()=>kt,inverse:()=>Fn,len:()=>Xn,length:()=>dt,lerp:()=>er,max:()=>Ln,min:()=>Rn,mul:()=>jn,multiply:()=>$t,negate:()=>On,normalize:()=>Jt,random:()=>zn,round:()=>Pn,scale:()=>Yt,scaleAndAdd:()=>wn,set:()=>Xt,sqrDist:()=>Vn,sqrLen:()=>Wn,squaredDistance:()=>Kt,squaredLength:()=>_t,str:()=>Dn,sub:()=>Gn,subtract:()=>Ht,transformMat4:()=>Nn,transformQuat:()=>Bn,zero:()=>Cn});var n={};v.r(n),v.d(n,{add:()=>as,calculateW:()=>Zn,clone:()=>is,conjugate:()=>es,copy:()=>mt,create:()=>Ye,dot:()=>vt,equals:()=>ds,exactEquals:()=>us,exp:()=>cr,fromEuler:()=>ts,fromMat3:()=>lr,fromValues:()=>ns,getAngle:()=>Yn,getAxisAngle:()=>qn,identity:()=>$n,invert:()=>Qn,len:()=>hs,length:()=>gt,lerp:()=>cs,ln:()=>hr,mul:()=>os,multiply:()=>nr,normalize:()=>Et,pow:()=>Kn,random:()=>Jn,rotateX:()=>sr,rotateY:()=>ar,rotateZ:()=>or,rotationTo:()=>_s,scale:()=>_r,set:()=>ss,setAxes:()=>ps,setAxisAngle:()=>ir,slerp:()=>Ze,sqlerp:()=>fs,sqrLen:()=>ls,squaredLength:()=>bt,str:()=>rs});var i={};v.r(i),v.d(i,{add:()=>Cs,clone:()=>vs,conjugate:()=>ks,copy:()=>pr,create:()=>ms,dot:()=>vr,equals:()=>qs,exactEquals:()=>$s,fromMat4:()=>Ts,fromRotation:()=>ys,fromRotationTranslation:()=>fr,fromRotationTranslationValues:()=>bs,fromTranslation:()=>Es,fromValues:()=>gs,getDual:()=>Ms,getReal:()=>Ss,getTranslation:()=>Ps,identity:()=>xs,invert:()=>Us,len:()=>Vs,length:()=>gr,lerp:()=>js,mul:()=>Ds,multiply:()=>mr,normalize:()=>Ws,rotateAroundAxis:()=>Bs,rotateByQuatAppend:()=>zs,rotateByQuatPrepend:()=>Ns,rotateX:()=>Os,rotateY:()=>Fs,rotateZ:()=>Is,scale:()=>Gs,set:()=>As,setDual:()=>Ls,setReal:()=>Rs,sqrLen:()=>Xs,squaredLength:()=>Ke,str:()=>Hs,translate:()=>ws});var c={};v.r(c),v.d(c,{add:()=>Qs,angle:()=>ba,ceil:()=>ea,clone:()=>Ys,copy:()=>Ks,create:()=>br,cross:()=>ua,dist:()=>La,distance:()=>xr,div:()=>Ra,divide:()=>Tr,dot:()=>la,equals:()=>xa,exactEquals:()=>Ta,floor:()=>ta,forEach:()=>Oa,fromValues:()=>Zs,inverse:()=>ca,len:()=>Aa,length:()=>Sr,lerp:()=>da,max:()=>ia,min:()=>ra,mul:()=>Ma,multiply:()=>yr,negate:()=>oa,normalize:()=>ha,random:()=>_a,rotate:()=>ga,round:()=>na,scale:()=>sa,scaleAndAdd:()=>aa,set:()=>Js,sqrDist:()=>Pa,sqrLen:()=>wa,squaredDistance:()=>Ar,squaredLength:()=>Mr,str:()=>ya,sub:()=>Sa,subtract:()=>Er,transformMat2:()=>fa,transformMat2d:()=>pa,transformMat3:()=>ma,transformMat4:()=>va,zero:()=>Ea});var s=1e-6,a=typeof Float32Array!="undefined"?Float32Array:Array,h=Math.random;function g(e){a=e}var _=Math.PI/180;function T(e){return e*_}function y(e,t){return Math.abs(e-t)<=s*Math.max(1,Math.abs(e),Math.abs(t))}function A(){var e=new a(4);return a!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function w(e){var t=new a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function L(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function D(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function j(e,t,l,E){var x=new a(4);return x[0]=e,x[1]=t,x[2]=l,x[3]=E,x}function V(e,t,l,E,x){return e[0]=t,e[1]=l,e[2]=E,e[3]=x,e}function G(e,t){if(e===t){var l=t[1];e[1]=t[2],e[2]=l}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function W(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=l*S-x*E;return M?(M=1/M,e[0]=S*M,e[1]=-E*M,e[2]=-x*M,e[3]=l*M,e):null}function H(e,t){var l=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=l,e}function q(e){return e[0]*e[3]-e[2]*e[1]}function Z(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=l[0],P=l[1],O=l[2],I=l[3];return e[0]=E*R+S*P,e[1]=x*R+M*P,e[2]=E*O+S*I,e[3]=x*O+M*I,e}function $(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=Math.sin(l),P=Math.cos(l);return e[0]=E*P+S*R,e[1]=x*P+M*R,e[2]=E*-R+S*P,e[3]=x*-R+M*P,e}function J(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=l[0],P=l[1];return e[0]=E*R,e[1]=x*R,e[2]=S*P,e[3]=M*P,e}function se(e,t){var l=Math.sin(t),E=Math.cos(t);return e[0]=E,e[1]=l,e[2]=-l,e[3]=E,e}function Q(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function ae(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function me(e){return Math.hypot(e[0],e[1],e[2],e[3])}function he(e,t,l,E){return e[2]=E[2]/E[0],l[0]=E[0],l[1]=E[1],l[3]=E[3]-e[2]*l[1],[e,t,l]}function xe(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e[3]=t[3]+l[3],e}function Y(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e[2]=t[2]-l[2],e[3]=t[3]-l[3],e}function be(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ve(e,t){var l=e[0],E=e[1],x=e[2],S=e[3],M=t[0],R=t[1],P=t[2],O=t[3];return Math.abs(l-M)<=s*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(E-R)<=s*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(x-P)<=s*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(S-O)<=s*Math.max(1,Math.abs(S),Math.abs(O))}function ze(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e}function Ae(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e[2]=t[2]+l[2]*E,e[3]=t[3]+l[3]*E,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ye=Z,Te=Y;function Le(){var e=new a(6);return a!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function Ge(e){var t=new a(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Pe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Ne(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Be(e,t,l,E,x,S){var M=new a(6);return M[0]=e,M[1]=t,M[2]=l,M[3]=E,M[4]=x,M[5]=S,M}function Ie(e,t,l,E,x,S,M){return e[0]=t,e[1]=l,e[2]=E,e[3]=x,e[4]=S,e[5]=M,e}function je(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=t[4],R=t[5],P=l*S-E*x;return P?(P=1/P,e[0]=S*P,e[1]=-E*P,e[2]=-x*P,e[3]=l*P,e[4]=(x*R-S*M)*P,e[5]=(E*M-l*R)*P,e):null}function Ce(e){return e[0]*e[3]-e[1]*e[2]}function Xe(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=l[0],I=l[1],z=l[2],N=l[3],B=l[4],U=l[5];return e[0]=E*O+S*I,e[1]=x*O+M*I,e[2]=E*z+S*N,e[3]=x*z+M*N,e[4]=E*B+S*U+R,e[5]=x*B+M*U+P,e}function Je(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=Math.sin(l),I=Math.cos(l);return e[0]=E*I+S*O,e[1]=x*I+M*O,e[2]=E*-O+S*I,e[3]=x*-O+M*I,e[4]=R,e[5]=P,e}function Qe(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=l[0],I=l[1];return e[0]=E*O,e[1]=x*O,e[2]=S*I,e[3]=M*I,e[4]=R,e[5]=P,e}function We(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=l[0],I=l[1];return e[0]=E,e[1]=x,e[2]=S,e[3]=M,e[4]=E*O+S*I+R,e[5]=x*O+M*I+P,e}function et(e,t){var l=Math.sin(t),E=Math.cos(t);return e[0]=E,e[1]=l,e[2]=-l,e[3]=E,e[4]=0,e[5]=0,e}function tt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function rt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function He(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function it(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function nt(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e[3]=t[3]+l[3],e[4]=t[4]+l[4],e[5]=t[5]+l[5],e}function $e(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e[2]=t[2]-l[2],e[3]=t[3]-l[3],e[4]=t[4]-l[4],e[5]=t[5]-l[5],e}function st(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e[4]=t[4]*l,e[5]=t[5]*l,e}function Ue(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e[2]=t[2]+l[2]*E,e[3]=t[3]+l[3]*E,e[4]=t[4]+l[4]*E,e[5]=t[5]+l[5]*E,e}function De(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function at(e,t){var l=e[0],E=e[1],x=e[2],S=e[3],M=e[4],R=e[5],P=t[0],O=t[1],I=t[2],z=t[3],N=t[4],B=t[5];return Math.abs(l-P)<=s*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(E-O)<=s*Math.max(1,Math.abs(E),Math.abs(O))&&Math.abs(x-I)<=s*Math.max(1,Math.abs(x),Math.abs(I))&&Math.abs(S-z)<=s*Math.max(1,Math.abs(S),Math.abs(z))&&Math.abs(M-N)<=s*Math.max(1,Math.abs(M),Math.abs(N))&&Math.abs(R-B)<=s*Math.max(1,Math.abs(R),Math.abs(B))}var ot=Xe,ct=$e;function _e(){var e=new a(9);return a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ge(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Ee(e){var t=new a(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function we(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Or(e,t,l,E,x,S,M,R,P){var O=new a(9);return O[0]=e,O[1]=t,O[2]=l,O[3]=E,O[4]=x,O[5]=S,O[6]=M,O[7]=R,O[8]=P,O}function Fr(e,t,l,E,x,S,M,R,P,O){return e[0]=t,e[1]=l,e[2]=E,e[3]=x,e[4]=S,e[5]=M,e[6]=R,e[7]=P,e[8]=O,e}function Ir(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function zr(e,t){if(e===t){var l=t[1],E=t[2],x=t[5];e[1]=t[3],e[2]=t[6],e[3]=l,e[5]=t[7],e[6]=E,e[7]=x}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Nr(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=t[4],R=t[5],P=t[6],O=t[7],I=t[8],z=I*M-R*O,N=-I*S+R*P,B=O*S-M*P,U=l*z+E*N+x*B;return U?(U=1/U,e[0]=z*U,e[1]=(-I*E+x*O)*U,e[2]=(R*E-x*M)*U,e[3]=N*U,e[4]=(I*l-x*P)*U,e[5]=(-R*l+x*S)*U,e[6]=B*U,e[7]=(-O*l+E*P)*U,e[8]=(M*l-E*S)*U,e):null}function Br(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=t[4],R=t[5],P=t[6],O=t[7],I=t[8];return e[0]=M*I-R*O,e[1]=x*O-E*I,e[2]=E*R-x*M,e[3]=R*P-S*I,e[4]=l*I-x*P,e[5]=x*S-l*R,e[6]=S*O-M*P,e[7]=E*P-l*O,e[8]=l*M-E*S,e}function Cr(e){var t=e[0],l=e[1],E=e[2],x=e[3],S=e[4],M=e[5],R=e[6],P=e[7],O=e[8];return t*(O*S-M*P)+l*(-O*x+M*R)+E*(P*x-S*R)}function Tt(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=t[8],N=l[0],B=l[1],U=l[2],k=l[3],C=l[4],X=l[5],te=l[6],K=l[7],ee=l[8];return e[0]=N*E+B*M+U*O,e[1]=N*x+B*R+U*I,e[2]=N*S+B*P+U*z,e[3]=k*E+C*M+X*O,e[4]=k*x+C*R+X*I,e[5]=k*S+C*P+X*z,e[6]=te*E+K*M+ee*O,e[7]=te*x+K*R+ee*I,e[8]=te*S+K*P+ee*z,e}function Dr(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=t[8],N=l[0],B=l[1];return e[0]=E,e[1]=x,e[2]=S,e[3]=M,e[4]=R,e[5]=P,e[6]=N*E+B*M+O,e[7]=N*x+B*R+I,e[8]=N*S+B*P+z,e}function Gr(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=t[8],N=Math.sin(l),B=Math.cos(l);return e[0]=B*E+N*M,e[1]=B*x+N*R,e[2]=B*S+N*P,e[3]=B*M-N*E,e[4]=B*R-N*x,e[5]=B*P-N*S,e[6]=O,e[7]=I,e[8]=z,e}function jr(e,t,l){var E=l[0],x=l[1];return e[0]=E*t[0],e[1]=E*t[1],e[2]=E*t[2],e[3]=x*t[3],e[4]=x*t[4],e[5]=x*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ur(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function kr(e,t){var l=Math.sin(t),E=Math.cos(t);return e[0]=E,e[1]=l,e[2]=0,e[3]=-l,e[4]=E,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Vr(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Xr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Wr(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=l+l,R=E+E,P=x+x,O=l*M,I=E*M,z=E*R,N=x*M,B=x*R,U=x*P,k=S*M,C=S*R,X=S*P;return e[0]=1-z-U,e[3]=I-X,e[6]=N+C,e[1]=I+X,e[4]=1-O-U,e[7]=B-k,e[2]=N-C,e[5]=B+k,e[8]=1-O-z,e}function Hr(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=t[4],R=t[5],P=t[6],O=t[7],I=t[8],z=t[9],N=t[10],B=t[11],U=t[12],k=t[13],C=t[14],X=t[15],te=l*R-E*M,K=l*P-x*M,ee=l*O-S*M,ne=E*P-x*R,re=E*O-S*R,fe=x*O-S*P,ue=I*k-z*U,de=I*C-N*U,le=I*X-B*U,pe=z*C-N*k,oe=z*X-B*k,ce=N*X-B*C,ie=te*ce-K*oe+ee*pe+ne*le-re*de+fe*ue;return ie?(ie=1/ie,e[0]=(R*ce-P*oe+O*pe)*ie,e[1]=(P*le-M*ce-O*de)*ie,e[2]=(M*oe-R*le+O*ue)*ie,e[3]=(x*oe-E*ce-S*pe)*ie,e[4]=(l*ce-x*le+S*de)*ie,e[5]=(E*le-l*oe-S*ue)*ie,e[6]=(k*fe-C*re+X*ne)*ie,e[7]=(C*ee-U*fe-X*K)*ie,e[8]=(U*re-k*ee+X*te)*ie,e):null}function $r(e,t,l){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/l,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function qr(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Yr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Zr(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e[3]=t[3]+l[3],e[4]=t[4]+l[4],e[5]=t[5]+l[5],e[6]=t[6]+l[6],e[7]=t[7]+l[7],e[8]=t[8]+l[8],e}function xt(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e[2]=t[2]-l[2],e[3]=t[3]-l[3],e[4]=t[4]-l[4],e[5]=t[5]-l[5],e[6]=t[6]-l[6],e[7]=t[7]-l[7],e[8]=t[8]-l[8],e}function Kr(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e[4]=t[4]*l,e[5]=t[5]*l,e[6]=t[6]*l,e[7]=t[7]*l,e[8]=t[8]*l,e}function Jr(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e[2]=t[2]+l[2]*E,e[3]=t[3]+l[3]*E,e[4]=t[4]+l[4]*E,e[5]=t[5]+l[5]*E,e[6]=t[6]+l[6]*E,e[7]=t[7]+l[7]*E,e[8]=t[8]+l[8]*E,e}function Qr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function ei(e,t){var l=e[0],E=e[1],x=e[2],S=e[3],M=e[4],R=e[5],P=e[6],O=e[7],I=e[8],z=t[0],N=t[1],B=t[2],U=t[3],k=t[4],C=t[5],X=t[6],te=t[7],K=t[8];return Math.abs(l-z)<=s*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(E-N)<=s*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(x-B)<=s*Math.max(1,Math.abs(x),Math.abs(B))&&Math.abs(S-U)<=s*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(M-k)<=s*Math.max(1,Math.abs(M),Math.abs(k))&&Math.abs(R-C)<=s*Math.max(1,Math.abs(R),Math.abs(C))&&Math.abs(P-X)<=s*Math.max(1,Math.abs(P),Math.abs(X))&&Math.abs(O-te)<=s*Math.max(1,Math.abs(O),Math.abs(te))&&Math.abs(I-K)<=s*Math.max(1,Math.abs(I),Math.abs(K))}var ti=Tt,ri=xt;function ii(){var e=new a(16);return a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ni(e){var t=new a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function si(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ai(e,t,l,E,x,S,M,R,P,O,I,z,N,B,U,k){var C=new a(16);return C[0]=e,C[1]=t,C[2]=l,C[3]=E,C[4]=x,C[5]=S,C[6]=M,C[7]=R,C[8]=P,C[9]=O,C[10]=I,C[11]=z,C[12]=N,C[13]=B,C[14]=U,C[15]=k,C}function oi(e,t,l,E,x,S,M,R,P,O,I,z,N,B,U,k,C){return e[0]=t,e[1]=l,e[2]=E,e[3]=x,e[4]=S,e[5]=M,e[6]=R,e[7]=P,e[8]=O,e[9]=I,e[10]=z,e[11]=N,e[12]=B,e[13]=U,e[14]=k,e[15]=C,e}function At(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ci(e,t){if(e===t){var l=t[1],E=t[2],x=t[3],S=t[6],M=t[7],R=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=l,e[6]=t[9],e[7]=t[13],e[8]=E,e[9]=S,e[11]=t[14],e[12]=x,e[13]=M,e[14]=R}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function hi(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=t[4],R=t[5],P=t[6],O=t[7],I=t[8],z=t[9],N=t[10],B=t[11],U=t[12],k=t[13],C=t[14],X=t[15],te=l*R-E*M,K=l*P-x*M,ee=l*O-S*M,ne=E*P-x*R,re=E*O-S*R,fe=x*O-S*P,ue=I*k-z*U,de=I*C-N*U,le=I*X-B*U,pe=z*C-N*k,oe=z*X-B*k,ce=N*X-B*C,ie=te*ce-K*oe+ee*pe+ne*le-re*de+fe*ue;return ie?(ie=1/ie,e[0]=(R*ce-P*oe+O*pe)*ie,e[1]=(x*oe-E*ce-S*pe)*ie,e[2]=(k*fe-C*re+X*ne)*ie,e[3]=(N*re-z*fe-B*ne)*ie,e[4]=(P*le-M*ce-O*de)*ie,e[5]=(l*ce-x*le+S*de)*ie,e[6]=(C*ee-U*fe-X*K)*ie,e[7]=(I*fe-N*ee+B*K)*ie,e[8]=(M*oe-R*le+O*ue)*ie,e[9]=(E*le-l*oe-S*ue)*ie,e[10]=(U*re-k*ee+X*te)*ie,e[11]=(z*ee-I*re-B*te)*ie,e[12]=(R*de-M*pe-P*ue)*ie,e[13]=(l*pe-E*de+x*ue)*ie,e[14]=(k*K-U*ne-C*te)*ie,e[15]=(I*ne-z*K+N*te)*ie,e):null}function li(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=t[4],R=t[5],P=t[6],O=t[7],I=t[8],z=t[9],N=t[10],B=t[11],U=t[12],k=t[13],C=t[14],X=t[15];return e[0]=R*(N*X-B*C)-z*(P*X-O*C)+k*(P*B-O*N),e[1]=-(E*(N*X-B*C)-z*(x*X-S*C)+k*(x*B-S*N)),e[2]=E*(P*X-O*C)-R*(x*X-S*C)+k*(x*O-S*P),e[3]=-(E*(P*B-O*N)-R*(x*B-S*N)+z*(x*O-S*P)),e[4]=-(M*(N*X-B*C)-I*(P*X-O*C)+U*(P*B-O*N)),e[5]=l*(N*X-B*C)-I*(x*X-S*C)+U*(x*B-S*N),e[6]=-(l*(P*X-O*C)-M*(x*X-S*C)+U*(x*O-S*P)),e[7]=l*(P*B-O*N)-M*(x*B-S*N)+I*(x*O-S*P),e[8]=M*(z*X-B*k)-I*(R*X-O*k)+U*(R*B-O*z),e[9]=-(l*(z*X-B*k)-I*(E*X-S*k)+U*(E*B-S*z)),e[10]=l*(R*X-O*k)-M*(E*X-S*k)+U*(E*O-S*R),e[11]=-(l*(R*B-O*z)-M*(E*B-S*z)+I*(E*O-S*R)),e[12]=-(M*(z*C-N*k)-I*(R*C-P*k)+U*(R*N-P*z)),e[13]=l*(z*C-N*k)-I*(E*C-x*k)+U*(E*N-x*z),e[14]=-(l*(R*C-P*k)-M*(E*C-x*k)+U*(E*P-x*R)),e[15]=l*(R*N-P*z)-M*(E*N-x*z)+I*(E*P-x*R),e}function ui(e){var t=e[0],l=e[1],E=e[2],x=e[3],S=e[4],M=e[5],R=e[6],P=e[7],O=e[8],I=e[9],z=e[10],N=e[11],B=e[12],U=e[13],k=e[14],C=e[15];return(t*M-l*S)*(z*C-N*k)-(t*R-E*S)*(I*C-N*U)+(t*P-x*S)*(I*k-z*U)+(l*R-E*M)*(O*C-N*B)-(l*P-x*M)*(O*k-z*B)+(E*P-x*R)*(O*U-I*B)}function St(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=t[8],N=t[9],B=t[10],U=t[11],k=t[12],C=t[13],X=t[14],te=t[15],K=l[0],ee=l[1],ne=l[2],re=l[3];return e[0]=K*E+ee*R+ne*z+re*k,e[1]=K*x+ee*P+ne*N+re*C,e[2]=K*S+ee*O+ne*B+re*X,e[3]=K*M+ee*I+ne*U+re*te,K=l[4],ee=l[5],ne=l[6],re=l[7],e[4]=K*E+ee*R+ne*z+re*k,e[5]=K*x+ee*P+ne*N+re*C,e[6]=K*S+ee*O+ne*B+re*X,e[7]=K*M+ee*I+ne*U+re*te,K=l[8],ee=l[9],ne=l[10],re=l[11],e[8]=K*E+ee*R+ne*z+re*k,e[9]=K*x+ee*P+ne*N+re*C,e[10]=K*S+ee*O+ne*B+re*X,e[11]=K*M+ee*I+ne*U+re*te,K=l[12],ee=l[13],ne=l[14],re=l[15],e[12]=K*E+ee*R+ne*z+re*k,e[13]=K*x+ee*P+ne*N+re*C,e[14]=K*S+ee*O+ne*B+re*X,e[15]=K*M+ee*I+ne*U+re*te,e}function di(e,t,l){var E,x,S,M,R,P,O,I,z,N,B,U,k=l[0],C=l[1],X=l[2];return t===e?(e[12]=t[0]*k+t[4]*C+t[8]*X+t[12],e[13]=t[1]*k+t[5]*C+t[9]*X+t[13],e[14]=t[2]*k+t[6]*C+t[10]*X+t[14],e[15]=t[3]*k+t[7]*C+t[11]*X+t[15]):(E=t[0],x=t[1],S=t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=t[8],N=t[9],B=t[10],U=t[11],e[0]=E,e[1]=x,e[2]=S,e[3]=M,e[4]=R,e[5]=P,e[6]=O,e[7]=I,e[8]=z,e[9]=N,e[10]=B,e[11]=U,e[12]=E*k+R*C+z*X+t[12],e[13]=x*k+P*C+N*X+t[13],e[14]=S*k+O*C+B*X+t[14],e[15]=M*k+I*C+U*X+t[15]),e}function _i(e,t,l){var E=l[0],x=l[1],S=l[2];return e[0]=t[0]*E,e[1]=t[1]*E,e[2]=t[2]*E,e[3]=t[3]*E,e[4]=t[4]*x,e[5]=t[5]*x,e[6]=t[6]*x,e[7]=t[7]*x,e[8]=t[8]*S,e[9]=t[9]*S,e[10]=t[10]*S,e[11]=t[11]*S,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fi(e,t,l,E){var x,S,M,R,P,O,I,z,N,B,U,k,C,X,te,K,ee,ne,re,fe,ue,de,le,pe,oe=E[0],ce=E[1],ie=E[2],Re=Math.hypot(oe,ce,ie);return Re<s?null:(oe*=Re=1/Re,ce*=Re,ie*=Re,x=Math.sin(l),M=1-(S=Math.cos(l)),R=t[0],P=t[1],O=t[2],I=t[3],z=t[4],N=t[5],B=t[6],U=t[7],k=t[8],C=t[9],X=t[10],te=t[11],K=oe*oe*M+S,ee=ce*oe*M+ie*x,ne=ie*oe*M-ce*x,re=oe*ce*M-ie*x,fe=ce*ce*M+S,ue=ie*ce*M+oe*x,de=oe*ie*M+ce*x,le=ce*ie*M-oe*x,pe=ie*ie*M+S,e[0]=R*K+z*ee+k*ne,e[1]=P*K+N*ee+C*ne,e[2]=O*K+B*ee+X*ne,e[3]=I*K+U*ee+te*ne,e[4]=R*re+z*fe+k*ue,e[5]=P*re+N*fe+C*ue,e[6]=O*re+B*fe+X*ue,e[7]=I*re+U*fe+te*ue,e[8]=R*de+z*le+k*pe,e[9]=P*de+N*le+C*pe,e[10]=O*de+B*le+X*pe,e[11]=I*de+U*le+te*pe,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function pi(e,t,l){var E=Math.sin(l),x=Math.cos(l),S=t[4],M=t[5],R=t[6],P=t[7],O=t[8],I=t[9],z=t[10],N=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=S*x+O*E,e[5]=M*x+I*E,e[6]=R*x+z*E,e[7]=P*x+N*E,e[8]=O*x-S*E,e[9]=I*x-M*E,e[10]=z*x-R*E,e[11]=N*x-P*E,e}function mi(e,t,l){var E=Math.sin(l),x=Math.cos(l),S=t[0],M=t[1],R=t[2],P=t[3],O=t[8],I=t[9],z=t[10],N=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=S*x-O*E,e[1]=M*x-I*E,e[2]=R*x-z*E,e[3]=P*x-N*E,e[8]=S*E+O*x,e[9]=M*E+I*x,e[10]=R*E+z*x,e[11]=P*E+N*x,e}function vi(e,t,l){var E=Math.sin(l),x=Math.cos(l),S=t[0],M=t[1],R=t[2],P=t[3],O=t[4],I=t[5],z=t[6],N=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=S*x+O*E,e[1]=M*x+I*E,e[2]=R*x+z*E,e[3]=P*x+N*E,e[4]=O*x-S*E,e[5]=I*x-M*E,e[6]=z*x-R*E,e[7]=N*x-P*E,e}function gi(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function bi(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ei(e,t,l){var E,x,S,M=l[0],R=l[1],P=l[2],O=Math.hypot(M,R,P);return O<s?null:(M*=O=1/O,R*=O,P*=O,E=Math.sin(t),S=1-(x=Math.cos(t)),e[0]=M*M*S+x,e[1]=R*M*S+P*E,e[2]=P*M*S-R*E,e[3]=0,e[4]=M*R*S-P*E,e[5]=R*R*S+x,e[6]=P*R*S+M*E,e[7]=0,e[8]=M*P*S+R*E,e[9]=R*P*S-M*E,e[10]=P*P*S+x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function yi(e,t){var l=Math.sin(t),E=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=l,e[7]=0,e[8]=0,e[9]=-l,e[10]=E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ti(e,t){var l=Math.sin(t),E=Math.cos(t);return e[0]=E,e[1]=0,e[2]=-l,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=l,e[9]=0,e[10]=E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xi(e,t){var l=Math.sin(t),E=Math.cos(t);return e[0]=E,e[1]=l,e[2]=0,e[3]=0,e[4]=-l,e[5]=E,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mt(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=E+E,P=x+x,O=S+S,I=E*R,z=E*P,N=E*O,B=x*P,U=x*O,k=S*O,C=M*R,X=M*P,te=M*O;return e[0]=1-(B+k),e[1]=z+te,e[2]=N-X,e[3]=0,e[4]=z-te,e[5]=1-(I+k),e[6]=U+C,e[7]=0,e[8]=N+X,e[9]=U-C,e[10]=1-(I+B),e[11]=0,e[12]=l[0],e[13]=l[1],e[14]=l[2],e[15]=1,e}function Ai(e,t){var l=new a(3),E=-t[0],x=-t[1],S=-t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=E*E+x*x+S*S+M*M;return z>0?(l[0]=2*(R*M+I*E+P*S-O*x)/z,l[1]=2*(P*M+I*x+O*E-R*S)/z,l[2]=2*(O*M+I*S+R*x-P*E)/z):(l[0]=2*(R*M+I*E+P*S-O*x),l[1]=2*(P*M+I*x+O*E-R*S),l[2]=2*(O*M+I*S+R*x-P*E)),Mt(e,t,l),e}function Rt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Lt(e,t){var l=t[0],E=t[1],x=t[2],S=t[4],M=t[5],R=t[6],P=t[8],O=t[9],I=t[10];return e[0]=Math.hypot(l,E,x),e[1]=Math.hypot(S,M,R),e[2]=Math.hypot(P,O,I),e}function Pt(e,t){var l=new a(3);Lt(l,t);var E=1/l[0],x=1/l[1],S=1/l[2],M=t[0]*E,R=t[1]*x,P=t[2]*S,O=t[4]*E,I=t[5]*x,z=t[6]*S,N=t[8]*E,B=t[9]*x,U=t[10]*S,k=M+I+U,C=0;return k>0?(C=2*Math.sqrt(k+1),e[3]=.25*C,e[0]=(z-B)/C,e[1]=(N-P)/C,e[2]=(R-O)/C):M>I&&M>U?(C=2*Math.sqrt(1+M-I-U),e[3]=(z-B)/C,e[0]=.25*C,e[1]=(R+O)/C,e[2]=(N+P)/C):I>U?(C=2*Math.sqrt(1+I-M-U),e[3]=(N-P)/C,e[0]=(R+O)/C,e[1]=.25*C,e[2]=(z+B)/C):(C=2*Math.sqrt(1+U-M-I),e[3]=(R-O)/C,e[0]=(N+P)/C,e[1]=(z+B)/C,e[2]=.25*C),e}function Si(e,t,l,E){var x=t[0],S=t[1],M=t[2],R=t[3],P=x+x,O=S+S,I=M+M,z=x*P,N=x*O,B=x*I,U=S*O,k=S*I,C=M*I,X=R*P,te=R*O,K=R*I,ee=E[0],ne=E[1],re=E[2];return e[0]=(1-(U+C))*ee,e[1]=(N+K)*ee,e[2]=(B-te)*ee,e[3]=0,e[4]=(N-K)*ne,e[5]=(1-(z+C))*ne,e[6]=(k+X)*ne,e[7]=0,e[8]=(B+te)*re,e[9]=(k-X)*re,e[10]=(1-(z+U))*re,e[11]=0,e[12]=l[0],e[13]=l[1],e[14]=l[2],e[15]=1,e}function Mi(e,t,l,E,x){var S=t[0],M=t[1],R=t[2],P=t[3],O=S+S,I=M+M,z=R+R,N=S*O,B=S*I,U=S*z,k=M*I,C=M*z,X=R*z,te=P*O,K=P*I,ee=P*z,ne=E[0],re=E[1],fe=E[2],ue=x[0],de=x[1],le=x[2],pe=(1-(k+X))*ne,oe=(B+ee)*ne,ce=(U-K)*ne,ie=(B-ee)*re,Re=(1-(N+X))*re,ke=(C+te)*re,Ve=(U+K)*fe,Rr=(C-te)*fe,Lr=(1-(N+k))*fe;return e[0]=pe,e[1]=oe,e[2]=ce,e[3]=0,e[4]=ie,e[5]=Re,e[6]=ke,e[7]=0,e[8]=Ve,e[9]=Rr,e[10]=Lr,e[11]=0,e[12]=l[0]+ue-(pe*ue+ie*de+Ve*le),e[13]=l[1]+de-(oe*ue+Re*de+Rr*le),e[14]=l[2]+le-(ce*ue+ke*de+Lr*le),e[15]=1,e}function Ri(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=l+l,R=E+E,P=x+x,O=l*M,I=E*M,z=E*R,N=x*M,B=x*R,U=x*P,k=S*M,C=S*R,X=S*P;return e[0]=1-z-U,e[1]=I+X,e[2]=N-C,e[3]=0,e[4]=I-X,e[5]=1-O-U,e[6]=B+k,e[7]=0,e[8]=N+C,e[9]=B-k,e[10]=1-O-z,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Li(e,t,l,E,x,S,M){var R=1/(l-t),P=1/(x-E),O=1/(S-M);return e[0]=2*S*R,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*S*P,e[6]=0,e[7]=0,e[8]=(l+t)*R,e[9]=(x+E)*P,e[10]=(M+S)*O,e[11]=-1,e[12]=0,e[13]=0,e[14]=M*S*2*O,e[15]=0,e}function Pi(e,t,l,E,x){var S,M=1/Math.tan(t/2);return e[0]=M/l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=M,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,x!=null&&x!==1/0?(S=1/(E-x),e[10]=(x+E)*S,e[14]=2*x*E*S):(e[10]=-1,e[14]=-2*E),e}function wi(e,t,l,E){var x=Math.tan(t.upDegrees*Math.PI/180),S=Math.tan(t.downDegrees*Math.PI/180),M=Math.tan(t.leftDegrees*Math.PI/180),R=Math.tan(t.rightDegrees*Math.PI/180),P=2/(M+R),O=2/(x+S);return e[0]=P,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=O,e[6]=0,e[7]=0,e[8]=-(M-R)*P*.5,e[9]=(x-S)*O*.5,e[10]=E/(l-E),e[11]=-1,e[12]=0,e[13]=0,e[14]=E*l/(l-E),e[15]=0,e}function Oi(e,t,l,E,x,S,M){var R=1/(t-l),P=1/(E-x),O=1/(S-M);return e[0]=-2*R,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*P,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*O,e[11]=0,e[12]=(t+l)*R,e[13]=(x+E)*P,e[14]=(M+S)*O,e[15]=1,e}function Fi(e,t,l,E){var x,S,M,R,P,O,I,z,N,B,U=t[0],k=t[1],C=t[2],X=E[0],te=E[1],K=E[2],ee=l[0],ne=l[1],re=l[2];return Math.abs(U-ee)<s&&Math.abs(k-ne)<s&&Math.abs(C-re)<s?At(e):(I=U-ee,z=k-ne,N=C-re,x=te*(N*=B=1/Math.hypot(I,z,N))-K*(z*=B),S=K*(I*=B)-X*N,M=X*z-te*I,(B=Math.hypot(x,S,M))?(x*=B=1/B,S*=B,M*=B):(x=0,S=0,M=0),R=z*M-N*S,P=N*x-I*M,O=I*S-z*x,(B=Math.hypot(R,P,O))?(R*=B=1/B,P*=B,O*=B):(R=0,P=0,O=0),e[0]=x,e[1]=R,e[2]=I,e[3]=0,e[4]=S,e[5]=P,e[6]=z,e[7]=0,e[8]=M,e[9]=O,e[10]=N,e[11]=0,e[12]=-(x*U+S*k+M*C),e[13]=-(R*U+P*k+O*C),e[14]=-(I*U+z*k+N*C),e[15]=1,e)}function Ii(e,t,l,E){var x=t[0],S=t[1],M=t[2],R=E[0],P=E[1],O=E[2],I=x-l[0],z=S-l[1],N=M-l[2],B=I*I+z*z+N*N;B>0&&(I*=B=1/Math.sqrt(B),z*=B,N*=B);var U=P*N-O*z,k=O*I-R*N,C=R*z-P*I;return(B=U*U+k*k+C*C)>0&&(U*=B=1/Math.sqrt(B),k*=B,C*=B),e[0]=U,e[1]=k,e[2]=C,e[3]=0,e[4]=z*C-N*k,e[5]=N*U-I*C,e[6]=I*k-z*U,e[7]=0,e[8]=I,e[9]=z,e[10]=N,e[11]=0,e[12]=x,e[13]=S,e[14]=M,e[15]=1,e}function zi(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ni(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Bi(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e[3]=t[3]+l[3],e[4]=t[4]+l[4],e[5]=t[5]+l[5],e[6]=t[6]+l[6],e[7]=t[7]+l[7],e[8]=t[8]+l[8],e[9]=t[9]+l[9],e[10]=t[10]+l[10],e[11]=t[11]+l[11],e[12]=t[12]+l[12],e[13]=t[13]+l[13],e[14]=t[14]+l[14],e[15]=t[15]+l[15],e}function wt(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e[2]=t[2]-l[2],e[3]=t[3]-l[3],e[4]=t[4]-l[4],e[5]=t[5]-l[5],e[6]=t[6]-l[6],e[7]=t[7]-l[7],e[8]=t[8]-l[8],e[9]=t[9]-l[9],e[10]=t[10]-l[10],e[11]=t[11]-l[11],e[12]=t[12]-l[12],e[13]=t[13]-l[13],e[14]=t[14]-l[14],e[15]=t[15]-l[15],e}function Ci(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e[4]=t[4]*l,e[5]=t[5]*l,e[6]=t[6]*l,e[7]=t[7]*l,e[8]=t[8]*l,e[9]=t[9]*l,e[10]=t[10]*l,e[11]=t[11]*l,e[12]=t[12]*l,e[13]=t[13]*l,e[14]=t[14]*l,e[15]=t[15]*l,e}function Di(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e[2]=t[2]+l[2]*E,e[3]=t[3]+l[3]*E,e[4]=t[4]+l[4]*E,e[5]=t[5]+l[5]*E,e[6]=t[6]+l[6]*E,e[7]=t[7]+l[7]*E,e[8]=t[8]+l[8]*E,e[9]=t[9]+l[9]*E,e[10]=t[10]+l[10]*E,e[11]=t[11]+l[11]*E,e[12]=t[12]+l[12]*E,e[13]=t[13]+l[13]*E,e[14]=t[14]+l[14]*E,e[15]=t[15]+l[15]*E,e}function Gi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ji(e,t){var l=e[0],E=e[1],x=e[2],S=e[3],M=e[4],R=e[5],P=e[6],O=e[7],I=e[8],z=e[9],N=e[10],B=e[11],U=e[12],k=e[13],C=e[14],X=e[15],te=t[0],K=t[1],ee=t[2],ne=t[3],re=t[4],fe=t[5],ue=t[6],de=t[7],le=t[8],pe=t[9],oe=t[10],ce=t[11],ie=t[12],Re=t[13],ke=t[14],Ve=t[15];return Math.abs(l-te)<=s*Math.max(1,Math.abs(l),Math.abs(te))&&Math.abs(E-K)<=s*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(x-ee)<=s*Math.max(1,Math.abs(x),Math.abs(ee))&&Math.abs(S-ne)<=s*Math.max(1,Math.abs(S),Math.abs(ne))&&Math.abs(M-re)<=s*Math.max(1,Math.abs(M),Math.abs(re))&&Math.abs(R-fe)<=s*Math.max(1,Math.abs(R),Math.abs(fe))&&Math.abs(P-ue)<=s*Math.max(1,Math.abs(P),Math.abs(ue))&&Math.abs(O-de)<=s*Math.max(1,Math.abs(O),Math.abs(de))&&Math.abs(I-le)<=s*Math.max(1,Math.abs(I),Math.abs(le))&&Math.abs(z-pe)<=s*Math.max(1,Math.abs(z),Math.abs(pe))&&Math.abs(N-oe)<=s*Math.max(1,Math.abs(N),Math.abs(oe))&&Math.abs(B-ce)<=s*Math.max(1,Math.abs(B),Math.abs(ce))&&Math.abs(U-ie)<=s*Math.max(1,Math.abs(U),Math.abs(ie))&&Math.abs(k-Re)<=s*Math.max(1,Math.abs(k),Math.abs(Re))&&Math.abs(C-ke)<=s*Math.max(1,Math.abs(C),Math.abs(ke))&&Math.abs(X-Ve)<=s*Math.max(1,Math.abs(X),Math.abs(Ve))}var Ui=St,ki=wt;function ht(){var e=new a(3);return a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Vi(e){var t=new a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ot(e){var t=e[0],l=e[1],E=e[2];return Math.hypot(t,l,E)}function lt(e,t,l){var E=new a(3);return E[0]=e,E[1]=t,E[2]=l,E}function Xi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Wi(e,t,l,E){return e[0]=t,e[1]=l,e[2]=E,e}function Hi(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e}function Ft(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e[2]=t[2]-l[2],e}function It(e,t,l){return e[0]=t[0]*l[0],e[1]=t[1]*l[1],e[2]=t[2]*l[2],e}function zt(e,t,l){return e[0]=t[0]/l[0],e[1]=t[1]/l[1],e[2]=t[2]/l[2],e}function $i(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function qi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Yi(e,t,l){return e[0]=Math.min(t[0],l[0]),e[1]=Math.min(t[1],l[1]),e[2]=Math.min(t[2],l[2]),e}function Zi(e,t,l){return e[0]=Math.max(t[0],l[0]),e[1]=Math.max(t[1],l[1]),e[2]=Math.max(t[2],l[2]),e}function Ki(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Ji(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e}function Qi(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e[2]=t[2]+l[2]*E,e}function Nt(e,t){var l=t[0]-e[0],E=t[1]-e[1],x=t[2]-e[2];return Math.hypot(l,E,x)}function Bt(e,t){var l=t[0]-e[0],E=t[1]-e[1],x=t[2]-e[2];return l*l+E*E+x*x}function Ct(e){var t=e[0],l=e[1],E=e[2];return t*t+l*l+E*E}function en(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function tn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Dt(e,t){var l=t[0],E=t[1],x=t[2],S=l*l+E*E+x*x;return S>0&&(S=1/Math.sqrt(S)),e[0]=t[0]*S,e[1]=t[1]*S,e[2]=t[2]*S,e}function ut(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qe(e,t,l){var E=t[0],x=t[1],S=t[2],M=l[0],R=l[1],P=l[2];return e[0]=x*P-S*R,e[1]=S*M-E*P,e[2]=E*R-x*M,e}function rn(e,t,l,E){var x=t[0],S=t[1],M=t[2];return e[0]=x+E*(l[0]-x),e[1]=S+E*(l[1]-S),e[2]=M+E*(l[2]-M),e}function nn(e,t,l,E,x,S){var M=S*S,R=M*(2*S-3)+1,P=M*(S-2)+S,O=M*(S-1),I=M*(3-2*S);return e[0]=t[0]*R+l[0]*P+E[0]*O+x[0]*I,e[1]=t[1]*R+l[1]*P+E[1]*O+x[1]*I,e[2]=t[2]*R+l[2]*P+E[2]*O+x[2]*I,e}function sn(e,t,l,E,x,S){var M=1-S,R=M*M,P=S*S,O=R*M,I=3*S*R,z=3*P*M,N=P*S;return e[0]=t[0]*O+l[0]*I+E[0]*z+x[0]*N,e[1]=t[1]*O+l[1]*I+E[1]*z+x[1]*N,e[2]=t[2]*O+l[2]*I+E[2]*z+x[2]*N,e}function an(e,t){t=t||1;var l=2*h()*Math.PI,E=2*h()-1,x=Math.sqrt(1-E*E)*t;return e[0]=Math.cos(l)*x,e[1]=Math.sin(l)*x,e[2]=E*t,e}function on(e,t,l){var E=t[0],x=t[1],S=t[2],M=l[3]*E+l[7]*x+l[11]*S+l[15];return M=M||1,e[0]=(l[0]*E+l[4]*x+l[8]*S+l[12])/M,e[1]=(l[1]*E+l[5]*x+l[9]*S+l[13])/M,e[2]=(l[2]*E+l[6]*x+l[10]*S+l[14])/M,e}function cn(e,t,l){var E=t[0],x=t[1],S=t[2];return e[0]=E*l[0]+x*l[3]+S*l[6],e[1]=E*l[1]+x*l[4]+S*l[7],e[2]=E*l[2]+x*l[5]+S*l[8],e}function hn(e,t,l){var E=l[0],x=l[1],S=l[2],M=l[3],R=t[0],P=t[1],O=t[2],I=x*O-S*P,z=S*R-E*O,N=E*P-x*R,B=x*N-S*z,U=S*I-E*N,k=E*z-x*I,C=2*M;return I*=C,z*=C,N*=C,B*=2,U*=2,k*=2,e[0]=R+I+B,e[1]=P+z+U,e[2]=O+N+k,e}function ln(e,t,l,E){var x=[],S=[];return x[0]=t[0]-l[0],x[1]=t[1]-l[1],x[2]=t[2]-l[2],S[0]=x[0],S[1]=x[1]*Math.cos(E)-x[2]*Math.sin(E),S[2]=x[1]*Math.sin(E)+x[2]*Math.cos(E),e[0]=S[0]+l[0],e[1]=S[1]+l[1],e[2]=S[2]+l[2],e}function un(e,t,l,E){var x=[],S=[];return x[0]=t[0]-l[0],x[1]=t[1]-l[1],x[2]=t[2]-l[2],S[0]=x[2]*Math.sin(E)+x[0]*Math.cos(E),S[1]=x[1],S[2]=x[2]*Math.cos(E)-x[0]*Math.sin(E),e[0]=S[0]+l[0],e[1]=S[1]+l[1],e[2]=S[2]+l[2],e}function dn(e,t,l,E){var x=[],S=[];return x[0]=t[0]-l[0],x[1]=t[1]-l[1],x[2]=t[2]-l[2],S[0]=x[0]*Math.cos(E)-x[1]*Math.sin(E),S[1]=x[0]*Math.sin(E)+x[1]*Math.cos(E),S[2]=x[2],e[0]=S[0]+l[0],e[1]=S[1]+l[1],e[2]=S[2]+l[2],e}function _n(e,t){var l=e[0],E=e[1],x=e[2],S=t[0],M=t[1],R=t[2],P=Math.sqrt(l*l+E*E+x*x)*Math.sqrt(S*S+M*M+R*R),O=P&&ut(e,t)/P;return Math.acos(Math.min(Math.max(O,-1),1))}function fn(e){return e[0]=0,e[1]=0,e[2]=0,e}function pn(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function mn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function vn(e,t){var l=e[0],E=e[1],x=e[2],S=t[0],M=t[1],R=t[2];return Math.abs(l-S)<=s*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(E-M)<=s*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(x-R)<=s*Math.max(1,Math.abs(x),Math.abs(R))}var Oe,gn=Ft,bn=It,En=zt,yn=Nt,Tn=Bt,Gt=Ot,xn=Ct,An=(Oe=ht(),function(e,t,l,E,x,S){var M,R;for(t||(t=3),l||(l=0),R=E?Math.min(E*t+l,e.length):e.length,M=l;M<R;M+=t)Oe[0]=e[M],Oe[1]=e[M+1],Oe[2]=e[M+2],x(Oe,Oe,S),e[M]=Oe[0],e[M+1]=Oe[1],e[M+2]=Oe[2];return e});function jt(){var e=new a(4);return a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ut(e){var t=new a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function kt(e,t,l,E){var x=new a(4);return x[0]=e,x[1]=t,x[2]=l,x[3]=E,x}function Vt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xt(e,t,l,E,x){return e[0]=t,e[1]=l,e[2]=E,e[3]=x,e}function Wt(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e[3]=t[3]+l[3],e}function Ht(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e[2]=t[2]-l[2],e[3]=t[3]-l[3],e}function $t(e,t,l){return e[0]=t[0]*l[0],e[1]=t[1]*l[1],e[2]=t[2]*l[2],e[3]=t[3]*l[3],e}function qt(e,t,l){return e[0]=t[0]/l[0],e[1]=t[1]/l[1],e[2]=t[2]/l[2],e[3]=t[3]/l[3],e}function Sn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Mn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Rn(e,t,l){return e[0]=Math.min(t[0],l[0]),e[1]=Math.min(t[1],l[1]),e[2]=Math.min(t[2],l[2]),e[3]=Math.min(t[3],l[3]),e}function Ln(e,t,l){return e[0]=Math.max(t[0],l[0]),e[1]=Math.max(t[1],l[1]),e[2]=Math.max(t[2],l[2]),e[3]=Math.max(t[3],l[3]),e}function Pn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Yt(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e}function wn(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e[2]=t[2]+l[2]*E,e[3]=t[3]+l[3]*E,e}function Zt(e,t){var l=t[0]-e[0],E=t[1]-e[1],x=t[2]-e[2],S=t[3]-e[3];return Math.hypot(l,E,x,S)}function Kt(e,t){var l=t[0]-e[0],E=t[1]-e[1],x=t[2]-e[2],S=t[3]-e[3];return l*l+E*E+x*x+S*S}function dt(e){var t=e[0],l=e[1],E=e[2],x=e[3];return Math.hypot(t,l,E,x)}function _t(e){var t=e[0],l=e[1],E=e[2],x=e[3];return t*t+l*l+E*E+x*x}function On(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Fn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Jt(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=l*l+E*E+x*x+S*S;return M>0&&(M=1/Math.sqrt(M)),e[0]=l*M,e[1]=E*M,e[2]=x*M,e[3]=S*M,e}function Qt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function In(e,t,l,E){var x=l[0]*E[1]-l[1]*E[0],S=l[0]*E[2]-l[2]*E[0],M=l[0]*E[3]-l[3]*E[0],R=l[1]*E[2]-l[2]*E[1],P=l[1]*E[3]-l[3]*E[1],O=l[2]*E[3]-l[3]*E[2],I=t[0],z=t[1],N=t[2],B=t[3];return e[0]=z*O-N*P+B*R,e[1]=-I*O+N*M-B*S,e[2]=I*P-z*M+B*x,e[3]=-I*R+z*S-N*x,e}function er(e,t,l,E){var x=t[0],S=t[1],M=t[2],R=t[3];return e[0]=x+E*(l[0]-x),e[1]=S+E*(l[1]-S),e[2]=M+E*(l[2]-M),e[3]=R+E*(l[3]-R),e}function zn(e,t){var l,E,x,S,M,R;t=t||1;do M=(l=2*h()-1)*l+(E=2*h()-1)*E;while(M>=1);do R=(x=2*h()-1)*x+(S=2*h()-1)*S;while(R>=1);var P=Math.sqrt((1-M)/R);return e[0]=t*l,e[1]=t*E,e[2]=t*x*P,e[3]=t*S*P,e}function Nn(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3];return e[0]=l[0]*E+l[4]*x+l[8]*S+l[12]*M,e[1]=l[1]*E+l[5]*x+l[9]*S+l[13]*M,e[2]=l[2]*E+l[6]*x+l[10]*S+l[14]*M,e[3]=l[3]*E+l[7]*x+l[11]*S+l[15]*M,e}function Bn(e,t,l){var E=t[0],x=t[1],S=t[2],M=l[0],R=l[1],P=l[2],O=l[3],I=O*E+R*S-P*x,z=O*x+P*E-M*S,N=O*S+M*x-R*E,B=-M*E-R*x-P*S;return e[0]=I*O+B*-M+z*-P-N*-R,e[1]=z*O+B*-R+N*-M-I*-P,e[2]=N*O+B*-P+I*-R-z*-M,e[3]=t[3],e}function Cn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Dn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function tr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function rr(e,t){var l=e[0],E=e[1],x=e[2],S=e[3],M=t[0],R=t[1],P=t[2],O=t[3];return Math.abs(l-M)<=s*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(E-R)<=s*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(x-P)<=s*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(S-O)<=s*Math.max(1,Math.abs(S),Math.abs(O))}var Gn=Ht,jn=$t,Un=qt,kn=Zt,Vn=Kt,Xn=dt,Wn=_t,Hn=function(){var e=jt();return function(t,l,E,x,S,M){var R,P;for(l||(l=4),E||(E=0),P=x?Math.min(x*l+E,t.length):t.length,R=E;R<P;R+=l)e[0]=t[R],e[1]=t[R+1],e[2]=t[R+2],e[3]=t[R+3],S(e,e,M),t[R]=e[0],t[R+1]=e[1],t[R+2]=e[2],t[R+3]=e[3];return t}}();function Ye(){var e=new a(4);return a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function $n(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ir(e,t,l){l*=.5;var E=Math.sin(l);return e[0]=E*t[0],e[1]=E*t[1],e[2]=E*t[2],e[3]=Math.cos(l),e}function qn(e,t){var l=2*Math.acos(t[3]),E=Math.sin(l/2);return E>s?(e[0]=t[0]/E,e[1]=t[1]/E,e[2]=t[2]/E):(e[0]=1,e[1]=0,e[2]=0),l}function Yn(e,t){var l=vt(e,t);return Math.acos(2*l*l-1)}function nr(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=l[0],P=l[1],O=l[2],I=l[3];return e[0]=E*I+M*R+x*O-S*P,e[1]=x*I+M*P+S*R-E*O,e[2]=S*I+M*O+E*P-x*R,e[3]=M*I-E*R-x*P-S*O,e}function sr(e,t,l){l*=.5;var E=t[0],x=t[1],S=t[2],M=t[3],R=Math.sin(l),P=Math.cos(l);return e[0]=E*P+M*R,e[1]=x*P+S*R,e[2]=S*P-x*R,e[3]=M*P-E*R,e}function ar(e,t,l){l*=.5;var E=t[0],x=t[1],S=t[2],M=t[3],R=Math.sin(l),P=Math.cos(l);return e[0]=E*P-S*R,e[1]=x*P+M*R,e[2]=S*P+E*R,e[3]=M*P-x*R,e}function or(e,t,l){l*=.5;var E=t[0],x=t[1],S=t[2],M=t[3],R=Math.sin(l),P=Math.cos(l);return e[0]=E*P+x*R,e[1]=x*P-E*R,e[2]=S*P+M*R,e[3]=M*P-S*R,e}function Zn(e,t){var l=t[0],E=t[1],x=t[2];return e[0]=l,e[1]=E,e[2]=x,e[3]=Math.sqrt(Math.abs(1-l*l-E*E-x*x)),e}function cr(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=Math.sqrt(l*l+E*E+x*x),R=Math.exp(S),P=M>0?R*Math.sin(M)/M:0;return e[0]=l*P,e[1]=E*P,e[2]=x*P,e[3]=R*Math.cos(M),e}function hr(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=Math.sqrt(l*l+E*E+x*x),R=M>0?Math.atan2(M,S)/M:0;return e[0]=l*R,e[1]=E*R,e[2]=x*R,e[3]=.5*Math.log(l*l+E*E+x*x+S*S),e}function Kn(e,t,l){return hr(e,t),_r(e,e,l),cr(e,e),e}function Ze(e,t,l,E){var x,S,M,R,P,O=t[0],I=t[1],z=t[2],N=t[3],B=l[0],U=l[1],k=l[2],C=l[3];return(S=O*B+I*U+z*k+N*C)<0&&(S=-S,B=-B,U=-U,k=-k,C=-C),1-S>s?(x=Math.acos(S),M=Math.sin(x),R=Math.sin((1-E)*x)/M,P=Math.sin(E*x)/M):(R=1-E,P=E),e[0]=R*O+P*B,e[1]=R*I+P*U,e[2]=R*z+P*k,e[3]=R*N+P*C,e}function Jn(e){var t=h(),l=h(),E=h(),x=Math.sqrt(1-t),S=Math.sqrt(t);return e[0]=x*Math.sin(2*Math.PI*l),e[1]=x*Math.cos(2*Math.PI*l),e[2]=S*Math.sin(2*Math.PI*E),e[3]=S*Math.cos(2*Math.PI*E),e}function Qn(e,t){var l=t[0],E=t[1],x=t[2],S=t[3],M=l*l+E*E+x*x+S*S,R=M?1/M:0;return e[0]=-l*R,e[1]=-E*R,e[2]=-x*R,e[3]=S*R,e}function es(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function lr(e,t){var l,E=t[0]+t[4]+t[8];if(E>0)l=Math.sqrt(E+1),e[3]=.5*l,l=.5/l,e[0]=(t[5]-t[7])*l,e[1]=(t[6]-t[2])*l,e[2]=(t[1]-t[3])*l;else{var x=0;t[4]>t[0]&&(x=1),t[8]>t[3*x+x]&&(x=2);var S=(x+1)%3,M=(x+2)%3;l=Math.sqrt(t[3*x+x]-t[3*S+S]-t[3*M+M]+1),e[x]=.5*l,l=.5/l,e[3]=(t[3*S+M]-t[3*M+S])*l,e[S]=(t[3*S+x]+t[3*x+S])*l,e[M]=(t[3*M+x]+t[3*x+M])*l}return e}function ts(e,t,l,E){var x=.5*Math.PI/180;t*=x,l*=x,E*=x;var S=Math.sin(t),M=Math.cos(t),R=Math.sin(l),P=Math.cos(l),O=Math.sin(E),I=Math.cos(E);return e[0]=S*P*I-M*R*O,e[1]=M*R*I+S*P*O,e[2]=M*P*O-S*R*I,e[3]=M*P*I+S*R*O,e}function rs(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Se,ur,dr,ft,pt,Me,is=Ut,ns=kt,mt=Vt,ss=Xt,as=Wt,os=nr,_r=Yt,vt=Qt,cs=er,gt=dt,hs=gt,bt=_t,ls=bt,Et=Jt,us=tr,ds=rr,_s=(Se=ht(),ur=lt(1,0,0),dr=lt(0,1,0),function(e,t,l){var E=ut(t,l);return E<-.999999?(qe(Se,ur,t),Gt(Se)<1e-6&&qe(Se,dr,t),Dt(Se,Se),ir(e,Se,Math.PI),e):E>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(qe(Se,t,l),e[0]=Se[0],e[1]=Se[1],e[2]=Se[2],e[3]=1+E,Et(e,e))}),fs=(ft=Ye(),pt=Ye(),function(e,t,l,E,x,S){return Ze(ft,t,x,S),Ze(pt,l,E,S),Ze(e,ft,pt,2*S*(1-S)),e}),ps=(Me=_e(),function(e,t,l,E){return Me[0]=l[0],Me[3]=l[1],Me[6]=l[2],Me[1]=E[0],Me[4]=E[1],Me[7]=E[2],Me[2]=-t[0],Me[5]=-t[1],Me[8]=-t[2],Et(e,lr(e,Me))});function ms(){var e=new a(8);return a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function vs(e){var t=new a(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function gs(e,t,l,E,x,S,M,R){var P=new a(8);return P[0]=e,P[1]=t,P[2]=l,P[3]=E,P[4]=x,P[5]=S,P[6]=M,P[7]=R,P}function bs(e,t,l,E,x,S,M){var R=new a(8);R[0]=e,R[1]=t,R[2]=l,R[3]=E;var P=.5*x,O=.5*S,I=.5*M;return R[4]=P*E+O*l-I*t,R[5]=O*E+I*e-P*l,R[6]=I*E+P*t-O*e,R[7]=-P*e-O*t-I*l,R}function fr(e,t,l){var E=.5*l[0],x=.5*l[1],S=.5*l[2],M=t[0],R=t[1],P=t[2],O=t[3];return e[0]=M,e[1]=R,e[2]=P,e[3]=O,e[4]=E*O+x*P-S*R,e[5]=x*O+S*M-E*P,e[6]=S*O+E*R-x*M,e[7]=-E*M-x*R-S*P,e}function Es(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function ys(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Ts(e,t){var l=Ye();Pt(l,t);var E=new a(3);return Rt(E,t),fr(e,l,E),e}function pr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function xs(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function As(e,t,l,E,x,S,M,R,P){return e[0]=t,e[1]=l,e[2]=E,e[3]=x,e[4]=S,e[5]=M,e[6]=R,e[7]=P,e}var Ss=mt;function Ms(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Rs=mt;function Ls(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Ps(e,t){var l=t[4],E=t[5],x=t[6],S=t[7],M=-t[0],R=-t[1],P=-t[2],O=t[3];return e[0]=2*(l*O+S*M+E*P-x*R),e[1]=2*(E*O+S*R+x*M-l*P),e[2]=2*(x*O+S*P+l*R-E*M),e}function ws(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=.5*l[0],P=.5*l[1],O=.5*l[2],I=t[4],z=t[5],N=t[6],B=t[7];return e[0]=E,e[1]=x,e[2]=S,e[3]=M,e[4]=M*R+x*O-S*P+I,e[5]=M*P+S*R-E*O+z,e[6]=M*O+E*P-x*R+N,e[7]=-E*R-x*P-S*O+B,e}function Os(e,t,l){var E=-t[0],x=-t[1],S=-t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=R*M+I*E+P*S-O*x,N=P*M+I*x+O*E-R*S,B=O*M+I*S+R*x-P*E,U=I*M-R*E-P*x-O*S;return sr(e,t,l),E=e[0],x=e[1],S=e[2],M=e[3],e[4]=z*M+U*E+N*S-B*x,e[5]=N*M+U*x+B*E-z*S,e[6]=B*M+U*S+z*x-N*E,e[7]=U*M-z*E-N*x-B*S,e}function Fs(e,t,l){var E=-t[0],x=-t[1],S=-t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=R*M+I*E+P*S-O*x,N=P*M+I*x+O*E-R*S,B=O*M+I*S+R*x-P*E,U=I*M-R*E-P*x-O*S;return ar(e,t,l),E=e[0],x=e[1],S=e[2],M=e[3],e[4]=z*M+U*E+N*S-B*x,e[5]=N*M+U*x+B*E-z*S,e[6]=B*M+U*S+z*x-N*E,e[7]=U*M-z*E-N*x-B*S,e}function Is(e,t,l){var E=-t[0],x=-t[1],S=-t[2],M=t[3],R=t[4],P=t[5],O=t[6],I=t[7],z=R*M+I*E+P*S-O*x,N=P*M+I*x+O*E-R*S,B=O*M+I*S+R*x-P*E,U=I*M-R*E-P*x-O*S;return or(e,t,l),E=e[0],x=e[1],S=e[2],M=e[3],e[4]=z*M+U*E+N*S-B*x,e[5]=N*M+U*x+B*E-z*S,e[6]=B*M+U*S+z*x-N*E,e[7]=U*M-z*E-N*x-B*S,e}function zs(e,t,l){var E=l[0],x=l[1],S=l[2],M=l[3],R=t[0],P=t[1],O=t[2],I=t[3];return e[0]=R*M+I*E+P*S-O*x,e[1]=P*M+I*x+O*E-R*S,e[2]=O*M+I*S+R*x-P*E,e[3]=I*M-R*E-P*x-O*S,R=t[4],P=t[5],O=t[6],I=t[7],e[4]=R*M+I*E+P*S-O*x,e[5]=P*M+I*x+O*E-R*S,e[6]=O*M+I*S+R*x-P*E,e[7]=I*M-R*E-P*x-O*S,e}function Ns(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=l[0],P=l[1],O=l[2],I=l[3];return e[0]=E*I+M*R+x*O-S*P,e[1]=x*I+M*P+S*R-E*O,e[2]=S*I+M*O+E*P-x*R,e[3]=M*I-E*R-x*P-S*O,R=l[4],P=l[5],O=l[6],I=l[7],e[4]=E*I+M*R+x*O-S*P,e[5]=x*I+M*P+S*R-E*O,e[6]=S*I+M*O+E*P-x*R,e[7]=M*I-E*R-x*P-S*O,e}function Bs(e,t,l,E){if(Math.abs(E)<s)return pr(e,t);var x=Math.hypot(l[0],l[1],l[2]);E*=.5;var S=Math.sin(E),M=S*l[0]/x,R=S*l[1]/x,P=S*l[2]/x,O=Math.cos(E),I=t[0],z=t[1],N=t[2],B=t[3];e[0]=I*O+B*M+z*P-N*R,e[1]=z*O+B*R+N*M-I*P,e[2]=N*O+B*P+I*R-z*M,e[3]=B*O-I*M-z*R-N*P;var U=t[4],k=t[5],C=t[6],X=t[7];return e[4]=U*O+X*M+k*P-C*R,e[5]=k*O+X*R+C*M-U*P,e[6]=C*O+X*P+U*R-k*M,e[7]=X*O-U*M-k*R-C*P,e}function Cs(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e[2]=t[2]+l[2],e[3]=t[3]+l[3],e[4]=t[4]+l[4],e[5]=t[5]+l[5],e[6]=t[6]+l[6],e[7]=t[7]+l[7],e}function mr(e,t,l){var E=t[0],x=t[1],S=t[2],M=t[3],R=l[4],P=l[5],O=l[6],I=l[7],z=t[4],N=t[5],B=t[6],U=t[7],k=l[0],C=l[1],X=l[2],te=l[3];return e[0]=E*te+M*k+x*X-S*C,e[1]=x*te+M*C+S*k-E*X,e[2]=S*te+M*X+E*C-x*k,e[3]=M*te-E*k-x*C-S*X,e[4]=E*I+M*R+x*O-S*P+z*te+U*k+N*X-B*C,e[5]=x*I+M*P+S*R-E*O+N*te+U*C+B*k-z*X,e[6]=S*I+M*O+E*P-x*R+B*te+U*X+z*C-N*k,e[7]=M*I-E*R-x*P-S*O+U*te-z*k-N*C-B*X,e}var Ds=mr;function Gs(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e[4]=t[4]*l,e[5]=t[5]*l,e[6]=t[6]*l,e[7]=t[7]*l,e}var vr=vt;function js(e,t,l,E){var x=1-E;return vr(t,l)<0&&(E=-E),e[0]=t[0]*x+l[0]*E,e[1]=t[1]*x+l[1]*E,e[2]=t[2]*x+l[2]*E,e[3]=t[3]*x+l[3]*E,e[4]=t[4]*x+l[4]*E,e[5]=t[5]*x+l[5]*E,e[6]=t[6]*x+l[6]*E,e[7]=t[7]*x+l[7]*E,e}function Us(e,t){var l=Ke(t);return e[0]=-t[0]/l,e[1]=-t[1]/l,e[2]=-t[2]/l,e[3]=t[3]/l,e[4]=-t[4]/l,e[5]=-t[5]/l,e[6]=-t[6]/l,e[7]=t[7]/l,e}function ks(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var gr=gt,Vs=gr,Ke=bt,Xs=Ke;function Ws(e,t){var l=Ke(t);if(l>0){l=Math.sqrt(l);var E=t[0]/l,x=t[1]/l,S=t[2]/l,M=t[3]/l,R=t[4],P=t[5],O=t[6],I=t[7],z=E*R+x*P+S*O+M*I;e[0]=E,e[1]=x,e[2]=S,e[3]=M,e[4]=(R-E*z)/l,e[5]=(P-x*z)/l,e[6]=(O-S*z)/l,e[7]=(I-M*z)/l}return e}function Hs(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function $s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function qs(e,t){var l=e[0],E=e[1],x=e[2],S=e[3],M=e[4],R=e[5],P=e[6],O=e[7],I=t[0],z=t[1],N=t[2],B=t[3],U=t[4],k=t[5],C=t[6],X=t[7];return Math.abs(l-I)<=s*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(E-z)<=s*Math.max(1,Math.abs(E),Math.abs(z))&&Math.abs(x-N)<=s*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(S-B)<=s*Math.max(1,Math.abs(S),Math.abs(B))&&Math.abs(M-U)<=s*Math.max(1,Math.abs(M),Math.abs(U))&&Math.abs(R-k)<=s*Math.max(1,Math.abs(R),Math.abs(k))&&Math.abs(P-C)<=s*Math.max(1,Math.abs(P),Math.abs(C))&&Math.abs(O-X)<=s*Math.max(1,Math.abs(O),Math.abs(X))}function br(){var e=new a(2);return a!=Float32Array&&(e[0]=0,e[1]=0),e}function Ys(e){var t=new a(2);return t[0]=e[0],t[1]=e[1],t}function Zs(e,t){var l=new a(2);return l[0]=e,l[1]=t,l}function Ks(e,t){return e[0]=t[0],e[1]=t[1],e}function Js(e,t,l){return e[0]=t,e[1]=l,e}function Qs(e,t,l){return e[0]=t[0]+l[0],e[1]=t[1]+l[1],e}function Er(e,t,l){return e[0]=t[0]-l[0],e[1]=t[1]-l[1],e}function yr(e,t,l){return e[0]=t[0]*l[0],e[1]=t[1]*l[1],e}function Tr(e,t,l){return e[0]=t[0]/l[0],e[1]=t[1]/l[1],e}function ea(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ta(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ra(e,t,l){return e[0]=Math.min(t[0],l[0]),e[1]=Math.min(t[1],l[1]),e}function ia(e,t,l){return e[0]=Math.max(t[0],l[0]),e[1]=Math.max(t[1],l[1]),e}function na(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function sa(e,t,l){return e[0]=t[0]*l,e[1]=t[1]*l,e}function aa(e,t,l,E){return e[0]=t[0]+l[0]*E,e[1]=t[1]+l[1]*E,e}function xr(e,t){var l=t[0]-e[0],E=t[1]-e[1];return Math.hypot(l,E)}function Ar(e,t){var l=t[0]-e[0],E=t[1]-e[1];return l*l+E*E}function Sr(e){var t=e[0],l=e[1];return Math.hypot(t,l)}function Mr(e){var t=e[0],l=e[1];return t*t+l*l}function oa(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ca(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function ha(e,t){var l=t[0],E=t[1],x=l*l+E*E;return x>0&&(x=1/Math.sqrt(x)),e[0]=t[0]*x,e[1]=t[1]*x,e}function la(e,t){return e[0]*t[0]+e[1]*t[1]}function ua(e,t,l){var E=t[0]*l[1]-t[1]*l[0];return e[0]=e[1]=0,e[2]=E,e}function da(e,t,l,E){var x=t[0],S=t[1];return e[0]=x+E*(l[0]-x),e[1]=S+E*(l[1]-S),e}function _a(e,t){t=t||1;var l=2*h()*Math.PI;return e[0]=Math.cos(l)*t,e[1]=Math.sin(l)*t,e}function fa(e,t,l){var E=t[0],x=t[1];return e[0]=l[0]*E+l[2]*x,e[1]=l[1]*E+l[3]*x,e}function pa(e,t,l){var E=t[0],x=t[1];return e[0]=l[0]*E+l[2]*x+l[4],e[1]=l[1]*E+l[3]*x+l[5],e}function ma(e,t,l){var E=t[0],x=t[1];return e[0]=l[0]*E+l[3]*x+l[6],e[1]=l[1]*E+l[4]*x+l[7],e}function va(e,t,l){var E=t[0],x=t[1];return e[0]=l[0]*E+l[4]*x+l[12],e[1]=l[1]*E+l[5]*x+l[13],e}function ga(e,t,l,E){var x=t[0]-l[0],S=t[1]-l[1],M=Math.sin(E),R=Math.cos(E);return e[0]=x*R-S*M+l[0],e[1]=x*M+S*R+l[1],e}function ba(e,t){var l=e[0],E=e[1],x=t[0],S=t[1],M=Math.sqrt(l*l+E*E)*Math.sqrt(x*x+S*S),R=M&&(l*x+E*S)/M;return Math.acos(Math.min(Math.max(R,-1),1))}function Ea(e){return e[0]=0,e[1]=0,e}function ya(e){return"vec2("+e[0]+", "+e[1]+")"}function Ta(e,t){return e[0]===t[0]&&e[1]===t[1]}function xa(e,t){var l=e[0],E=e[1],x=t[0],S=t[1];return Math.abs(l-x)<=s*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(E-S)<=s*Math.max(1,Math.abs(E),Math.abs(S))}var Aa=Sr,Sa=Er,Ma=yr,Ra=Tr,La=xr,Pa=Ar,wa=Mr,Oa=function(){var e=br();return function(t,l,E,x,S,M){var R,P;for(l||(l=2),E||(E=0),P=x?Math.min(x*l+E,t.length):t.length,R=E;R<P;R+=l)e[0]=t[R],e[1]=t[R+1],S(e,e,M),t[R]=e[0],t[R+1]=e[1];return t}}()},3041:F=>{F.exports=function(p){var v={};function d(u){if(v[u])return v[u].exports;var b=v[u]={i:u,l:!1,exports:{}};return p[u].call(b.exports,b,b.exports,d),b.l=!0,b.exports}return d.m=p,d.c=v,d.d=function(u,b,m){d.o(u,b)||Object.defineProperty(u,b,{enumerable:!0,get:m})},d.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},d.t=function(u,b){if(1&b&&(u=d(u)),8&b||4&b&&typeof u=="object"&&u&&u.__esModule)return u;var m=Object.create(null);if(d.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:u}),2&b&&typeof u!="string")for(var f in u)d.d(m,f,function(o){return u[o]}.bind(null,f));return m},d.n=function(u){var b=u&&u.__esModule?function(){return u.default}:function(){return u};return d.d(b,"a",b),b},d.o=function(u,b){return Object.prototype.hasOwnProperty.call(u,b)},d.p="",d(d.s=7)}([function(p,v,d){Object.defineProperty(v,"__esModule",{value:!0}),v.LoadingManager=class{constructor(){this.urlModifier=void 0,this.onStart=void 0,this.onProgress=void 0,this.onLoad=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0}itemStart(u){this.itemsTotal++,!this.isLoading&&this.onStart&&this.onStart(u,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(u){this.itemsLoaded++,this.onProgress&&this.onProgress(u,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,this.onLoad&&this.onLoad())}itemError(u){this.onError&&this.onError(u)}resolveURL(u){return this.urlModifier?this.urlModifier(u):u}}},function(p,v,d){var u=this&&this.__awaiter||function(n,i,c,s){return new(c||(c=Promise))(function(a,h){function g(y){try{T(s.next(y))}catch(A){h(A)}}function _(y){try{T(s.throw(y))}catch(A){h(A)}}function T(y){y.done?a(y.value):new c(function(A){A(y.value)}).then(g,_)}T((s=s.apply(n,i||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});const b=d(3),m=d(0);v.GLTF_COMPONENT_TYPE_ARRAYS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},v.GLTF_ELEMENTS_PER_TYPE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},v.GltfAsset=class{constructor(n,i,c,s=new m.LoadingManager){this.gltf=n,this.glbData=c,this.bufferData=new f(this,i,s),this.imageData=new o(this,i,s)}bufferViewData(n){return u(this,void 0,void 0,function*(){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const i=this.gltf.bufferViews[n],c=yield this.bufferData.get(i.buffer),s=i.byteLength||0,a=i.byteOffset||0,h=c.buffer,g=c.byteOffset;return new Uint8Array(h,g+a,s)})}accessorData(n){return u(this,void 0,void 0,function*(){if(!this.gltf.accessors)throw new Error("No accessors views found.");const i=this.gltf.accessors[n],c=v.GLTF_ELEMENTS_PER_TYPE[i.type];let s;if(i.bufferView!==void 0)s=yield this.bufferViewData(i.bufferView);else{const a=v.GLTF_COMPONENT_TYPE_ARRAYS[i.componentType].BYTES_PER_ELEMENT*c*i.count;s=new Uint8Array(a)}if(i.sparse){const{count:a,indices:h,values:g}=i.sparse;let _=v.GLTF_COMPONENT_TYPE_ARRAYS[h.componentType],T=yield this.bufferViewData(h.bufferView);const y=new _(T.buffer,T.byteOffset+(h.byteOffset||0),a);_=v.GLTF_COMPONENT_TYPE_ARRAYS[i.componentType],T=yield this.bufferViewData(g.bufferView);const A=new _((yield this.bufferViewData(g.bufferView)).buffer,T.byteOffset+(g.byteOffset||0),a*c);i.bufferView&&(s=new Uint8Array(s));const w=new v.GLTF_COMPONENT_TYPE_ARRAYS[i.componentType](s.buffer);for(let L=0;L<a;L++)for(let D=0;D<c;D++)w[c*y[L]+D]=A[c*L+D]}return s})}preFetchAll(){return u(this,void 0,void 0,function*(){return Promise.all([this.bufferData.preFetchAll(),this.imageData.preFetchAll()])})}};class f{constructor(i,c,s){this.bufferCache=[],this.asset=i,this.baseUri=c,this.manager=s,this.loader=new b.FileLoader(s),this.loader.responseType="arraybuffer"}get(i){return u(this,void 0,void 0,function*(){if(this.bufferCache[i]!==void 0)return this.bufferCache[i];const c=this.asset.gltf;if(!c.buffers)throw new Error("No buffers found.");const s=c.buffers[i];if(s.uri===void 0){if(i!==0)throw new Error("GLB container is required to be the first buffer");if(this.asset.glbData===void 0)throw new Error("invalid gltf: buffer has no uri nor is there a GLB buffer");return this.asset.glbData.binaryChunk}const a=r(s.uri,this.baseUri),h=yield this.loader.load(a),g=new Uint8Array(h);return this.bufferCache[i]=g,g})}preFetchAll(){return u(this,void 0,void 0,function*(){const i=this.asset.gltf.buffers;return i?Promise.all(i.map((c,s)=>this.get(s))):[]})}}v.BufferData=f;class o{constructor(i,c,s){this.crossOrigin="anonymous",this.imageCache=[],this.asset=i,this.baseUri=c,this.manager=s}get(i){return u(this,void 0,void 0,function*(){if(this.imageCache[i]!==void 0)return this.imageCache[i];const c=this.asset.gltf;if(!c.images)throw new Error("No images found.");const s=c.images[i];let a,h=!1;if(s.bufferView!==void 0){const _=yield this.asset.bufferViewData(s.bufferView);h=!0;const T=new Blob([_],{type:s.mimeType});a=URL.createObjectURL(T)}else{if(s.uri===void 0)throw new Error("Invalid glTF: image must either have a `uri` or a `bufferView`");a=this.manager.resolveURL(r(s.uri,this.baseUri))}const g=new Image;return g.crossOrigin=this.crossOrigin,new Promise((_,T)=>{g.onerror=()=>{T(`Failed to load ${a}`),this.manager.itemEnd(a),this.manager.itemError(a)},g.onload=()=>{h&&URL.revokeObjectURL(a),this.imageCache[i]=g,_(g),this.manager.itemEnd(a)},g.src=a,this.manager.itemStart(a)})})}preFetchAll(){return u(this,void 0,void 0,function*(){const i=this.asset.gltf.images;return i?Promise.all(i.map((c,s)=>this.get(s))):[]})}}function r(n,i){return typeof n!="string"||n===""?"":/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:i+n}v.ImageData=o,v.resolveURL=r},function(p,v,d){Object.defineProperty(v,"__esModule",{value:!0}),v.LoaderUtils=class{static decodeText(u){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(u);let b="";for(const m of u)b+=String.fromCharCode(m);return decodeURIComponent(escape(b))}static extractUrlBase(u){const b=u.split("/");return b.length===1?"./":(b.pop(),b.join("/")+"/")}}},function(p,v,d){Object.defineProperty(v,"__esModule",{value:!0}),v.FileLoader=class{constructor(u){this.runningRequests={},this.manager=u}load(u,b){if(this.path!==void 0&&(u=this.path+u),u=this.manager.resolveURL(u),this.runningRequests[u])return this.runningRequests[u];const m=new Promise((f,o)=>{const r=new XMLHttpRequest;r.open("GET",u,!0);const n=this;r.onload=function(i){const c=this.response;this.status===0?(console.warn("FileLoader: HTTP Status 0 received."),f(c),n.manager.itemEnd(u)):this.status===200?(f(c),n.manager.itemEnd(u)):(o({url:u,status:this.status,statusText:r.statusText}),n.manager.itemEnd(u),n.manager.itemError(u)),delete n.runningRequests[u]},r.onprogress=i=>{b&&b(i)},r.onerror=function(i){o({url:u,status:this.status,statusText:r.statusText}),n.manager.itemEnd(u),n.manager.itemError(u),delete n.runningRequests[u]},this.responseType&&(r.responseType=this.responseType),this.withCredentials&&(r.withCredentials=this.withCredentials),this.mimeType&&r.overrideMimeType&&r.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const i in this.requestHeaders)r.setRequestHeader(i,this.requestHeaders[i]);r.send(null),this.manager.itemStart(u)});return this.runningRequests[u]=m,m}setRequestHeader(u,b){return this.requestHeaders[u]=b,this}}},function(p,v,d){Object.defineProperty(v,"__esModule",{value:!0})},function(p,v,d){Object.defineProperty(v,"__esModule",{value:!0});const u=d(2);v.BINARY_HEADER_MAGIC="glTF",v.GLTFBinaryData=class{constructor(b){const m=new DataView(b,0,12),f=u.LoaderUtils.decodeText(new Uint8Array(b,0,4)),o=m.getUint32(4,!0);if(m.getUint32(8,!0),f!==v.BINARY_HEADER_MAGIC)throw new Error("Unsupported glTF-Binary header.");if(o<2)throw new Error("Unsupported legacy binary file detected.");const r=new DataView(b,12);let n=0;for(;n<r.byteLength;){const i=r.getUint32(n,!0);n+=4;const c=r.getUint32(n,!0);if(n+=4,c===1313821514){const s=new Uint8Array(b,12+n,i);this.json=u.LoaderUtils.decodeText(s)}else if(c===5130562){const s=12+n;this.binaryChunk=new Uint8Array(b,s,i)}n+=i}if(this.json===null)throw new Error("glTF-Binary: JSON content not found.")}}},function(p,v,d){var u=this&&this.__awaiter||function(c,s,a,h){return new(a||(a=Promise))(function(g,_){function T(w){try{A(h.next(w))}catch(L){_(L)}}function y(w){try{A(h.throw(w))}catch(L){_(L)}}function A(w){w.done?g(w.value):new a(function(L){L(w.value)}).then(T,y)}A((h=h.apply(c,s||[])).next())})};function b(c){for(var s in c)v.hasOwnProperty(s)||(v[s]=c[s])}Object.defineProperty(v,"__esModule",{value:!0});const m=d(3),f=d(5),o=d(1),r=d(2),n=d(0),i=d(4);v.gltf=i,b(d(1)),b(d(0)),v.GltfLoader=class{constructor(c){this.manager=c||new n.LoadingManager}load(c,s){return u(this,void 0,void 0,function*(){const a=r.LoaderUtils.extractUrlBase(c),h=new m.FileLoader(this.manager);h.responseType="arraybuffer";const g=yield h.load(c,s);return yield this.parse(g,a)})}loadFromFiles(c){return u(this,void 0,void 0,function*(){let s,a;for(const[y,A]of c)A.name.match(/\.(gltf|glb)$/)&&(s=A,a=y.replace(A.name,""));if(!s)throw new Error("No .gltf or .glb asset found.");const h=typeof s=="string"?s:URL.createObjectURL(s),g=r.LoaderUtils.extractUrlBase(h),_=[];this.manager.urlModifier=y=>{const A=a+y.replace(g,"").replace(/^(\.?\/)/,"");if(c.has(A)){const w=c.get(A),L=URL.createObjectURL(w);return _.push(L),L}return y};const T=yield this.load(h);return yield T.preFetchAll(),URL.revokeObjectURL(h),_.forEach(URL.revokeObjectURL),T})}parse(c,s){return u(this,void 0,void 0,function*(){let a,h;a=typeof c=="string"?c:r.LoaderUtils.decodeText(new Uint8Array(c,0,4))===f.BINARY_HEADER_MAGIC?(h=new f.GLTFBinaryData(c)).json:r.LoaderUtils.decodeText(new Uint8Array(c));const g=JSON.parse(a);if(g.asset===void 0||g.asset.version[0]<2)throw new Error("Unsupported asset. glTF versions >=2.0 are supported.");return new o.GltfAsset(g,s,h,this.manager)})}}},function(p,v,d){p.exports=d(6)}])},9609:(F,p,v)=>{var d=v(3533),u=d.ValidatorResult,b=d.SchemaError,m={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0}},f=m.validators={};function o(s,a,h,g,_){var T=a.throwError,y=a.throwAll;a.throwError=!1,a.throwAll=!1;var A=this.validateSchema(s,_,a,h);return a.throwError=T,a.throwAll=y,!A.valid&&g instanceof Function&&g(A),A.valid}function r(s,a){if(Object.hasOwnProperty.call(s,a))return s[a];if(a in s){for(;s=Object.getPrototypeOf(s);)if(Object.propertyIsEnumerable.call(s,a))return s[a]}}function n(s,a,h,g,_,T){if(this.types.object(s)&&(!a.properties||a.properties[_]===void 0))if(a.additionalProperties===!1)T.addError({name:"additionalProperties",argument:_,message:"is not allowed to have the additional property "+JSON.stringify(_)});else{var y=a.additionalProperties||{};typeof h.preValidateProperty=="function"&&h.preValidateProperty(s,_,y,h,g);var A=this.validateSchema(s[_],y,h,g.makeChild(y,_));A.instance!==T.instance[_]&&(T.instance[_]=A.instance),T.importErrors(A)}}f.type=function(s,a,h,g){if(s===void 0)return null;var _=new u(s,a,h,g),T=Array.isArray(a.type)?a.type:[a.type];if(!T.some(this.testType.bind(this,s,a,h,g))){var y=T.map(function(A){if(A){var w=A.$id||A.id;return w?"<"+w+">":A+""}});_.addError({name:"type",argument:y,message:"is not of a type(s) "+y})}return _},f.anyOf=function(s,a,h,g){if(s===void 0)return null;var _=new u(s,a,h,g),T=new u(s,a,h,g);if(!Array.isArray(a.anyOf))throw new b("anyOf must be an array");if(!a.anyOf.some(o.bind(this,s,h,g,function(A){T.importErrors(A)}))){var y=a.anyOf.map(function(A,w){var L=A.$id||A.id;return L?"<"+L+">":A.title&&JSON.stringify(A.title)||A.$ref&&"<"+A.$ref+">"||"[subschema "+w+"]"});h.nestedErrors&&_.importErrors(T),_.addError({name:"anyOf",argument:y,message:"is not any of "+y.join(",")})}return _},f.allOf=function(s,a,h,g){if(s===void 0)return null;if(!Array.isArray(a.allOf))throw new b("allOf must be an array");var _=new u(s,a,h,g),T=this;return a.allOf.forEach(function(y,A){var w=T.validateSchema(s,y,h,g);if(!w.valid){var L=y.$id||y.id||y.title&&JSON.stringify(y.title)||y.$ref&&"<"+y.$ref+">"||"[subschema "+A+"]";_.addError({name:"allOf",argument:{id:L,length:w.errors.length,valid:w},message:"does not match allOf schema "+L+" with "+w.errors.length+" error[s]:"}),_.importErrors(w)}}),_},f.oneOf=function(s,a,h,g){if(s===void 0)return null;if(!Array.isArray(a.oneOf))throw new b("oneOf must be an array");var _=new u(s,a,h,g),T=new u(s,a,h,g),y=a.oneOf.filter(o.bind(this,s,h,g,function(w){T.importErrors(w)})).length,A=a.oneOf.map(function(w,L){return w.$id||w.id||w.title&&JSON.stringify(w.title)||w.$ref&&"<"+w.$ref+">"||"[subschema "+L+"]"});return y!==1&&(h.nestedErrors&&_.importErrors(T),_.addError({name:"oneOf",argument:A,message:"is not exactly one from "+A.join(",")})),_},f.if=function(s,a,h,g){if(s===void 0)return null;if(!d.isSchema(a.if))throw new Error('Expected "if" keyword to be a schema');var _,T=o.call(this,s,h,g,null,a.if),y=new u(s,a,h,g);if(T){if(a.then===void 0)return;if(!d.isSchema(a.then))throw new Error('Expected "then" keyword to be a schema');_=this.validateSchema(s,a.then,h,g.makeChild(a.then)),y.importErrors(_)}else{if(a.else===void 0)return;if(!d.isSchema(a.else))throw new Error('Expected "else" keyword to be a schema');_=this.validateSchema(s,a.else,h,g.makeChild(a.else)),y.importErrors(_)}return y},f.propertyNames=function(s,a,h,g){if(this.types.object(s)){var _=new u(s,a,h,g),T=a.propertyNames!==void 0?a.propertyNames:{};if(!d.isSchema(T))throw new b('Expected "propertyNames" to be a schema (object or boolean)');for(var y in s)if(r(s,y)!==void 0){var A=this.validateSchema(y,T,h,g.makeChild(T));_.importErrors(A)}return _}},f.properties=function(s,a,h,g){if(this.types.object(s)){var _=new u(s,a,h,g),T=a.properties||{};for(var y in T){var A=T[y];if(A!==void 0){if(A===null)throw new b('Unexpected null, expected schema in "properties"');typeof h.preValidateProperty=="function"&&h.preValidateProperty(s,y,A,h,g);var w=r(s,y),L=this.validateSchema(w,A,h,g.makeChild(A,y));L.instance!==_.instance[y]&&(_.instance[y]=L.instance),_.importErrors(L)}}return _}},f.patternProperties=function(s,a,h,g){if(this.types.object(s)){var _=new u(s,a,h,g),T=a.patternProperties||{};for(var y in s){var A=!0;for(var w in T){var L=T[w];if(L!==void 0){if(L===null)throw new b('Unexpected null, expected schema in "patternProperties"');try{var D=new RegExp(w,"u")}catch{D=new RegExp(w)}if(D.test(y)){A=!1,typeof h.preValidateProperty=="function"&&h.preValidateProperty(s,y,L,h,g);var j=this.validateSchema(s[y],L,h,g.makeChild(L,y));j.instance!==_.instance[y]&&(_.instance[y]=j.instance),_.importErrors(j)}}}A&&n.call(this,s,a,h,g,y,_)}return _}},f.additionalProperties=function(s,a,h,g){if(this.types.object(s)){if(a.patternProperties)return null;var _=new u(s,a,h,g);for(var T in s)n.call(this,s,a,h,g,T,_);return _}},f.minProperties=function(s,a,h,g){if(this.types.object(s)){var _=new u(s,a,h,g);return Object.keys(s).length>=a.minProperties||_.addError({name:"minProperties",argument:a.minProperties,message:"does not meet minimum property length of "+a.minProperties}),_}},f.maxProperties=function(s,a,h,g){if(this.types.object(s)){var _=new u(s,a,h,g);return Object.keys(s).length<=a.maxProperties||_.addError({name:"maxProperties",argument:a.maxProperties,message:"does not meet maximum property length of "+a.maxProperties}),_}},f.items=function(s,a,h,g){var _=this;if(this.types.array(s)&&a.items){var T=new u(s,a,h,g);return s.every(function(y,A){var w=Array.isArray(a.items)?a.items[A]||a.additionalItems:a.items;if(w===void 0)return!0;if(w===!1)return T.addError({name:"items",message:"additionalItems not permitted"}),!1;var L=_.validateSchema(y,w,h,g.makeChild(w,A));return L.instance!==T.instance[A]&&(T.instance[A]=L.instance),T.importErrors(L),!0}),T}},f.minimum=function(s,a,h,g){if(this.types.number(s)){var _=new u(s,a,h,g);return a.exclusiveMinimum&&a.exclusiveMinimum===!0?s>a.minimum||_.addError({name:"minimum",argument:a.minimum,message:"must be greater than "+a.minimum}):s>=a.minimum||_.addError({name:"minimum",argument:a.minimum,message:"must be greater than or equal to "+a.minimum}),_}},f.maximum=function(s,a,h,g){if(this.types.number(s)){var _=new u(s,a,h,g);return a.exclusiveMaximum&&a.exclusiveMaximum===!0?s<a.maximum||_.addError({name:"maximum",argument:a.maximum,message:"must be less than "+a.maximum}):s<=a.maximum||_.addError({name:"maximum",argument:a.maximum,message:"must be less than or equal to "+a.maximum}),_}},f.exclusiveMinimum=function(s,a,h,g){if(typeof a.exclusiveMaximum!="boolean"&&this.types.number(s)){var _=new u(s,a,h,g);return s>a.exclusiveMinimum||_.addError({name:"exclusiveMinimum",argument:a.exclusiveMinimum,message:"must be strictly greater than "+a.exclusiveMinimum}),_}},f.exclusiveMaximum=function(s,a,h,g){if(typeof a.exclusiveMaximum!="boolean"&&this.types.number(s)){var _=new u(s,a,h,g);return s<a.exclusiveMaximum||_.addError({name:"exclusiveMaximum",argument:a.exclusiveMaximum,message:"must be strictly less than "+a.exclusiveMaximum}),_}};var i=function(s,a,h,g,_,T){if(this.types.number(s)){var y=a[_];if(y==0)throw new b(_+" cannot be zero");var A=new u(s,a,h,g),w=d.getDecimalPlaces(s),L=d.getDecimalPlaces(y),D=Math.max(w,L),j=Math.pow(10,D);return Math.round(s*j)%Math.round(y*j)!=0&&A.addError({name:_,argument:y,message:T+JSON.stringify(y)}),A}};function c(s,a,h){var g,_=h.length;for(g=a+1;g<_;g++)if(d.deepCompareStrict(s,h[g]))return!1;return!0}f.multipleOf=function(s,a,h,g){return i.call(this,s,a,h,g,"multipleOf","is not a multiple of (divisible by) ")},f.divisibleBy=function(s,a,h,g){return i.call(this,s,a,h,g,"divisibleBy","is not divisible by (multiple of) ")},f.required=function(s,a,h,g){var _=new u(s,a,h,g);return s===void 0&&a.required===!0?_.addError({name:"required",message:"is required"}):this.types.object(s)&&Array.isArray(a.required)&&a.required.forEach(function(T){r(s,T)===void 0&&_.addError({name:"required",argument:T,message:"requires property "+JSON.stringify(T)})}),_},f.pattern=function(s,a,h,g){if(this.types.string(s)){var _=new u(s,a,h,g),T=a.pattern;try{var y=new RegExp(T,"u")}catch{y=new RegExp(T)}return s.match(y)||_.addError({name:"pattern",argument:a.pattern,message:"does not match pattern "+JSON.stringify(a.pattern.toString())}),_}},f.format=function(s,a,h,g){if(s!==void 0){var _=new u(s,a,h,g);return _.disableFormat||d.isFormat(s,a.format,this)||_.addError({name:"format",argument:a.format,message:"does not conform to the "+JSON.stringify(a.format)+" format"}),_}},f.minLength=function(s,a,h,g){if(this.types.string(s)){var _=new u(s,a,h,g),T=s.match(/[\uDC00-\uDFFF]/g);return s.length-(T?T.length:0)>=a.minLength||_.addError({name:"minLength",argument:a.minLength,message:"does not meet minimum length of "+a.minLength}),_}},f.maxLength=function(s,a,h,g){if(this.types.string(s)){var _=new u(s,a,h,g),T=s.match(/[\uDC00-\uDFFF]/g);return s.length-(T?T.length:0)<=a.maxLength||_.addError({name:"maxLength",argument:a.maxLength,message:"does not meet maximum length of "+a.maxLength}),_}},f.minItems=function(s,a,h,g){if(this.types.array(s)){var _=new u(s,a,h,g);return s.length>=a.minItems||_.addError({name:"minItems",argument:a.minItems,message:"does not meet minimum length of "+a.minItems}),_}},f.maxItems=function(s,a,h,g){if(this.types.array(s)){var _=new u(s,a,h,g);return s.length<=a.maxItems||_.addError({name:"maxItems",argument:a.maxItems,message:"does not meet maximum length of "+a.maxItems}),_}},f.uniqueItems=function(s,a,h,g){if(a.uniqueItems===!0&&this.types.array(s)){var _=new u(s,a,h,g);return s.every(c)||_.addError({name:"uniqueItems",message:"contains duplicate item"}),_}},f.dependencies=function(s,a,h,g){if(this.types.object(s)){var _=new u(s,a,h,g);for(var T in a.dependencies)if(s[T]!==void 0){var y=a.dependencies[T],A=g.makeChild(y,T);if(typeof y=="string"&&(y=[y]),Array.isArray(y))y.forEach(function(L){s[L]===void 0&&_.addError({name:"dependencies",argument:A.propertyPath,message:"property "+L+" not found, required by "+A.propertyPath})});else{var w=this.validateSchema(s,y,h,A);_.instance!==w.instance&&(_.instance=w.instance),w&&w.errors.length&&(_.addError({name:"dependencies",argument:A.propertyPath,message:"does not meet dependency required by "+A.propertyPath}),_.importErrors(w))}}return _}},f.enum=function(s,a,h,g){if(s===void 0)return null;if(!Array.isArray(a.enum))throw new b("enum expects an array",a);var _=new u(s,a,h,g);return a.enum.some(d.deepCompareStrict.bind(null,s))||_.addError({name:"enum",argument:a.enum,message:"is not one of enum values: "+a.enum.map(String).join(",")}),_},f.const=function(s,a,h,g){if(s===void 0)return null;var _=new u(s,a,h,g);return d.deepCompareStrict(a.const,s)||_.addError({name:"const",argument:a.const,message:"does not exactly match expected constant: "+a.const}),_},f.not=f.disallow=function(s,a,h,g){var _=this;if(s===void 0)return null;var T=new u(s,a,h,g),y=a.not||a.disallow;return y?(Array.isArray(y)||(y=[y]),y.forEach(function(A){if(_.testType(s,a,h,g,A)){var w=A&&(A.$id||A.id)||A;T.addError({name:"not",argument:w,message:"is of prohibited type "+w})}}),T):null},F.exports=m},3533:(F,p,v)=>{var d=v(4760),u=p.ValidationError=function(_,T,y,A,w,L){if(Array.isArray(A)?(this.path=A,this.property=A.reduce(function(j,V){return j+i(V)},"instance")):A!==void 0&&(this.property=A),_&&(this.message=_),y){var D=y.$id||y.id;this.schema=D||y}T!==void 0&&(this.instance=T),this.name=w,this.argument=L,this.stack=this.toString()};u.prototype.toString=function(){return this.property+" "+this.message};var b=p.ValidatorResult=function(_,T,y,A){this.instance=_,this.schema=T,this.options=y,this.path=A.path,this.propertyPath=A.propertyPath,this.errors=[],this.throwError=y&&y.throwError,this.throwFirst=y&&y.throwFirst,this.throwAll=y&&y.throwAll,this.disableFormat=y&&y.disableFormat===!0};function m(_,T){return T+": "+_.toString()+`
`}function f(_){Error.captureStackTrace&&Error.captureStackTrace(this,f),this.instance=_.instance,this.schema=_.schema,this.options=_.options,this.errors=_.errors}b.prototype.addError=function(_){var T;if(typeof _=="string")T=new u(_,this.instance,this.schema,this.path);else{if(!_)throw new Error("Missing error detail");if(!_.message)throw new Error("Missing error message");if(!_.name)throw new Error("Missing validator type");T=new u(_.message,this.instance,this.schema,this.path,_.name,_.argument)}if(this.errors.push(T),this.throwFirst)throw new f(this);if(this.throwError)throw T;return T},b.prototype.importErrors=function(_){typeof _=="string"||_&&_.validatorType?this.addError(_):_&&_.errors&&Array.prototype.push.apply(this.errors,_.errors)},b.prototype.toString=function(_){return this.errors.map(m).join("")},Object.defineProperty(b.prototype,"valid",{get:function(){return!this.errors.length}}),F.exports.ValidatorResultError=f,f.prototype=new Error,f.prototype.constructor=f,f.prototype.name="Validation Error";var o=p.SchemaError=function _(T,y){this.message=T,this.schema=y,Error.call(this,T),Error.captureStackTrace(this,_)};o.prototype=Object.create(Error.prototype,{constructor:{value:o,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var r=p.SchemaContext=function(_,T,y,A,w){this.schema=_,this.options=T,Array.isArray(y)?(this.path=y,this.propertyPath=y.reduce(function(L,D){return L+i(D)},"instance")):this.propertyPath=y,this.base=A,this.schemas=w};r.prototype.resolve=function(_){return d.resolve(this.base,_)},r.prototype.makeChild=function(_,T){var y=T===void 0?this.path:this.path.concat([T]),A=_.$id||_.id,w=d.resolve(this.base,A||""),L=new r(_,this.options,y,w,Object.create(this.schemas));return A&&!L.schemas[w]&&(L.schemas[w]=_),L};var n=p.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(_){return typeof _=="string"&&parseFloat(_)===parseInt(_,10)&&!isNaN(_)},regex:function(_){var T=!0;try{new RegExp(_)}catch{T=!1}return T},style:/\s*(.+?):\s*([^;]+);?/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};n.regexp=n.regex,n.pattern=n.regex,n.ipv4=n["ip-address"],p.isFormat=function(_,T,y){if(typeof _=="string"&&n[T]!==void 0){if(n[T]instanceof RegExp)return n[T].test(_);if(typeof n[T]=="function")return n[T](_)}else if(y&&y.customFormats&&typeof y.customFormats[T]=="function")return y.customFormats[T](_);return!0};var i=p.makeSuffix=function(_){return(_=_.toString()).match(/[.\s\[\]]/)||_.match(/^[\d]/)?_.match(/^\d+$/)?"["+_+"]":"["+JSON.stringify(_)+"]":"."+_};function c(_,T,y,A){typeof y=="object"?T[A]=h(_[A],y):_.indexOf(y)===-1&&T.push(y)}function s(_,T,y){T[y]=_[y]}function a(_,T,y,A){typeof T[A]=="object"&&T[A]&&_[A]?y[A]=h(_[A],T[A]):y[A]=T[A]}function h(_,T){var y=Array.isArray(T),A=y&&[]||{};return y?(_=_||[],A=A.concat(_),T.forEach(c.bind(null,_,A))):(_&&typeof _=="object"&&Object.keys(_).forEach(s.bind(null,_,A)),Object.keys(T).forEach(a.bind(null,_,T,A))),A}function g(_){return"/"+encodeURIComponent(_).replace(/~/g,"%7E")}p.deepCompareStrict=function _(T,y){if(typeof T!=typeof y)return!1;if(Array.isArray(T))return!!Array.isArray(y)&&T.length===y.length&&T.every(function(L,D){return _(T[D],y[D])});if(typeof T=="object"){if(!T||!y)return T===y;var A=Object.keys(T),w=Object.keys(y);return A.length===w.length&&A.every(function(L){return _(T[L],y[L])})}return T===y},F.exports.deepMerge=h,p.objectGetPath=function(_,T){for(var y,A=T.split("/").slice(1);typeof(y=A.shift())=="string";){var w=decodeURIComponent(y.replace(/~0/,"~").replace(/~1/g,"/"));if(!(w in _))return;_=_[w]}return _},p.encodePath=function(_){return _.map(g).join("")},p.getDecimalPlaces=function(_){var T=0;if(isNaN(_))return T;typeof _!="number"&&(_=Number(_));var y=_.toString().split("e");if(y.length===2){if(y[1][0]!=="-")return T;T=Number(y[1].slice(1))}var A=y[0].split(".");return A.length===2&&(T+=A[1].length),T},p.isSchema=function(_){return typeof _=="object"&&_||typeof _=="boolean"}},634:(F,p,v)=>{var d=F.exports.Validator=v(7298);F.exports.ValidatorResult=v(3533).ValidatorResult,F.exports.ValidatorResultError=v(3533).ValidatorResultError,F.exports.ValidationError=v(3533).ValidationError,F.exports.SchemaError=v(3533).SchemaError,F.exports.SchemaScanResult=v(433).SchemaScanResult,F.exports.scan=v(433).scan,F.exports.validate=function(u,b,m){return new d().validate(u,b,m)}},433:(F,p,v)=>{var d=v(4760),u=v(3533);function b(m,f){this.id=m,this.ref=f}F.exports.SchemaScanResult=b,F.exports.scan=function(m,f){function o(s,a){if(a&&typeof a=="object")if(a.$ref){var h=d.resolve(s,a.$ref);c[h]=c[h]?c[h]+1:0}else{var g=a.$id||a.id,_=g?d.resolve(s,g):s;if(_){if(_.indexOf("#")<0&&(_+="#"),i[_]){if(!u.deepCompareStrict(i[_],a))throw new Error("Schema <"+_+"> already exists with different definition");return i[_]}i[_]=a,_[_.length-1]=="#"&&(i[_.substring(0,_.length-1)]=a)}r(_+"/items",Array.isArray(a.items)?a.items:[a.items]),r(_+"/extends",Array.isArray(a.extends)?a.extends:[a.extends]),o(_+"/additionalItems",a.additionalItems),n(_+"/properties",a.properties),o(_+"/additionalProperties",a.additionalProperties),n(_+"/definitions",a.definitions),n(_+"/patternProperties",a.patternProperties),n(_+"/dependencies",a.dependencies),r(_+"/disallow",a.disallow),r(_+"/allOf",a.allOf),r(_+"/anyOf",a.anyOf),r(_+"/oneOf",a.oneOf),o(_+"/not",a.not)}}function r(s,a){if(Array.isArray(a))for(var h=0;h<a.length;h++)o(s+"/"+h,a[h])}function n(s,a){if(a&&typeof a=="object")for(var h in a)o(s+"/"+h,a[h])}var i={},c={};return o(m,f),new b(i,c)}},7298:(F,p,v)=>{var d=v(4760),u=v(9609),b=v(3533),m=v(433).scan,f=b.ValidatorResult,o=b.ValidatorResultError,r=b.SchemaError,n=b.SchemaContext,i=function a(){this.customFormats=Object.create(a.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(s),this.attributes=Object.create(u.validators)};function c(a){var h=typeof a=="string"?a:a.$ref;return typeof h=="string"&&h}i.prototype.customFormats={},i.prototype.schemas=null,i.prototype.types=null,i.prototype.attributes=null,i.prototype.unresolvedRefs=null,i.prototype.addSchema=function(a,h){var g=this;if(!a)return null;var _=m(h||"/",a),T=h||a.$id||a.id;for(var y in _.id)this.schemas[y]=_.id[y];for(var y in _.ref)this.unresolvedRefs.push(y);return this.unresolvedRefs=this.unresolvedRefs.filter(function(A){return g.schemas[A]===void 0}),this.schemas[T]},i.prototype.addSubSchemaArray=function(a,h){if(Array.isArray(h))for(var g=0;g<h.length;g++)this.addSubSchema(a,h[g])},i.prototype.addSubSchemaObject=function(a,h){if(h&&typeof h=="object")for(var g in h)this.addSubSchema(a,h[g])},i.prototype.setSchemas=function(a){this.schemas=a},i.prototype.getSchema=function(a){return this.schemas[a]},i.prototype.validate=function(a,h,g,_){if(typeof h!="boolean"&&typeof h!="object"||h===null)throw new r("Expected `schema` to be an object or boolean");g||(g={});var T,y=h.$id||h.id,A=d.resolve(g.base||"/",y||"");if(!_){(_=new n(h,g,[],A,Object.create(this.schemas))).schemas[A]||(_.schemas[A]=h);var w=m(A,h);for(var L in w.id){var D=w.id[L];_.schemas[L]=D}}if(g.required&&a===void 0)return(T=new f(a,h,g,_)).addError("is required, but is undefined"),T;if(!(T=this.validateSchema(a,h,g,_)))throw new Error("Result undefined");if(g.throwAll&&T.errors.length)throw new o(T);return T},i.prototype.validateSchema=function(a,h,g,_){var T=new f(a,h,g,_);if(typeof h=="boolean")h===!0?h={}:h===!1&&(h={type:[]});else if(!h)throw new Error("schema is undefined");if(h.extends)if(Array.isArray(h.extends)){var y={schema:h,ctx:_};h.extends.forEach(this.schemaTraverser.bind(this,y)),h=y.schema,y.schema=null,y.ctx=null,y=null}else h=b.deepMerge(h,this.superResolve(h.extends,_));var A=c(h);if(A){var w=this.resolve(h,A,_),L=new n(w.subschema,g,_.path,w.switchSchema,_.schemas);return this.validateSchema(a,w.subschema,g,L)}var D=g&&g.skipAttributes||[];for(var j in h)if(!u.ignoreProperties[j]&&D.indexOf(j)<0){var V=null,G=this.attributes[j];if(G)V=G.call(this,a,h,g,_);else if(g.allowUnknownAttributes===!1)throw new r("Unsupported attribute: "+j,h);V&&T.importErrors(V)}if(typeof g.rewrite=="function"){var W=g.rewrite.call(this,a,h,g,_);T.instance=W}return T},i.prototype.schemaTraverser=function(a,h){a.schema=b.deepMerge(a.schema,this.superResolve(h,a.ctx))},i.prototype.superResolve=function(a,h){var g=c(a);return g?this.resolve(a,g,h).subschema:a},i.prototype.resolve=function(a,h,g){if(h=g.resolve(h),g.schemas[h])return{subschema:g.schemas[h],switchSchema:h};var _=d.parse(h),T=_&&_.hash,y=T&&T.length&&h.substr(0,h.length-T.length);if(!y||!g.schemas[y])throw new r("no such schema <"+h+">",a);var A=b.objectGetPath(g.schemas[y],T.substr(1));if(A===void 0)throw new r("no such schema "+T+" located in <"+y+">",a);return{subschema:A,switchSchema:h}},i.prototype.testType=function(a,h,g,_,T){if(T!==void 0){if(T===null)throw new r('Unexpected null in "type" keyword');if(typeof this.types[T]=="function")return this.types[T].call(this,a);if(T&&typeof T=="object"){var y=this.validateSchema(a,T,g,_);return y===void 0||!(y&&y.errors.length)}return!0}};var s=i.prototype.types={};s.string=function(a){return typeof a=="string"},s.number=function(a){return typeof a=="number"&&isFinite(a)},s.integer=function(a){return typeof a=="number"&&a%1==0},s.boolean=function(a){return typeof a=="boolean"},s.array=function(a){return Array.isArray(a)},s.null=function(a){return a===null},s.date=function(a){return a instanceof Date},s.any=function(a){return!0},s.object=function(a){return a&&typeof a=="object"&&!Array.isArray(a)&&!(a instanceof Date)},F.exports=i},8770:(F,p,v)=>{v.r(p),v.d(p,{ucs2decode:()=>s,ucs2encode:()=>a,decode:()=>_,encode:()=>T,toASCII:()=>A,toUnicode:()=>y,default:()=>w});const d=2147483647,u=36,b=/^xn--/,m=/[^\0-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,o={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},r=Math.floor,n=String.fromCharCode;function i(L){throw new RangeError(o[L])}function c(L,D){const j=L.split("@");let V="";j.length>1&&(V=j[0]+"@",L=j[1]);const G=function(W,H){const q=[];let Z=W.length;for(;Z--;)q[Z]=H(W[Z]);return q}((L=L.replace(f,".")).split("."),D).join(".");return V+G}function s(L){const D=[];let j=0;const V=L.length;for(;j<V;){const G=L.charCodeAt(j++);if(G>=55296&&G<=56319&&j<V){const W=L.charCodeAt(j++);(64512&W)==56320?D.push(((1023&G)<<10)+(1023&W)+65536):(D.push(G),j--)}else D.push(G)}return D}const a=L=>String.fromCodePoint(...L),h=function(L,D){return L+22+75*(L<26)-((D!=0)<<5)},g=function(L,D,j){let V=0;for(L=j?r(L/700):L>>1,L+=r(L/D);L>455;V+=u)L=r(L/35);return r(V+36*L/(L+38))},_=function(L){const D=[],j=L.length;let V=0,G=128,W=72,H=L.lastIndexOf("-");H<0&&(H=0);for(let Z=0;Z<H;++Z)L.charCodeAt(Z)>=128&&i("not-basic"),D.push(L.charCodeAt(Z));for(let Z=H>0?H+1:0;Z<j;){let $=V;for(let se=1,Q=u;;Q+=u){Z>=j&&i("invalid-input");const ae=(q=L.charCodeAt(Z++))-48<10?q-22:q-65<26?q-65:q-97<26?q-97:u;(ae>=u||ae>r((d-V)/se))&&i("overflow"),V+=ae*se;const me=Q<=W?1:Q>=W+26?26:Q-W;if(ae<me)break;const he=u-me;se>r(d/he)&&i("overflow"),se*=he}const J=D.length+1;W=g(V-$,J,$==0),r(V/J)>d-G&&i("overflow"),G+=r(V/J),V%=J,D.splice(V++,0,G)}var q;return String.fromCodePoint(...D)},T=function(L){const D=[];let j=(L=s(L)).length,V=128,G=0,W=72;for(const Z of L)Z<128&&D.push(n(Z));let H=D.length,q=H;for(H&&D.push("-");q<j;){let Z=d;for(const J of L)J>=V&&J<Z&&(Z=J);const $=q+1;Z-V>r((d-G)/$)&&i("overflow"),G+=(Z-V)*$,V=Z;for(const J of L)if(J<V&&++G>d&&i("overflow"),J==V){let se=G;for(let Q=u;;Q+=u){const ae=Q<=W?1:Q>=W+26?26:Q-W;if(se<ae)break;const me=se-ae,he=u-ae;D.push(n(h(ae+me%he,0))),se=r(me/he)}D.push(n(h(se,0))),W=g(G,$,q==H),G=0,++q}++G,++V}return D.join("")},y=function(L){return c(L,function(D){return b.test(D)?_(D.slice(4).toLowerCase()):D})},A=function(L){return c(L,function(D){return m.test(D)?"xn--"+T(D):D})},w={version:"2.1.0",ucs2:{decode:s,encode:a},decode:_,encode:T,toASCII:A,toUnicode:y}},9350:F=>{function p(v,d){return Object.prototype.hasOwnProperty.call(v,d)}F.exports=function(v,d,u,b){d=d||"&",u=u||"=";var m={};if(typeof v!="string"||v.length===0)return m;var f=/\+/g;v=v.split(d);var o=1e3;b&&typeof b.maxKeys=="number"&&(o=b.maxKeys);var r=v.length;o>0&&r>o&&(r=o);for(var n=0;n<r;++n){var i,c,s,a,h=v[n].replace(f,"%20"),g=h.indexOf(u);g>=0?(i=h.substr(0,g),c=h.substr(g+1)):(i=h,c=""),s=decodeURIComponent(i),a=decodeURIComponent(c),p(m,s)?Array.isArray(m[s])?m[s].push(a):m[s]=[m[s],a]:m[s]=a}return m}},4104:F=>{var p=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};F.exports=function(v,d,u,b){return d=d||"&",u=u||"=",v===null&&(v=void 0),typeof v=="object"?Object.keys(v).map(function(m){var f=encodeURIComponent(p(m))+u;return Array.isArray(v[m])?v[m].map(function(o){return f+encodeURIComponent(p(o))}).join(d):f+encodeURIComponent(p(v[m]))}).join(d):b?encodeURIComponent(p(b))+u+encodeURIComponent(p(v)):""}},8966:(F,p,v)=>{p.decode=p.parse=v(9350),p.encode=p.stringify=v(4104)},3666:function(F,p,v){var d=this&&this.__decorate||function(a,h,g,_){var T,y=arguments.length,A=y<3?h:_===null?_=Object.getOwnPropertyDescriptor(h,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(a,h,g,_);else for(var w=a.length-1;w>=0;w--)(T=a[w])&&(A=(y<3?T(A):y>3?T(h,g,A):T(h,g))||A);return y>3&&A&&Object.defineProperty(h,g,A),A};Object.defineProperty(p,"__esModule",{value:!0}),p.AccumulatePass=void 0;const u=v(9696),b=v(4597),m=v(9564),f=v(1030),o=v(7570),r=v(4895),n=v(5263),i=v(6942),c=v(1284);class s extends f.Initializable{constructor(h){super(),this._altered=Object.assign(new b.ChangeLookup,{any:!1,texture:!1,precision:!1,passThrough:!1}),this._precision=c.Wizard.Precision.half,this._write=0,this._ndcTriangleShared=!1,this._context=h}initialize(h){const g=this._context.gl;this._accumulationFBOs=[new m.Framebuffer(this._context,"AccumPingFBO"),new m.Framebuffer(this._context,"AccumPongFBO")],this._accumulationTextures=[new i.Texture2D(this._context,"AccumPingTexture"),new i.Texture2D(this._context,"AccumPongTexture")],h===void 0?this._ndcTriangle=new o.NdcFillingTriangle(this._context,"NdcFillingTriangle-Accumulate"):(this._ndcTriangle=h,this._ndcTriangleShared=!0);const _=new n.Shader(this._context,g.VERTEX_SHADER,"ndcvertices.vert (accumulate)");_.initialize(v(3643));const T=new n.Shader(this._context,g.FRAGMENT_SHADER,"accumulate.frag");return T.initialize(v(3170)),this._program=new r.Program(this._context,"AccumulateProgram"),this._program.initialize([_,T],!1),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uWeight=this._program.uniform("u_weight"),this._program.bind(),g.uniform1f(this._uWeight,0),g.uniform1i(this._program.uniform("u_accumulationTexture"),0),g.uniform1i(this._program.uniform("u_currentFrameTexture"),1),this._program.unbind(),!0}uninitialize(){!this._ndcTriangleShared&&this._ndcTriangle.initialized&&this._ndcTriangle.uninitialize(),this._program.uninitialize(),this._accumulationFBOs[0].uninitialize(),this._accumulationFBOs[1].uninitialize(),this._accumulationTextures[0].uninitialize(),this._accumulationTextures[1].uninitialize(),this._write=0}update(){if(!this._texture||!this._texture.valid)return void u.log(u.LogLevel.Warning,`valid texture for accumulation update expected, given ${this._texture}`);if(this._passThrough)return;const h=this._altered.texture||this._accumulationTextures[0].width!==this._texture.width||this._accumulationTextures[0].height!==this._texture.height;if(!this._altered.any&&!h)return void u.assert(this._accumulationFBOs[0].valid&&this._accumulationFBOs[1].valid,"valid accumulation framebuffers expected");const g=this._context.gl,_=this._context.gl2facade,T=this._texture.size;if(this._accumulationTextures[0].initialized){if((this._altered.texture||h)&&(this._accumulationTextures[0].resize(this._texture.width,this._texture.height),this._accumulationTextures[1].resize(this._texture.width,this._texture.height)),this._altered.precision){const y=c.Wizard.queryInternalTextureFormat(this._context,g.RGBA,this._precision);this._accumulationTextures[0].reformat(y[0],g.RGBA,y[1]),this._accumulationTextures[1].reformat(y[0],g.RGBA,y[1])}}else{const y=c.Wizard.queryInternalTextureFormat(this._context,g.RGBA,this._precision);this._accumulationTextures[0].initialize(T[0],T[1],y[0],g.RGBA,y[1]),this._accumulationTextures[1].initialize(T[0],T[1],y[0],g.RGBA,y[1])}this._accumulationFBOs[0].initialized||(this._accumulationFBOs[0].initialize([[_.COLOR_ATTACHMENT0,this._accumulationTextures[0]]]),this._accumulationFBOs[1].initialize([[_.COLOR_ATTACHMENT0,this._accumulationTextures[1]]])),u.assert(this._accumulationFBOs[0].valid&&this._accumulationFBOs[1].valid,"valid accumulation framebuffers expected"),this._altered.reset()}frame(h,g){if(u.assert(this._accumulationFBOs[0].valid&&this._accumulationFBOs[1].valid,"valid framebuffer objects for accumulation expected (initialize or update was probably not called)"),this._passThrough||this._texture===void 0)return;u.logIf(!this._texture||!this._texture.valid,u.LogLevel.Warning,`valid texture for accumulation frame expected, given ${this._texture}`);const _=this._context.gl;g!==void 0&&_.viewport(0,0,g[0],g[1]);const T=h%2,y=this._write=1-T,A=this._accumulationTextures[T],w=this._texture;A.bind(_.TEXTURE0),w.bind(_.TEXTURE1),this._program.bind(),_.uniform1f(this._uWeight,1/(h+1)),this._accumulationFBOs[y].bind(_.DRAW_FRAMEBUFFER),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),this._accumulationFBOs[y].unbind(_.DRAW_FRAMEBUFFER),A.unbind(_.TEXTURE0),w.unbind(_.TEXTURE1)}set texture(h){this.assertInitialized(),this._texture!==h&&(this._texture=h,this._altered.alter("texture"))}set precision(h){this.assertInitialized(),this._precision!==h&&(this._precision=h,this._altered.alter("precision"))}set passThrough(h){this.assertInitialized(),this._passThrough!==h&&(this._passThrough&&this._accumulationTextures[0].initialized&&(this._accumulationTextures[0].uninitialize(),this._accumulationTextures[1].uninitialize()),this._passThrough&&this._accumulationFBOs[0].initialized&&(this._accumulationFBOs[0].uninitialize(),this._accumulationFBOs[1].uninitialize()),this._passThrough=h,this._altered.alter("passThrough"))}get framebuffer(){return this._passThrough?void 0:this._accumulationFBOs[this._write]}}d([f.Initializable.initialize()],s.prototype,"initialize",null),d([f.Initializable.uninitialize()],s.prototype,"uninitialize",null),d([f.Initializable.assert_initialized()],s.prototype,"update",null),d([f.Initializable.assert_initialized()],s.prototype,"frame",null),p.AccumulatePass=s},7945:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.AllocationRegister=void 0;const d=v(7318),u=v(9696);p.AllocationRegister=class{constructor(){this._bytesByIdentifier=new Map,this._bytes=0,this._bytesSubject=new d.ReplaySubject(1)}bytesNext(){this._bytesSubject.next([this._bytes,this.bytesToString()])}assertIdentifier(b){u.assert(this._bytesByIdentifier.has(b),"allocation identifier unknown")}createUniqueIdentifier(b){let m=b,f=2;for(;this._bytesByIdentifier.has(m);)m=`${b}-${f}`,++f;return this._bytesByIdentifier.set(m,0),m}deleteUniqueIdentifier(b){u.assert(this._bytesByIdentifier.has(b),"identifier expected to be known for allocation registration"),this._bytesByIdentifier.delete(b)}allocate(b,m){if(this.assertIdentifier(b),u.assert(m>=0,`positive number of bytes expected for allocation, given ${m}`),m===0)return;const f=this._bytesByIdentifier.get(b)+m;this._bytesByIdentifier.set(b,f),this._bytes=this._bytes+m,this.bytesNext()}deallocate(b,m){this.assertIdentifier(b);const f=this._bytesByIdentifier.get(b);u.assert(m>=0,`positive number of bytes expected for deallocation, given ${m}`),u.assert(m<=f,`deallocation cannot exceed previous allocations of ${f}, given ${m}`),m!==0&&(this._bytesByIdentifier.set(b,f-m),this._bytes=this._bytes-m,this.bytesNext())}reallocate(b,m){this.assertIdentifier(b),u.assert(m>=0,`positive number of bytes expected for reallocation, given ${m}`);const f=this._bytesByIdentifier.get(b);f!==m&&(this._bytes=this._bytes-f,this._bytesByIdentifier.set(b,m),this._bytes=this._bytes+m,this.bytesNext())}allocated(b){return b===void 0?this._bytes:(this.assertIdentifier(b),this._bytesByIdentifier.get(b))}toString(){const b=new Array;return this._bytesByIdentifier.forEach((m,f)=>{b.push(`${f}: ${u.prettyPrintBytes(m)}`)}),b.join(", ")}bytesToString(b){return u.prettyPrintBytes(this.allocated(b))}get bytes(){return this._bytes}get bytes$(){return this._bytesSubject.asObservable()}}},3411:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.AntiAliasingKernel=void 0;const d=v(5785);class u extends d.RandomSquareKernel{constructor(m){super(m)}generate(){switch(this._width){case 8:this.fromJSON(v(1037));break;case 64:this.fromJSON(v(9655));break;case 128:this.fromJSON(v(6412));break;default:super.generate()}}}p.AntiAliasingKernel=u},9696:(F,p,v)=>{const d=v(2111);var u;(function(b){let m,f=2;b.logVerbosity=function(_){return _!==void 0&&(f=Math.max(-1,_)),f},function(_){_[_.Debug=3]="Debug",_[_.Info=2]="Info",_[_.Warning=1]="Warning",_[_.Error=0]="Error"}(m=b.LogLevel||(b.LogLevel={}));const o=(_,T)=>{if(!_)throw new EvalError(T)},r=(_,T)=>{};function n(_,...T){_>f||console.log(`[${_}]`,...T)}function i(_){const T=`${_}-start`;b.assert(performance.getEntriesByName(_).length===0,`expected mark identifier to not already exists, given ${_}`),b.assert(performance.getEntriesByName(T).length===0,`expected mark identifier to not already exists, given ${T}`),performance.mark(T)}function c(_,T,y=0){const A=`${_}-start`,w=`${_}-end`;b.assert(performance.getEntriesByName(_).length===0,`expected mark identifier to not already exists, given ${_}`),b.assert(performance.getEntriesByName(w).length===0,`expected mark identifier to not already exists, given ${w}`),performance.mark(w),performance.measure(_,A,w);const L=performance.getEntriesByName(_)[0];performance.clearMarks(A),performance.clearMarks(w),performance.clearMeasures(_);const D=T===void 0||T.length===0?0:2,j=Math.max(D,y-_.length-(T?T.length:0)-1),V=g(L.duration);n(m.Debug,`${_}${" ".repeat(j)}${T||""} | ${V}`)}b.assert=o,b.assertions=function(_){return _!==void 0&&(b.assert=_?o:r),b.assert!==r},b.log=n,b.logIf=function(_,T,...y){_&&n(T,...y)},b.logPerformanceStart=i,b.logPerformanceStartIf=function(_,T){_&&i(T)},b.logPerformanceStop=c,b.logPerformanceStopIf=function(_,T,y,A=0){_&&c(T,y,A)},b.rand=function(_=0,T=1){return Math.random()*(T-_)+_},b.isPowerOfTwo=function(_){return Number.isInteger(_)&&Number.isInteger(Math.log2(_))},b.upperPowerOfTwo=function(_){return--_,_|=_>>1,_|=_>>2,_|=_>>4,_|=_>>8,_|=_>>16,++_};const s=["","Ki","Mi","Gi","Ti","Pi","Ei","Zi","Yi"];b.prettyPrintBytes=function(_){const T=_>0?Math.floor(Math.log(_)/Math.log(1024)):0,y=_/Math.pow(1024,T);return`${T>0?y.toFixed(3):y}${s[T]}B`};const a=["ms","ns","\u03BCs","ms","s"],h=[0,1e6,1e3,1,.001];function g(_){let T=_>0?Math.max(1,Math.floor(Math.log(10*_)/Math.log(1e3))+3):0;return T=d.clamp(T,0,4),`${(_*h[T]).toFixed(3)}${a[T]}`}b.prettyPrintMilliseconds=g,b.bitInBitfield=function(_,T){return T!==void 0&&(_&T)===T},b.RAD2DEG=57.29577951308232,b.DEG2RAD=.017453292519943295,b.GETsearch=function(){let _=window.location.search;return _||(_=window.top.location.search),_},b.GETparameter=function(_){const T=new RegExp(`${_}=([^&]+)`);let y=window.location.search.match(T);if(y||(y=window.top.location.search.match(T)),y)return y[1]},b.PATH_SEPARATOR="/",b.dirname=function(_){return _.includes(b.PATH_SEPARATOR)===!1?"":_.substr(0,_.lastIndexOf(b.PATH_SEPARATOR)).trimLeft()},b.basename=function(_){return _.includes(b.PATH_SEPARATOR)===!1?_:_.substr(_.lastIndexOf(b.PATH_SEPARATOR)+1).trimRight()}})(u||(u={})),F.exports=u},4073:function(F,p,v){var d=this&&this.__decorate||function(c,s,a,h){var g,_=arguments.length,T=_<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,a):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(c,s,a,h);else for(var y=c.length-1;y>=0;y--)(g=c[y])&&(T=(_<3?g(T):_>3?g(s,a,T):g(s,a))||T);return _>3&&T&&Object.defineProperty(s,a,T),T};Object.defineProperty(p,"__esModule",{value:!0}),p.BlitPass=void 0;const u=v(3659),b=v(9696),m=v(2111),f=v(1030),o=v(7570),r=v(4895),n=v(5263);class i extends f.Initializable{constructor(s){super(),this._enforceProgramBlit=!1,this._ndcTriangleShared=!1,this._context=s}functionBlit(){const s=this._context.gl;if(this._target.bind(s.DRAW_FRAMEBUFFER),this._framebuffer.bind(s.READ_FRAMEBUFFER),s.readBuffer(this._readBuffer),this._drawBuffer>=s.COLOR_ATTACHMENT1&&this._drawBuffer<=s.COLOR_ATTACHMENT15){const g=this._drawBuffer-s.COLOR_ATTACHMENT0,_=new Array(g+1).fill(s.NONE);_[g]=this._drawBuffer,s.drawBuffers(_)}else s.drawBuffers([this._drawBuffer]);s.enable(s.SCISSOR_TEST),s.scissor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.disable(s.SCISSOR_TEST);const a=this._srcBounds?this._srcBounds:[0,0,this._framebuffer.width,this._framebuffer.height],h=this._dstBounds?this._dstBounds:[0,0,this._target.width,this._target.height];s.blitFramebuffer(a[0],a[1],a[2],a[3],h[0],h[1],h[2],h[3],s.COLOR_BUFFER_BIT,this._filter),this._framebuffer.unbind(s.READ_FRAMEBUFFER),this._target.unbind(s.DRAW_FRAMEBUFFER)}programBlit(){this._program===void 0&&this.createProgram(),b.assert(this._ndcTriangle&&this._ndcTriangle.initialized,"expected an initialized ndc triangle");const s=this._context.gl,a=this._srcBounds?this._srcBounds:u.vec4.fromValues(0,0,this._framebuffer.width,this._framebuffer.height),h=this._dstBounds?this._dstBounds:u.vec4.fromValues(0,0,this._target.width,this._target.height),g=u.vec4.div(m.v4(),a,[this._framebuffer.width,this._framebuffer.height,this._framebuffer.width,this._framebuffer.height]),_=u.vec4.div(m.v4(),h,[this._target.width,this._target.height,this._target.width,this._target.height]);s.viewport(h[0],h[1],h[2]-h[0],h[3]-h[1]),s.disable(s.DEPTH_TEST),s.depthMask(!1),this._program.bind(),s.uniform4fv(this._uSrcBounds,g),s.uniform4fv(this._uDstBounds,_),s.uniform1i(this._uNearest,this.filter===s.nearest);const T=this._framebuffer.texture(this._readBuffer);T.bind(s.TEXTURE0);const y=this._context.isWebGL2?s.DRAW_FRAMEBUFFER:s.FRAMEBUFFER;this._target.bind(y),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),this._target.unbind(y),T.unbind(),s.enable(s.DEPTH_TEST),s.depthMask(!0)}createProgram(){b.assert(this._program===void 0,"expected blit program to be undefined before its creation");const s=this._context.gl,a=new n.Shader(this._context,s.VERTEX_SHADER,"blit.vert (blit)");a.initialize(v(985));const h=new n.Shader(this._context,s.FRAGMENT_SHADER,"blit.frag (blit)");return h.initialize(v(3717)),this._program=new r.Program(this._context,"BlitProgram"),this._program.initialize([a,h],!1),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uSrcBounds=this._program.uniform("u_srcBounds"),this._uDstBounds=this._program.uniform("u_dstBounds"),this._uNearest=this._program.uniform("u_nearest"),this._program.bind(),s.uniform1i(this._program.uniform("u_source"),0),this._program.unbind(),this._program.valid}initialize(s){const a=this._context.gl;return s===void 0?this._ndcTriangle=new o.NdcFillingTriangle(this._context,"NdcFillingTriangle-Blit"):(this._ndcTriangle=s,this._ndcTriangleShared=!0),this._filter=a.NEAREST,!0}uninitialize(){!this._ndcTriangleShared&&this._ndcTriangle.initialized&&this._ndcTriangle.uninitialize(),this._program.uninitialize()}frame(){b.logIf(!this._target||!this._target.valid,b.LogLevel.Warning,`valid target expected, given ${this._target}`),b.logIf(!this._framebuffer||!this._framebuffer.valid,b.LogLevel.Warning,`valid framebuffer for blitting from expected, given ${this._framebuffer}`);const s=this._context.gl;switch(this._readBuffer){case s.DEPTH_ATTACHMENT:case s.STENCIL_ATTACHMENT:case s.DEPTH_STENCIL_ATTACHMENT:return this.programBlit()}if(this._context.supportsBlitFramebuffer&&this._enforceProgramBlit===!1)return this.functionBlit();this.programBlit()}set framebuffer(s){this.assertInitialized(),this._framebuffer=s}set readBuffer(s){this.assertInitialized(),this._readBuffer=s}set drawBuffer(s){this.assertInitialized(),this._drawBuffer=s}set target(s){this.assertInitialized(),this._target=s}set filter(s){this._filter=s}set srcBounds(s){this._srcBounds=s?u.vec4.clone(s):void 0}set dstBounds(s){this._dstBounds=s?u.vec4.clone(s):void 0}set enforceProgramBlit(s){this._enforceProgramBlit=s}}d([f.Initializable.initialize()],i.prototype,"initialize",null),d([f.Initializable.uninitialize()],i.prototype,"uninitialize",null),d([f.Initializable.assert_initialized()],i.prototype,"frame",null),p.BlitPass=i},6404:function(F,p,v){var d=this&&this.__decorate||function(o,r,n,i){var c,s=arguments.length,a=s<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,r,n,i);else for(var h=o.length-1;h>=0;h--)(c=o[h])&&(a=(s<3?c(a):s>3?c(r,n,a):c(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(p,"__esModule",{value:!0}),p.Buffer=void 0;const u=v(9696),b=v(1030),m=v(2281);class f extends m.AbstractObject{constructor(){super(...arguments),this._target=f.DEFAULT_BUFFER}create(r){const n=this._context.gl;return this._object=n.createBuffer(),this._valid=this._object instanceof WebGLBuffer,this._valid&&(u.assert(r===n.ARRAY_BUFFER||r===n.ELEMENT_ARRAY_BUFFER,"either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER expected as buffer target"),this._target=r),this._object}delete(){u.assert(this._object instanceof WebGLBuffer,"expected WebGLBuffer object"),this._context.gl.deleteBuffer(this._object),this._object=void 0,this._valid=!1,this._target=f.DEFAULT_BUFFER}bind(){u.assert(this._target===this._context.gl.ARRAY_BUFFER||this._target===this._context.gl.ELEMENT_ARRAY_BUFFER,"expected either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER as buffer target"),this._context.gl.bindBuffer(this._target,this._object)}unbind(){this.context.gl.bindBuffer(this._target,f.DEFAULT_BUFFER)}data(r,n,i=!0,c=!0){const s=this.context.gl;i&&this.bind(),s.bufferData(this._target,r,n),c&&this.unbind(),this._valid=s.isBuffer(this._object)&&s.getError()===s.NO_ERROR;const a=typeof r=="number"?r:r.byteLength,h=this._valid?a:0;this.context.allocationRegister.reallocate(this._identifier,h)}subData(r,n,i=0,c=0,s=!0,a=!0){const h=this.context.gl;s&&this.bind(),this.context.gl2facade.bufferSubData(this._target,r,n,i,c),a&&this.unbind(),this._valid=h.getError()===h.NO_ERROR}attribEnable(r,n,i,c=!1,s=0,a=0,h=!0,g=!0){const _=this.context.gl;h&&this.bind(),_.vertexAttribPointer(r,n,i,c,s,a),_.enableVertexAttribArray(r),g&&this.unbind()}attribDisable(r,n=!0,i=!0){const c=this.context.gl;n&&this.bind(),c.disableVertexAttribArray(r),i&&this.unbind()}get bytes(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)}get target(){return this.assertInitialized(),this._target}}f.DEFAULT_BUFFER=void 0,d([b.Initializable.assert_initialized()],f.prototype,"bind",null),d([b.Initializable.assert_initialized()],f.prototype,"unbind",null),d([b.Initializable.assert_initialized()],f.prototype,"data",null),d([b.Initializable.assert_initialized()],f.prototype,"attribEnable",null),d([b.Initializable.assert_initialized()],f.prototype,"attribDisable",null),p.Buffer=f},4082:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Camera=void 0;const d=v(3659),u=v(2111),b=v(9696),m=v(4934);class f{constructor(r,n,i){this._fovy=f.DEFAULT_FOVY,this._near=f.DEFAULT_NEAR,this._far=f.DEFAULT_FAR,this._viewport=[1,1],this._aspect=1,this._altered=!1,this._eye=r?d.vec3.clone(r):d.vec3.clone(f.DEFAULT_EYE),this._center=n?d.vec3.clone(n):d.vec3.clone(f.DEFAULT_CENTER),this._up=i?d.vec3.clone(i):d.vec3.clone(f.DEFAULT_UP)}static calculateFovY(r,n){return 2*Math.atan(.5*r/n)}invalidate(r,n,i=!1){r&&(this._view=void 0,this._viewInverse=void 0),n&&(this._projection=void 0,this._projectionInverse=void 0),(r||n||i)&&(this._viewProjection=void 0,this._viewProjectionInverse=void 0),this._altered=!0}get eye(){return this._eye}set eye(r){d.vec3.equals(this._eye,r)||(this._eye=d.vec3.clone(r),this.invalidate(!0,!1))}get center(){return this._center}set center(r){d.vec3.equals(this._center,r)||(this._center=d.vec3.clone(r),this.invalidate(!0,!1))}get up(){return this._up}set up(r){d.vec3.equals(this._up,r)||(this._up=d.vec3.clone(r),this.invalidate(!0,!1))}get fovy(){return this._fovy}set fovy(r){this._fovy!==r&&(this._fovy=r,this.invalidate(!1,!0))}set fovx(r){const n=r*b.DEG2RAD,i=2*Math.atan(Math.tan(n/2)*(1/this.aspect))*b.RAD2DEG;this._fovy!==i&&(this._fovy=i,this.invalidate(!1,!0))}fovFromLens(r,n){const i=2*Math.atan(r/(2*n));this.fovx=i*b.RAD2DEG}get near(){return this._near}set near(r){this._near!==r&&(r>=this._far&&b.log(b.LogLevel.Warning,`near expected to be smaller than far (${this._far}), given ${r}`),this._near=r,this.invalidate(!1,!0))}get far(){return this._far}set far(r){this._far!==r&&(this._near>=r&&b.log(b.LogLevel.Warning,`far expected to be greater than near (${this._near}), given ${r}`),this._far=r,this.invalidate(!1,!0))}set viewport(r){this._viewport[0]===r[0]&&this._viewport[1]===r[1]||(this._viewport=m.duplicate2(r),this.invalidate(!1,!0))}get viewport(){return this._viewport}get width(){return this._viewport[0]}get height(){return this._viewport[1]}set aspect(r){this._aspect!==r&&(this._aspect=r)}get aspect(){return this._aspect}get view(){return this._view||(this._view=d.mat4.lookAt(u.m4(),this._eye,this._center,this._up)),this._view}get viewInverse(){return this._viewInverse!==void 0||(this._viewInverse=d.mat4.invert(u.m4(),this.view)),this._viewInverse}get projection(){return this._projection||(this._projection=d.mat4.perspective(u.m4(),this.fovy*b.DEG2RAD,this.aspect,this.near,this.far)),this._projection}get projectionInverse(){return this._projectionInverse!==void 0||(this._projectionInverse=d.mat4.invert(u.m4(),this.projection)),this._projectionInverse}get viewProjection(){return this._viewProjection||(this._viewProjection=d.mat4.multiply(u.m4(),this.projection,this.view),this._viewProjection=d.mat4.multiply(u.m4(),this.postViewProjection,this._viewProjection)),this._viewProjection}get viewProjectionInverse(){return this._viewProjectionInverse!==void 0||(this._viewProjectionInverse=d.mat4.invert(u.m4(),this.viewProjection)),this._viewProjectionInverse}get postViewProjection(){return this._postViewProjection?this._postViewProjection:d.mat4.identity(u.m4())}set postViewProjection(r){this._postViewProjection=r,this.invalidate(!1,!1,!0)}get altered(){return this._altered}set altered(r){this._altered=r}}p.Camera=f,f.DEFAULT_EYE=d.vec3.fromValues(0,0,1),f.DEFAULT_CENTER=d.vec3.fromValues(0,0,0),f.DEFAULT_UP=d.vec3.fromValues(0,1,0),f.DEFAULT_FOVY=45,f.DEFAULT_NEAR=2,f.DEFAULT_FAR=8},6491:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.CameraModifier=void 0;const d=v(4082);p.CameraModifier=class{constructor(){this._camera=void 0,this._reference=new d.Camera}set camera(u){this._camera!==u&&(this._camera=u,u!==void 0&&(Object.assign(this._reference,u),this.update()))}}},7063:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Canvas=void 0;const d=v(7318),u=v(3659),b=v(2111),m=v(9696),f=v(4934),o=v(7677),r=v(4518),n=v(3863),i=v(5838),c=v(4841),s=v(8319),a=v(6346),h=v(4052),g=v(1284);class _ extends a.Resizable{constructor(y,A){super(),this._framePrecisionSubject=new d.ReplaySubject(1),this._size=[0,0],this._sizeSubject=new d.ReplaySubject(1),this._frameScaleSubject=new d.ReplaySubject(1),this._frameSizeSubject=new d.ReplaySubject(1),this._element=y instanceof HTMLCanvasElement?y:document.getElementById(y),this._element.addEventListener("webglcontextcreationerror",j=>{console.log(j.statusMessage||"Unknown error")},!1),this.observe(this._element),this._mouseEventProvider=new c.MouseEventProvider(this._element,200),this._touchEventProvider=new h.TouchEventProvider(this._element,200),this._pointerEventProvider=new s.PointerEventProvider(this._element,200),this._element.style.touchAction="none";const w=this._element.dataset;let L;this._context=r.Context.request(this._element,A),this.configureController(w),this.configureSizeAndScale(w),this.configureContextLostAndRestore(),this.configureContextLostAndRestoreEmulation(),w.clearColor&&(L=b.parseVec4(w.clearColor),m.logIf(L===void 0,m.LogLevel.Warning,`data-clear-color could not be parsed, given '${w.clearColor}'`)),this._clearColor=L?new o.Color(f.tuple4(L)):_.DEFAULT_CLEAR_COLOR;let D=w.accumulationFormat?w.accumulationFormat:_.DEFAULT_FRAME_PRECISION;D in g.Wizard.Precision||(D=_.DEFAULT_FRAME_PRECISION,m.log(m.LogLevel.Warning,`unknown frame precision '${w.accumulationFormat}' changed to '${D}'`)),this._framePrecision=D,this.framePrecisionNext()}configureController(y){let A,w;this._controller=new n.Controller,this._controller.block(),y.multiFrameNumber&&(A=parseInt(y.multiFrameNumber,10),m.logIf(isNaN(A),m.LogLevel.Warning,`data-multi-frame-number could not be parsed, given '${y.multiFrameNumber}'`)),y.debugFrameNumber&&(w=parseInt(y.debugFrameNumber,10),m.logIf(isNaN(w),m.LogLevel.Warning,`data-debug-frame-number could not be parsed, given '${y.debugFrameNumber}'`)),this._controller.multiFrameNumber=A||_.DEFAULT_MULTI_FRAME_NUMBER,this._controller.debugFrameNumber=w||0;const L=!!A&&A!==this._controller.multiFrameNumber;m.logIf(L,m.LogLevel.Warning,`data-multi-frame-number changed to ${this._controller.multiFrameNumber}, given '${y.multiFrameNumber}'`);const D=!!w&&w!==this._controller.debugFrameNumber;m.logIf(D,m.LogLevel.Warning,`data-debug-frame-number changed to ${this._controller.debugFrameNumber}, given '${y.debugFrameNumber}'`)}configureSizeAndScale(y){let A,w;y.frameScale&&(A=b.parseVec2(y.frameScale),m.logIf(y.frameScale!==void 0&&A===void 0,m.LogLevel.Warning,`data-frame-scale could not be parsed, given '${y.frameScale}'`)),this._frameScale=A?f.tuple2(A):[1,1],y.frameSize&&(w=b.parseVec2(y.frameSize),m.logIf(y.frameSize!==void 0&&w===void 0,m.LogLevel.Warning,`data-frame-size could not be parsed, given '${y.frameSize}'`)),this._favorSizeOverScale=w!==void 0,this._frameSize=w?f.tuple2(w):[this._size[0],this._size[1]],this.onResize()}configureContextLostAndRestore(){this._element.addEventListener("webglcontextlost",y=>{y.preventDefault(),this.onContextLost()},!1),this._element.addEventListener("webglcontextrestored",()=>{this.onContextRestore()},!1)}configureContextLostAndRestoreEmulation(){this._lostContextExtension=this._context.gl.getExtension("WEBGL_lose_context")}onContextLost(){m.log(m.LogLevel.Warning,"WebGL Context lost. Discarding renderer..."),this._controller.cancel(),this._controller.block(),this._renderer&&this._renderer.discard()}onContextRestore(){m.log(m.LogLevel.Warning,"WebGL Context restored. Reinitializing renderer...");const y=this._renderer;this.unbind(),this.bind(y),this._controller.unblock();const A=this._element.style.visibility;this._element.style.visibility="hidden",this._element.offsetHeight,this._element.style.visibility=A}retrieveSize(){const y=a.Resizable.elementSize(this._element);y!==void 0?(this._size=[y[0],y[1]],this.sizeNext()):this._size=[0,0]}onResize(){if(this.retrieveSize(),this._size[0]===0||this._size[1]===0)return m.log(m.LogLevel.Debug,"canvas width or height is invalid, resize discarded and controller blocked"),void this._controller.block();this._element.width=this._size[0],this._element.height=this._size[1],this._renderer&&this._controller.block(),this._favorSizeOverScale?this.frameSize=this._frameSize:this.frameScale=this._frameScale,this._renderer&&(this._controller.unblock(),this._renderer.swap())}framePrecisionNext(){this._framePrecisionSubject.next(this._framePrecision)}sizeNext(){this._sizeSubject.next(this._size)}frameScaleNext(){this._frameScaleSubject.next(this._frameScale)}frameSizeNext(){this._frameSizeSubject.next(this._frameSize)}bind(y){this._renderer!==y&&(this.unbind(),y!==void 0&&(m.assert(this._controller.blocked,"expected controller to be blocked"),this._renderer=y,this._renderer.initialize(this.context,A=>this._controller.update(A),{pointerEventProvider:this._pointerEventProvider,mouseEventProvider:this._mouseEventProvider,eyeGazeEventProvider:this._eyeGazeEventProvider}),this._renderer.frameSize=this._frameSize,this._renderer.clearColor=this._clearColor.rgba,this._renderer.framePrecision=this._framePrecision,this._renderer.debugTexture=-1,this._controller.controllable=this._renderer,this._controller.unblock()))}unbind(){this._renderer!==void 0&&(this._controller.block(),this._controller.controllable=void 0,this._renderer=void 0)}dispose(){super.dispose(),this._renderer&&(this._renderer.uninitialize(),this.unbind())}resize(){this.onResize()}get controller(){return this._controller}get renderer(){return this._renderer}set renderer(y){this.bind(y)}get frameScale(){return this._frameScale}set frameScale(y){if(!isFinite(y[0])||!isFinite(y[1]))return void m.log(m.LogLevel.Warning,`expected finite frame size, non-finite values ignored, given [${y}]`);m.logIf(y[0]<0||y[0]>2,m.LogLevel.Info,`frame width scale clamped to [0.0,2.0], given ${y[0]}`),m.logIf(y[1]<0||y[1]>2,m.LogLevel.Info,`frame height scale clamped to [0.0,2.0], given ${y[0]}`);const A=u.vec2.create();b.clamp2(A,y,[0,0],[2,2]);const w=u.vec2.create();u.vec2.mul(w,this._size,A),u.vec2.max(w,[1,1],w),u.vec2.round(w,w),u.vec2.div(A,w,this._size),m.logIf(!u.vec2.exactEquals(A,y),2,`frame scale was adjusted to ${A.toString()}, given ${y.toString()}`),this._frameScale=f.tuple2(A),this._frameSize=f.tuple2(w),this._favorSizeOverScale=!1,this.frameScaleNext(),this.frameSizeNext(),this._renderer&&(this._renderer.frameSize=this._frameSize)}get frameScale$(){return this._frameScaleSubject.asObservable()}get frameSize(){return this._frameSize}set frameSize(y){if(!isFinite(y[0])||!isFinite(y[1]))return void m.log(m.LogLevel.Warning,`expected finite frame size, non-finite values ignored, given [${y}]`);m.logIf(y[0]<1||y[0]>this._size[0],m.LogLevel.Info,`frame width scale clamped to [1,${this._size[0]}], given ${y[0]}`),m.logIf(y[1]<1||y[1]>this._size[1],m.LogLevel.Info,`frame height scale clamped to [1, ${this._size[1]}], given ${y[1]}`);const A=u.vec2.create();b.clamp2(A,y,[1,1],this._size),u.vec2.round(A,A),m.logIf(!u.vec2.exactEquals(A,y),m.LogLevel.Warning,`frame size was adjusted to ${A.toString()}, given ${y.toString()}`);const w=u.vec2.create();u.vec2.div(w,A,this._size),this._frameScale=f.tuple2(w),this._frameSize=f.tuple2(A),this._favorSizeOverScale=!u.vec2.exactEquals(this._frameSize,this._size),this.frameScaleNext(),this.frameSizeNext(),this._renderer&&(this._renderer.frameSize=this._frameSize)}get frameSize$(){return this._frameSizeSubject.asObservable()}get clearColor(){return this._clearColor}set clearColor(y){this._clearColor=y,this._renderer&&(this._renderer.clearColor=this._clearColor.rgba)}get framePrecision(){return this._framePrecision}set framePrecision(y){this._framePrecision=y,this._renderer&&(this._renderer.framePrecision=this._framePrecision,this._framePrecision=this._renderer.framePrecision),this.framePrecisionNext()}get framePrecision$(){return this._framePrecisionSubject.asObservable()}get context(){return this._context}get backend(){return this._context.backendString}get size(){return this._size}get size$(){return this._sizeSubject.asObservable()}get width(){return this._size[0]}get height(){return this._size[1]}get element(){return this._element}get mouseEventProvider(){return this._mouseEventProvider}get touchEventProvider(){return this._touchEventProvider}testLoseContext(){this._lostContextExtension!==void 0&&this._lostContextExtension.loseContext()}testRestoreContext(){this._lostContextExtension!==void 0&&this._lostContextExtension.restoreContext()}get eyeGazeEventProvider(){return this._eyeGazeEventProvider}activateEyeGazeEventProvider(y,A){this._eyeGazeEventProvider=new i.EyeGazeEventProvider(y,A)}}p.Canvas=_,_.DEFAULT_CLEAR_COLOR=new o.Color([.203,.227,.25,1]),_.DEFAULT_FRAME_PRECISION=g.Wizard.Precision.auto,_.DEFAULT_MULTI_FRAME_NUMBER=0},6233:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.CanvasRecorder=void 0;const d=v(9696);class u{constructor(m){d.assert(u.isSupported(),"Recording the canvas is not supported."),this._canvas=m,this._state=u.State.INACTIVE,this._images=new Array}static isSupported(){return window.MediaRecorder!==void 0}static isMIMETypeSupported(m){return MediaRecorder.isTypeSupported(m)}start(m,f="video/webm",o=4194304){d.assert(m>=0,"FPS has to be positive"),d.assert(this._state===u.State.INACTIVE,"Recorder has to be inactive."),d.assert(u.isMIMETypeSupported(f),`MIME type: ${f} is not supported.`),this._stream=this._canvas.element.captureStream(m),this._recorder=new MediaRecorder(this._stream,{mimeType:f,bitsPerSecond:o}),this._images.length=0,this._mimeType=f,this._recorder.ondataavailable=r=>this._images.push(r.data),this._recorder.onstop=()=>{this._onImagesAvailable&&this._onImagesAvailable(this._images)},this._recorder.start(),this._state=u.State.RECORDING}stop(){d.assert(this._state!==u.State.INACTIVE,"Recorder must not be inactive.");const m=this._stream.getTracks();d.assert(m.length===1,"CanvasRecorder uses outdated version of MediaStream API."),this._recorder.stop(),m[0].stop(),this._recorder=void 0,this._stream=void 0,this._state=u.State.INACTIVE}pause(){d.assert(this._state!==u.State.INACTIVE,"Recorder must not be inactive."),this._recorder.pause(),this._state=u.State.PAUSED}resume(){d.assert(this._state!==u.State.INACTIVE,"Recorder must not be inactive."),this._recorder.resume(),this._state=u.State.RECORDING}frame(){d.assert(this._state===u.State.RECORDING,"Recorder has to be recording.");const m=this._stream.getTracks();d.assert(m.length===1,"CanvasRecorder uses unknown implementation of MediaStream API."),d.assert(this._stream.requestFrame||m[0].requestFrame,"CanvasRecorder uses unknown implementation of MediaStream API."),this._stream.requestFrame?this._stream.requestFrame():m[0].requestFrame()}download(m){const f=URL.createObjectURL(this.blob),o=document.createElement("a");o.style.display="none",o.setAttribute("href",f),o.setAttribute("download",m),document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(f)},256)}get images(){return this._images}get state(){return this._state}get blob(){return new Blob(this._images,{type:this._mimeType})}set onImagesAvailable(m){this._onImagesAvailable=m}}p.CanvasRecorder=u,function(b){(function(m){m[m.INACTIVE=0]="INACTIVE",m[m.RECORDING=1]="RECORDING",m[m.PAUSED=2]="PAUSED"})(b.State||(b.State={}))}(u=p.CanvasRecorder||(p.CanvasRecorder={}))},4597:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.ChangeLookup=void 0;const d=v(9696);class u{static alter(m,f){d.assert(f.hasOwnProperty("any"),"expected alterable object to provide 'any' key"),f.any=!0;const o=m.split("."),r=o.shift();if(d.assert(r===""||f.hasOwnProperty(r),`expected object to have key '${r}' in order to capture alterations`),r!==""&&typeof f[r]!="object")return void(f[r]=!0);if(r!==""&&o.length>0)return void u.alter(o.join("."),f[r]);const n=r!==""?f[r]:f;for(const i of Object.getOwnPropertyNames(n))i!=="any"&&u.alter(i,n)}static reset(m){for(const f of Object.getOwnPropertyNames(m))typeof m[f]!="object"?m[f]=!1:u.reset(m[f])}alter(m){return u.alter(m,this)}reset(){return u.reset(this)}}p.ChangeLookup=u},7677:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Color=void 0;const d=v(3659),u=v(2111),b=v(9696),m=v(4934);class f{constructor(r,n){this._rgba=[0,0,0,f.DEFAULT_ALPHA],this._altered=!1,r!==void 0&&(r.length===3&&n!==void 0?this.fromF32(r[0],r[1],r[2],n):r.length===4?(this.fromF32(r[0],r[1],r[2],r[3]),b.assert(n===void 0,"expected alpha to be undefined when given an 4-tuple in RGBA")):this.fromF32(r[0],r[1],r[2]))}static hue2rgb(r,n,i){return b.assert(i>=-1&&i<=2,"t is expected to be between -1 and 2"),i<0?i+=1:i>1&&(i-=1),6*i<1?r+6*(n-r)*i:2*i<1?n:3*i<2?r+6*(n-r)*(2/3-i):r}static to2CharHexCode(r){return(r<15.5/255?"0":"")+Math.round(255*r).toString(16)}static hsl2rgb(r){const n=m.clampf3(r,"HSL input");if(n[1]===0)return[n[2],n[2],n[2]];const i=n[2]<.5?n[2]*(1+n[1]):n[2]+n[1]-n[1]*n[2],c=2*n[2]-i;return[f.hue2rgb(c,i,n[0]+1/3),f.hue2rgb(c,i,n[0]),f.hue2rgb(c,i,n[0]-1/3)]}static rgb2hsl(r){const n=m.clampf3(r,"RGB input"),i=[0,0,0],c=Math.min(n[0],n[1],n[2]),s=Math.max(n[0],n[1],n[2]),a=s-c;if(i[2]=.5*(s+c),a===0)return i;i[1]=i[2]<.5?a/(s+c):a/(2-s-c);const h=((s-n[0])/6+a/2)/a,g=((s-n[1])/6+a/2)/a,_=((s-n[2])/6+a/2)/a;return n[0]===s?i[0]=_-g:n[1]===s?i[0]=h-_+1/3:i[0]=g-h+2/3,i}static lab2xyz(r){const n=m.clampf3(r,"LAB input"),i=(100*n[0]+16)/116,c=(256*n[1]-128)/500+i,s=i-(256*n[2]-128)/200,a=Math.pow(c,3),h=Math.pow(i,3),g=Math.pow(s,3);return[.95047*(a>.008856?a:(c-16/116)/7.787),1*(h>.008856?h:(i-16/116)/7.787),1.08883*(g>.008856?g:(s-16/116)/7.787)]}static xyz2lab(r){const n=[r[0]/.95047,r[1]/1,r[2]/1.08883],i=n[0]>.008856?Math.cbrt(n[0]):7.787*n[0]+16/116,c=n[1]>.008856?Math.cbrt(n[1]):7.787*n[1]+16/116,s=n[2]>.008856?Math.cbrt(n[2]):7.787*n[2]+16/116;return m.clampf3([(116*c-16)/100,(500*(i-c)+128)/256,(200*(c-s)+128)/256])}static xyz2rgb(r){const n=2.04137*r[0]+-.56495*r[1]+-.34469*r[2],i=-.96927*r[0]+1.87601*r[1]+.04156*r[2],c=.01345*r[0]+-.11839*r[1]+1.01541*r[2];return m.clampf3([n>0?Math.pow(n,1/2.19921875):0,i>0?Math.pow(i,1/2.19921875):0,c>0?Math.pow(c,1/2.19921875):0])}static rgb2xyz(r){const n=m.clampf3(r,"RGB input"),i=Math.pow(n[0],2.19921875),c=Math.pow(n[1],2.19921875),s=Math.pow(n[2],2.19921875);return[.57667*i+.18555*c+.18819*s,.29738*i+.62735*c+.07527*s,.02703*i+.07069*c+.9911*s]}static lab2rgb(r){return f.xyz2rgb(f.lab2xyz(r))}static rgb2lab(r){return f.xyz2lab(f.rgb2xyz(r))}static cmyk2rgb(r){const n=m.clampf4(r,"CMYK input"),i=1-n[3];return[(1-n[0])*i,(1-n[1])*i,(1-n[2])*i]}static rgb2cmyk(r){const n=m.clampf3(r,"RGB input"),i=1-Math.max(n[0],n[1],n[2]),c=1-i,s=c===0?0:1/c;return[(c-n[0])*s,(c-n[1])*s,(c-n[2])*s,i]}static hex2rgba(r){const n=[0,0,0,f.DEFAULT_ALPHA];if(!f.HEX_FORMAT_REGEX.test(r))return b.log(b.LogLevel.Warning,`hexadecimal RGBA color string must conform to either '0x0000', '#0000', '0000', '0x00000000', '#00000000', or '00000000', given '${r}'`),n;const i=r.startsWith("0x")?2:r.startsWith("#")?1:0,c=Math.floor((r.length-i)/3),s=c-1;return n[0]=parseInt(r[i+0*c]+r[i+0*c+s],16)/255,n[1]=parseInt(r[i+1*c]+r[i+1*c+s],16)/255,n[2]=parseInt(r[i+2*c]+r[i+2*c+s],16)/255,r.length-i!=4&&r.length-i!=8||(n[3]=parseInt(r[i+3*c]+r[i+3*c+s],16)/255),b.assert(!(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])),`expected well formated hexadecimal RGBA string, given '${r}'`),n}static rgb2hex(r){const n=m.clampf3(r,"RGB input");return"#"+f.to2CharHexCode(n[0])+f.to2CharHexCode(n[1])+f.to2CharHexCode(n[2])}static rgba2hex(r){const n=m.clampf4(r,"RGBA input");return"#"+f.to2CharHexCode(n[0])+f.to2CharHexCode(n[1])+f.to2CharHexCode(n[2])+f.to2CharHexCode(n[3])}static lerp(r,n,i,c=f.Space.LAB){if(i<=0)return new f(r.rgba);if(i>=1)return new f(n.rgba);const s=d.vec4.create();switch(c){case f.Space.CMYK:d.vec4.lerp(s,r.cmyk,n.cmyk,i);const a=u.mix(r.a,n.a,i);return new f().fromCMYK(s[0],s[1],s[2],s[3],a);case f.Space.LAB:return d.vec4.lerp(s,r.laba,n.laba,i),new f().fromLAB(s[0],s[1],s[2],s[3]);case f.Space.HSL:return d.vec4.lerp(s,r.hsla,n.hsla,i),new f().fromHSL(s[0],s[1],s[2],s[3]);case f.Space.RGB:return d.vec4.lerp(s,r.rgba,n.rgba,i),new f().fromRGB(s[0],s[1],s[2],s[3])}}equals(r){return m.equals4(this._rgba,r._rgba)}fromF32(r,n,i,c=f.DEFAULT_ALPHA){const s=m.duplicate4(this._rgba);return this._rgba[0]=m.clampf(r,"red value"),this._rgba[1]=m.clampf(n,"green value"),this._rgba[2]=m.clampf(i,"blue value"),this._rgba[3]=m.clampf(c,"alpha value"),this._altered=!m.equals4(this._rgba,s),this}fromUI8(r,n,i,c=Math.floor(255*f.DEFAULT_ALPHA)){const s=m.duplicate4(this._rgba);return this._rgba[0]=u.clamp(r,0,255)/255,this._rgba[1]=u.clamp(n,0,255)/255,this._rgba[2]=u.clamp(i,0,255)/255,this._rgba[3]=u.clamp(c,0,255)/255,this._altered=!m.equals4(this._rgba,s),this}fromRGB(r,n,i,c=f.DEFAULT_ALPHA){const s=m.duplicate4(this._rgba);return this._rgba=m.clampf4([r,n,i,c],"RGBA input"),this._altered=!m.equals4(this._rgba,s),this}fromHSL(r,n,i,c=f.DEFAULT_ALPHA){const s=m.duplicate4(this._rgba),a=f.hsl2rgb([r,n,i]),h=m.clampf(c,"ALPHA input");return this._rgba=[a[0],a[1],a[2],h],this._altered=!m.equals4(this._rgba,s),this}fromLAB(r,n,i,c=f.DEFAULT_ALPHA){const s=m.duplicate4(this._rgba),a=f.lab2rgb([r,n,i]),h=m.clampf(c,"ALPHA input");return this._rgba=[a[0],a[1],a[2],h],this._altered=!m.equals4(this._rgba,s),this}fromCMYK(r,n,i,c,s=f.DEFAULT_ALPHA){const a=m.duplicate4(this._rgba),h=f.cmyk2rgb([r,n,i,c]),g=m.clampf(s,"ALPHA input");return this._rgba=[h[0],h[1],h[2],g],this._altered=!m.equals4(this._rgba,a),this}fromHex(r){const n=m.duplicate4(this._rgba);return this._rgba=f.hex2rgba(r),this._altered=!m.equals4(this._rgba,n),this}gray(r=f.GrayscaleAlgorithm.LinearLuminance){switch(r){case f.GrayscaleAlgorithm.Average:return(this._rgba[0]+this._rgba[1]+this._rgba[2])/3;case f.GrayscaleAlgorithm.LeastSaturatedVariant:return .5*(Math.max(this._rgba[0],this._rgba[1],this._rgba[2])-Math.min(this._rgba[0],this._rgba[1],this._rgba[2]));case f.GrayscaleAlgorithm.MinimumDecomposition:return Math.min(this._rgba[0],this._rgba[1],this._rgba[2]);case f.GrayscaleAlgorithm.MaximumDecomposition:return Math.max(this._rgba[0],this._rgba[1],this._rgba[2]);case f.GrayscaleAlgorithm.LinearLuminance:return .2126*this._rgba[0]+.7152*this._rgba[1]+.0722*this._rgba[2]}}tuple(r,n=!0){switch(r){case f.Space.RGB:return n?this.rgba:this.rgb;case f.Space.LAB:return n?this.laba:this.lab;case f.Space.CMYK:return n?this.cmyka:this.cmyk;case f.Space.HSL:return n?this.hsla:this.hsl}}get rgb(){return[this._rgba[0],this._rgba[1],this._rgba[2]]}get rgbUI8(){const r=new Uint8Array(3);return r[0]=Math.round(255*this._rgba[0]),r[1]=Math.round(255*this._rgba[1]),r[2]=Math.round(255*this._rgba[2]),r}get rgbF32(){const r=new Float32Array(3);return r[0]=this._rgba[0],r[1]=this._rgba[1],r[2]=this._rgba[2],r}get rgba(){return this._rgba}get rgbaUI8(){const r=new Uint8Array(4);return r[0]=Math.round(255*this._rgba[0]),r[1]=Math.round(255*this._rgba[1]),r[2]=Math.round(255*this._rgba[2]),r[3]=Math.round(255*this._rgba[3]),r}get rgbaF32(){return new Float32Array(this._rgba)}get r(){return this._rgba[0]}get g(){return this._rgba[1]}get b(){return this._rgba[2]}get a(){return this._rgba[3]}get hexRGB(){return f.rgb2hex(this.rgb)}get hexRGBA(){return f.rgba2hex(this._rgba)}get hsl(){return f.rgb2hsl(this.rgb)}get hsla(){const r=f.rgb2hsl(this.rgb);return[r[0],r[1],r[2],this._rgba[3]]}get lab(){return f.rgb2lab(this.rgb)}get laba(){const r=f.rgb2lab(this.rgb);return[r[0],r[1],r[2],this._rgba[3]]}get cmyk(){return f.rgb2cmyk(this.rgb)}get cmyka(){const r=f.rgb2cmyk(this.rgb);return[r[0],r[1],r[2],r[3],this._rgba[3]]}get altered(){return this._altered}set altered(r){this._altered=r}}p.Color=f,f.DEFAULT_ALPHA=1,f.HEX_FORMAT_REGEX=new RegExp(/^(#|0x)?(([0-9a-f]{3}){1,2}|([0-9a-f]{4}){1,2})$/i),function(o){(function(r){r.Average="average",r.LinearLuminance="linear-luminance",r.LeastSaturatedVariant="least-saturated-variant",r.MinimumDecomposition="minimum-decomposition",r.MaximumDecomposition="maximum-decomposition"})(o.GrayscaleAlgorithm||(o.GrayscaleAlgorithm={})),function(r){r.RGB="rgb",r.HSL="hsl",r.LAB="lab",r.CMYK="cmyk"}(o.Space||(o.Space={}))}(f=p.Color||(p.Color={}))},5252:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.ColorScale=void 0;const d=v(2111),u=v(9696),b=v(7677),m=v(6869);class f{constructor(){this._hint=f.InterpolationHint.Linear,this._colors=new Array,this._inverted=!1}static stride(r){switch(r){case f.ArrayType.RGBA:case f.ArrayType.RGBAf:return 4;case f.ArrayType.RGB:case f.ArrayType.RGBf:default:return 3}}static fromPreset(r,n,i){return m.fetchJsonAsync(r,c=>{let s;for(const w of c)if(w.identifier===n){s=w;break}if(s===void 0)return;const a=s.format,h=f.stride(a),g=s.colors;let _=g.length-1;for(let w=0;w<g.length;++w)if(g[w].length===i*h){_=w;break}const T=g[_],y=s.positions;if(y===void 0)return f.fromArray(T,a,i,void 0);let A;for(let w=0;w<y.length;++w)y[w].length===T.length&&(A=y[w]);return f.fromArray(T,a,i,A)},f.SCHEMA.properties)}static fromArray(r,n,i,c){if(i===0||r.length===0)return new f;const s=r,a=f.stride(n),h=s.length/a,g=new Array(h);for(let w=0;w<s.length;w+=a){const L=new b.Color;switch(n){case f.ArrayType.RGB:L.fromUI8(s[w+0],s[w+1],s[w+2]);break;case f.ArrayType.RGBA:L.fromUI8(s[w+0],s[w+1],s[w+2],s[w+3]);break;case f.ArrayType.RGBf:L.fromF32(s[w+0],s[w+1],s[w+2]);break;case f.ArrayType.RGBAf:L.fromF32(s[w+0],s[w+1],s[w+2],s[w+3])}g[w/a]=L}const _=new f;if(c===void 0&&i===h)return _._colors=g,_;if(i===1&&_._colors.push(g[0]),c===void 0){(c=new Array(h))[0]=0;for(let w=1;w<h;++w)c[w]=w/(h-1)}u.assert(c.length===g.length,`expected number of positions (${c.length}) to match number of colors (${g.length})`);let T=0,y=T+1;const A=h-1;for(let w=0;w<i;++w){const L=w===0?0:w/(i-1);if(L<=c[T]){_._colors.push(g[T]);continue}if(c[A]<=L){_._colors.push(g[A]);continue}for(let j=T+1;j<h;++j)if(!(c[j]<L)){y=j,T=j-1;break}const D=(L-c[T])/(c[y]-c[T]);_._colors.push(b.Color.lerp(g[T],g[y],D,b.Color.Space.LAB))}return _}lerp(r,n=b.Color.Space.LAB){if(this._colors.length===0)return;if(this._colors.length===1)return this._colors[0];const i=d.clamp(r,0,1);if(i<=0)return this._colors[0];if(i>=1)return this._colors[this._colors.length-1];const c=r*this._colors.length,s=Math.floor(c),a=s+1;return a>=this._colors.length?this._colors[this._colors.length-1]:(u.assert(a<this._colors.length,`expected upper not exceed maximum color index: ${a} < ${this._colors.length}`),this._hint===f.InterpolationHint.Nearest?this._colors[c-s<=a-c?s:a]:b.Color.lerp(this._colors[s],this._colors[a],c-s,n))}color(r){if(!(r<0||r>=this._colors.length))return this._colors[r]}get colors(){return this._colors}set colors(r){this._colors=r}set hint(r){this._hint=r}get hint(){return this._hint}get length(){return this._colors.length}get inverted(){return this._inverted}invert(){this._colors.reverse(),this._inverted=!this._inverted}bitsUI8(r=b.Color.Space.RGB,n=!0){const i=this._colors.length,c=n?4:3,s=new Uint8Array(i*c);for(let a=0;a<i;++a){const h=this._colors[a].tuple(r,n);s[a*c+0]=255*h[0],s[a*c+1]=255*h[1],s[a*c+2]=255*h[2],n&&h.length===4&&(s[a*c+3]=255*h[3])}return s}bitsF32(r=b.Color.Space.RGB,n=!0){const i=this._colors.length,c=n?4:3,s=new Float32Array(i*c);for(let a=0;a<i;++a){const h=this._colors[a].tuple(r,n);s[a*c+0]=h[0],s[a*c+1]=h[1],s[a*c+2]=h[2],n&&h.length===4&&(s[a*c+3]=h[3])}return s}}p.ColorScale=f,f.SCHEMA=v(8632),function(o){(function(r){r.Linear="linear",r.Nearest="nearest"})(o.InterpolationHint||(o.InterpolationHint={})),function(r){r.sequential="sequential",r.diverging="diverging",r.qualitative="qualitative"}(o.ScaleType||(o.ScaleType={})),function(r){r.RGB="rgb",r.RGBf="rgbf",r.RGBA="rgba",r.RGBAf="rgbaf"}(o.ArrayType||(o.ArrayType={}))}(f=p.ColorScale||(p.ColorScale={}))},4518:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Context=void 0;const d=v(9696),u=v(423),b=v(7945),m=v(1985),f=v(8600),o=v(9568),r=v(5218);class n{constructor(c,s){this._attributes=void 0,this._extensions=new Array,this._allocationRegister=new b.AllocationRegister,this._context=c,this._mask=s;const a=c.toString();{const h=/WebGLRenderingContext/.test(a)||/CaptureContext/.test(a),g=/WebGL2RenderingContext/.test(a);this._backend=h?n.BackendType.WebGL1:g?n.BackendType.WebGL2:void 0}if(d.assert(this._backend!==void 0&&this._backend.valueOf()!==n.BackendType.Invalid.valueOf(),`context is neither webgl nor webgl2, given ${a}`),this.queryAttributes(),this.queryExtensionSupport(),this._mask&&this._mask.functionsUndefine)for(const h in this._mask.functionsUndefine)this._context[h]=void 0;this._gl2=new r.GL2Facade(this)}static createMasqueradeFromGETorDataAttribute(c){return m.ContextMasquerade.fromGET()||(c.msqrdH?m.ContextMasquerade.fromHash(c.msqrdH):c.msqrdP?m.ContextMasquerade.fromPreset(c.msqrdP):void 0)}static request(c,s=n.DEFAULT_ATTRIBUTES){const a=c.dataset,h=n.createMasqueradeFromGETorDataAttribute(a);let g,_=h?h.backend:a.backend?a.backend.toLowerCase():"auto";switch(_ in n.BackendRequestType||(d.log(d.LogLevel.Warning,`unknown backend '${a.backend}' changed to '${n.BackendRequestType.auto}'`),_="auto"),_){case n.BackendRequestType.webgl:break;case n.BackendRequestType.experimental:case n.BackendRequestType.webgl1:case n.BackendRequestType.experimental1:_=n.BackendRequestType.webgl;break;case n.BackendRequestType.webgl2:case n.BackendRequestType.experimental2:_=n.BackendRequestType.webgl2;break;default:_=n.BackendRequestType.auto}return _!==n.BackendRequestType.webgl&&(g=this.requestWebGL2(c,s)),g||(g=this.requestWebGL1(c,s),d.logIf(g!==void 0&&_===n.BackendRequestType.webgl2,d.LogLevel.Info,`backend changed to '${n.BackendRequestType.webgl}', given '${_}'`)),d.assert(!!g,"creating a context failed"),new n(g,h)}static requestWebGL1(c,s=n.DEFAULT_ATTRIBUTES){let a=c.getContext(n.BackendRequestType.webgl,s);return a||(a=c.getContext(n.BackendRequestType.experimental,s),a===null?void 0:a)}static requestWebGL2(c,s=n.DEFAULT_ATTRIBUTES){let a=c.getContext(n.BackendRequestType.webgl2,s);return a||(a=c.getContext(n.BackendRequestType.experimental2,s),a===null?void 0:a)}queryAttributes(){const c=this._context.getContextAttributes();c!==null?this._attributes=c:d.log(d.LogLevel.Error,"querying context attributes failed (probably blocked)")}get alpha(){return!!this._attributes&&this._attributes.alpha}get antialias(){return!!this._attributes&&this._attributes.antialias}get depth(){return!!this._attributes&&this._attributes.depth}get failIfMajorPerformanceCaveat(){return!!this._attributes&&this._attributes.failIfMajorPerformanceCaveat}get premultipliedAlpha(){return!!this._attributes&&this._attributes.premultipliedAlpha}get preserveDrawingBuffer(){return!!this._attributes&&this._attributes.preserveDrawingBuffer}get stencil(){return!!this._attributes&&this._attributes.stencil}supports(c){if(this._mask&&this._mask.extensionsConceal.indexOf(c)>-1)return!1;switch(this._backend){case n.BackendType.WebGL1:d.assert(f.WEBGL1_EXTENSIONS.indexOf(c)>-1,`extension ${c} not available to WebGL1`);break;case n.BackendType.WebGL2:d.assert(f.WEBGL2_DEFAULT_EXTENSIONS.indexOf(c)===-1,`extension ${c} supported by default in WebGL2`),d.assert(f.WEBGL2_EXTENSIONS.indexOf(c)>-1,`extension ${c} not available to WebGL2`)}return this._extensions.indexOf(c)>-1}enable(c){for(const s of c)this.isWebGL1&&f.WEBGL1_EXTENSIONS.indexOf(s)===-1||this.isWebGL2&&f.WEBGL2_EXTENSIONS.indexOf(s)===-1||this.supports(s)!==!1&&this.extension(void 0,s)}queryExtensionSupport(){const c=this._context.getSupportedExtensions();if(c!==null){for(const s of c)this._mask&&this._mask.extensionsConceal.indexOf(s)>-1||this._extensions.push(s);this._backend===n.BackendType.WebGL1&&(this.ANGLE_instanced_arrays_supported=this.supports("ANGLE_instanced_arrays"),this.EXT_blend_minmax_supported=this.supports("EXT_blend_minmax"),this.EXT_color_buffer_half_float_supported=this.supports("EXT_color_buffer_half_float"),this.EXT_disjoint_timer_query_supported=this.supports("EXT_disjoint_timer_query"),this.EXT_frag_depth_supported=this.supports("EXT_frag_depth"),this.EXT_sRGB_supported=this.supports("EXT_sRGB"),this.EXT_shader_texture_lod_supported=this.supports("EXT_shader_texture_lod"),this.OES_element_index_uint_supported=this.supports("OES_element_index_uint"),this.OES_standard_derivatives_supported=this.supports("OES_standard_derivatives"),this.OES_texture_float_supported=this.supports("OES_texture_float"),this.OES_texture_half_float_supported=this.supports("OES_texture_half_float"),this.OES_vertex_array_object_supported=this.supports("OES_vertex_array_object"),this.WEBGL_color_buffer_float_supported=this.supports("WEBGL_color_buffer_float"),this.WEBGL_depth_texture_supported=this.supports("WEBGL_depth_texture"),this.WEBGL_draw_buffers_supported=this.supports("WEBGL_draw_buffers")),this._backend===n.BackendType.WebGL2&&(this.EXT_color_buffer_float_supported=this.supports("EXT_color_buffer_float"),this.EXT_disjoint_timer_query_webgl2_supported=this.supports("EXT_disjoint_timer_query_webgl2")),this.EXT_texture_filter_anisotropic_supported=this.supports("EXT_texture_filter_anisotropic"),this.OES_texture_float_linear_supported=this.supports("OES_texture_float_linear"),this.OES_texture_half_float_linear_supported=this.supports("OES_texture_half_float_linear"),this.WEBGL_compressed_texture_astc_supported=this.supports("WEBGL_compressed_texture_astc"),this.WEBGL_compressed_texture_atc_supported=this.supports("WEBGL_compressed_texture_atc"),this.WEBGL_compressed_texture_etc_supported=this.supports("WEBGL_compressed_texture_etc"),this.WEBGL_compressed_texture_etc1_supported=this.supports("WEBGL_compressed_texture_etc1"),this.WEBGL_compressed_texture_pvrtc_supported=this.supports("WEBGL_compressed_texture_pvrtc"),this.WEBGL_compressed_texture_s3tc_supported=this.supports("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb_supported=this.supports("WEBGL_compressed_texture_s3tc_srgb"),this.WEBGL_debug_renderer_info_supported=this.supports("WEBGL_debug_renderer_info"),this.WEBGL_debug_shaders_supported=this.supports("WEBGL_debug_shaders"),this.WEBGL_lose_context_supported=this.supports("WEBGL_lose_context")}else d.log(d.LogLevel.Error,"querying supported extensions failed (probably blocked)")}extension(c,s){return c===void 0&&(d.assert(this.supports(s),`extension ${s} expected to be supported`),c=this._context.getExtension(s)),c}get allocationRegister(){return this._allocationRegister}get backend(){return this._backend}get backendString(){switch(this._backend){case n.BackendType.WebGL1:return"WebGL";case n.BackendType.WebGL2:return"WebGL2";default:return}}get extensions(){return this._extensions}get mask(){return this._mask}get gl(){return this._context}get gl2facade(){return this._gl2}get isWebGL1(){return this._backend===n.BackendType.WebGL1}get isWebGL2(){return this._backend===n.BackendType.WebGL2}get supportsInstancedArrays(){return this.ANGLE_instanced_arrays_supported}get instancedArrays(){return this.extension(this.ANGLE_instanced_arrays,"ANGLE_instanced_arrays")}get supportsBlendMinmax(){return this.EXT_blend_minmax_supported}get blendMinmax(){return this.extension(this.EXT_blend_minmax,"EXT_blend_minmax")}get supportsColorBufferHalfFloat(){return this.EXT_color_buffer_half_float_supported}get colorBufferHalfFloat(){return this.extension(this.EXT_color_buffer_half_float,"EXT_color_buffer_half_float")}get supportsDisjointTimerQuery(){return this.EXT_disjoint_timer_query_supported}get disjointTimerQuery(){return this.extension(this.EXT_disjoint_timer_query,"EXT_disjoint_timer_query")}get supportsDisjointTimerQueryWebGL2(){return this.EXT_disjoint_timer_query_webgl2_supported}get disjointTimerQueryWebGL2(){return this.extension(this.EXT_disjoint_timer_query_webgl2,"EXT_disjoint_timer_query_webgl2")}get supportsFragDepth(){return this.EXT_frag_depth_supported}get fragDepth(){return this.extension(this.EXT_frag_depth,"EXT_frag_depth")}get supportsSRGB(){return this.EXT_sRGB_supported}get sRGB(){return this.extension(this.EXT_sRGB,"EXT_sRGB")}get supportsShaderTextureLOD(){return this.EXT_shader_texture_lod_supported}get shaderTextureLOD(){return this.extension(this.EXT_shader_texture_lod,"EXT_shader_texture_lod")}get supportsTextureFilterAnisotropic(){return this.EXT_texture_filter_anisotropic_supported}get textureFilterAnisotropic(){return this.extension(this.EXT_texture_filter_anisotropic,"EXT_texture_filter_anisotropic")}get supportsElementIndexUint(){return this.OES_element_index_uint_supported}get elementIndexUint(){return this.extension(this.OES_element_index_uint,"OES_element_index_uint")}get supportsStandardDerivatives(){return this.OES_standard_derivatives_supported}get standardDerivatives(){return this.extension(this.OES_standard_derivatives,"OES_standard_derivatives")}get supportsTextureFloat(){return this.OES_texture_float_supported}get textureFloat(){return this.extension(this.OES_texture_float,"OES_texture_float")}get supportsTextureFloatLinear(){return this.OES_texture_float_linear_supported}get textureFloatLinear(){return this.extension(this.OES_texture_float_linear,"OES_texture_float_linear")}get supportsTextureHalfFloat(){return this.OES_texture_half_float_supported}get textureHalfFloat(){return this.extension(this.OES_texture_half_float,"OES_texture_half_float")}get supportsTextureHalfFloatLinear(){return this.OES_texture_half_float_linear_supported}get textureHalfFloatLinear(){return this.extension(this.OES_texture_half_float_linear,"OES_texture_half_float_linear")}get supportsVertexArrayObject(){return this.OES_vertex_array_object_supported}get vertexArrayObject(){return this.extension(this.OES_vertex_array_object,"OES_vertex_array_object")}get supportsColorBufferFloat(){switch(this._backend){case n.BackendType.WebGL1:return this.WEBGL_color_buffer_float_supported;case n.BackendType.WebGL2:return this.EXT_color_buffer_float_supported;default:return}}get colorBufferFloat(){switch(this._backend){case n.BackendType.WebGL1:return this.extension(this.WEBGL_color_buffer_float,"WEBGL_color_buffer_float");case n.BackendType.WebGL2:return this.extension(this.EXT_color_buffer_float,"EXT_color_buffer_float");default:return}}get supportsCompressedTextureASTC(){return this.WEBGL_compressed_texture_astc_supported}get compressedTextureASTC(){return this.extension(this.WEBGL_compressed_texture_astc,"WEBGL_compressed_texture_astc")}get supportsCompressedTextureATC(){return this.WEBGL_compressed_texture_atc_supported}get compressedTextureATC(){return this.extension(this.WEBGL_compressed_texture_atc,"WEBGL_compressed_texture_atc")}get supportsCompressedTextureETC(){return this.WEBGL_compressed_texture_etc_supported}get compressedTextureETC(){return this.extension(this.WEBGL_compressed_texture_etc,"WEBGL_compressed_texture_etc")}get supportsCompressedTextureETC1(){return this.WEBGL_compressed_texture_etc1_supported}get compressedTextureETC1(){return this.extension(this.WEBGL_compressed_texture_etc1,"WEBGL_compressed_texture_etc1")}get supportsCompressedTexturePVRTC(){return this.WEBGL_compressed_texture_pvrtc_supported}get compressedTexturePVRTC(){return this.extension(this.WEBGL_compressed_texture_pvrtc,"WEBGL_compressed_texture_pvrtc")}get supportsCompressedTextureS3TC(){return this.WEBGL_compressed_texture_s3tc_supported}get compressedTextureS3TC(){return this.extension(this.WEBGL_compressed_texture_s3tc,"WEBGL_compressed_texture_s3tc")}get supportsCompressedTextureS3TCSRGB(){return this.WEBGL_compressed_texture_s3tc_srgb_supported}get compressedTextureS3TCSRGB(){return this.extension(this.WEBGL_compressed_texture_s3tc_srgb,"WEBGL_compressed_texture_s3tc_srgb")}get supportsDebugRendererInfo(){return this.WEBGL_debug_renderer_info_supported}get debugRendererInfo(){return this.extension(this.WEBGL_debug_renderer_info,"WEBGL_debug_renderer_info")}get supportsDebugShaders(){return this.WEBGL_debug_shaders_supported}get debugShaders(){return this.extension(this.WEBGL_debug_shaders,"WEBGL_debug_shaders")}get supportsDepthTexture(){return this.WEBGL_depth_texture_supported}get depthTexture(){return this.extension(this.WEBGL_depth_texture,"WEBGL_depth_texture")}get supportsDrawBuffers(){return this.WEBGL_draw_buffers_supported}get drawBuffers(){return this.extension(this.WEBGL_draw_buffers,"WEBGL_draw_buffers")}get supportsLoseContext(){return this.WEBGL_lose_context_supported}get loseContext(){return this.extension(this.WEBGL_lose_context,"WEBGL_lose_context")}get supportsBlitFramebuffer(){return this._context.blitFramebuffer!==void 0}get supportsReadBuffer(){return this._context.readBuffer!==void 0}get supportsTexImage3D(){return this._context.texImage3D!==void 0}param(c){return d.assert(!!this._context,"expected context to be valid"),this._context.getParameter(c)}hash(){return o.ExtensionsHash.encode(this._backend,this._extensions)}about(){const c="ok",s="na";if(this._backend===n.BackendType.Invalid)return new Array;d.assert(!!this._context,"expected context to be valid");const a=this._context,h=new Array;h.push(["BACKEND (GLOPERATE)",this.backend]),h.push(["CONTEXT_HASH (GLOPERATE)",this.hash()]),h.push(["RENDERER",this.param(a.RENDERER)]),h.push(["VENDOR",this.param(a.VENDOR)]),h.push(["VERSION",this.param(a.VERSION)]),h.push(["SHADING_LANGUAGE_VERSION",this.param(a.SHADING_LANGUAGE_VERSION)]),h.push(["UNMASKED_VENDOR_WEBGL",this.supportsDebugRendererInfo?this.param(this.debugRendererInfo.UNMASKED_VENDOR_WEBGL):s]),h.push(["UNMASKED_RENDERER_WEBGL",this.supportsDebugRendererInfo?this.param(this.debugRendererInfo.UNMASKED_RENDERER_WEBGL):s]),h.push(["ALPHA (ATTRIBUTE)",String(this.alpha)]),h.push(["ANTIALIAS (ATTRIBUTE)",String(this.antialias)]),h.push(["DEPTH (ATTRIBUTE)",String(this.depth)]),h.push(["FAIL_IF_MAJOR_PERFORMANCE_CAVEAT (ATTRIBUTE)",String(this.failIfMajorPerformanceCaveat)]),h.push(["PREMULTIPLIED_ALPHA (ATTRIBUTE)",String(this.premultipliedAlpha)]),h.push(["PRESERVE_DRAWING_BUFFER (ATTRIBUTE)",String(this.preserveDrawingBuffer)]),h.push(["STENCIL (ATTRIBUTE)",String(this.stencil)]),h.push(["DEVICE_PIXEL_RATIO (WINDOW)",window.devicePixelRatio]),h.push(["APP_CODE_NAME (NAVIGATOR)",window.navigator.appCodeName]),h.push(["APP_NAME (NAVIGATOR)",window.navigator.appName]),h.push(["APP_VERSION (NAVIGATOR)",window.navigator.appVersion]),h.push(["PLATFORM (NAVIGATOR)",window.navigator.platform]),h.push(["HARDWARE_CONCURRENCY (NAVIGATOR)",window.navigator.appCodeName]),h.push(["VENDOR (NAVIGATOR)",window.navigator.vendor]),h.push(["VENDOR_SUB (NAVIGATOR)",window.navigator.vendorSub]),h.push(["MAX_COMBINED_TEXTURE_IMAGE_UNITS",this.param(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS)]),h.push(["MAX_CUBE_MAP_TEXTURE_SIZE",this.param(a.MAX_CUBE_MAP_TEXTURE_SIZE)]),h.push(["MAX_FRAGMENT_UNIFORM_VECTORS",this.param(a.MAX_FRAGMENT_UNIFORM_VECTORS)]),h.push(["MAX_RENDERBUFFER_SIZE",this.param(a.MAX_RENDERBUFFER_SIZE)]),h.push(["MAX_TEXTURE_IMAGE_UNITS",this.param(a.MAX_TEXTURE_IMAGE_UNITS)]),h.push(["MAX_TEXTURE_SIZE",this.param(a.MAX_TEXTURE_SIZE)]),h.push(["MAX_VARYING_VECTORS",this.param(a.MAX_VARYING_VECTORS)]),h.push(["MAX_VERTEX_ATTRIBS",this.param(a.MAX_VERTEX_ATTRIBS)]),h.push(["MAX_VERTEX_TEXTURE_IMAGE_UNITS",this.param(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)]),h.push(["MAX_VERTEX_UNIFORM_VECTORS",this.param(a.MAX_VERTEX_UNIFORM_VECTORS)]);const g=this.param(a.MAX_VIEWPORT_DIMS);if(h.push(["MAX_VIEWPORT_DIMS (WIDTH)",g?g[0]:null]),h.push(["MAX_VIEWPORT_DIMS (HEIGHT)",g?g[1]:null]),this.isWebGL2){const _=this._context;h.push(["MAX_3D_TEXTURE_SIZE",this.param(_.MAX_3D_TEXTURE_SIZE)]),h.push(["MAX_ARRAY_TEXTURE_LAYERS",this.param(_.MAX_ARRAY_TEXTURE_LAYERS)]),h.push(["MAX_CLIENT_WAIT_TIMEOUT_WEBGL",this.param(_.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)]),h.push(["MAX_COLOR_ATTACHMENTS",this.param(_.MAX_COLOR_ATTACHMENTS)]),h.push(["MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",this.param(_.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS)]),h.push(["MAX_COMBINED_UNIFORM_BLOCKS",this.param(_.MAX_COMBINED_UNIFORM_BLOCKS)]),h.push(["MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",this.param(_.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS)]),h.push(["MAX_DRAW_BUFFERS",this.param(_.MAX_DRAW_BUFFERS)]),h.push(["MAX_ELEMENT_INDEX",this.param(_.MAX_ELEMENT_INDEX)]),h.push(["MAX_ELEMENTS_INDICES",this.param(_.MAX_ELEMENTS_INDICES)]),h.push(["MAX_ELEMENTS_VERTICES",this.param(_.MAX_ELEMENTS_VERTICES)]),h.push(["MAX_FRAGMENT_INPUT_COMPONENTS",this.param(_.MAX_FRAGMENT_INPUT_COMPONENTS)]),h.push(["MAX_FRAGMENT_UNIFORM_BLOCKS",this.param(_.MAX_FRAGMENT_UNIFORM_BLOCKS)]),h.push(["MAX_FRAGMENT_UNIFORM_COMPONENTS",this.param(_.MAX_FRAGMENT_UNIFORM_COMPONENTS)]),h.push(["MAX_PROGRAM_TEXEL_OFFSET",this.param(_.MAX_PROGRAM_TEXEL_OFFSET)]),h.push(["MAX_SAMPLES",this.param(_.MAX_SAMPLES)]),h.push(["MAX_SERVER_WAIT_TIMEOUT",this.param(_.MAX_SERVER_WAIT_TIMEOUT)]),h.push(["MAX_TEXTURE_LOD_BIAS",this.param(_.MAX_TEXTURE_LOD_BIAS)]),h.push(["MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",this.param(_.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS)]),h.push(["MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",this.param(_.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS)]),h.push(["MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",this.param(_.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS)]),h.push(["MAX_UNIFORM_BLOCK_SIZE",this.param(_.MAX_UNIFORM_BLOCK_SIZE)]),h.push(["MAX_UNIFORM_BUFFER_BINDINGS",this.param(_.MAX_UNIFORM_BUFFER_BINDINGS)]),h.push(["MAX_VARYING_COMPONENTS",this.param(_.MAX_VARYING_COMPONENTS)]),h.push(["MAX_VERTEX_OUTPUT_COMPONENTS",this.param(_.MAX_VERTEX_OUTPUT_COMPONENTS)]),h.push(["MAX_VERTEX_UNIFORM_BLOCKS",this.param(_.MAX_VERTEX_UNIFORM_BLOCKS)]),h.push(["MAX_VERTEX_UNIFORM_COMPONENTS",this.param(_.MAX_VERTEX_UNIFORM_COMPONENTS)]),h.push(["MIN_PROGRAM_TEXEL_OFFSET",this.param(_.MIN_PROGRAM_TEXEL_OFFSET)])}if(this.isWebGL1)for(const _ of f.WEBGL1_EXTENSIONS)h.push([_,this.supports(_)?c:s]);else if(this.isWebGL2){for(const _ of f.WEBGL2_DEFAULT_EXTENSIONS)h.push([`${_} (default)`,c]);for(const _ of f.WEBGL2_EXTENSIONS)h.push([_,this.supports(_)?c:s])}return h}aboutString(){const c=this.about();let s=0;for(const _ of c)s=Math.max(_[0].length,s);let a=0,h="";const g=this.isWebGL2?63+f.WEBGL2_DEFAULT_EXTENSIONS.length:-1;for(const _ of c){switch(a){case 2:case 6:case 8:case 15:case 16:case 23:case 35:case 63:case g:h+=`
`}h+=`  ${_[0]} ${"-".repeat(s-_[0].length)}-- ${_[1]}
`,++a}return h+=`
`,h}logAbout(c=d.LogLevel.Info){d.log(c,`context.about

`+this.aboutString())}logAboutIf(c,s=d.LogLevel.Info){d.logIf(c,s,`context.about

`+this.aboutString())}byteSizeOfFormat(c){return u.byteSizeOfFormat(this,c)}}p.Context=n,n.DEFAULT_ATTRIBUTES={alpha:!0,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},function(i){(function(c){c.Invalid="invalid",c.WebGL1="webgl1",c.WebGL2="webgl2"})(i.BackendType||(i.BackendType={})),function(c){c.auto="auto",c.webgl="webgl",c.experimental="experimental-webgl",c.webgl1="webgl1",c.experimental1="experimental-webgl1",c.webgl2="webgl2",c.experimental2="experimental-webgl2"}(i.BackendRequestType||(i.BackendRequestType={}))}(n=p.Context||(p.Context={}))},1985:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.ContextMasquerade=void 0;const d=v(9696),u=v(9568);class b{constructor(){this._extensionsStrive=new Array,this._extensionsConceal=new Array,this._functionsUndefine=new Array}static fromHash(f){const o=new b,r=u.ExtensionsHash.decode(f);return o._backend=r[0],o._extensionsStrive=r[1],o._extensionsConceal=u.ExtensionsHash.complement(o._backend,o._extensionsStrive),o}static fromPreset(f){const o=new b,r=new Array;let n;for(const i of b.presets())if(r.push(i.identifier),i.identifier===f){n=i;break}if(n===void 0&&d.assert(!1,`expected valid identifier, available ['${r.join("', '")}'], given '${f}'`),n=n,n.extensions_hash!==void 0){const i=u.ExtensionsHash.decode(n.extensions_hash);o._backend=i[0],o._extensionsStrive=i[1]}else o._backend=n.backend;return d.assert(o._backend!==void 0,"expected backend to be included in preset"),n.extensions_strive===void 0?(o._extensionsStrive=[],o._extensionsConceal=n.extensions_conceal?n.extensions_conceal:[]):(o._extensionsStrive=n.extensions_strive,o._extensionsConceal=u.ExtensionsHash.complement(o._backend,n.extensions_strive)),o._functionsUndefine=n.functions_undefine?n.functions_undefine:[],o}static fromGET(){const f=d.GETparameter("msqrd_h");if(f!==void 0)return b.fromHash(f);const o=d.GETparameter("msqrd_p");return o!==void 0?b.fromPreset(o):void 0}static presets(){return this.MASQUERADE_JSON}get backend(){return this._backend}get extensionsStrive(){return this._extensionsStrive}get extensionsConceal(){return this._extensionsConceal}get functionsUndefine(){return this._functionsUndefine}}p.ContextMasquerade=b,b.MASQUERADE_JSON=v(7456)},3863:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Controller=void 0;const d=v(7318),u=v(9696),b=v(2111);class m{constructor(){this._batchSize=1,this._multiFrameNumber=1,this._multiFrameNumberSubject=new d.ReplaySubject(1),this._debugFrameNumber=0,this._debugFrameNumberSubject=new d.ReplaySubject(1),this._frameNumber=0,this._frameNumberSubject=new d.ReplaySubject(1),this._multiFrameDelay=0,this._postFrameEventSubject=new d.Subject,this._postSwapEventSubject=new d.Subject,this._animationFrameID=0,this._block=!1,this._blockedUpdates=0,this._intermediateFrameCount=0,this._multiFrameCount=0,this._intermediateFrameTimes=new Array(2),this._multiTime=[0,0],this._invalidated=!1,this._force=!1}set debug(o){o&&u.logVerbosity()<u.LogLevel.Debug&&(u.logVerbosity(u.LogLevel.Debug),u.log(u.LogLevel.Debug,`changed log verbosity to ${u.LogLevel.Debug} (debug)`)),m._debug=o}set batch(o){u.log(u.LogLevel.Warning,"(adaptive) batch multi-frame rendering is experimental for now"),this._batchSize=Math.max(1,o)}request(o=m.RequestType.Frame){this._animationFrameID=0,this._block?this._blockedUpdates++:this._animationFrameID=window.requestAnimationFrame(()=>this.invoke(o))}invoke(o){if(this._animationFrameID!==0){if(u.assert(this._controllable!==void 0,"frame sequence invoked without controllable set"),this._invalidated&&(this._invalidated=!1,(this.invokeUpdate()||this._force)&&(this._force=!1,this._frameNumber=0,this.cancelWaitMultiFrame(),this.invokePrepare())),o===m.RequestType.Frame&&this._frameNumber===1)return this._timeoutID===void 0&&this.startWaitMultiFrame(),void(this._animationFrameID=0);this.isMultiFrameFinished()?this._animationFrameID=0:(this.invokeFrameAndSwap(),this.request())}}invokeUpdate(){return u.logIf(m._debug,u.LogLevel.Debug,`c invoke update     | pending: '${this._animationFrameID}', mfnum: ${this._multiFrameNumber}`),this._controllable.update(this._multiFrameNumber)}invokePrepare(){u.logIf(m._debug,u.LogLevel.Debug,"c invoke prepare    |"),this._multiFrameTime=0,this._intermediateFrameTimes[0]=Number.MAX_VALUE,this._intermediateFrameTimes[1]=Number.MIN_VALUE,this._multiTime[0]=performance.now(),this._controllable.prepare(),this._multiTime[1]=performance.now();const o=this._multiTime[1]-this._multiTime[0];this._multiFrameTime=o,this._updateFrameTime=o}invokeFrameAndSwap(){u.logIf(m._debug,u.LogLevel.Debug,`c invoke frame      | pending: '${this._animationFrameID}'`);const o=this._debugFrameNumber>0;u.assert(!o||this._frameNumber<this._debugFrameNumber,"frame number about to exceed debug-frame number");const r=performance.now();let n=Math.min(this._multiFrameNumber,this._frameNumber+this._batchSize);for(this._debugFrameNumber>0&&(n=Math.min(n,this._debugFrameNumber));this._frameNumber<n;++this._frameNumber)u.logIf(m._debug,u.LogLevel.Debug,`c -> frame          | frame: ${this._frameNumber}`),this._controllable.frame(this._frameNumber),this._postFrameEventSubject.next(this._frameNumber),++this._intermediateFrameCount;u.logIf(m._debug,u.LogLevel.Debug,"c -> swap           |"),this._controllable.swap(),this._postSwapEventSubject.next(this._frameNumber),this._multiTime[1]=performance.now();const i=this._multiTime[1]-r;this._multiFrameTime+=i,this._intermediateFrameTimes[0]=Math.min(this._intermediateFrameTimes[0],i),this._intermediateFrameTimes[1]=Math.max(this._intermediateFrameTimes[1],i),this.frameNumberNext()}startWaitMultiFrame(){this._timeoutID=window.setTimeout(()=>{this.request(m.RequestType.MultiFrame),this._timeoutID=void 0},this._multiFrameDelay)}cancelWaitMultiFrame(){this._timeoutID!==void 0&&(window.clearTimeout(this._timeoutID),this._timeoutID=void 0)}isMultiFrameFinished(){return this._debugFrameNumber>0?this._frameNumber===this._debugFrameNumber:this._frameNumber===this._multiFrameNumber}multiFrameNumberNext(){this._multiFrameNumberSubject.next(this._multiFrameNumber)}debugFrameNumberNext(){this._debugFrameNumberSubject.next(this._debugFrameNumber)}frameNumberNext(){this._frameNumberSubject.next(this._frameNumber)}update(o=!1){this._invalidated=!0,this._force=this._force||o,this._animationFrameID===0&&this.request()}block(){u.logIf(m._debug,u.LogLevel.Debug,`c block   ${this._block?"(ignored) ":"          "}|`),this._block=!0}unblock(){u.logIf(m._debug,u.LogLevel.Debug,"c unblock "+(this._block?"          ":"(ignored) ")+`| blocked: #${this._blockedUpdates}`),this._block&&(this._block=!1,this._blockedUpdates>0&&(this._blockedUpdates=0,this.update()))}cancel(){this._animationFrameID!==0&&(window.cancelAnimationFrame(this._animationFrameID),this._animationFrameID=0)}get blocked(){return this._block}set controllable(o){o!==this._controllable&&(this._controllable=o,this.update(!0))}get multiFrameNumber(){return this._multiFrameNumber}set multiFrameNumber(o){const r=Math.max(1,isNaN(o)?1:o);r!==this._multiFrameNumber&&(this._multiFrameNumber=r,this.multiFrameNumberNext(),u.logIf(r!==o,u.LogLevel.Debug,`multi-frame number adjusted to ${r}, given ${o}`),this.debugFrameNumber>this.multiFrameNumber?this.debugFrameNumber=this.multiFrameNumber:this.update())}get multiFrameNumber$(){return this._multiFrameNumberSubject.asObservable()}get debugFrameNumber(){return this._debugFrameNumber}set debugFrameNumber(o){const r=b.clamp(isNaN(o)?0:o,0,this.multiFrameNumber);r!==this._debugFrameNumber&&(this._debugFrameNumber=r,this.debugFrameNumberNext(),u.logIf(r!==o,u.LogLevel.Debug,`debug-frame number adjusted to ${r}, given ${o}`),this.update(this.debugFrameNumber<this._frameNumber))}get debugFrameNumber$(){return this._debugFrameNumberSubject.asObservable()}set multiFrameDelay(o){const r=Math.max(0,o);r!==this._multiFrameDelay&&(this._multiFrameDelay=r)}get multiFrameDelay(){return this._multiFrameDelay}get frameNumber(){return this._frameNumber}get frameNumber$(){return this._frameNumberSubject.asObservable()}get intermediateFrameCount(){return this._intermediateFrameCount}get multiFrameCount(){return this._multiFrameCount}get averageFrameTime(){return this._frameNumber===0?0:this._multiFrameTime/this._frameNumber}get updateFrameTime(){return this._updateFrameTime}get minimumFrameTime(){return this._intermediateFrameTimes[0]}get maximumFrameTime(){return this._intermediateFrameTimes[1]}get multiFrameTime(){return this._frameNumber===0?0:this._multiTime[1]-this._multiTime[0]}get framesPerSecond(){return this._frameNumber===0?0:1e3/(this.multiFrameTime/this._frameNumber)}get postFrameEvent$(){return this._postFrameEventSubject.asObservable()}get postSwapEvent$(){return this._postSwapEventSubject.asObservable()}}p.Controller=m,m._debug=!1,function(f){(function(o){o[o.Frame=0]="Frame",o[o.MultiFrame=1]="MultiFrame"})(f.RequestType||(f.RequestType={}))}(m=p.Controller||(p.Controller={}))},2380:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.CuboidGeometry=void 0;const d=v(3659),u=v(6404),b=v(4894);class m extends b.Geometry{constructor(o,r,n=!1,i=[1,1,1]){super(o,r),this._vertexLocation=0,this._extent=d.vec3.fromValues(1,1,1),this._uvCoordinates=!1,r=r!==void 0&&r!==""?r:this.constructor.name;const c=new u.Buffer(o,r+"VBO");this._buffers.push(c);const s=new u.Buffer(o,`${r}IndicesVBO`);this._buffers.push(s),this._extent=d.vec3.clone(i),this._uvCoordinates=n}bindBuffers(){this._uvCoordinates===!1?this._buffers[0].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,0,0,!0,!1):(this._buffers[0].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,20,0,!0,!1),this._buffers[0].attribEnable(this._uvCoordLocation,2,this.context.gl.FLOAT,!1,20,12,!1,!1)),this._buffers[1].bind()}unbindBuffers(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0),this._uvCoordinates&&this._buffers[0].attribDisable(this._uvCoordLocation,!1,!0),this._buffers[1].unbind()}initialize(o=0,r=1){this._vertexLocation=o,this._uvCoordLocation=r;const n=this.context.gl,i=super.initialize([n.ARRAY_BUFFER,n.ELEMENT_ARRAY_BUFFER],[o,r]),c=this._uvCoordinates;let s=c?m.VERTICES_UV:m.VERTICES;return s=s.map((a,h)=>a*(c===!1?.5*this._extent[h%3]:h%5<3?.5*this._extent[h%5]:1)),this._buffers[0].data(s,n.STATIC_DRAW),this._buffers[1].data(c?m.INDICES_UV:m.INDICES,n.STATIC_DRAW),this._count=c?m.INDICES_UV.length:m.INDICES.length,i}draw(){const o=this.context.gl;o.drawElements(o.TRIANGLE_STRIP,this._count,o.UNSIGNED_BYTE,0)}get vertexLocation(){return this._vertexLocation}get uvCoordLocation(){return this._uvCoordLocation}get extent(){return this._extent}}p.CuboidGeometry=m,m.VERTICES=new Float32Array([-1,-1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),m.INDICES=new Uint8Array([0,1,2,3,7,1,5,4,7,6,2,4,0,1]),m.VERTICES_UV=new Float32Array([-1,-1,1,0,0,1,-1,1,1,0,-1,1,1,0,1,1,1,1,1,1,-1,1,1,0,0,1,1,1,1,0,1,1,-1,1,1,1,1,1,0,1,1,-1,1,0,0,1,-1,-1,1,0,1,-1,1,1,1,-1,-1,-1,0,0,1,-1,-1,0,0,-1,-1,-1,1,0,1,1,-1,0,1,-1,1,-1,1,1,-1,1,-1,0,1,-1,1,1,1,1,-1,-1,1,1,0,-1,-1,1,0,1]),m.INDICES_UV=new Uint8Array([3,2,1,0,10,19,11,18,11,17,16,4,16,5,6,7,6,8,9,10,9,11,12,13,14,15])},7922:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GeosphereGeometry=void 0;const d=v(9696),u=v(6404),b=v(4894),m=v(7498);class f extends b.Geometry{constructor(r,n,i=1,c=!0){super(r,n),this._diameter=1,this._textured=!1,this._size=0,n=n!==void 0&&n!==""?n:this.constructor.name,this._diameter=i,this._textured=c;const s=new u.Buffer(r,n+"IndexBuffer");this._buffers.push(s);const a=new u.Buffer(r,n+"VBO");if(this._buffers.push(a),this._textured){const h=new u.Buffer(r,n+"UV");this._buffers.push(h)}}bindBuffers(){this._buffers[0].bind(),this._buffers[1].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,0,0,!0,!1),this._textured&&this._buffers[2].attribEnable(this._texCoordLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1)}unbindBuffers(){this._buffers[0].unbind(),this._buffers[1].attribDisable(this._vertexLocation,!0,!0),this._textured&&this._buffers[2].attribDisable(this._texCoordLocation,!0,!0)}initialize(r=0,n=1){const i=this.context.gl;this._vertexLocation=r,this._texCoordLocation=n;const c=super.initialize([i.ELEMENT_ARRAY_BUFFER,i.ARRAY_BUFFER,i.ARRAY_BUFFER],[8,r,n]);d.assert(this._buffers[0]!==void 0&&this._buffers[0].object instanceof WebGLBuffer,"expected valid WebGLBuffer"),d.assert(this._buffers[1]!==void 0&&this._buffers[1].object instanceof WebGLBuffer,"expected valid WebGLBuffer"),this._textured&&d.assert(this._buffers[2]!==void 0&&this._buffers[2].object instanceof WebGLBuffer,"expected valid WebGLBuffer");const s=new m.Icosahedron;s.generateGeometry(3),this._textured&&s.generateTextureCoordinates();const a=s.faces,h=new Uint16Array(3*a.length);let g=0;for(const y of a)h[g+0]=y[0],h[g+1]=y[1],h[g+2]=y[2],g+=3;this._buffers[0].data(h,i.STATIC_DRAW),this._size=3*a.length;const _=s.vertices,T=new Float32Array(3*_.length);g=0;for(const y of _)T[g+0]=y[0]*this._diameter,T[g+1]=y[1]*this._diameter,T[g+2]=y[2]*this._diameter,g+=3;if(this._buffers[1].data(T,i.STATIC_DRAW),this._textured){const y=s.texcoords,A=new Float32Array(2*y.length);if(y&&y.length>0){g=0;for(const w of y)A[g+0]=w[0],A[g+1]=w[1],g+=2}this._buffers[2].data(A,i.STATIC_DRAW)}return c}draw(){const r=this.context.gl;r.drawElements(r.TRIANGLES,this._size,r.UNSIGNED_SHORT,0)}get vertexLocation(){return this._vertexLocation}get texCoordLocation(){return this._texCoordLocation}}p.GeosphereGeometry=f},7498:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Icosahedron=void 0;const d=v(3659),u=v(2111);p.Icosahedron=class{constructor(){}baseVertices(){const b=.5*(1+Math.sqrt(5)),m=1/Math.sqrt(b*b+1),f=b*m;return[d.vec3.fromValues(-m,+f,0),d.vec3.fromValues(+m,+f,0),d.vec3.fromValues(-m,-f,0),d.vec3.fromValues(+m,-f,0),d.vec3.fromValues(0,-m,+f),d.vec3.fromValues(0,+m,+f),d.vec3.fromValues(0,-m,-f),d.vec3.fromValues(0,+m,-f),d.vec3.fromValues(+f,0,-m),d.vec3.fromValues(+f,0,+m),d.vec3.fromValues(-f,0,-m),d.vec3.fromValues(-f,0,+m)]}baseFaces(){return[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]]}refine(b,m,f){const o=new Map;for(let r=0;r<f;r++){const n=m.length;for(let i=0;i<n;i++){const c=m[i],s=c[0],a=c[1],h=c[2],g=this.split(s,a,b,o),_=this.split(a,h,b,o),T=this.split(h,s,b,o);m[i]=[g,_,T],m.push([s,g,T]),m.push([a,_,g]),m.push([h,T,_])}}}split(b,m,f,o){const r=b<m,n=((r?b:m)<<16)+(r?m:b);if(o.has(n))return o.get(n);const i=d.vec3.add(u.v3(),f[b],f[m]);d.vec3.normalize(i,i),f.push(i);const c=f.length-1;return o.set(n,c),c}generateGeometry(b){this._vertices=this.baseVertices(),this._faces=this.baseFaces(),b>0&&this.refine(this._vertices,this._faces,Math.min(Math.max(b,0),8))}generateTextureCoordinates(){this._texcoords=new Array;for(const b of this._vertices){const m=d.vec3.normalize(u.v3(),b),f=d.vec2.fromValues(.5-Math.atan2(m[2],m[0])/(2*Math.PI),Math.asin(m[1])/Math.PI+.5);this._texcoords.push(f)}}get faces(){return this._faces}get vertices(){return this._vertices}get texcoords(){return this._texcoords}}},2194:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.ResourceManager=p.PlaneGeometry=p.GeosphereGeometry=p.Icosahedron=p.CuboidGeometry=void 0;var d=v(2380);Object.defineProperty(p,"CuboidGeometry",{enumerable:!0,get:function(){return d.CuboidGeometry}});var u=v(7498);Object.defineProperty(p,"Icosahedron",{enumerable:!0,get:function(){return u.Icosahedron}});var b=v(7922);Object.defineProperty(p,"GeosphereGeometry",{enumerable:!0,get:function(){return b.GeosphereGeometry}});var m=v(4574);Object.defineProperty(p,"PlaneGeometry",{enumerable:!0,get:function(){return m.PlaneGeometry}});var f=v(9045);Object.defineProperty(p,"ResourceManager",{enumerable:!0,get:function(){return f.ResourceManager}})},4574:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.PlaneGeometry=void 0;const d=v(3659),u=v(6404),b=v(4894);class m extends b.Geometry{constructor(o,r){super(o,r),this._vertexLocation=0,this._texCoordLocation=1,this._translation=d.vec3.fromValues(0,0,0),this._scale=d.vec3.fromValues(1,1,1),this._rotation=d.quat.create(),r=r!==void 0&&r!==""?r:this.constructor.name;const n=new u.Buffer(o,r+"VertexVBO"),i=new u.Buffer(o,r+"TexCoordVBO"),c=new u.Buffer(o,r+"IndexBuffer");this._buffers.push(n),this._buffers.push(i),this._buffers.push(c)}bindBuffers(){this._buffers[0].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,0,0,!0,!1),this._buffers[1].attribEnable(this._texCoordLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1),this._buffers[2].bind()}unbindBuffers(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0),this._buffers[1].attribDisable(this._texCoordLocation,!0,!0),this._buffers[2].unbind()}initialize(o=0,r=1){const n=this.context.gl;this._vertexLocation=o,this._texCoordLocation=r;const i=super.initialize([n.ARRAY_BUFFER,n.ARRAY_BUFFER,n.ELEMENT_ARRAY_BUFFER],[o,r,8]);return this._buffers[0].data(m.VERTICES,n.STATIC_DRAW),this._buffers[1].data(m.UV,n.STATIC_DRAW),this._buffers[2].data(m.INDICES,n.STATIC_DRAW),i}draw(){const o=this.context.gl;o.drawElements(o.TRIANGLE_STRIP,m.INDICES.length,o.UNSIGNED_BYTE,0)}set translation(o){this._translation=o}set scale(o){this._scale=d.vec3.fromValues(o[0],1,o[1])}set rotation(o){this._rotation=o}get transformation(){const o=d.mat4.create();return d.mat4.fromRotationTranslationScale(o,this._rotation,this._translation,this._scale)}get vertexLocation(){return this._vertexLocation}get texCoordLocation(){return this._texCoordLocation}}p.PlaneGeometry=m,m.VERTICES=new Float32Array([-1,0,-1,-1,0,1,1,0,-1,1,0,1]),m.UV=new Float32Array([-1,-1,-1,1,1,-1,1,1]),m.INDICES=new Uint8Array([0,1,2,3])},9045:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.ResourceManager=void 0;const d=v(9696),u=v(6404),b=v(4894),m=v(9922),f=v(6942);p.ResourceManager=class{constructor(o){this._texture2Ds=new Map,this._materials=new Map,this._geometries=new Map,this._buffers=new Map,this._context=o}fetchTexture2D(o,r,n=!1){if(this._texture2Ds.has(o))return;const i=new f.Texture2D(this._context,o);return d.assert(i.identifier===o,"expected object identifier to be unchanged"),this._texture2Ds.set(o,i),i.fetch(r,n)}add(o,r){const n=new Array;if(o instanceof f.Texture2D){const i=o;for(const c of r)this._texture2Ds.has(c)||(this._texture2Ds.set(c,i),n.push(c))}if(o instanceof m.Material){const i=o;for(const c of r)this._materials.has(c)||(this._materials.set(c,i),n.push(c))}if(o instanceof b.Geometry){const i=o;for(const c of r)this._geometries.has(c)||(this._geometries.set(c,i),n.push(c))}if(o instanceof u.Buffer){const i=o;for(const c of r)this._buffers.has(c)||(this._buffers.set(c,i),n.push(c))}return n}get(o){return this._texture2Ds.has(o)?this._texture2Ds.get(o):this._materials.has(o)?this._materials.get(o):this._geometries.has(o)?this._geometries.get(o):this._buffers.has(o)?this._buffers.get(o):void 0}uninitialize(){for(const o of Array.from(this._geometries.values()))o.initialized&&o.uninitialize();this._geometries.clear();for(const o of Array.from(this._texture2Ds.values()))o.initialized&&o.uninitialize();this._texture2Ds.clear();for(const o of Array.from(this._buffers.values()))o.initialized&&o.uninitialize();this._buffers.clear(),this._materials.clear()}}},7491:function(F,p,v){var d=this&&this.__createBinding||(Object.create?function(r,n,i,c){c===void 0&&(c=i),Object.defineProperty(r,c,{enumerable:!0,get:function(){return n[i]}})}:function(r,n,i,c){c===void 0&&(c=i),r[c]=n[i]}),u=this&&this.__setModuleDefault||(Object.create?function(r,n){Object.defineProperty(r,"default",{enumerable:!0,value:n})}:function(r,n){r.default=n}),b=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(r!=null)for(var i in r)i!=="default"&&Object.prototype.hasOwnProperty.call(r,i)&&d(n,r,i);return u(n,r),n};Object.defineProperty(p,"__esModule",{value:!0}),p.debug=void 0;const m=b(v(1604)),f=b(v(493));var o;(o=p.debug||(p.debug={})).TestRenderer=f.TestRenderer,o.TestNavigation=m.TestNavigation},1604:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.TestNavigation=void 0;const d=v(7595);p.TestNavigation=class{constructor(u,b){this._altered=!1,this._eventHandler=new d.EventHandler(u,b),this._eventHandler.pushMouseEnterHandler((m,f)=>this.onMouseEnter(m,f)),this._eventHandler.pushMouseLeaveHandler((m,f)=>this.onMouseLeave(m,f))}onMouseEnter(u,b){this._altered=!1}onMouseLeave(u,b){this._altered=!0}update(){this._eventHandler.update()}reset(){this._altered=!1}get altered(){return this._altered}}},493:(F,p,v)=>{const d=v(9696),u=v(3666),b=v(3411),m=v(4073),f=v(6786),o=v(9564),r=v(7570),n=v(4895),i=v(7540),c=v(3205),s=v(5263),a=v(6942),h=v(1604);var g;(function(_){class T extends c.Renderer{constructor(){super(...arguments),this._extensions=!1}onInitialize(A,w,L){const D=this._context.gl,j=this._context.gl2facade;this._extensions===!1&&this._context.isWebGL1&&(d.assert(this._context.supportsStandardDerivatives,"expected OES_standard_derivatives support"),this._context.standardDerivatives,this._extensions=!0);const V=new s.Shader(this._context,D.VERTEX_SHADER,"testrenderer.vert");V.initialize(v(354));const G=new s.Shader(this._context,D.FRAGMENT_SHADER,"testrenderer.frag");G.initialize(v(9587)),this._program=new n.Program(this._context),this._program.initialize([V,G]),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uFrameNumber=this._program.uniform("u_frameNumber"),this._ndcTriangle=new r.NdcFillingTriangle(this._context);const W=this._program.attribute("a_vertex",0);return this._ndcTriangle.initialize(W),this._ndcOffsetKernel=new b.AntiAliasingKernel(this._multiFrameNumber),this._defaultFBO=new f.DefaultFramebuffer(this._context,"DefaultFBO"),this._defaultFBO.initialize(),this._colorRenderTexture=new a.Texture2D(this._context,"ColorRenderTexture"),this._depthRenderbuffer=new i.Renderbuffer(this._context,"DepthRenderbuffer"),this._intermediateFBO=new o.Framebuffer(this._context,"IntermediateFBO"),this._accumulate=new u.AccumulatePass(this._context),this._accumulate.initialize(this._ndcTriangle),this._accumulate.precision=this._framePrecision,this._accumulate.texture=this._colorRenderTexture,this._blit=new m.BlitPass(this._context),this._blit.initialize(this._ndcTriangle),this._blit.readBuffer=j.COLOR_ATTACHMENT0,this._blit.drawBuffer=D.BACK,this._blit.target=this._defaultFBO,this._testNavigation=new h.TestNavigation(()=>this.invalidate(),L),!0}onUninitialize(){super.uninitialize(),this._uNdcOffset=-1,this._uFrameNumber=-1,this._program.uninitialize(),this._ndcTriangle.uninitialize(),this._intermediateFBO.uninitialize(),this._defaultFBO.uninitialize(),this._colorRenderTexture.uninitialize(),this._depthRenderbuffer.uninitialize(),this._blit.uninitialize(),this._accumulate.uninitialize()}onDiscarded(){this._altered.alter("frameSize"),this._altered.alter("multiFrameNumber"),this._altered.alter("framePrecision"),this._altered.alter("clearColor")}onUpdate(){this._testNavigation.update();const A=this._testNavigation.altered;return this._testNavigation.reset(),!(!A&&!this._altered.any)&&A}onPrepare(){const A=this._context.gl,w=this._context.gl2facade;this._intermediateFBO.initialized?this._altered.frameSize&&this._intermediateFBO.resize(this._frameSize[0],this._frameSize[1]):(this._colorRenderTexture.initialize(this._frameSize[0],this._frameSize[1],this._context.isWebGL2?A.RGBA8:A.RGBA,A.RGBA,A.UNSIGNED_BYTE),this._depthRenderbuffer.initialize(this._frameSize[0],this._frameSize[1],A.DEPTH_COMPONENT16),this._intermediateFBO.initialize([[w.COLOR_ATTACHMENT0,this._colorRenderTexture],[A.DEPTH_ATTACHMENT,this._depthRenderbuffer]])),this._altered.multiFrameNumber&&(this._ndcOffsetKernel.width=this._multiFrameNumber),this._altered.framePrecision&&(this._accumulate.precision=this._framePrecision),this._altered.clearColor&&this._intermediateFBO.clearColor(this._clearColor),this._accumulate.update(),this._altered.reset()}onFrame(A){const w=this._context.gl;w.viewport(0,0,this._frameSize[0],this._frameSize[1]),this._program.bind();const L=this._ndcOffsetKernel.get(A);L[0]=2*L[0]/this._frameSize[0],L[1]=2*L[1]/this._frameSize[1],w.uniform2fv(this._uNdcOffset,L),w.uniform1i(this._uFrameNumber,A),this._intermediateFBO.clear(w.COLOR_BUFFER_BIT,!0,!1),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._intermediateFBO.unbind(),this._accumulate.frame(A)}onSwap(){this._blit.framebuffer=this._accumulate.framebuffer?this._accumulate.framebuffer:this._blit.framebuffer=this._intermediateFBO,this._blit.frame()}}_.TestRenderer=T})(g||(g={})),F.exports=g},26:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.DebugPass=void 0;const d=v(9696),u=v(4895),b=v(5263),m=v(4073);class f extends m.BlitPass{constructor(){super(...arguments),this._debug=f.Mode.Depth,this._near=0,this._far=0}createProgram(){d.assert(this._program===void 0,"expected blit program to be undefined before its creation");const r=this._context.gl,n=new b.Shader(this._context,r.VERTEX_SHADER,"blit.vert (debug)");n.initialize(v(985));const i=new b.Shader(this._context,r.FRAGMENT_SHADER,"blit_debug.frag (debug)");return i.initialize(v(8356)),this._program=new u.Program(this._context,"DebugProgram"),this._program.initialize([n,i]),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uSrcBounds=this._program.uniform("u_srcBounds"),this._uDstBounds=this._program.uniform("u_dstBounds"),this._uNearest=this._program.uniform("u_nearest"),this._uDebugMode=this._program.uniform("u_mode"),this._uLinearize=this._program.uniform("u_linearize"),this._program.bind(),r.uniform1i(this._program.uniform("u_source"),0),r.uniform1i(this._uDebugMode,this._debug),this._program.unbind(),this._program.valid}initialize(r){const n=super.initialize(r);return this.enforceProgramBlit=!0,n&&this.createProgram()}uninitialize(){super.uninitialize(),this._uDebugMode=void 0,this._uLinearize=void 0}set debug(r){this.assertInitialized(),this._debug!==r&&(this._debug=r,this._program!==void 0&&this._program.valid&&(this._program.bind(),this._context.gl.uniform1i(this._uDebugMode,this._debug),this._program.unbind()))}set near(r){this._near=r||0,this._program!==void 0&&this._program.valid&&(this._program.bind(),this._context.gl.uniform2f(this._uLinearize,this._near,this._far),this._program.unbind())}set far(r){this._far=r||0,this._program!==void 0&&this._program.valid&&(this._program.bind(),this._context.gl.uniform2f(this._uLinearize,this._near,this._far),this._program.unbind())}}p.DebugPass=f,function(o){(function(r){r[r.None=0]="None",r[r.Depth=1]="Depth",r[r.DepthLinear=2]="DepthLinear",r[r.DepthPacked=3]="DepthPacked",r[r.DepthLinearPacked=4]="DepthLinearPacked"})(o.Mode||(o.Mode={}))}(f=p.DebugPass||(p.DebugPass={}))},6786:function(F,p,v){var d=this&&this.__decorate||function(o,r,n,i){var c,s=arguments.length,a=s<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,r,n,i);else for(var h=o.length-1;h>=0;h--)(c=o[h])&&(a=(s<3?c(a):s>3?c(r,n,a):c(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(p,"__esModule",{value:!0}),p.DefaultFramebuffer=void 0;const u=v(9696),b=v(9564),m=v(1030);class f extends b.Framebuffer{create(){return this._object=b.Framebuffer.DEFAULT_FRAMEBUFFER,this._valid=!0,this._clearColors=new Array(1),this._clearDepth=1,this._clearStencil=0,this.clear=this.es2Clear,this._object}delete(){this._object=void 0,this._valid=!1}hasAttachment(r){return!1}bind(r=this.context.gl.FRAMEBUFFER){this.context.gl.bindFramebuffer(r,this._object)}clearColor(r){super.clearColor(r)}resize(){u.assert(!1,"the default framebuffer cannot be resized directly")}get width(){return this.context.gl.canvas.width}get height(){return this.context.gl.canvas.height}}d([m.Initializable.assert_initialized()],f.prototype,"bind",null),p.DefaultFramebuffer=f},172:function(F,p,v){var d=this&&this.__decorate||function(s,a,h,g){var _,T=arguments.length,y=T<3?a:g===null?g=Object.getOwnPropertyDescriptor(a,h):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(s,a,h,g);else for(var A=s.length-1;A>=0;A--)(_=s[A])&&(y=(T<3?_(y):T>3?_(a,h,y):_(a,h))||y);return T>3&&y&&Object.defineProperty(a,h,y),y};Object.defineProperty(p,"__esModule",{value:!0}),p.EnvironmentTextureType=p.EnvironmentRenderingPass=void 0;const u=v(9696),b=v(1030),m=v(7570),f=v(4895),o=v(5263),r=v(6942),n=v(945);class i extends b.Initializable{constructor(a){super(),this._skipCubeLod=!1,this._altered=!0,this._context=a,this._cubeMapProgram=new f.Program(a,"CubemapEnvironmentProgram"),this._equiMapProgram=new f.Program(a,"EquimapEnvironmentProgram"),this._polarMapProgram=new f.Program(a,"PolarmapEnvironmentProgram"),this._sphereMapProgram=new f.Program(a,"SpheremapEnvironmentProgram"),this._ndcTriangle=new m.NdcFillingTriangle(this._context,"EnvironmentNdcTriangle")}initialize(){const a=this._context.gl;this._ndcTriangle.initialize();const h=new o.Shader(this._context,a.VERTEX_SHADER,"env-projections.vert");h.initialize(v(8170));const g=new o.Shader(this._context,a.FRAGMENT_SHADER,"env-projections.frag");g.initialize(v(4965),!1),g.replace("PROJECTION_TYPE","CUBE_MAP"),g.compile(),this._cubeMapProgram.initialize([h,g],!1),this._cubeMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._cubeMapProgram.link(),this._cubeMapProgram.bind(),a.uniform1i(this._cubeMapProgram.uniform("u_cubemap"),0),this._uSkipLod=this._cubeMapProgram.uniform("u_skipLod"),this._cubeMapProgram.unbind();const _=new o.Shader(this._context,a.FRAGMENT_SHADER,"env-projections.frag");_.initialize(v(4965),!1),_.replace("PROJECTION_TYPE","EQUI_MAP"),_.compile(),this._equiMapProgram.initialize([h,_],!1),this._equiMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._equiMapProgram.link(),this._equiMapProgram.bind(),a.uniform1i(this._equiMapProgram.uniform("u_equirectmap"),0),this._equiMapProgram.unbind();const T=new o.Shader(this._context,a.FRAGMENT_SHADER,"env-projections.frag");T.initialize(v(4965),!1),T.replace("PROJECTION_TYPE","SPHERE_MAP"),T.compile(),this._sphereMapProgram.initialize([h,T],!1),this._sphereMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._sphereMapProgram.link(),this._sphereMapProgram.bind(),a.uniform1i(this._sphereMapProgram.uniform("u_spheremap"),0),this._sphereMapProgram.unbind();const y=new o.Shader(this._context,a.FRAGMENT_SHADER,"env-projections.frag");return y.initialize(v(4965),!1),y.replace("PROJECTION_TYPE","POLAR_MAP"),y.compile(),this._polarMapProgram.initialize([h,y],!1),this._polarMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._polarMapProgram.link(),this._polarMapProgram.bind(),a.uniform1iv(this._polarMapProgram.uniform("u_polarmap"),[0,1]),this._polarMapProgram.unbind(),!0}uninitialize(){this._cubeMapProgram.uninitialize(),this._equiMapProgram.uninitialize(),this._sphereMapProgram.uninitialize(),this._polarMapProgram.uninitialize()}update(){if(this._altered===!1)return;const a=this._context.gl;this._cubeMapProgram.bind(),a.uniform1i(this._uSkipLod,this._skipCubeLod),this._altered=!1}frame(){const a=this._context.gl;u.assert(this._camera!==void 0,"Camera is undefined in environment rendering pass."),u.assert(this._environmentTexture!==void 0,"Environment texture is undefined in environment rendering pass.");let h=this._cubeMapProgram;this._envTextureType===c.EquirectangularMap?(u.assert(this._environmentTexture instanceof r.Texture2D,"Input texture expected to be Texture2D for equirectangular mapping."),this._environmentTexture.bind(a.TEXTURE0),h=this._equiMapProgram):this._envTextureType===c.SphereMap?(u.assert(this._environmentTexture instanceof r.Texture2D,"Input texture expected to be Texture2D for sphere mapping."),this._environmentTexture.bind(a.TEXTURE0),h=this._sphereMapProgram):this._envTextureType===c.CubeMap?(u.assert(this._environmentTexture instanceof n.TextureCube,"Input texture expected to be a TextureCube for cube mapping."),this._environmentTexture.bind(a.TEXTURE0),h=this._cubeMapProgram):this._envTextureType===c.PolarMap&&(u.assert(this._environmentTexture2!==void 0,"Two input textures expected for polar mapping."),u.assert(this._environmentTexture instanceof r.Texture2D,"Input texture expected to be a Texture2D for polar mapping."),u.assert(this._environmentTexture2 instanceof r.Texture2D,"Input texture expected to be a Texture2D for polar mapping."),this._environmentTexture.bind(a.TEXTURE0),this._environmentTexture2.bind(a.TEXTURE1),h=this._polarMapProgram),h.bind(),a.uniformMatrix4fv(h.uniform("u_viewProjectionInverse"),!1,this._camera.viewProjectionInverse),this._ndcTriangle.bind(),this._ndcTriangle.draw(),h.unbind()}set environmentTextureType(a){this._envTextureType=a}set environmentTexture(a){this._environmentTexture=a}set environmentTexture2(a){this._environmentTexture2=a}set camera(a){this._camera=a}set skipCubeLod(a){this._skipCubeLod!==a&&(this._skipCubeLod=a,this._altered=!0)}}var c;d([b.Initializable.initialize()],i.prototype,"initialize",null),d([b.Initializable.uninitialize()],i.prototype,"uninitialize",null),p.EnvironmentRenderingPass=i,function(s){s[s.CubeMap=0]="CubeMap",s[s.EquirectangularMap=1]="EquirectangularMap",s[s.SphereMap=2]="SphereMap",s[s.PolarMap=3]="PolarMap"}(c=p.EnvironmentTextureType||(p.EnvironmentTextureType={}))},7595:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.EventHandler=void 0;const d=v(3659),u=v(9696),b=v(5838),m=v(4841),f=v(8319),o=v(4052);p.EventHandler=class{constructor(r,n){this._subscriptions=new Array,this._latestMouseEventsByType=new Map,this._previousMouseEventsByType=new Map,this._mouseEventHandlerByType=new Map,this._latestTouchEventsByType=new Map,this._previousTouchEventsByType=new Map,this._touchEventHandlerByType=new Map,this._latestPointerEventsByType=new Map,this._previousPointerEventsByType=new Map,this._pointerEventHandlerByType=new Map,this._latestEyeGazeEventsByType=new Map,this._previousEyeGazeEventsByType=new Map,this._eyeGazeEventHandlerByType=new Map,this._invalidate=r,this._mouseEventProvider=n.mouseEventProvider,this._mouseEventProvider.preventDefault(m.MouseEventProvider.Type.Wheel),this._pointerEventProvider=n.pointerEventProvider,this._eyeGazeEventProvider=n.eyeGazeEventProvider}invalidate(r=!1){this._invalidate&&this._invalidate(r)}pushMouseEventHandler(r,n){if(this._mouseEventHandlerByType.has(r))return void this._mouseEventHandlerByType.get(r).push(n);this._mouseEventHandlerByType.set(r,new Array),this._previousMouseEventsByType.set(r,new Array);const i=new Array;this._latestMouseEventsByType.set(r,i),u.assert(this._mouseEventProvider!==void 0,"expected valid mouse event provider");const c=this._mouseEventProvider.observable(r);switch(r){case m.MouseEventProvider.Type.Wheel:default:this._subscriptions.push(c.subscribe(s=>{i.push(s),this.invalidate()}))}this._mouseEventHandlerByType.get(r).push(n)}invokeMouseEventHandler(r){const n=this._mouseEventHandlerByType.get(r);if(n===void 0||n.length===0)return;const i=this._latestMouseEventsByType.get(r);if(i.length===0)return;const c=this._previousMouseEventsByType.get(r);n.forEach(s=>s(i,c)),Object.assign(c,i),i.length=0}pushTouchEventHandler(r,n){if(this._touchEventHandlerByType.has(r))return void this._touchEventHandlerByType.get(r).push(n);this._touchEventHandlerByType.set(r,new Array),this._previousTouchEventsByType.set(r,new Array);const i=new Array;this._latestTouchEventsByType.set(r,i),u.assert(this._touchEventProvider!==void 0,"expected valid touch event provider");const c=this._touchEventProvider.observable(r);this._subscriptions.push(c.subscribe(s=>{i.push(s),this.invalidate()})),this._touchEventHandlerByType.get(r).push(n)}invokeTouchEventHandler(r){const n=this._touchEventHandlerByType.get(r);if(n===void 0||n.length===0)return;const i=this._latestTouchEventsByType.get(r);if(i.length===0)return;const c=this._previousTouchEventsByType.get(r);n.forEach(s=>s(i,c)),Object.assign(c,i),i.length=0}pushPointerEventHandler(r,n){if(this._pointerEventHandlerByType.has(r))return void this._pointerEventHandlerByType.get(r).push(n);this._pointerEventHandlerByType.set(r,new Array),this._previousPointerEventsByType.set(r,new Array);const i=new Array;this._latestPointerEventsByType.set(r,i),u.assert(this._pointerEventProvider!==void 0,"expected valid pointer event provider");const c=this._pointerEventProvider.observable(r);this._subscriptions.push(c.subscribe(s=>{i.push(s),this.invalidate()})),this._pointerEventHandlerByType.get(r).push(n)}invokePointerEventHandler(r){const n=this._pointerEventHandlerByType.get(r);if(n===void 0||n.length===0)return;const i=this._latestPointerEventsByType.get(r);if(i.length===0)return;const c=this._previousPointerEventsByType.get(r);n.forEach(s=>s(i,c)),Object.assign(c,i),i.length=0}pushEyeGazeEventHandler(r,n){if(this._eyeGazeEventHandlerByType.has(r))return void this._eyeGazeEventHandlerByType.get(r).push(n);this._eyeGazeEventHandlerByType.set(r,new Array),this._previousEyeGazeEventsByType.set(r,new Array);const i=new Array;this._latestEyeGazeEventsByType.set(r,i),u.assert(this._eyeGazeEventProvider!==void 0,"expected valid eye gaze event provider");const c=this._eyeGazeEventProvider.observable(r);this._subscriptions.push(c.subscribe(s=>{i.push(s),this.invalidate()})),this._eyeGazeEventHandlerByType.get(r).push(n)}invokeEyeGazeEventHandler(r){const n=this._eyeGazeEventHandlerByType.get(r);if(n===void 0||n.length===0)return;const i=this._latestEyeGazeEventsByType.get(r);if(i.length===0)return;const c=this._previousEyeGazeEventsByType.get(r);n.forEach(s=>s(i,c)),Object.assign(c,i),i.length=0}dispose(){this._latestMouseEventsByType.forEach(r=>r.length=0),this._previousMouseEventsByType.forEach(r=>r.length=0),this._latestTouchEventsByType.forEach(r=>r.length=0),this._previousTouchEventsByType.forEach(r=>r.length=0),this._latestPointerEventsByType.forEach(r=>r.length=0),this._previousPointerEventsByType.forEach(r=>r.length=0),this._previousEyeGazeEventsByType.forEach(r=>r.length=0),this._latestEyeGazeEventsByType.forEach(r=>r.length=0);for(const r of this._subscriptions)r.unsubscribe()}update(){this.invokeMouseEventHandler(m.MouseEventProvider.Type.Click),this.invokeMouseEventHandler(m.MouseEventProvider.Type.Enter),this.invokeMouseEventHandler(m.MouseEventProvider.Type.Leave),this.invokeMouseEventHandler(m.MouseEventProvider.Type.Down),this.invokeMouseEventHandler(m.MouseEventProvider.Type.Up),this.invokeMouseEventHandler(m.MouseEventProvider.Type.Move),this.invokeMouseEventHandler(m.MouseEventProvider.Type.Wheel),this.invokeTouchEventHandler(o.TouchEventProvider.Type.Start),this.invokeTouchEventHandler(o.TouchEventProvider.Type.End),this.invokeTouchEventHandler(o.TouchEventProvider.Type.Move),this.invokeTouchEventHandler(o.TouchEventProvider.Type.Cancel),this.invokePointerEventHandler(f.PointerEventProvider.Type.Move),this.invokePointerEventHandler(f.PointerEventProvider.Type.Down),this.invokePointerEventHandler(f.PointerEventProvider.Type.Enter),this.invokePointerEventHandler(f.PointerEventProvider.Type.Up),this.invokePointerEventHandler(f.PointerEventProvider.Type.Leave),this.invokePointerEventHandler(f.PointerEventProvider.Type.Cancel),this.invokeEyeGazeEventHandler(b.EyeGazeEventProvider.Type.EyeGazeData),this.invokeEyeGazeEventHandler(b.EyeGazeEventProvider.Type.NewServerMessage),this.invokeEyeGazeEventHandler(b.EyeGazeEventProvider.Type.ConnectionStatus),this.invokeEyeGazeEventHandler(b.EyeGazeEventProvider.Type.BinaryMessageParsingError)}offsets(r,n=!0){const i=new Array;let c=!1;if(r instanceof MouseEvent){const a=r;c=a.offsetX!==0&&a.offsetY!==0,i.push(c?d.vec2.fromValues(a.offsetX,a.offsetY):d.vec2.fromValues(a.clientX,a.clientY))}else if(r instanceof WheelEvent){const a=r;c=a.offsetX!==0&&a.offsetY!==0,i.push(c?d.vec2.fromValues(a.offsetX,a.offsetY):d.vec2.fromValues(a.clientX,a.clientY))}else if(r instanceof TouchEvent){const a=r;for(let h=0;h<a.touches.length;++h){const g=a.touches.item(h);i.push(d.vec2.fromValues(g.clientX,g.clientY))}}if(c){if(n)for(const a of i)d.vec2.scale(a,a,window.devicePixelRatio);return i}const s=(r.target||r.currentTarget||r.srcElement).getBoundingClientRect();for(const a of i)a[0]=Math.floor(a[0]-s.left),a[1]=Math.floor(a[1]-s.top),n&&d.vec2.scale(a,a,window.devicePixelRatio);return i}pushClickHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Click,r)}pushMouseEnterHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Enter,r)}pushMouseLeaveHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Leave,r)}pushMouseDownHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Down,r)}pushMouseUpHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Up,r)}pushMouseMoveHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Move,r)}pushMouseWheelHandler(r){this.pushMouseEventHandler(m.MouseEventProvider.Type.Wheel,r)}pushTouchStartHandler(r){this.pushTouchEventHandler(o.TouchEventProvider.Type.Start,r)}pushTouchEndHandler(r){this.pushTouchEventHandler(o.TouchEventProvider.Type.End,r)}pushTouchMoveHandler(r){this.pushTouchEventHandler(o.TouchEventProvider.Type.Move,r)}pushTouchCancelHandler(r){this.pushTouchEventHandler(o.TouchEventProvider.Type.Cancel,r)}pushPointerUpHandler(r){this.pushPointerEventHandler(f.PointerEventProvider.Type.Up,r)}pushPointerDownHandler(r){this.pushPointerEventHandler(f.PointerEventProvider.Type.Down,r)}pushPointerEnterHandler(r){this.pushPointerEventHandler(f.PointerEventProvider.Type.Enter,r)}pushPointerLeaveHandler(r){this.pushPointerEventHandler(f.PointerEventProvider.Type.Leave,r)}pushPointerMoveHandler(r){this.pushPointerEventHandler(f.PointerEventProvider.Type.Move,r)}pushPointerCancelHandler(r){this.pushPointerEventHandler(f.PointerEventProvider.Type.Cancel,r)}pushEyeGazeDataHandler(r){this.pushEyeGazeEventHandler(b.EyeGazeEventProvider.Type.EyeGazeData,r)}pushEyeGazeServerMessageHandler(r){this.pushEyeGazeEventHandler(b.EyeGazeEventProvider.Type.NewServerMessage,r)}pushEyeGazeConnectionStatusHandler(r){this.pushEyeGazeEventHandler(b.EyeGazeEventProvider.Type.ConnectionStatus,r)}pushEyeGazeBinaryMessageParsingErrorHandler(r){this.pushEyeGazeEventHandler(b.EyeGazeEventProvider.Type.BinaryMessageParsingError,r)}requestPointerLock(){this._mouseEventProvider&&(this._mouseEventProvider.pointerLock=!0)}exitPointerLock(){this._mouseEventProvider&&(this._mouseEventProvider.pointerLock=!1)}}},8600:F=>{var p;(function(v){v.WEBGL1_EXTENSIONS=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context"],v.WEBGL2_EXTENSIONS=["EXT_color_buffer_float","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","OES_texture_float_linear","OES_texture_half_float_linear","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context"],v.WEBGL2_DEFAULT_EXTENSIONS=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_vertex_array_object","WEBGL_depth_texture","WEBGL_draw_buffers"]})(p||(p={})),F.exports=p},9568:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.ExtensionsHash=void 0;const d=v(9696),u=v(8600);class b{static encode64(f){return d.assert(f>=0&&f<=63,`expected bitfield in range [ 0b000000, 0b111111 ], given ${f}`),b.BASE64_ALPHABET[f]}static decode64(f){d.assert(f.length===1,`expected single base64 character, given '${f}'`);const o=b.BASE64_ALPHABET.indexOf(f);return d.assert(o>-1,`unknown base64 character, given '${f}'`),o}static encode(f,o){const r=b.LATEST_VERSION,n=b.EXTENSIONS_BY_VERSION.get(r),i=b.WEBGL_BACKENDS.indexOf(f);d.assert(i>-1,`expected valid backend ${b.WEBGL_BACKENDS}, given ${f} `);let c=b.encode64(r<<3|i+1);if(o.length===0)return c;let s=0;for(let a=0;a<n.length;++a)s|=o.indexOf(n[a])>-1?32>>a%6:0,a%6<5&&a<n.length-1||(c+=b.encode64(s),s=0);return c}static decode(f){const o=b.decode64(f[0]),r=o>>3,n=(7&o)-1;d.assert(n<b.WEBGL_BACKENDS.length,`expected valid backend index, given ${n}`);const i=b.WEBGL_BACKENDS[n];d.assert(b.EXTENSIONS_BY_VERSION.has(r),`expected valid hash version, given ${r}`);const c=b.EXTENSIONS_BY_VERSION.get(r),s=Math.ceil(c.length/6)+1;d.assert(f.length===s,`expected hash of version ${r} to have a length of ${s}, given ${f}`);const a=new Array;for(let h=1;h<f.length;++h){const g=b.decode64(f[h]),_=6*(h-1);32&g&&a.push(c[_+0]),16&g&&a.push(c[_+1]),8&g&&a.push(c[_+2]),4&g&&a.push(c[_+3]),2&g&&a.push(c[_+4]),1&g&&a.push(c[_+5])}return[i,a]}static complement(f,o){const r=b.WEBGL_BACKENDS.indexOf(f);return d.assert(r>-1,`expected valid backend ${b.WEBGL_BACKENDS}, given ${f} `),b.WEBGL_EXTENSIONS_BY_BACKEND.get(r).filter(n=>o.indexOf(n)<0)}}p.ExtensionsHash=b,b.WEBGL_BACKENDS=["webgl1","webgl2"],b.WEBGL_EXTENSIONS_BY_BACKEND=new Map([[0,u.WEBGL1_EXTENSIONS],[1,u.WEBGL2_EXTENSIONS]]),b.EXTENSIONS_BY_VERSION=new Map([[0,["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context"]]]),b.LATEST_VERSION=0,b.BASE64_ALPHABET="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+"},378:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.EyeGazeDataStreams=p.EyeGazeDataStream=p.EyeGazeEventTarget=void 0;const d=v(2497);class u extends EventTarget{}p.EyeGazeEventTarget=u;class b{constructor(){this._eyeGazeDataStreams=new m,this._eyeGazeEventTarget=new EventTarget}generateStreamConfigByte(){const o=Uint8Array.from([0]);return this._eyeGazeDataStreams.gazePosition&&(o[0]=1|o[0]),this._eyeGazeDataStreams.gazeOrigin&&(o[0]=2|o[0]),this._eyeGazeDataStreams.eyePositionNormalized&&(o[0]=4|o[0]),this._eyeGazeDataStreams.headPositionAndRotation&&(o[0]=8|o[0]),this._eyeGazeDataStreams.userPresence&&(o[0]=16|o[0]),o}performHandshake(){this._eyeGazeDataStreams.recalculateNumberOfFloats();const o=this.generateStreamConfigByte();this._webSocket.send(o)}parseEyeTrackingData(o){if(o.length<this._eyeGazeDataStreams.expectedNumberOfFloats)return new CustomEvent(b.BINARY_MESSAGE_PARSING_ERROR);let r=0;const n=new d.EyeGazeData;return this._eyeGazeDataStreams.gazePosition&&(n.gazePositionXY[0]=o[r++],n.gazePositionXY[1]=o[r++]),this._eyeGazeDataStreams.gazeOrigin&&(n.gazeOriginRightXYZ[0]=o[r++],n.gazeOriginRightXYZ[1]=o[r++],n.gazeOriginRightXYZ[2]=o[r++],n.gazeOriginLeftXYZ[0]=o[r++],n.gazeOriginLeftXYZ[1]=o[r++],n.gazeOriginLeftXYZ[2]=o[r++]),this._eyeGazeDataStreams.eyePositionNormalized&&(n.eyePositionRightNormalizedXYZ[0]=o[r++],n.eyePositionRightNormalizedXYZ[1]=o[r++],n.eyePositionRightNormalizedXYZ[2]=o[r++],n.eyePositionLeftNormalizedXYZ[0]=o[r++],n.eyePositionLeftNormalizedXYZ[1]=o[r++],n.eyePositionLeftNormalizedXYZ[2]=o[r++]),this._eyeGazeDataStreams.headPositionAndRotation&&(n.headPositionXYZ[0]=o[r++],n.headPositionXYZ[1]=o[r++],n.headPositionXYZ[2]=o[r++],n.headRotationXYZ[0]=o[r++],n.headRotationXYZ[1]=o[r++],n.headRotationXYZ[2]=o[r++]),this._eyeGazeDataStreams.userPresence&&(n.userPresence=o[r]!==0),new CustomEvent(b.EYE_GAZE_DATA,{detail:{eyeGazeData:n}})}onOpen(o){this.dispatchEvent(new CustomEvent(b.CONNECTION_STATUS,{detail:{message:b.SUCCESSFULLY_CONNECTED_TO_SERVER,event:o}})),this.performHandshake()}onClose(o){this.dispatchEvent(new CustomEvent(b.CONNECTION_STATUS,{detail:{message:b.DISCONNECTED_TO_SERVER,event:o}}))}onError(o){this.dispatchEvent(new CustomEvent(b.CONNECTION_STATUS,{detail:{message:b.CONNECTION_ERROR,event:o}}))}async onMessage(o){if(typeof o.data!="string"){const r=await o.data.arrayBuffer(),n=new Float32Array(r);this.dispatchEvent(this.parseEyeTrackingData(n))}else this.dispatchEvent(new CustomEvent(b.NEW_SERVER_MESSAGE,{detail:{message:o.data}}))}connect(o){this._webSocket=new WebSocket(o),this._webSocket.onopen=r=>{this.onOpen(r)},this._webSocket.onclose=r=>{this.onClose(r)},this._webSocket.onerror=r=>{this.onError(r)},this._webSocket.onmessage=r=>{this.onMessage(r)}}addEventListener(o,r,n){this._eyeGazeEventTarget.addEventListener(o,r||null,n)}dispatchEvent(o){return this._eyeGazeEventTarget.dispatchEvent(o)}removeEventListener(o,r,n){this._eyeGazeEventTarget.removeEventListener(o,r||null,n)}get connectionState(){return this._webSocket.readyState}get eyeGazeDataStreams(){return this._eyeGazeDataStreams}set eyeGazeDataStreams(o){this._eyeGazeDataStreams!==o&&(this._eyeGazeDataStreams=o)}}p.EyeGazeDataStream=b,b.EYE_GAZE_DATA="eyegazedata",b.NEW_SERVER_MESSAGE="newservermessage",b.CONNECTION_STATUS="connectionstatus",b.BINARY_MESSAGE_PARSING_ERROR="binarymessageparsingerror",b.SUCCESSFULLY_CONNECTED_TO_SERVER="successfully connected to server",b.DISCONNECTED_TO_SERVER="disconnected to server",b.CONNECTION_ERROR="connection error with server";class m{constructor(){this.gazePosition=!1,this.gazeOrigin=!1,this.eyePositionNormalized=!1,this.headPositionAndRotation=!1,this.userPresence=!1,this.expectedNumberOfFloats=0}recalculateNumberOfFloats(){let o=0;this.gazePosition&&(o+=2),this.gazeOrigin&&(o+=6),this.eyePositionNormalized&&(o+=6),this.headPositionAndRotation&&(o+=6),this.userPresence&&(o+=1),this.expectedNumberOfFloats=o}}p.EyeGazeDataStreams=m},2497:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.EyeGazeData=void 0,p.EyeGazeData=class{constructor(){this.gazePositionXY=[0,0],this.gazeOriginRightXYZ=[0,0,0],this.gazeOriginLeftXYZ=[0,0,0],this.eyePositionRightNormalizedXYZ=[0,0,0],this.eyePositionLeftNormalizedXYZ=[0,0,0],this.headPositionXYZ=[0,0,0],this.headRotationXYZ=[0,0,0],this.userPresence=!1}toString(){let v="";return v+=`Gaze Position: ${this.gazePositionXY}
`,v+=`Gaze Origin Right: ${this.gazeOriginRightXYZ}
`,v+=`Gaze Origin Left: ${this.gazeOriginLeftXYZ}
`,v+=`Eye Position Normalized Right: ${this.eyePositionRightNormalizedXYZ}
`,v+=`Eye Position Normalized Left: ${this.eyePositionLeftNormalizedXYZ}
`,v+=`Head Position: ${this.headPositionXYZ}
`,v+=`Head Rotation: ${this.headRotationXYZ}
`,v+=`User Presence: ${this.userPresence}
`,v}}},5838:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.EyeGazeEventProvider=void 0;const d=v(7318),u=v(9696),b=v(378);class m{constructor(o,r){u.assert(o!==void 0,`expected a valid eye gaze data streams object on initialization, given ${o}.`),this._eyeGazeDataStream=new b.EyeGazeDataStream,this._eyeGazeDataStream.eyeGazeDataStreams=o,this._eyeGazeDataStream.connect(r)}preventDefaultOnEvent(o,r){u.bitInBitfield(this._preventDefaultMask,o)&&r.preventDefault()}allowDefault(...o){for(const r of o)u.bitInBitfield(this._preventDefaultMask,r)&&(this._preventDefaultMask&=~r)}preventDefault(...o){for(const r of o)u.bitInBitfield(this._preventDefaultMask,r)||(this._preventDefaultMask|=r)}observable(o){switch(o){case m.Type.EyeGazeData:return this.EyeGazeData$;case m.Type.NewServerMessage:return this.NewServerMessage$;case m.Type.ConnectionStatus:return this.ConnectionStatus$;case m.Type.BinaryMessageParsingError:return this.BinaryMessageParsingError$;default:return}}get EyeGazeData$(){return this._eyeGazeDataSubject===void 0&&(this._eyeGazeDataSubject=new d.ReplaySubject(void 0,this._timeframe),this._eyeGazeDataListener=o=>{this.preventDefaultOnEvent(m.Type.EyeGazeData,o),this._eyeGazeDataSubject.next(o)},this._eyeGazeDataStream.addEventListener(b.EyeGazeDataStream.EYE_GAZE_DATA,this._eyeGazeDataListener)),this._eyeGazeDataSubject.asObservable()}get NewServerMessage$(){return this._newServerMessageSubject===void 0&&(this._newServerMessageSubject=new d.ReplaySubject(void 0,this._timeframe),this._newServerMessageListener=o=>{this.preventDefaultOnEvent(m.Type.NewServerMessage,o),this._newServerMessageSubject.next(o)},this._eyeGazeDataStream.addEventListener(b.EyeGazeDataStream.NEW_SERVER_MESSAGE,this._newServerMessageListener)),this._newServerMessageSubject.asObservable()}get ConnectionStatus$(){return this._connectionStatusSubject===void 0&&(this._connectionStatusSubject=new d.ReplaySubject(void 0,this._timeframe),this._connectionStatusListener=o=>{this.preventDefaultOnEvent(m.Type.ConnectionStatus,o),this._connectionStatusSubject.next(o)},this._eyeGazeDataStream.addEventListener(b.EyeGazeDataStream.CONNECTION_STATUS,this._connectionStatusListener)),this._connectionStatusSubject.asObservable()}get BinaryMessageParsingError$(){return this._binaryMessageParsingErrorSubject===void 0&&(this._binaryMessageParsingErrorSubject=new d.ReplaySubject(void 0,this._timeframe),this._binaryMessageParsingErrorListener=o=>{this.preventDefaultOnEvent(m.Type.BinaryMessageParsingError,o),this._binaryMessageParsingErrorSubject.next(o)},this._eyeGazeDataStream.addEventListener(b.EyeGazeDataStream.BINARY_MESSAGE_PARSING_ERROR,this._binaryMessageParsingErrorListener)),this._eyeGazeDataSubject.asObservable()}}p.EyeGazeEventProvider=m,function(f){(function(o){o[o.EyeGazeData=1]="EyeGazeData",o[o.NewServerMessage=2]="NewServerMessage",o[o.ConnectionStatus=4]="ConnectionStatus",o[o.BinaryMessageParsingError=8]="BinaryMessageParsingError"})(f.Type||(f.Type={}))}(m=p.EyeGazeEventProvider||(p.EyeGazeEventProvider={}))},6869:(F,p,v)=>{const d=v(3607);var u;(function(b){const m=(f,o)=>`fetching '${f}' failed (${o.status}): ${o.statusText}`;b.fetchAsync=function(f,o){return new Promise((r,n)=>{const i=new XMLHttpRequest;i.open("GET",f,!0),i.responseType=o,i.onload=()=>{i.status<200||i.status>=300?n(m(f,i)):r(i.response)},i.onerror=()=>n(m(f,i)),i.ontimeout=()=>n(m(f,i)),i.send()})},b.fetchJsonAsync=function(f,o,r){return new Promise((n,i)=>{const c=new XMLHttpRequest;c.open("GET",f,!0),c.onload=()=>{if(c.status<200||c.status>=300)return void i(m(f,c));const s=c.responseText;if(r!==void 0&&!d.validate(s,r))return;let a;try{a=JSON.parse(s)}catch(g){return void i(`fetching '${f}' failed (${g.name}): ${g.message}`)}const h=o(a);h!==void 0?n(h):i(`fetching '${f}' failed (TransformError): transforming the object failed.`)},c.onerror=()=>i(m(f,c)),c.ontimeout=()=>i(m(f,c)),c.send()})}})(u||(u={})),F.exports=u},9870:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.FirstPersonModifier=void 0;const d=v(3659),u=v(2111),b=v(6491);class m extends b.CameraModifier{constructor(){super(...arguments),this._rotation=d.mat4.create(),this._sensitivity=m.DEFAULT_SENSITIVITY}initiate(o){Object.assign(this._reference,this._camera),this._initialPoint=o}process(o,r){this._currentPoint=o;const n=d.vec2.create();r===void 0?d.vec2.subtract(n,this._initialPoint,this._currentPoint):d.vec2.copy(n,r),d.vec2.scale(n,n,window.devicePixelRatio*this._sensitivity),d.vec2.copy(this._initialPoint,this._currentPoint);const i=d.vec3.sub(u.v3(),this._reference.eye,this._reference.center);d.vec3.normalize(i,i);const c=d.vec3.cross(u.v3(),i,this._reference.up),s=d.mat4.fromRotation(u.m4(),-n[0],this._reference.up),a=d.mat4.fromRotation(u.m4(),n[1],c);d.mat4.mul(this._rotation,a,s),this.update()}update(){if(this._camera===void 0)return;const o=d.mat4.fromTranslation(u.m4(),this._reference.eye);d.mat4.multiply(o,o,this._rotation),d.mat4.translate(o,o,d.vec3.negate(u.v3(),this._reference.eye));const r=d.vec3.transformMat4(u.v3(),this._reference.center,o);this._camera.center=r,Object.assign(this._reference,this._camera)}set sensitivity(o){this._sensitivity=o}get sensitivity(){return this._sensitivity}}p.FirstPersonModifier=m,m.DEFAULT_SENSITIVITY=8e-4},423:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.byteSizeOfFormat=void 0;const d=v(9696);let u;const b=new Map;p.byteSizeOfFormat=function(m,f){const o=m.gl;if(f===void 0)return d.assert(!1,"expected given format to be defined"),0;if(function(n,i){const c=n.gl,s=n.gl2facade;if(i===void 0)return!1;if(u===void 0){const a=n.supportsDepthTexture?n.depthTexture.UNSIGNED_INT_24_8_WEBGL:void 0;u=new Array(c.UNSIGNED_BYTE,c.UNSIGNED_SHORT_5_6_5,c.UNSIGNED_SHORT_4_4_4_4,c.UNSIGNED_SHORT_5_5_5_1,c.UNSIGNED_SHORT,c.UNSIGNED_INT,a,c.FLOAT,s.HALF_FLOAT,c.BYTE,c.SHORT,c.INT,c.HALF_FLOAT,c.UNSIGNED_INT_2_10_10_10_REV,c.UNSIGNED_INT_10F_11F_11F_REV,c.UNSIGNED_INT_5_9_9_9_REV,c.UNSIGNED_INT_24_8,c.FLOAT_32_UNSIGNED_INT_24_8_REV)}return u.indexOf(i)>-1}(m,f))return d.assert(!1,`expected format instead of type ${f}`),0;if(f===o.DEPTH_COMPONENT||f===o.DEPTH_STENCIL)return d.assert(!1,"byte size of DEPTH_COMPONENT or DEPTH_STENCIL formats depends on active render buffer"),0;const r=function(n){if(b.has(n))return b.get(n);const i=n.gl,c=new Map([[i.ALPHA,1],[i.LUMINANCE,1],[i.R8,1],[i.R8I,1],[i.R8UI,1],[i.STENCIL_INDEX8,1],[i.DEPTH_COMPONENT16,2],[i.LUMINANCE_ALPHA,2],[i.R16F,2],[i.R16I,2],[i.R16UI,2],[i.RG8,2],[i.RG8I,2],[i.RG8UI,2],[i.RGB565,2],[i.RGB5_A1,2],[i.RGBA4,2],[i.DEPTH_COMPONENT24,3],[i.RGB,3],[i.RGB8,3],[i.RGB8UI,3],[i.SRGB,3],[i.SRGB8,3],[i.DEPTH24_STENCIL8,4],[i.DEPTH_COMPONENT32F,4],[i.R11F_G11F_B10F,4],[i.R32F,4],[i.R32I,4],[i.R32UI,4],[i.RG16F,4],[i.RG16I,4],[i.RG16UI,4],[i.RGB10_A2,4],[i.RGB10_A2UI,4],[i.RGB9_E5,4],[i.RGBA,4],[i.RGBA8,4],[i.RGBA8I,4],[i.RGBA8UI,4],[i.SRGB8_ALPHA8,4],[i.SRGB_ALPHA,4],[i.SRGB_ALPHA8,4],[i.SRGB_APLHA8,4],[i.DEPTH32F_STENCIL8,5],[i.RGB16F,6],[i.RG32F,8],[i.RG32I,8],[i.RG32UI,8],[i.RGBA16F,8],[i.RGBA16I,8],[i.RGBA16UI,8],[i.RGB32F,12],[i.RGBA32F,16],[i.RGBA32I,16],[i.RGBA32UI,16]]);return n.isWebGL1&&n.supportsSRGB&&(c.set(n.sRGB.SRGB_EXT,3),c.set(n.sRGB.SRGB_ALPHA_EXT,4),c.set(n.sRGB.SRGB8_ALPHA8_EXT,4)),n.supportsColorBufferFloat&&(c.set(n.colorBufferFloat.RGB32F_EXT,12),c.set(n.colorBufferFloat.RGBA32F_EXT,16)),b.set(n,c),c}(m).get(f);return d.assert(r!==void 0,`size of format ${f} is unknown`),r||0}},9564:function(F,p,v){var d=this&&this.__decorate||function(n,i,c,s){var a,h=arguments.length,g=h<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,c):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(n,i,c,s);else for(var _=n.length-1;_>=0;_--)(a=n[_])&&(g=(h<3?a(g):h>3?a(i,c,g):a(i,c))||g);return h>3&&g&&Object.defineProperty(i,c,g),g};Object.defineProperty(p,"__esModule",{value:!0}),p.Framebuffer=void 0;const u=v(9696),b=v(1030),m=v(2281),f=v(7540),o=v(6942);class r extends m.AbstractObject{constructor(){super(...arguments),this._buffersByAttachment=new Map,this._texturesByAttachment=new Map,this._colorClearQueue=new Array,this._drawBuffers=new Array,this._drawBuffersChanged=!1}static statusString(i,c){const s=i.gl;switch(c){case s.FRAMEBUFFER_COMPLETE:return"the framebuffer is ready to display (COMPLETE)";case s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"the attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete (INCOMPLETE_ATTACHMENT)";case s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"there is no attachment (INCOMPLETE_MISSING_ATTACHMENT)";case s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"height and width of the attachment are not the same (INCOMPLETE_DIMENSIONS)";case s.FRAMEBUFFER_UNSUPPORTED:return"the format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer (UNSUPPORTED)";case s.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"the values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures (INCOMPLETE_MULTISAMPLE)";default:return u.assert(!1,`expected known framebuffer status, given ${c}`),""}}create(i){const c=this._context.gl,s=this.context.gl2facade;this._object=c.createFramebuffer(),this._clearColors=new Array(s.COLOR_ATTACHMENT_MAX-s.COLOR_ATTACHMENT0),this._clearDepth=1,this._clearStencil=0,this.clear=this.context.isWebGL1?this.es2Clear:this.es3Clear;for(const h of i){const g=h[0],_=h[1];if(_ instanceof f.Renderbuffer?this._buffersByAttachment.set(g,_):_ instanceof o.Texture2D&&this._texturesByAttachment.set(g,_),g<s.COLOR_ATTACHMENT_MIN||g>s.COLOR_ATTACHMENT_MAX)continue;this._drawBuffers.push(g);const T=g-c.COLOR_ATTACHMENT0;this._colorClearQueue.push(T),this._clearColors[T]=[0,0,0,0]}this._drawBuffersChanged=!0,c.bindFramebuffer(c.FRAMEBUFFER,this._object),this._buffersByAttachment.forEach((h,g)=>{c.framebufferRenderbuffer(c.FRAMEBUFFER,g,c.RENDERBUFFER,h.object)}),this._texturesByAttachment.forEach((h,g)=>{c.framebufferTexture2D(c.FRAMEBUFFER,g,c.TEXTURE_2D,h.object,0)}),s.drawBuffers&&s.drawBuffers(this._drawBuffers);const a=c.checkFramebufferStatus(c.FRAMEBUFFER);return this._valid=c.isFramebuffer(this._object)&&a===c.FRAMEBUFFER_COMPLETE,u.logIf(!this._valid,u.LogLevel.Warning,r.statusString(this.context,a)),c.bindFramebuffer(c.FRAMEBUFFER,r.DEFAULT_FRAMEBUFFER),this._object}delete(){u.assert(this._object instanceof WebGLFramebuffer,"expected WebGLFramebuffer object"),this.context.gl.deleteFramebuffer(this._object),this._object=void 0,this._valid=!1}es2Clear(i,c=!0,s=!0){const a=this.context.gl,h=u.bitInBitfield(i,a.DEPTH_BUFFER_BIT),g=u.bitInBitfield(i,a.STENCIL_BUFFER_BIT),_=u.bitInBitfield(i,a.COLOR_BUFFER_BIT);if(_||h||g){if(c&&this.bind(),_&&this._clearColors[0]!==void 0){const T=this._clearColors[0];a.clearColor(T[0],T[1],T[2],T[3])}h&&this._clearDepth!==void 0&&a.clearDepth(this._clearDepth),g&&this._clearStencil!==void 0&&a.clearStencil(this._clearStencil),a.clear(i),s&&this.unbind()}}es3Clear(i,c=!0,s=!0,a){const h=this.context.gl,g=u.bitInBitfield(i,h.DEPTH_BUFFER_BIT),_=u.bitInBitfield(i,h.STENCIL_BUFFER_BIT),T=u.bitInBitfield(i,h.COLOR_BUFFER_BIT);if(T||g||_){if(c&&this.bind(),T){if(window.chrome&&(window.chrome.webstore||window.chrome.runtime)){const y=this._clearColors[0]?this._clearColors[0]:[0,0,0,1];h.clearColor(y[0],y[1],y[2],y[3]),h.clear(h.COLOR_BUFFER_BIT)}for(const y of a||this._colorClearQueue)h.clearBufferfv(h.COLOR,y,this._clearColors[y])}g&&_?(h.clearStencil(this._clearStencil),h.clearDepth(this._clearDepth),h.clear(h.STENCIL_BUFFER_BIT|h.DEPTH_BUFFER_BIT)):g?h.clearBufferfv(h.DEPTH,0,[this._clearDepth]):_&&(h.clearStencil(this._clearStencil),h.clear(h.STENCIL_BUFFER_BIT)),s&&this.unbind()}}hasAttachment(i){return this._texturesByAttachment.has(i)||this._buffersByAttachment.has(i)}bind(i=this.context.gl.FRAMEBUFFER){this.context.gl.bindFramebuffer(i,this._object),this._drawBuffersChanged&&this.context.gl2facade.drawBuffers&&(this.context.gl2facade.drawBuffers(this._drawBuffers),this._drawBuffersChanged=!1)}unbind(i=this.context.gl.FRAMEBUFFER){this.context.gl.bindFramebuffer(i,r.DEFAULT_FRAMEBUFFER)}clearColor(i,c){u.assert(c===void 0||c===0||this.context.isWebGL2||this.context.supportsDrawBuffers,"WebGL2 context expected for clearing multiple color attachments.");const s=i[3]<1&&!this.context.alpha;u.logIf(s,u.LogLevel.Warning,"context has alpha disabled, clear color alpha is ignored");const a=[i[0],i[1],i[2],s?1:i[3]];if(this.context.premultipliedAlpha&&!s&&(a[0]*=a[3],a[1]*=a[3],a[2]*=a[3]),c!==void 0)this._clearColors[c]=a;else for(let h=0;h<this._clearColors.length;++h)this._clearColors[h]=a}clearDepth(i){this._clearDepth=i}clearStencil(i){this._clearStencil=i}texture(i){return this._texturesByAttachment.get(i)}resize(i,c,s=!0,a=!0){this._buffersByAttachment.forEach(h=>{h.resize(i,c,s,a)}),this._texturesByAttachment.forEach(h=>{h.resize(i,c,s,a)})}get width(){this.assertInitialized();let i=NaN;return this._buffersByAttachment.forEach(c=>{(isNaN(i)||c.width<i)&&(i=c.width)}),this._texturesByAttachment.forEach(c=>{(isNaN(i)||c.width<i)&&(i=c.width)}),i}get height(){this.assertInitialized();let i=NaN;return this._buffersByAttachment.forEach(c=>{(isNaN(i)||c.height<i)&&(i=c.height)}),this._texturesByAttachment.forEach(c=>{(isNaN(i)||c.height<i)&&(i=c.height)}),i}get size(){return[this.width,this.height]}set drawBuffers(i){this.assertInitialized();const c=this.context.gl2facade;for(const s of i)u.assert(this.hasAttachment(s),`valid attachment expected for draw buffer, given ${s}`),u.assert(s>=c.COLOR_ATTACHMENT_MIN&&s<=c.COLOR_ATTACHMENT_MAX,`color attachment expected for draw buffer, given ${s}`),this._drawBuffersChanged=this._drawBuffersChanged||this._drawBuffers.indexOf(s)===-1;this._drawBuffersChanged=this._drawBuffersChanged||i.length!==this._drawBuffers.length,this._drawBuffersChanged&&(this._drawBuffers=i)}get drawBuffers(){return this.assertInitialized(),this._drawBuffers}}r.DEFAULT_FRAMEBUFFER=void 0,d([b.Initializable.assert_initialized()],r.prototype,"es2Clear",null),d([b.Initializable.assert_initialized()],r.prototype,"es3Clear",null),d([b.Initializable.assert_initialized()],r.prototype,"bind",null),d([b.Initializable.assert_initialized()],r.prototype,"unbind",null),d([b.Initializable.assert_initialized()],r.prototype,"clearColor",null),d([b.Initializable.assert_initialized()],r.prototype,"clearDepth",null),d([b.Initializable.assert_initialized()],r.prototype,"clearStencil",null),d([b.Initializable.assert_initialized()],r.prototype,"texture",null),d([b.Initializable.assert_initialized()],r.prototype,"resize",null),p.Framebuffer=r},9544:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.FrameCapture=void 0;const d=v(9696),u=v(9564),b=v(6786);class m{static createDataURL(o,r,n){const i=document.createElement("canvas"),c=i.getContext("2d");return i.width=o.width,i.height=o.height,c.putImageData(o,0,0),i.toDataURL(r,n)}static captureDefaultFramebuffer(o,r,n){const i=o.context.gl;o.bind(),i.readPixels(r.x,r.y,r.width,r.height,i.RGBA,i.UNSIGNED_BYTE,n),o.unbind()}static captureFramebuffer(o,r,n,i){const c=o.context.gl,s=o.texture(r);if(d.assert(s!==void 0,`Framebuffer does not have given attachment ${r}.`),d.assert(s.format===c.RGBA,`Unsupported texture format ${s.format}.`),d.assert(s.type===c.UNSIGNED_BYTE||s.type===c.FLOAT||s.type===c.HALF_FLOAT,`Unsupported texture type ${s.type}.`),c.readBuffer(r),s.type===c.FLOAT||s.type===c.HALF_FLOAT){const a=new Float32Array(n.width*n.height*4);c.readPixels(n.x,n.y,n.width,n.height,c.RGBA,c.FLOAT,a),a.forEach((h,g)=>{i[g]=255*h})}else s.type===c.UNSIGNED_BYTE&&c.readPixels(n.x,n.y,n.width,n.height,c.RGBA,c.UNSIGNED_BYTE,i)}static flipImageDataVertically(o){const r=o.height,n=o.data.length/r,i=Math.floor(r/2);for(let c=0;c<i;++c){const s=o.data.slice(c*n,(c+1)*n);o.data.copyWithin(c*n,(r-c-1)*n,(r-c)*n),o.data.set(s,(r-c-1)*n)}}static capture(o,r,n){const i=o.context.gl,c=o.size;n===void 0&&(n={x:0,y:0,width:c[0],height:c[1]}),r===void 0&&(r=i.COLOR_ATTACHMENT0);const s=new ImageData(n.width,n.height),a=new Uint8Array(s.data.buffer);return o.bind(i.READ_FRAMEBUFFER),o instanceof b.DefaultFramebuffer?m.captureDefaultFramebuffer(o,n,a):o instanceof u.Framebuffer&&m.captureFramebuffer(o,r,n,a),o.unbind(i.READ_FRAMEBUFFER),m.flipImageDataVertically(s),s}}p.FrameCapture=m},5714:function(F,p,v){var d=this&&this.__decorate||function(c,s,a,h){var g,_=arguments.length,T=_<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,a):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(c,s,a,h);else for(var y=c.length-1;y>=0;y--)(g=c[y])&&(T=(_<3?g(T):_>3?g(s,a,T):g(s,a))||T);return _>3&&T&&Object.defineProperty(s,a,T),T};Object.defineProperty(p,"__esModule",{value:!0}),p.GaussFilter=void 0;const u=v(3659),b=v(9696),m=v(2111),f=v(1030),o=v(7570),r=v(4895),n=v(5263);class i extends f.Initializable{constructor(s){super(),this._kernelSize=7,this._standardDeviation=1,this._redistribute=!0,this._ndcTriangleShared=!1,this._context=s}recalculateWeights(){if(this._weights)return!1;const s=1/Math.sqrt(2*Math.PI)*this._standardDeviation,a=2*this._standardDeviation*this._standardDeviation;this._weights=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let h=0;for(let g=0;g<=Math.floor(this._kernelSize/2);g++)this._weights[g]=s*Math.pow(Math.E,-Math.pow(g,2)/a),h+=g>0?2*this._weights[g]:this._weights[g];if(this._redistribute){const g=1-h;for(let _=0;_<=Math.floor(this._kernelSize/2);_++)this._weights[_]+=this._weights[_]/h*g}return!0}get kernelSize(){return this._kernelSize}set kernelSize(s){b.assert(s>0,"Kernel size has to be positive."),b.assert(s<=2*(i._MAXKERNELSIZEHALF-1)+1,"Kernel size has to be smaller than "+(2*(i._MAXKERNELSIZEHALF-1)+2)+"."),b.assert(Number.isInteger(s),"Kernel size has to be an integer."),b.assert(s%2==1,"Kernel size has to be odd."),this._kernelSize=s,this._weights=void 0}get standardDeviation(){return this._standardDeviation}set standardDeviation(s){b.assert(s>0,"Standard deviation has to be positive."),this._standardDeviation=s,this._weights=void 0}get redistribute(){return this._redistribute}set redistribute(s){this._redistribute=s,this._weights=void 0}initialize(s){const a=this._context.gl,h=new n.Shader(this._context,a.VERTEX_SHADER,"gauss.vert");h.initialize(v(1622)),this._fragmentShader=new n.Shader(this._context,a.FRAGMENT_SHADER,"gauss.frag"),this._fragmentShader.replace("$KERNEL_HALF_SIZE",`${Math.floor(this.kernelSize/2)}`),this._fragmentShader.initialize(v(4472)),this._program=new r.Program(this._context),this._program.initialize([h,this._fragmentShader]),this._uDelta=this._program.uniform("u_delta"),this._uWeights=this._program.uniform("u_weights");const g=this._program.attribute("a_vertex",0);return s===void 0?this._ndcTriangle=new o.NdcFillingTriangle(this._context,"GaussFilterQuad"):(this._ndcTriangle=s,this._ndcTriangleShared=!0),this._ndcTriangle.initialize(g),!0}uninitialize(){this._program.uninitialize(),this._ndcTriangleShared||this._ndcTriangle.uninitialize()}filter(s,a){const h=this._context.gl,g=[u.vec2.fromValues(1,0),u.vec2.fromValues(0,1)];this.recalculateWeights()&&(this._fragmentShader.replace("$KERNEL_HALF_SIZE",`${Math.floor(this.kernelSize/2)}`),this._fragmentShader.compile(),this._program.link(),this._uDelta=this._program.uniform("u_delta"),this._uWeights=this._program.uniform("u_weights"),this._program.bind(),h.uniform1fv(this._uWeights,this._weights)),this._program.bind(),s.bind(h.TEXTURE0),h.uniform2fv(this._uDelta,u.vec2.divide(m.v2(),g[a],s.size)),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),s.unbind(h.TEXTURE0),this._program.unbind()}}i._MAXKERNELSIZEHALF=32,d([f.Initializable.initialize()],i.prototype,"initialize",null),d([f.Initializable.uninitialize()],i.prototype,"uninitialize",null),d([f.Initializable.assert_initialized()],i.prototype,"filter",null),p.GaussFilter=i,function(c){(function(s){s[s.Horizontal=0]="Horizontal",s[s.Vertical=1]="Vertical"})(c.Direction||(c.Direction={}))}(i=p.GaussFilter||(p.GaussFilter={}))},4894:function(F,p,v){var d=this&&this.__decorate||function(f,o,r,n){var i,c=arguments.length,s=c<3?o:n===null?n=Object.getOwnPropertyDescriptor(o,r):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(f,o,r,n);else for(var a=f.length-1;a>=0;a--)(i=f[a])&&(s=(c<3?i(s):c>3?i(o,r,s):i(o,r))||s);return c>3&&s&&Object.defineProperty(o,r,s),s};Object.defineProperty(p,"__esModule",{value:!0}),p.Geometry=void 0;const u=v(1030),b=v(5590);class m extends u.Initializable{constructor(o,r){super(),this._buffers=new Array,r=r!==void 0&&r!==""?r:this.constructor.name,this._vertexArray=new b.VertexArray(o,`${r}VAO`)}initialize(...o){const r=o[0],n=o[1];let i=!0;for(let c=0;c<this._buffers.length;++c)i=this._buffers[c].initialize(r[c])&&i;return this._vertexArray.initialize(()=>this.bindBuffers(n),()=>this.unbindBuffers(n)),this._vertexArray.valid&&i}uninitialize(){this._vertexArray.uninitialize(),this._buffers.forEach(o=>o.uninitialize())}bind(){this._vertexArray.bind()}unbind(){this._vertexArray.unbind()}get buffers(){return this._buffers}get context(){return this._vertexArray.context}get vertexArray(){return this._vertexArray}}d([u.Initializable.initialize()],m.prototype,"initialize",null),d([u.Initializable.uninitialize()],m.prototype,"uninitialize",null),d([u.Initializable.assert_initialized()],m.prototype,"bind",null),d([u.Initializable.assert_initialized()],m.prototype,"unbind",null),p.Geometry=m},2111:(F,p,v)=>{const d=v(3659);var u;(function(b){function m(o){return o>0?o-Math.floor(o):o-Math.ceil(o)}b.sign=function(o){return o>0?1:o<0?-1:0},b.clamp=function(o,r,n){return Math.max(r,Math.min(n,o))},b.fract=m,b.v2=function(){return d.vec2.create()},b.clamp2=function(o,r,n,i){return o[0]=Math.max(n[0],Math.min(i[0],r[0])),o[1]=Math.max(n[1],Math.min(i[1],r[1])),o},b.abs2=function(o,r){return o[0]=Math.abs(r[0]),o[1]=Math.abs(r[1]),o},b.v3=function(){return d.vec3.create()},b.clamp3=function(o,r,n,i){return o[0]=Math.max(n[0],Math.min(i[0],r[0])),o[1]=Math.max(n[1],Math.min(i[1],r[1])),o[2]=Math.max(n[2],Math.min(i[2],r[2])),o},b.abs3=function(o,r){return o[0]=Math.abs(r[0]),o[1]=Math.abs(r[1]),o[2]=Math.abs(r[2]),o};const f=1/256;b.encode_float24x1_to_uint8x3=function(o,r){return o[0]=Math.floor(256*r),o[1]=Math.floor(256*m(256*r)),o[2]=Math.floor(256*m(65536*r)),o},b.decode_float24x1_from_uint8x3=function(o){return(o[0]+(o[1]+o[2]*f)*f)*f},b.encode_uint24_to_rgb8=function(o,r){return o[0]=r>>>0&255,o[1]=r>>>8&255,o[2]=r>>>16&255,o},b.encode_uint32_to_rgba8=function(o,r){return o[0]=r>>>0&255,o[1]=r>>>8&255,o[2]=r>>>16&255,o[3]=r>>>24&255,o},b.decode_uint24_from_rgb8=function(o){return o[0]+(o[1]<<8)+(o[2]<<16)},b.decode_uint32_from_rgba8=function(o){return o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24)>>>0},b.fromVec4=function(o){return o[3]===0?d.vec3.fromValues(o[0],o[1],o[2]):d.vec3.fromValues(o[0]/o[3],o[1]/o[3],o[2]/o[3])},b.v4=function(){return d.vec4.create()},b.clamp4=function(o,r,n,i){return o[0]=Math.max(n[0],Math.min(i[0],r[0])),o[1]=Math.max(n[1],Math.min(i[1],r[1])),o[2]=Math.max(n[2],Math.min(i[2],r[2])),o[3]=Math.max(n[3],Math.min(i[3],r[3])),o},b.abs4=function(o,r){return o[0]=Math.abs(r[0]),o[1]=Math.abs(r[1]),o[2]=Math.abs(r[2]),o[3]=Math.abs(r[3]),o},b.fromVec3=function(o){return d.vec4.fromValues(o[0],o[1],o[2],1)},b.parseVec2=function(o){if(o===void 0||o==="")return;let r=[];try{r=JSON.parse(`[${o}]`)}catch{return}return r.length!==2||isNaN(r[0])||isNaN(r[1])?void 0:d.vec2.clone(r)},b.parseVec3=function(o){if(o===void 0||o==="")return;let r=[];try{r=JSON.parse(`[${o}]`)}catch{return}return r.length!==3||isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?void 0:d.vec3.clone(r)},b.parseVec4=function(o){if(o===void 0||o==="")return;let r=[];try{r=JSON.parse(`[${o}]`)}catch{return}return r.length!==4||isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?void 0:d.vec4.clone(r)},b.mix=function(o,r,n){return o*(1-n)+r*n},b.m2=function(){return d.mat2.create()},b.m3=function(){return d.mat3.create()},b.m4=function(){return d.mat4.create()}})(u||(u={})),F.exports=u},5218:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GL2Facade=void 0;const d=v(9696),u=v(4518);p.GL2Facade=class{constructor(b){this.drawBuffers=void 0,d.assert(b!==void 0,"gl2 facade expects a valid WebGL context"),this.queryHalfFloatSupport(b),this.queryColorAttachments(b),this.queryInstancedArraySupport(b),this.queryDrawBuffersSupport(b),this.queryVertexArrayObjectSupport(b),this.queryMaxUniformVec3Components(b),this.queryBufferSubDataInterface(b),this.queryTexImageInterface(b)}get HALF_FLOAT(){return this._halfFloat}queryHalfFloatSupport(b){switch(b.backend){case u.Context.BackendType.WebGL1:this._halfFloat=b.supportsTextureHalfFloat&&b.textureHalfFloat?b.textureHalfFloat.HALF_FLOAT_OES:void 0;break;case u.Context.BackendType.WebGL2:default:this._halfFloat=b.gl.HALF_FLOAT}}get COLOR_ATTACHMENT_MIN(){return this._colorAttachmentMin}get COLOR_ATTACHMENT_MAX(){return this._colorAttachmentMax}get COLOR_ATTACHMENT0(){return this._colorAttachments[0]}get COLOR_ATTACHMENT1(){return this._colorAttachments[1]}get COLOR_ATTACHMENT2(){return this._colorAttachments[2]}get COLOR_ATTACHMENT3(){return this._colorAttachments[3]}get COLOR_ATTACHMENT4(){return this._colorAttachments[4]}get COLOR_ATTACHMENT5(){return this._colorAttachments[5]}get COLOR_ATTACHMENT6(){return this._colorAttachments[6]}get COLOR_ATTACHMENT7(){return this._colorAttachments[7]}get COLOR_ATTACHMENT8(){return this._colorAttachments[8]}get COLOR_ATTACHMENT9(){return this._colorAttachments[9]}get COLOR_ATTACHMENT10(){return this._colorAttachments[10]}get COLOR_ATTACHMENT11(){return this._colorAttachments[11]}get COLOR_ATTACHMENT12(){return this._colorAttachments[12]}get COLOR_ATTACHMENT13(){return this._colorAttachments[13]}get COLOR_ATTACHMENT14(){return this._colorAttachments[14]}get COLOR_ATTACHMENT15(){return this._colorAttachments[15]}queryColorAttachments(b){const m=b.gl;switch(this._colorAttachments=new Array(16),this._colorAttachments[0]=m.COLOR_ATTACHMENT0,b.backend){case u.Context.BackendType.WebGL1:const f=b.supportsDrawBuffers?b.drawBuffers:void 0;if(this._colorAttachmentMin=this._colorAttachments[0],this._colorAttachmentMax=this._colorAttachmentMin+(f?m.getParameter(f.MAX_COLOR_ATTACHMENTS_WEBGL):0),this._colorAttachments[0]=f?f.COLOR_ATTACHMENT0_WEBGL:m.COLOR_ATTACHMENT0,!f)break;for(let o=1;o<16;++o)this._colorAttachments[o]=f.COLOR_ATTACHMENT0_WEBGL+o;break;case u.Context.BackendType.WebGL2:default:this._colorAttachmentMin=b.gl.COLOR_ATTACHMENT0,this._colorAttachmentMax=b.gl.COLOR_ATTACHMENT0+m.getParameter(m.MAX_COLOR_ATTACHMENTS);for(let o=0;o<16;++o)this._colorAttachments[o]=m.COLOR_ATTACHMENT0+o}}queryInstancedArraySupport(b){(b.isWebGL2||b.supportsInstancedArrays)&&(this.drawArraysInstanced=b.isWebGL2?(m,f,o,r)=>b.gl.drawArraysInstanced(m,f,o,r):(m,f,o,r)=>b.instancedArrays.drawArraysInstancedANGLE(m,f,o,r),this.drawElementsInstanced=b.isWebGL2?(m,f,o,r,n)=>b.gl.drawElementsInstanced(m,f,o,r,n):(m,f,o,r,n)=>b.instancedArrays.drawElementsInstancedANGLE(m,f,o,r,n),this.vertexAttribDivisor=b.isWebGL2?(m,f)=>b.gl.vertexAttribDivisor(m,f):(m,f)=>b.instancedArrays.vertexAttribDivisorANGLE(m,f))}get MAX_DRAW_BUFFERS(){return this._maxDrawBuffers}queryDrawBuffersSupport(b){(b.isWebGL2||b.supportsDrawBuffers)&&(this.drawBuffers=b.isWebGL2?m=>b.gl.drawBuffers(m):m=>b.drawBuffers.drawBuffersWEBGL(m),this._maxDrawBuffers=b.isWebGL2?b.gl.MAX_DRAW_BUFFERS:b.drawBuffers.MAX_DRAW_BUFFERS_WEBGL)}queryVertexArrayObjectSupport(b){(b.isWebGL2||b.supportsVertexArrayObject)&&(this.createVertexArray=b.isWebGL2?()=>b.gl.createVertexArray():()=>b.vertexArrayObject.createVertexArrayOES(),this.deleteVertexArray=b.isWebGL2?m=>b.gl.deleteVertexArray(m):m=>b.vertexArrayObject.deleteVertexArrayOES(m),this.isVertexArray=b.isWebGL2?m=>b.gl.isVertexArray(m):m=>b.vertexArrayObject.isVertexArrayOES(m),this.bindVertexArray=b.isWebGL2?m=>b.gl.bindVertexArray(m):m=>b.vertexArrayObject.bindVertexArrayOES(m))}get maxUniformVec3Components(){return this._maxUniformVec3Components}queryMaxUniformVec3Components(b){const m=b.gl;this._maxUniformVec3Components=b.isWebGL2?m.getParameter(m.MAX_VERTEX_UNIFORM_COMPONENTS):3*m.getParameter(m.MAX_VERTEX_UNIFORM_VECTORS)}queryBufferSubDataInterface(b){const m=b.gl;b.isWebGL2?this.bufferSubData=(f,o,r,n,i=0)=>m.bufferSubData(f,o,r,n,i):this.bufferSubData=(f,o,r,n=0,i=0)=>(d.logIf(n!==0,d.LogLevel.Warning,"srcOffset ignored (not supported in WebGL)"),d.logIf(i!==0,d.LogLevel.Warning,"length ignored (not supported in WebGL)"),m.bufferSubData(f,o,r))}queryTexImageInterface(b){const m=b.gl;b.isWebGL2?this.texImage2D=(f,o,r,n,i,c,s,a,h,g)=>h instanceof ArrayBuffer?m.texImage2D(f,o,r,n,i,c,s,a,h===void 0?null:h,g):(d.assert(g===void 0,"offset expected to be undefined for non ArrayBuffer source"),m.texImage2D(f,o,r,n,i,c,s,a,h===void 0?null:h)):this.texImage2D=(f,o,r,n,i,c,s,a,h,g)=>h===void 0?m.texImage2D(f,o,r,n,i,c,s,a,null):h instanceof Int8Array||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Int16Array||h instanceof Uint16Array||h instanceof Int32Array||h instanceof Uint32Array||h instanceof Float32Array||h instanceof Float64Array||h instanceof DataView?m.texImage2D(f,o,r,n,i,c,s,a,h):m.texImage2D(f,o,r,s,a,h),b.supportsTexImage3D?this.texImage3D=(f,o,r,n,i,c,s,a,h,g,_)=>g instanceof ArrayBuffer?m.texImage3D(f,o,r,n,i,c,s,a,h,g===void 0?null:g,_):(d.assert(_===void 0,"offset expected to be undefined for non ArrayBuffer source"),m.texImage3D(f,o,r,n,i,c,s,a,h,g===void 0?null:g)):this.texImage3D=(f,o,r,n,i,c,s,a,h,g,_)=>d.assert(!1,"texImage3D not supported on this context")}}},8269:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GLTFHelper=void 0;const d=v(9696);p.GLTFHelper=class{static modeToEnum(u,b){return(b<0||b>6)&&d.log(d.LogLevel.Error,`Specified draw mode is ${b} but is required to be between 0 and 6`),b===0?u.POINTS:b===1?u.LINES:b===2?u.LINE_LOOP:b===3?u.LINE_STRIP:b===4?u.TRIANGLES:b===5?u.TRIANGLE_STRIP:b===6?u.TRIANGLE_FAN:u.TRIANGLES}static nameToAttributeIndex(u){return u==="POSITION"?0:u==="NORMAL"?1:u==="TANGENT"?2:u==="TEXCOORD_0"?3:u==="TEXCOORD_1"?4:u==="TEXCOORD_2"?5:u==="JOINTS_0"?6:u==="WEIGHTS_0"?7:u==="COLOR_0"?8:(d.log(d.LogLevel.Warning,`Unknown attribute name '${u}' encountered.             Possibly this model uses an unsupported extension.`),-1)}}},5500:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GLTFLoader=void 0;const d=v(3659),u=v(9696),b=v(3041),m=v(8269),f=v(858),o=v(7964),r=v(4303),n=v(6404),i=v(2194),c=v(4895),s=v(9922),a=v(9981),h=v(5263),g=v(6942);p.GLTFLoader=class{constructor(_){this._context=_;const T=this._context.gl;this._resourceManager=new i.ResourceManager(this._context),this._scenes=new Array;const y=new h.Shader(this._context,T.VERTEX_SHADER,"gltf_default.vert");y.initialize(v(6263));const A=new h.Shader(this._context,T.FRAGMENT_SHADER,"gltf_default.frag");A.initialize(v(6277)),this._pbrProgram=new c.Program(this._context,"GLTFPbrProgram"),this._pbrProgram.initialize([y,A])}async loadTextures(_){const T=this._context.gl;this._uriTextureMap=new Map;const y=_.gltf.textures,A=_.gltf.images,w=_.gltf.samplers;if(!y||!A)return;let L=0;for(const D of y){if(D.source===void 0){u.log(u.LogLevel.Warning,"The GLTF model does not specify a texture source. Possibly it uses an unsupported extension."),L++;continue}const j=D.source,V=A[j],G=this._sceneName+"_texture_"+L,W=V.name===void 0?V.uri:V.name;let H=await _.imageData.get(j);if(!u.isPowerOfTwo(H.width)||!u.isPowerOfTwo(H.height)){const $=document.createElement("canvas");$.width=u.upperPowerOfTwo(H.width),$.height=u.upperPowerOfTwo(H.height);const J=$.getContext("2d");J===void 0&&u.log(u.LogLevel.Error,"Failed to create context while trying to resize non power of two texture"),J.drawImage(H,0,0,$.width,$.height),H=$}const q=new g.Texture2D(this._context,W);if(q.initialize(H.width,H.height,T.RGBA8,T.RGBA,T.UNSIGNED_BYTE),q.data(H),w===void 0||D.sampler===void 0)q.wrap(T.REPEAT,T.REPEAT),q.filter(T.LINEAR,T.LINEAR);else{const $=w[D.sampler];q.wrap($.wrapS||T.REPEAT,$.wrapT||T.REPEAT),q.filter($.magFilter||T.LINEAR,$.minFilter||T.LINEAR),$.minFilter!==T.NEAREST_MIPMAP_NEAREST&&$.minFilter!==T.LINEAR_MIPMAP_NEAREST&&$.minFilter!==T.NEAREST_MIPMAP_LINEAR&&$.minFilter!==T.LINEAR_MIPMAP_LINEAR||q.generateMipMap()}this._resourceManager.add(q,[W,G]);const Z=V.uri?V.uri:G;this._uriTextureMap.set(Z,q),L++}}getTexture(_){const T=this._sceneName+"_texture_"+_,y=this._resourceManager.get(T);if(y!==void 0)return y;u.log(u.LogLevel.Warning,`Texture with index ${_} could not be located.`)}async loadMaterials(_){this._pbrDefaultMaterial=new o.GLTFPbrMaterial(this._context,"DefaultMaterial"),this._resourceManager.add(this._pbrDefaultMaterial,[this._pbrDefaultMaterial.name]);const T=_.gltf.materials;if(!T)return;let y=0;for(const A of T){const w=this._sceneName+"_material_"+y,L=new o.GLTFPbrMaterial(this._context,A.name),D=A.normalTexture;D!==void 0&&(L.normalTexture=this.getTexture(D.index),L.normalTexCoord=D.texCoord||0,L.normalScale=D.scale||1);const j=A.occlusionTexture;j!==void 0&&(L.occlusionTexture=this.getTexture(j.index),L.occlusionTexCoord=j.texCoord||0);const V=A.emissiveTexture;V!==void 0&&(L.emissiveTexture=this.getTexture(V.index),L.emissiveTexCoord=V.texCoord||0),L.emissiveFactor=d.vec3.fromValues(0,0,0),A.emissiveFactor!==void 0&&(L.emissiveFactor=d.vec3.fromValues.apply(void 0,A.emissiveFactor)),L.alphaMode=o.GLTFAlphaMode.OPAQUE,A.alphaMode==="MASK"?(L.alphaMode=o.GLTFAlphaMode.MASK,A.alphaCutoff===void 0?L.alphaCutoff=.5:L.alphaCutoff=A.alphaCutoff):A.alphaMode==="BLEND"&&(L.alphaMode=o.GLTFAlphaMode.BLEND,L.isTransparent=!0),L.isDoubleSided=A.doubleSided||!1;const G=A.pbrMetallicRoughness;G===void 0&&u.log(u.LogLevel.Warning,"Model contains a material without PBR information");const W=G.baseColorTexture;W!==void 0&&(L.baseColorTexture=this.getTexture(W.index),L.baseColorTexCoord=W.texCoord||0);const H=G.metallicRoughnessTexture;H!==void 0&&(L.metallicRoughnessTexture=this.getTexture(H.index),L.metallicRoughnessTexCoord=H.texCoord||0),L.baseColorFactor=d.vec4.fromValues(1,1,1,1),G.baseColorFactor!==void 0&&(L.baseColorFactor=d.vec4.fromValues.apply(void 0,G.baseColorFactor)),L.metallicFactor=1,G.metallicFactor!==void 0&&(L.metallicFactor=G.metallicFactor),L.roughnessFactor=1,G.roughnessFactor!==void 0&&(L.roughnessFactor=G.roughnessFactor),this._resourceManager.add(L,[A.name,w]),y++}}inferBufferUsage(_,T){const y=this._context.gl,A=_.gltf.meshes,w=_.gltf.accessors;if(A===void 0||w===void 0)return u.log(u.LogLevel.Error,"Asset does not include any meshes or accessors"),y.ARRAY_BUFFER;for(const L of A)for(const D of L.primitives){const j=D.indices;if(j===void 0)continue;const V=w[j].bufferView;if(V!==void 0&&V===T)return y.ELEMENT_ARRAY_BUFFER}return y.ARRAY_BUFFER}async loadBuffers(_){const T=this._context.gl,y=_.gltf.bufferViews,A=_.gltf.accessors;if(!y)return void u.log(u.LogLevel.Warning,"The asset does not include any buffer view information.");if(!A)return void u.log(u.LogLevel.Warning,"The asset does not include any accessor information.");let w=0;for(const D of y){const j=this._sceneName+"_bufferView_"+w,V=await _.bufferViewData(w);let G=D.target;G===void 0&&(G=this.inferBufferUsage(_,w));const W=new n.Buffer(this._context,j);W.initialize(G),W.data(V,T.STATIC_DRAW),this._resourceManager.add(W,[j]),w++}let L=0;for(const D of A){const j=D.bufferView,V=D.sparse;if(j===void 0||V!==void 0){const G=this._sceneName+"_accessor_"+L,W=new n.Buffer(this._context,G),H=await _.accessorData(L);W.initialize(T.ARRAY_BUFFER),W.data(H,T.STATIC_DRAW),this._resourceManager.add(W,[G])}L++}}async loadMeshes(_){this._meshes=new Array,this._nameMeshMap=new Map;const T=_.gltf.meshes;if(T===void 0)return u.log(u.LogLevel.Warning,"The asset does not contain any mesh information"),this._meshes;let y=0;for(const A of T){const w=new f.GLTFMesh(A.name);for(const L of A.primitives){const D=await this.loadPrimitive(_,L,y);D!==void 0&&w.addPrimitive(D),y++}A.name&&this._nameMeshMap.set(A.name,w),this._meshes.push(w)}return this._meshes}async loadPrimitive(_,T,y){const A=this._context.gl,w=_.gltf.accessors,L=_.gltf.bufferViews;if(w===void 0)return void u.log(u.LogLevel.Error,"GLTF asset does not have any accessors.");if(L===void 0)return void u.log(u.LogLevel.Error,"GLTF asset does not have any buffer views.");let D=T.mode;const j=this._sceneName+"_primitive_"+y;D||(D=4);const V=m.GLTFHelper.modeToEnum(A,D),G=new Array;let W=this._pbrDefaultMaterial;if(T.material!==void 0){const $=this._sceneName+"_material_"+T.material,J=this._resourceManager.get($);J!==void 0?W=J:u.log(u.LogLevel.Warning,`Material ${$} could not be found.`)}let H,q=0;for(const $ in T.attributes){const J=m.GLTFHelper.nameToAttributeIndex($);$==="NORMAL"&&(q|=o.GLTFShaderFlags.HAS_NORMALS),$==="TANGENT"&&(q|=o.GLTFShaderFlags.HAS_TANGENTS),$==="COLOR_0"&&(q|=o.GLTFShaderFlags.HAS_COLORS),$!=="TEXCOORD_0"&&$!=="TEXCOORD_1"&&$!=="TEXCOORD_2"||(q|=o.GLTFShaderFlags.HAS_UV);const se=T.attributes[$],Q=w[se],ae=Q.bufferView,me=Q.sparse;let he,xe=0;if(ae===void 0||me!==void 0){const be=this._sceneName+"_accessor_"+se;he=this._resourceManager.get(be)}else{const be=L[ae],ve=this._sceneName+"_bufferView_"+ae;he=this._resourceManager.get(ve),xe=be.byteStride||0}const Y=new r.VertexBinding;Y.buffer=he,Y.attributeIndex=J,Y.numVertices=Q.count,Y.normalized=Q.normalized||!1,Y.size=b.GLTF_ELEMENTS_PER_TYPE[Q.type],Y.offset=Q.byteOffset||0,Y.stride=xe,Y.type=Q.componentType,G.push(Y)}if(T.indices!==void 0){const $=w[T.indices],J=$.bufferView;!J===void 0&&u.log(u.LogLevel.Error,"Accessor does not reference a BufferView.");const se=this._sceneName+"_bufferView_"+J,Q=this._resourceManager.get(se);H=new r.IndexBinding,H.buffer=Q,H.numIndices=$.count,H.offset=$.byteOffset||0,H.type=$.componentType}const Z=new r.GLTFPrimitive(this._context,G,H,V,W,q);return Z.initialize(),this._resourceManager.add(Z,[j]),Z}async generateScenes(_){const T=_.gltf.nodes,y=_.gltf.scenes;if(!T||!y)return void u.log(u.LogLevel.Warning,"The asset does not contain any nodes or scene information.");const A=new Map;let w=0;for(const j of T){const V=j.name||"node_"+w,G=new a.SceneNode(V);if(A.set(w,G),j.matrix){const W=d.mat4.fromValues.apply(void 0,j.matrix),H=new s.TransformComponent(W);G.addComponent(H)}else if(j.translation||j.rotation||j.scale){let W=d.quat.create();j.rotation&&(W=d.quat.fromValues.apply(void 0,j.rotation));let H=d.vec3.create();j.translation&&(H=d.vec3.fromValues.apply(void 0,j.translation));let q=d.vec3.fromValues(1,1,1);j.scale&&(q=d.vec3.fromValues.apply(void 0,j.scale));const Z=d.mat4.fromRotationTranslationScale(d.mat4.create(),W,H,q),$=new s.TransformComponent(Z);G.addComponent($)}if(j.mesh!==void 0){const W=this._meshes[j.mesh];for(const H of W.primitives){const q=new s.GeometryComponent;q.material=H.material,q.geometry=H,G.addComponent(q)}}(j.skin||j.weights)&&u.log(u.LogLevel.Info,"Imported GLTF assets uses skins, which are not supported yet."),w++}w=0;for(const j of T){const V=A.get(w);if(u.assert(V!==void 0,"Scene node could not be found."),j.children)for(const G of j.children){const W=A.get(G);W||u.log(u.LogLevel.Error,"Model references a node that does not exist."),V.addNode(W)}w++}let L=0;for(const j of y){const V=j.name||"scene_"+L,G=new a.SceneNode(V);if(j.nodes)for(const W of j.nodes){const H=A.get(W);H||u.log(u.LogLevel.Error,"Scene references a node that does not exist."),G.addNode(H)}else u.log(u.LogLevel.Warning,`Scene ${V} does not contain any nodes.`);this._scenes.push(G),L++}const D=_.gltf.scene;D!==void 0&&(this._defaultScene=this._scenes[D])}async loadAsset(_){const T=new b.GltfLoader,y=await T.load(_),A=y.gltf;this._sceneName="scene",A.scenes&&A.scene&&A.scenes[A.scene].name&&(this._sceneName=A.scenes[A.scene].name),await this.loadTextures(y).then(()=>this.loadMaterials(y)).then(()=>this.loadBuffers(y)).then(()=>this.loadMeshes(y)).then(()=>this.generateScenes(y))}uninitialize(){this._scenes=[],this._defaultScene=void 0,this._resourceManager.uninitialize()}getMeshByName(_){return this._nameMeshMap.get(_)}get meshes(){return this._meshes}get uriTextureMap(){return this._uriTextureMap}get pbrProgram(){return this._pbrProgram}get scenes(){return this._scenes}get defaultScene(){return this._defaultScene!==void 0?this._defaultScene:this._scenes!==void 0&&this._scenes.length>0?this._scenes[0]:(u.log(u.LogLevel.Warning,"Default scene was requested, but none is available."),new a.SceneNode("EmptyScene"))}}},858:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GLTFMesh=void 0,p.GLTFMesh=class{constructor(v){this._name=v,this._primitives=new Array}get primitives(){return this._primitives}addPrimitive(v){this._primitives.push(v)}}},7964:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GLTFPbrMaterial=p.GLTFAlphaMode=p.GLTFShaderFlags=void 0;const d=v(3659),u=v(9922);var b,m;(function(o){o[o.HAS_NORMALS=1]="HAS_NORMALS",o[o.HAS_TANGENTS=2]="HAS_TANGENTS",o[o.HAS_UV=4]="HAS_UV",o[o.HAS_COLORS=8]="HAS_COLORS",o[o.USE_IBL=16]="USE_IBL",o[o.HAS_BASECOLORMAP=32]="HAS_BASECOLORMAP",o[o.HAS_NORMALMAP=64]="HAS_NORMALMAP",o[o.HAS_EMISSIVEMAP=128]="HAS_EMISSIVEMAP",o[o.HAS_METALROUGHNESSMAP=256]="HAS_METALROUGHNESSMAP",o[o.HAS_OCCLUSIONMAP=512]="HAS_OCCLUSIONMAP",o[o.USE_TEX_LOD=1024]="USE_TEX_LOD"})(b=p.GLTFShaderFlags||(p.GLTFShaderFlags={})),function(o){o[o.OPAQUE=0]="OPAQUE",o[o.MASK=1]="MASK",o[o.BLEND=2]="BLEND"}(m=p.GLTFAlphaMode||(p.GLTFAlphaMode={}));class f extends u.Material{constructor(r,n){super(r,n),this.baseColorTexCoord=0,this.metallicRoughnessTexCoord=0,this.normalTexCoord=0,this.occlusionTexCoord=0,this.emissiveTexCoord=0,this._alphaMode=m.OPAQUE,this._alphaCutoff=1,this._baseColorFactor=d.vec4.fromValues(1,1,1,1),this._metallicFactor=1,this._roughnessFactor=1,this._emissiveFactor=d.vec3.fromValues(0,0,0),this._isDoubleSided=!1,this._normalScale=1}set baseColorTexture(r){this._baseColorTexture=r}get baseColorTexture(){return this._baseColorTexture}set metallicRoughnessTexture(r){this._metallicRoughnessTexture=r}get metallicRoughnessTexture(){return this._metallicRoughnessTexture}set normalTexture(r){this._normalTexture=r}get normalTexture(){return this._normalTexture}set occlusionTexture(r){this._occlusionTexture=r}get occlusionTexture(){return this._occlusionTexture}set emissiveTexture(r){this._emissiveTexture=r}get emissiveTexture(){return this._emissiveTexture}set emissiveFactor(r){this._emissiveFactor=r}get emissiveFactor(){return this._emissiveFactor}set baseColorFactor(r){this._baseColorFactor=r}get baseColorFactor(){return this._baseColorFactor}set metallicFactor(r){this._metallicFactor=r}get metallicFactor(){return this._metallicFactor}set roughnessFactor(r){this._roughnessFactor=r}get roughnessFactor(){return this._roughnessFactor}get normalScale(){return this._normalScale}set normalScale(r){this._normalScale=r}set isDoubleSided(r){this._isDoubleSided=r}get isDoubleSided(){return this._isDoubleSided}set alphaMode(r){this._alphaMode=r}get alphaMode(){return this._alphaMode}set alphaCutoff(r){this._alphaCutoff=r}get alphaCutoff(){return this._alphaCutoff}get flags(){let r=0;return this.baseColorTexture!==void 0&&(r|=b.HAS_BASECOLORMAP),this.metallicRoughnessTexture!==void 0&&(r|=b.HAS_METALROUGHNESSMAP),this.normalTexture!==void 0&&(r|=b.HAS_NORMALMAP),this.occlusionTexture!==void 0&&(r|=b.HAS_OCCLUSIONMAP),this.emissiveTexture!==void 0&&(r|=b.HAS_EMISSIVEMAP),r}}p.GLTFPbrMaterial=f},4303:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GLTFPrimitive=p.VertexBinding=p.IndexBinding=void 0;const d=v(4894),u=v(8269);p.IndexBinding=class{},p.VertexBinding=class{};class b extends d.Geometry{constructor(f,o,r,n,i,c,s){super(f,s),this._bindings=o,this._indexBinding=r,this._material=i,this._geometryFlags=c,this._drawMode=n}bindBuffers(){this._indexBinding&&this._indexBinding.buffer.bind();for(const f of this._bindings)f.buffer.attribEnable(f.attributeIndex,f.size,f.type,f.normalized,f.stride,f.offset,!0,!0)}unbindBuffers(){this._indexBinding&&this._indexBinding.buffer.unbind();for(const f of this._bindings)f.buffer.attribDisable(f.attributeIndex,!0,!0)}draw(){const f=this.context.gl;this._indexBinding?f.drawElements(this._drawMode,this._indexBinding.numIndices,this._indexBinding.type,this._indexBinding.offset):f.drawArrays(this._drawMode,0,this._bindings[0].numVertices)}get drawMode(){return this._drawMode}get material(){return this._material}get flags(){return this._geometryFlags}get indexBufferInformation(){return this._indexBinding}getVertexBufferInformationFromAttribute(f){const o=u.GLTFHelper.nameToAttributeIndex(f);for(const r of this._bindings)if(r.attributeIndex===o)return r}}p.GLTFPrimitive=b},3733:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GLTFMesh=p.GLTFPrimitive=p.GLTFShaderFlags=p.GLTFPbrMaterial=p.GLTFAlphaMode=p.GLTFLoader=void 0;var d=v(5500);Object.defineProperty(p,"GLTFLoader",{enumerable:!0,get:function(){return d.GLTFLoader}});var u=v(7964);Object.defineProperty(p,"GLTFAlphaMode",{enumerable:!0,get:function(){return u.GLTFAlphaMode}}),Object.defineProperty(p,"GLTFPbrMaterial",{enumerable:!0,get:function(){return u.GLTFPbrMaterial}}),Object.defineProperty(p,"GLTFShaderFlags",{enumerable:!0,get:function(){return u.GLTFShaderFlags}});var b=v(4303);Object.defineProperty(p,"GLTFPrimitive",{enumerable:!0,get:function(){return b.GLTFPrimitive}});var m=v(858);Object.defineProperty(p,"GLTFMesh",{enumerable:!0,get:function(){return m.GLTFMesh}})},1030:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Initializable=void 0;const d=v(9696);class u{constructor(){this._initialized=!1,this.assertInitialized=()=>u.assertInitializedFalse(this),this.assertUninitialized=()=>{}}static initialize(){return(m,f,o)=>{const r=o.value;return o.value=function(){return d.assert(this._initialized===!1,"re-initialization of initialized object not anticipated"),this._initialized=r.apply(this,arguments),this._initialized?(this.assertInitialized=()=>{},this.assertUninitialized=()=>u.assertUninitializedFalse(this)):(this.assertUninitialized=()=>{},this.assertInitialized=()=>u.assertInitializedFalse(this)),this._initialized},o}}static uninitialize(){return(m,f,o)=>{const r=o.value;return o.value=function(){d.assert(this._initialized===!0,"expected object to be initialized in order to uninitialize"),r.apply(this),this._initialized=!1,this.assertUninitialized=()=>{},this.assertInitialized=()=>u.assertInitializedFalse(this)},o}}static discard(){return(m,f,o)=>{const r=o.value;return o.value=function(){d.assert(this._initialized===!0,"expected object to be initialized in order to uninitialize"),r.apply(this),this._initialized=!1,this.assertUninitialized=()=>{},this.assertInitialized=()=>u.assertInitializedFalse(this)},o}}static assert_initialized(){return(m,f,o)=>{const r=o.value;return o.value=function(){return this.assertInitialized(),r.apply(this,arguments)},o}}static assert_uninitialized(){return(m,f,o)=>{const r=o.value;return o.value=function(){this.assertUninitialized(),r.apply(this,arguments)},o}}get initialized(){return this._initialized}}p.Initializable=u,u.assertInitializedFalse=b=>d.assert(!1,`instance of ${b.constructor.name} expected to be initialized`),u.assertUninitializedFalse=b=>d.assert(!1,`instance of ${b.constructor.name} not expected to be initialized`)},4563:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.KernelI8=p.KernelUI8=p.KernelI32=p.KernelUI32=p.KernelF32=p.AbstractKernel=void 0;const d=v(9696);class u{constructor(m,f,o=1,r=1){this._components=m,this._width=isNaN(f)?1:Math.max(1,f),this._height=Math.max(1,o),this._depth=Math.max(1,r),this.resize()}get(m,f,o){let r;switch(r=f===void 0&&o===void 0?this._components*m:this.index(m,f,o||0),d.assert(r<this.length,`index expected to be in range [0, ${this.length-1}], given ${r}`),this._components){case 1:return[this._samples[r]];case 2:return[this._samples[r],this._samples[r+1]];case 3:return[this._samples[r],this._samples[r+1],this._samples[r+2]];case 4:return[this._samples[r],this._samples[r+1],this._samples[r+2],this._samples[r+3]]}}set(m,f,o,r){let n;switch(d.assert(m.length===this._components,`number of components expected to be ${this._components}, given ${m.length}`),n=o===void 0&&r===void 0?this._components*Math.min(this.elements,Math.max(0,f)):this._components*this.index(f,o,r||0),d.assert(n<this.length,`index expected to be in range [0, ${this.length-1}], given ${n}`),this._components){case 4:this._samples[n+3]=m[3];case 3:this._samples[n+2]=m[2];case 2:this._samples[n+1]=m[1];case 1:this._samples[n+0]=m[0]}}fromJSON(m){d.assert(m.size&&m.size.width!==void 0&&m.size.height!==void 0&&m.size.depth!==void 0,`expected kernel width, height, and depth to be set, given '${m.size}'`);const f=r=>r.reduce((n,i)=>n.concat(Array.isArray(i)?f(i):i),[]);this._width=Math.max(1,m.size.width),this._height=Math.max(1,m.size.height),this._depth=Math.max(1,m.size.depth);const o=f(m.kernel);this._components=Math.floor(o.length/this.elements),this.resize(),this.fromArray(o)}index(m,f=0,o=0){return this._width*(this._height*Math.min(this._depth,Math.max(0,o))+Math.min(this._height,Math.max(0,f)))+Math.min(this._width,Math.max(0,m))}position(m){let f=Math.min(this.elements,Math.max(0,m));const o=Math.floor(f/(this._width*this._height));f-=o*this._width*this._height;const r=Math.floor(f/this._width);return f-=r*this._width,[f,r,o]}sort(m){if(this.elements<2)return;const f=Array(this.elements);for(let r=0;r<this.elements;++r){let n=0;switch(m){case u.SortApproach.BySquaredLength:default:for(let i=0;i<this._components;++i){const c=this._samples[r*this._components+i];n+=c*c}}f[r]=[r,n]}switch(m){case u.SortApproach.BySquaredLength:default:f.sort((r,n)=>r[1]-n[1])}const o=this._samples.slice();for(let r=0;r<f.length;++r)for(let n=0;n<this._components;++n){const i=f[r][0]*this._components+n,c=r*this._components+n;this._samples[c]=o[i]}}get samples(){return this._samples}get length(){return this._width*this._height*this._depth*this._components}get elements(){const m=this._width*this._height*this._depth;return isNaN(m)?0:m}get components(){return this._components}get width(){return this._width}get height(){return this._height}get depth(){return this._depth}get xStride(){return this.bytesPerComponent*this._components}get yStride(){return this.bytesPerComponent*this._components*this._width}get zStride(){return this.bytesPerComponent*this._components*this._width*this._depth}get bytesLength(){return this.bytesPerComponent*this._components*this._width*this._height*this._depth}}p.AbstractKernel=u,function(b){(function(m){m[m.BySquaredLength=0]="BySquaredLength"})(b.SortApproach||(b.SortApproach={}))}(u=p.AbstractKernel||(p.AbstractKernel={})),p.KernelF32=class extends u{resize(){this._samples=new Float32Array(this.length)}fromArray(b){d.assert(b.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Float32Array(b))}get bytesPerComponent(){return 4}},p.KernelUI32=class extends u{resize(){this._samples=new Uint32Array(this.length)}fromArray(b){d.assert(b.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Uint32Array(b))}get bytesPerComponent(){return 4}},p.KernelI32=class extends u{resize(){this._samples=new Int32Array(this.length)}fromArray(b){d.assert(b.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Int32Array(b))}get bytesPerComponent(){return 4}},p.KernelUI8=class extends u{resize(){this._samples=new Uint8Array(this.length)}fromArray(b){d.assert(b.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Uint8Array(b))}get bytesPerComponent(){return 4}},p.KernelI8=class extends u{resize(){this._samples=new Int8Array(this.length)}fromArray(b){d.assert(b.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Int8Array(b))}get bytesPerComponent(){return 4}}},4841:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.MouseEventProvider=void 0;const d=v(7318),u=v(9696),b=v(6157),m=v(9258);class f{constructor(r,n){this._pointerLockRequestPending=!1,u.assert(r!==void 0,`expected valid canvas element on initialization, given ${r}`),this._element=r,this._timeframe=n,this._element.addEventListener("click",()=>this.processPointerLockRequests()),(b.IS_EDGE||b.IS_IE11)&&this._element.addEventListener("dragstart",i=>i.preventDefault())}processPointerLockRequests(){this._pointerLockRequestPending&&m.PointerLock.request(this._element)}preventDefaultOnEvent(r,n){u.bitInBitfield(this._preventDefaultMask,r)&&n.preventDefault()}preventDefault(...r){for(const n of r)u.bitInBitfield(this._preventDefaultMask,n)||(this._preventDefaultMask|=n)}allowDefault(...r){for(const n of r)u.bitInBitfield(this._preventDefaultMask,n)&&(this._preventDefaultMask&=~n)}observable(r){switch(r){case f.Type.Click:return this.click$;case f.Type.Enter:return this.enter$;case f.Type.Leave:return this.leave$;case f.Type.Down:return this.down$;case f.Type.Up:return this.up$;case f.Type.Move:return this.move$;case f.Type.Wheel:return this.wheel$;case f.Type.Drag:return this.drag$;default:return}}set pointerLock(r){this._pointerLockRequestPending=r,r===!1&&(this._pointerLockRequestPending=!1,m.PointerLock.exit())}get pointerLock(){return m.PointerLock.active(this._element)}get click$(){return this._clickSubject===void 0&&(this._clickSubject=new d.ReplaySubject(void 0,this._timeframe),this._clickListener=r=>{this.preventDefaultOnEvent(f.Type.Click,r),this._clickSubject.next(r)},this._element.addEventListener("click",this._clickListener)),this._clickSubject.asObservable()}get enter$(){return this._enterSubject===void 0&&(this._enterSubject=new d.ReplaySubject(void 0,this._timeframe),this._enterListener=r=>{this.preventDefaultOnEvent(f.Type.Enter,r),this._enterSubject.next(r)},this._element.addEventListener("mouseenter",this._enterListener)),this._enterSubject.asObservable()}get leave$(){return this._leaveSubject===void 0&&(this._leaveSubject=new d.ReplaySubject(void 0,this._timeframe),this._leaveListener=r=>{this.preventDefaultOnEvent(f.Type.Leave,r),this._leaveSubject.next(r)},this._element.addEventListener("mouseleave",this._leaveListener)),this._leaveSubject.asObservable()}get down$(){return this._downSubject===void 0&&(this._downSubject=new d.ReplaySubject(void 0,this._timeframe),this._downListener=r=>{this.preventDefaultOnEvent(f.Type.Down,r),this._downSubject.next(r)},this._element.addEventListener("mousedown",this._downListener)),this._downSubject.asObservable()}get up$(){return this._upSubject===void 0&&(this._upSubject=new d.ReplaySubject(void 0,this._timeframe),this._upListener=r=>{this.preventDefaultOnEvent(f.Type.Up,r),this._upSubject.next(r)},this._element.addEventListener("mouseup",this._upListener)),this._upSubject.asObservable()}get move$(){return this._moveSubject===void 0&&(this._moveSubject=new d.ReplaySubject(void 0,this._timeframe),this._moveListener=r=>{this.preventDefaultOnEvent(f.Type.Move,r),this._moveSubject.next(r)},this._element.addEventListener("mousemove",this._moveListener)),this._moveSubject.asObservable()}get wheel$(){return this._wheelSubject===void 0&&(this._wheelSubject=new d.ReplaySubject(void 0,this._timeframe),this._wheelListener=r=>{this.preventDefaultOnEvent(f.Type.Wheel,r),this._wheelSubject.next(r)},this._element.addEventListener("wheel",this._wheelListener)),this._wheelSubject.asObservable()}get drag$(){return this._dragSubject===void 0&&(this._dragSubject=new d.ReplaySubject(void 0,this._timeframe),this._dragListener=r=>{this.preventDefaultOnEvent(f.Type.Drag,r),this._dragSubject.next(r)},this._element.addEventListener("drag",this._dragListener)),this._dragSubject.asObservable()}}p.MouseEventProvider=f,function(o){(function(r){r[r.Click=1]="Click",r[r.Wheel=2]="Wheel",r[r.Enter=4]="Enter",r[r.Leave=8]="Leave",r[r.Move=16]="Move",r[r.Down=32]="Down",r[r.Up=64]="Up",r[r.Drag=128]="Drag"})(o.Type||(o.Type={}))}(f=p.MouseEventProvider||(p.MouseEventProvider={}))},6157:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.IS_EDGE=p.IS_IE11=void 0,p.IS_IE11=typeof navigator=="undefined"?void 0:/MSIE 11|Windows/i.test(navigator.userAgent),p.IS_EDGE=typeof navigator=="undefined"?void 0:/Edge\/\d./i.test(navigator.userAgent)},8652:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Navigation=void 0;const d=v(3659),u=v(7595),b=v(9258),m=v(9696),f=v(9870),o=v(8287),r=v(8357),n=v(2763),i=v(2783),c=v(9817);class s{constructor(h,g){this._alwaysRotateOnMove=!1,this._invalidate=h,this._eventHandler=new u.EventHandler(h,g),this._eventHandler.pushPointerDownHandler((_,T)=>this.onPointerDown(_,T)),this._eventHandler.pushPointerUpHandler((_,T)=>this.onPointerUp(_,T)),this._eventHandler.pushPointerEnterHandler((_,T)=>this.onPointerEnter(_,T)),this._eventHandler.pushPointerLeaveHandler((_,T)=>this.onPointerLeave(_,T)),this._eventHandler.pushPointerMoveHandler((_,T)=>this.onPointerMove(_,T)),this._eventHandler.pushPointerCancelHandler((_,T)=>this.onPointerCancel(_,T)),this._eventHandler.pushMouseWheelHandler((_,T)=>this.onWheel(_,T)),this.rotationMetaphor=s.RotationMetaphor.Turntable,this._pan=new o.PanModifier,this._pinch=new r.PinchZoomModifier,this._wheelZoom=new c.WheelZoomModifier,this._activeEvents=new Map}mode(){const h=Array.from(this._activeEvents.values()),g=this.getPrimaryEvent(h);if(g===void 0)return void m.log(m.LogLevel.Warning,"No primary pointer event detected in Navigation::mode.");const _=g.pointerType==="mouse",T=g.pointerType==="touch"||g.pointerType==="pen",y=1&g.buttons,A=g.shiftKey,w=b.PointerLock.active()&&this._alwaysRotateOnMove,L=this._activeEvents.size;return w?s.Modes.Rotate:_&&y&&A&&L===1?s.Modes.Pan:T&&L===2?s.Modes.MultiTouch:_&&y&&L===1||T&&L===1?s.Modes.Rotate:void 0}resolveMultiTouch(){if(this._activeEvents.size<2)return void m.log(m.LogLevel.Warning,"MultiTouch resolution was canceled because less than two touches were detected.");const h=Array.from(this._activeEvents.values()),g=d.vec2.fromValues(h[0].movementX,h[0].movementY),_=d.vec2.fromValues(h[1].movementX,h[1].movementY);return d.vec2.length(g)===0||d.vec2.length(_)===0?s.Modes.Zoom:(d.vec2.normalize(g,g),d.vec2.normalize(_,_),d.vec2.dot(g,_)>.2?s.Modes.Pan:s.Modes.Zoom)}rotate(h){if(this._activeEvents.size!==1)return void m.log(m.LogLevel.Info,"Rotate event was canceled because less or more than two pointers were detected.");const g=Array.from(this._activeEvents.values()),_=this._eventHandler.offsets(g[0])[0];switch(this._rotationMetaphor){case s.RotationMetaphor.FirstPerson:const T=this._firstPerson;let y;b.PointerLock.active()&&event instanceof MouseEvent&&(y=d.vec2.fromValues(event.movementX,event.movementY)),h?T.initiate(_):T.process(_,y);break;case s.RotationMetaphor.Trackball:const A=this._trackball;h?A.initiate(_):A.process(_);break;case s.RotationMetaphor.Turntable:const w=this._turntable;h?w.initiate(_):w.process(_)}}pan(h){const g=Array.from(this._activeEvents.values()),_=this.getPrimaryEvent(g);if(_===void 0)return void m.log(m.LogLevel.Warning,"Pan event was canceled because no primary event was detected.");const T=this._eventHandler.offsets(_)[0],y=this._pan;h?y.initiate(T):y.process(T)}pinch(h){if(this._activeEvents.size!==2)return void m.log(m.LogLevel.Info,"Pinch event was canceled because less or more than two pointers were detected.");const g=Array.from(this._activeEvents.values()),_=this._eventHandler.offsets(g[0])[0],T=this._eventHandler.offsets(g[1])[0],y=this._pinch;h?y.initiate(_,T):y.process(_,T)}getPrimaryEvent(h){for(const g of h)if(g.isPrimary)return g}onPointerDown(h,g){for(const _ of h)this._activeEvents.set(_.pointerId,_);switch(this._mode=this.mode(),this._mode){case s.Modes.Rotate:this.rotate(!0);break;case s.Modes.Pan:this.pan(!0);break;case s.Modes.Zoom:this.pinch(!0)}}onPointerUp(h,g){for(const _ of h)this._activeEvents.delete(_.pointerId)}onPointerEnter(h,g){}onPointerLeave(h,g){for(const _ of h)this._activeEvents.delete(_.pointerId)}onPointerCancel(h,g){for(const _ of h)this._activeEvents.delete(_.pointerId)}onPointerMove(h,g){for(const A of h)this._activeEvents.set(A.pointerId,A);if(this._mode===void 0)return;const _=Array.from(this._activeEvents.values()),T=this.getPrimaryEvent(_);T&&T.pointerType==="mouse"&&(this._mode=this.mode());let y=!1;switch(this._mode===s.Modes.MultiTouch&&(this._mode=this.resolveMultiTouch(),y=!0),this._mode){case s.Modes.Rotate:this.rotate(y);break;case s.Modes.Pan:this.pan(y);break;case s.Modes.Zoom:this.pinch(y)}this._lastInteractionTime=performance.now()}onWheel(h,g){const _=h[0];this._wheelZoom.process(_.deltaY)}update(){this._eventHandler.update()}set camera(h){this._camera=h,this._firstPerson&&(this._firstPerson.camera=h),this._trackball&&(this._trackball.camera=h),this._turntable&&(this._turntable.camera=h),this._pan&&(this._pan.camera=h),this._pinch&&(this._pinch.camera=h),this._wheelZoom&&(this._wheelZoom.camera=h)}set rotationMetaphor(h){if(this._rotationMetaphor!==h){switch(this._firstPerson=void 0,this._trackball=void 0,this._turntable=void 0,this._eventHandler.exitPointerLock(),this._alwaysRotateOnMove=!1,this._rotationMetaphor=h,this._rotationMetaphor){case s.RotationMetaphor.FirstPerson:this._eventHandler.requestPointerLock(),this._alwaysRotateOnMove=!0,this._firstPerson=new f.FirstPersonModifier,this._firstPerson.camera=this._camera;break;case s.RotationMetaphor.Trackball:this._trackball=new n.TrackballModifier,this._trackball.camera=this._camera;break;case s.RotationMetaphor.Turntable:this._turntable=new i.TurntableModifier,this._turntable.camera=this._camera}this._invalidate(!0)}}get rotationMetaphor(){return this._rotationMetaphor}}p.Navigation=s,function(a){(function(h){h[h.Move=0]="Move",h[h.Pan=1]="Pan",h[h.MultiTouch=2]="MultiTouch",h[h.Rotate=3]="Rotate",h[h.Zoom=4]="Zoom",h[h.ZoomStep=5]="ZoomStep"})(a.Modes||(a.Modes={})),function(h){h.FirstPerson="firstperson",h.Flight="flight",h.Trackball="trackball",h.Turntable="turntable"}(a.RotationMetaphor||(a.RotationMetaphor={}))}(s=p.Navigation||(p.Navigation={}))},7429:function(F,p,v){var d=this&&this.__decorate||function(o,r,n,i){var c,s=arguments.length,a=s<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,r,n,i);else for(var h=o.length-1;h>=0;h--)(c=o[h])&&(a=(s<3?c(a):s>3?c(r,n,a):c(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(p,"__esModule",{value:!0}),p.NdcFillingRectangle=void 0;const u=v(6404),b=v(4894),m=v(1030);class f extends b.Geometry{constructor(r,n){super(r,n),n=n!==void 0&&n!==""?n:this.constructor.name;const i=new u.Buffer(r,`${n}VBO`);this._buffers.push(i)}bindBuffers(){this._buffers[0].attribEnable(this._vertexLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1)}unbindBuffers(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0)}initialize(r=0){this._vertexLocation=r;const n=this.context.gl,i=super.initialize([n.ARRAY_BUFFER]);return this._buffers[0].data(f.VERTICES,n.STATIC_DRAW),i}draw(){const r=this.context.gl;r.drawArrays(r.TRIANGLE_STRIP,0,4)}get vertexLocation(){return this._vertexLocation}}f.VERTICES=new Float32Array([-1,-1,1,-1,-1,1,1,1]),d([m.Initializable.assert_initialized()],f.prototype,"draw",null),p.NdcFillingRectangle=f},7570:function(F,p,v){var d=this&&this.__decorate||function(o,r,n,i){var c,s=arguments.length,a=s<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,r,n,i);else for(var h=o.length-1;h>=0;h--)(c=o[h])&&(a=(s<3?c(a):s>3?c(r,n,a):c(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(p,"__esModule",{value:!0}),p.NdcFillingTriangle=void 0;const u=v(6404),b=v(4894),m=v(1030);class f extends b.Geometry{constructor(r,n){super(r,n),n=n!==void 0&&n!==""?n:this.constructor.name;const i=new u.Buffer(r,`${n}VBO`);this._buffers.push(i)}bindBuffers(){this._buffers[0].attribEnable(this._vertexLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1)}unbindBuffers(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0)}initialize(r=0){this._vertexLocation=r;const n=this.context.gl,i=super.initialize([n.ARRAY_BUFFER]);return this._buffers[0].data(f.VERTICES,n.STATIC_DRAW),i}draw(){const r=this.context.gl;r.drawArrays(r.TRIANGLES,0,3)}get vertexLocation(){return this._vertexLocation}}f.VERTICES=new Float32Array([-1,-3,3,1,-1,1]),d([m.Initializable.assert_initialized()],f.prototype,"draw",null),p.NdcFillingTriangle=f},2281:function(F,p,v){var d=this&&this.__decorate||function(f,o,r,n){var i,c=arguments.length,s=c<3?o:n===null?n=Object.getOwnPropertyDescriptor(o,r):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(f,o,r,n);else for(var a=f.length-1;a>=0;a--)(i=f[a])&&(s=(c<3?i(s):c>3?i(o,r,s):i(o,r))||s);return c>3&&s&&Object.defineProperty(o,r,s),s};Object.defineProperty(p,"__esModule",{value:!0}),p.AbstractObject=void 0;const u=v(9696),b=v(1030);class m extends b.Initializable{constructor(o,r){super(),this._valid=!1,this._referenceCount=0,this._context=o,this._identifier=r!==void 0&&r!==""?r:"Object"}initialize(...o){return this._identifier=this._context.allocationRegister.createUniqueIdentifier(this._identifier),this.create(...o),this._valid||(this._context.allocationRegister.deleteUniqueIdentifier(this._identifier),u.log(u.LogLevel.Error,`initialization of '${this._identifier}' failed`)),this._valid}uninitialize(){this._context.allocationRegister.reallocate(this._identifier,0),this._context.allocationRegister.deleteUniqueIdentifier(this._identifier),this.delete(),u.assert(this._object===void 0,`expected object '${this._identifier}' to be undefined after delete`),u.assert(this._valid===!1,`expected object '${this._identifier}' to be invalid after delete`)}get context(){return this._context}get identifier(){return this._identifier}get object(){return u.assert(this._object!==void 0,"access to undefined object"),this._object}get valid(){return this._valid}ref(){u.assert(this.initialized,"expected object to be initialized in order to be referenced"),++this._referenceCount}unref(){u.assert(this._referenceCount>0,"expected object to be referenced in order to decrease its reference count"),--this._referenceCount}}d([b.Initializable.initialize()],m.prototype,"initialize",null),d([b.Initializable.uninitialize()],m.prototype,"uninitialize",null),p.AbstractObject=m},8287:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.PanModifier=void 0;const d=v(3659),u=v(2111),b=v(6491);class m extends b.CameraModifier{constructor(){super(...arguments),this._sensitivity=m.DEFAULT_SENSITIVITY,this._translation=u.v3()}initiate(o){Object.assign(this._reference,this._camera),this._initialPoint=o}process(o){this._currentPoint=o;const r=d.vec2.subtract(u.v2(),this._initialPoint,this._currentPoint);d.vec2.scale(r,r,window.devicePixelRatio*this._sensitivity);const n=d.vec3.sub(u.v3(),this._reference.eye,this._reference.center);d.vec3.normalize(n,n);const i=this._reference.up;d.vec3.normalize(i,i);const c=d.vec3.cross(u.v3(),i,n),s=d.vec3.scale(u.v3(),c,r[0]),a=d.vec3.scale(u.v3(),i,r[1]);d.vec3.negate(a,a),this._translation=d.vec3.add(u.v3(),a,s),this.update()}update(){if(this._camera===void 0)return;const o=d.mat4.fromTranslation(u.m4(),this._translation),r=d.vec3.transformMat4(u.v3(),this._reference.eye,o),n=d.vec3.transformMat4(u.v3(),this._reference.center,o);this._camera.eye=r,this._camera.center=n}}p.PanModifier=m,m.DEFAULT_SENSITIVITY=.002},8357:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.PinchZoomModifier=void 0;const d=v(3659),u=v(2111),b=v(6491);class m extends b.CameraModifier{constructor(){super(...arguments),this._sensitivity=m.DEFAULT_SENSITIVITY,this._translation=u.v3()}initiate(o,r){Object.assign(this._reference,this._camera);const n=d.vec2.subtract(u.v2(),o,r);this._initialDistance=d.vec2.length(n)}process(o,r){const n=d.vec2.subtract(u.v2(),o,r);this._currentDistance=d.vec2.length(n);const i=(this._currentDistance/this._initialDistance-1)*m.DEFAULT_SENSITIVITY,c=d.vec3.sub(u.v3(),this._reference.center,this._reference.eye);d.vec3.normalize(c,c),this._translation=d.vec3.scale(u.v3(),c,i),this.update()}update(){if(this._camera===void 0)return;const o=d.mat4.fromTranslation(u.m4(),this._translation),r=d.vec3.transformMat4(u.v3(),this._reference.eye,o);this._camera.eye=r}}p.PinchZoomModifier=m,m.DEFAULT_SENSITIVITY=2},8319:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.PointerEventProvider=void 0;const d=v(7318),u=v(9696),b=v(6157),m=v(9258);class f{constructor(r,n){this._pointerLockRequestPending=!1,u.assert(r!==void 0,`expected valid canvas element on initialization, given ${r}`),this._element=r,this._timeframe=n,this._element.addEventListener("click",()=>this.processPointerLockRequests()),(b.IS_EDGE||b.IS_IE11)&&this._element.addEventListener("dragstart",i=>i.preventDefault())}processPointerLockRequests(){this._pointerLockRequestPending&&m.PointerLock.request(this._element)}preventDefaultOnEvent(r,n){u.bitInBitfield(this._preventDefaultMask,r)&&n.preventDefault()}preventDefault(...r){for(const n of r)u.bitInBitfield(this._preventDefaultMask,n)||(this._preventDefaultMask|=n)}allowDefault(...r){for(const n of r)u.bitInBitfield(this._preventDefaultMask,n)&&(this._preventDefaultMask&=~n)}observable(r){switch(r){case f.Type.Enter:return this.enter$;case f.Type.Leave:return this.leave$;case f.Type.Down:return this.down$;case f.Type.Up:return this.up$;case f.Type.Move:return this.move$;case f.Type.Cancel:return this.cancel$;default:return}}set pointerLock(r){this._pointerLockRequestPending=r,r===!1&&(this._pointerLockRequestPending=!1,m.PointerLock.exit())}get pointerLock(){return m.PointerLock.active(this._element)}get enter$(){return this._enterSubject===void 0&&(this._enterSubject=new d.ReplaySubject(void 0,this._timeframe),this._enterListener=r=>{this.preventDefaultOnEvent(f.Type.Enter,r),this._enterSubject.next(r)},this._element.addEventListener("pointerenter",this._enterListener)),this._enterSubject.asObservable()}get leave$(){return this._leaveSubject===void 0&&(this._leaveSubject=new d.ReplaySubject(void 0,this._timeframe),this._leaveListener=r=>{this.preventDefaultOnEvent(f.Type.Leave,r),this._leaveSubject.next(r)},this._element.addEventListener("pointerleave",this._leaveListener)),this._leaveSubject.asObservable()}get down$(){return this._downSubject===void 0&&(this._downSubject=new d.ReplaySubject(void 0,this._timeframe),this._downListener=r=>{this.preventDefaultOnEvent(f.Type.Down,r),this._downSubject.next(r)},this._element.addEventListener("pointerdown",this._downListener)),this._downSubject.asObservable()}get up$(){return this._upSubject===void 0&&(this._upSubject=new d.ReplaySubject(void 0,this._timeframe),this._upListener=r=>{this.preventDefaultOnEvent(f.Type.Up,r),this._upSubject.next(r)},this._element.addEventListener("pointerup",this._upListener)),this._upSubject.asObservable()}get move$(){return this._moveSubject===void 0&&(this._moveSubject=new d.ReplaySubject(void 0,this._timeframe),this._moveListener=r=>{this.preventDefaultOnEvent(f.Type.Move,r),this._moveSubject.next(r)},this._element.addEventListener("pointermove",this._moveListener)),this._moveSubject.asObservable()}get cancel$(){return this._cancelSubject===void 0&&(this._cancelSubject=new d.ReplaySubject(void 0,this._timeframe),this._cancelListener=r=>{this.preventDefaultOnEvent(f.Type.Cancel,r),this._cancelSubject.next(r)},this._element.addEventListener("pointercancel",this._cancelListener)),this._cancelSubject.asObservable()}}p.PointerEventProvider=f,function(o){(function(r){r[r.Enter=1]="Enter",r[r.Leave=2]="Leave",r[r.Move=4]="Move",r[r.Down=8]="Down",r[r.Up=16]="Up",r[r.Cancel=32]="Cancel"})(o.Type||(o.Type={}))}(f=p.PointerEventProvider||(p.PointerEventProvider={}))},9258:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.PointerLock=void 0;const d=v(9696);class u{static queryAndCacheAPI(){if(u._exit!==void 0)return;const m=window.document,f=[m.exitPointerLock,m.mozExitPointerLock,m.webkitExitPointerLock,void 0];let o=0;for(;o<f.length&&f[o]===void 0;++o);switch(o){case 0:u._exit=()=>m.exitPointerLock(),u._request=r=>r.requestPointerLock(),u._element=()=>m.pointerLockElement;break;case 1:u._exit=()=>m.mozCancelPointerLock(),u._request=r=>r.mozRequestPointerLock(),u._element=()=>m.mozPointerLockElement;break;case 2:u._exit=()=>m.webkitExitPointerLock(),u._request=r=>r.webkitRequestPointerLock(),u._element=()=>m.webkitPointerLockElement;break;default:d.assert(!1,"none of the following pointer lock apis was found: native, moz, or webkit")}}static active(m){return this._element!==void 0&&(m!==void 0&&u._element()===m||m===void 0&&u._element()!==void 0&&u._element()!==null)}static request(m,f){m!==void 0&&(u.queryAndCacheAPI(),u.active()&&u._element()!==m&&u._exit(),u.active()||u._request(m))}static exit(){u._exit&&u._exit()}}p.PointerLock=u},5254:function(){String.prototype.repeat===void 0&&(String.prototype.repeat=function(F){if(this===null)throw new TypeError("can't convert "+this+" to object");const p=""+this;if((F=+F)!=F&&(F=0),F<0)throw new RangeError("repeat count must be non-negative");if(F===1/0)throw new RangeError("repeat count must be less than infinity");if(F=Math.floor(F),p.length===0||F===0)return"";if(p.length*F>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let v="";for(let d=0;d<F;d++)v+=p;return v}),String.prototype.startsWith===void 0&&(String.prototype.startsWith=function(F,p){return p=p||0,this.indexOf(F,p)===p}),String.prototype.endsWith===void 0&&(String.prototype.endsWith=function(F,p){return(p===void 0||p>this.length)&&(p=this.length),this.substring(p-F.length,p)===F}),String.prototype.includes===void 0&&(String.prototype.includes=function(F,p){return typeof p!="number"&&(p=0),!(p+F.length>this.length)&&this.indexOf(F,p)!==-1}),String.prototype.trimLeft===void 0&&(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),String.prototype.trimRight===void 0&&(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),Array.prototype.forEach===void 0&&(Array.prototype.forEach=(F,p)=>{const v=this.length;for(let d=0;d<v;d++)d in this&&F.call(p,this[d],d,this)}),Array.prototype.fill===void 0&&(Array.prototype.fill=(F,p,v)=>{if(this===null)throw new TypeError("this is null or not defined");const d=Object(this),u=d.length>>>0,b=p>>0;let m=b<0?Math.max(u+b,0):Math.min(b,u);const f=v===void 0?u:v>>0,o=f<0?Math.max(u+f,0):Math.min(f,u);for(;m<o;)d[m]=F,++m;return d}),Math.log10===void 0&&(Math.log10=F=>Math.log(F)*Math.LOG10E),Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),[Float32Array,Uint8Array,Int8Array,Uint32Array,Int32Array].forEach(F=>{F.prototype.slice||Object.defineProperty(F.prototype,"slice",{value:Array.prototype.slice}),F.prototype.reduce||Object.defineProperty(F.prototype,"reduce",{value:Array.prototype.reduce}),F.prototype.filter||Object.defineProperty(F.prototype,"filter",{value:Array.prototype.filter}),F.prototype.map||Object.defineProperty(F.prototype,"map",{value:Array.prototype.map}),F.prototype.indexOf||Object.defineProperty(F.prototype,"indexOf",{value:Array.prototype.indexOf})}),Object.assign===void 0&&Object.defineProperty(Object,"assign",{value(F,p){if(F===void 0&&F===null)throw new TypeError("Cannot convert undefined or null to object");const v=Object(F);for(let d=1;d<arguments.length;d++){const u=arguments[d];if(u!=null)for(const b in u)Object.prototype.hasOwnProperty.call(u,b)&&(v[b]=u[b])}return v},configurable:!0,writable:!0})},4895:function(F,p,v){var d=this&&this.__decorate||function(o,r,n,i){var c,s=arguments.length,a=s<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,r,n,i);else for(var h=o.length-1;h>=0;h--)(c=o[h])&&(a=(s<3?c(a):s>3?c(r,n,a):c(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(p,"__esModule",{value:!0}),p.Program=void 0;const u=v(9696),b=v(1030),m=v(2281);class f extends m.AbstractObject{constructor(){super(...arguments),this._shaders=new Array,this._linked=!1}create(r=new Array,n=!0){const i=this._context.gl;let c=0,s=0;for(const a of r)switch(a.type){case i.VERTEX_SHADER:++c;break;case i.FRAGMENT_SHADER:++s;break;default:u.assert(!1,"Unknown shader type detected.")}if(u.logIf(c<1,u.LogLevel.Error,"at least one vertex shader is expected"),u.logIf(s<1,u.LogLevel.Error,"at least one fragment shader is expected"),!(c<1||s<1))return this._object=i.createProgram(),this._valid=i.isProgram(this._object),u.assert(this._object instanceof WebGLProgram,"expected WebGLProgram object to be created"),r.length>0&&this.attach(r,n),this._object}delete(){u.assert(this._object!==void 0,"expected WebGLProgram object"),this._context.gl.deleteProgram(this._object),this._object=void 0,this._valid=!1}attach(r,n=!1){u.assert(this._object!==void 0,"expected a WebGLProgram object");const i=this._context.gl;for(const c of r instanceof Array?r:[r])this._shaders.indexOf(c)>-1||(this._shaders.push(c),c.initialized?(i.attachShader(this._object,c.object),c.ref()):u.log(u.LogLevel.Error,`shader '${c.identifier}' not initialized.`));return n&&this.link(),!0}detach(r){u.assert(this._object!==void 0,"expected WebGLProgram object");const n=this._context.gl;for(const i of r instanceof Array?r:[r]){const c=this._shaders.indexOf(i);c>-1&&this._shaders.splice(c),u.assert(i.initialized,`expected shader '${i.identifier}' to be initialized`),n.detachShader(this._object,i.object),i.unref()}}link(){u.assert(this._object!==void 0,"expected WebGLProgram object");const r=this._context.gl;if(r.linkProgram(this._object),r.getProgramParameter(this._object,r.LINK_STATUS))this._linked=!0;else{const n=r.getProgramInfoLog(this._object);u.log(u.LogLevel.Error,`linking of program '${this._identifier}' failed: '${n}'`),this._linked=!1}return this._linked}bind(){this._context.gl.useProgram(this._object)}unbind(){this._context.gl.useProgram(f.DEFAULT_PROGRAM)}uniform(r){return this._context.gl.getUniformLocation(this._object,r)}attribute(r,n){return n!==void 0?(u.logIf(this._linked,u.LogLevel.Debug,`name-to-generic attribute index mapping does go into effect on next linking, given ${r} -> ${n} (${this.identifier})`),this._context.gl.bindAttribLocation(this._object,n,r),n):this._context.gl.getAttribLocation(this._object,r)}get shaders(){return this._shaders}get linked(){return this._linked}}f.DEFAULT_PROGRAM=void 0,d([b.Initializable.assert_initialized()],f.prototype,"bind",null),d([b.Initializable.assert_initialized()],f.prototype,"unbind",null),d([b.Initializable.assert_initialized()],f.prototype,"uniform",null),d([b.Initializable.assert_initialized()],f.prototype,"attribute",null),p.Program=f},3607:(F,p,v)=>{const d=v(634),u=v(9696);function b(o,r){const n=r.properties,i=Object.getOwnPropertyNames(n);for(const c of i){const s=n[c],a=s.type==="object",h=o.hasOwnProperty(c),g=s.hasOwnProperty("properties"),_=s.hasOwnProperty("default");u.assert(g&&a||!g&&!a,`expected property '${c}' to be of type 'object', given '${s.type}'`),h&&g?f.complement(o[c],s):!h&&_&&Object.defineProperty(o,c,{value:s.default,writable:!0})}}function m(o,r){const n=r.items;if(n.type==="object")for(const i of Object.getOwnPropertyNames(o))i!=="length"&&f.complement(o[i],n)}var f;(function(o){o.validate=function(r,n,i){const c=new d.Validator;if(i!==void 0)for(const a of i)c.addSchema(a[0],a[1]);const s=c.validate(r,n);return u.logIf(!s.valid,u.LogLevel.Warning,`schema expected to be valid:
${s.toString()}`),s.valid},o.complement=function(r,n){if(r!==void 0)switch(u.assert(n.hasOwnProperty("properties")&&n.type==="object"||n.hasOwnProperty("items")&&n.type==="array",`expected schema to have 'properties' or 'items', given ${n}`),n.type){case"object":b(r,n);break;case"array":m(r,n)}},o.compare=function r(n,i,c,s=""){const a=c!==void 0;if(u.assert(!a||c.hasOwnProperty("any"),"expected allocation lookup object to have 'any' key"),n===void 0&&i!==void 0||n!==void 0&&i===void 0)return a&&c.alter(s),!0;let h=!0,g=[typeof n,typeof i];const _=[n instanceof Array,i instanceof Array];if(!(_[0]&&_[1]||g[0]==="object"&&g[1]==="object"))return h=n===i,!h&&a&&c.alter(`${s}`),!h;const T=Array.from(new Set(Array().concat(Object.getOwnPropertyNames(n),Object.getOwnPropertyNames(i))).values());for(const y of T){if(y==="length")continue;const A=[n[y],i[y]];g=[typeof A[0],typeof A[1]];const w=`${s}${s.length>0&&!_[0]?".":""}${_[0]?"":y}`;if(A[0]instanceof Array&&A[1]instanceof Array||g[0]==="object"&&g[1]==="object")h=h&&!r(A[0],A[1],c,w);else{if(g[0]===g[1]&&A[0]===A[1])continue;h=!1,a&&c.alter(w)}}return!h}})(f||(f={})),F.exports=f},5785:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.RandomSquareKernel=void 0;const d=v(9696),u=v(4563);class b extends u.KernelF32{constructor(f){super(2,f),this.generate()}generate(){d.assert(this.width>0,"expected every kernel to comprise at least one element"),this.set([0,0],0);for(let f=1;f<this.width;++f)this.set([d.rand(-.5,.5),d.rand(-.5,.5)],f)}get width(){return this._width}set width(f){this._width!==f&&(this._width=f,this.resize(),this.generate())}}p.RandomSquareKernel=b},3942:(F,p,v)=>{const d=v(3659),u=v(2111),b=v(9696);var m;(function(f){function o(c,s,a=1){const h=d.vec2.subtract(u.v2(),s,c);if(d.vec2.equals(h,d.vec2.fromValues(0,0)))return;const g=d.vec2.squaredLength(h),_=2*d.vec2.dot(h,c),T=_*_-4*g*(d.vec2.squaredLength(c)-a*a);if(T<0)return;const y=Math.sqrt(T),A=Math.min((-_+y)/(2*g),(-_-y)/(2*g)),w=d.vec2.scale(u.v2(),h,A);return d.vec2.add(w,w,c)}function r(c,s,a,h){const g=c,_=d.vec2.sub(u.v2(),s,c),T=a,y=d.vec2.sub(u.v2(),h,a),A=d.vec2.cross(u.v3(),_,y)[2];if(A===0)return;const w=d.vec2.sub(u.v2(),T,g),L=d.vec2.cross(u.v3(),w,d.vec2.scale(u.v2(),_,1/A))[2],D=d.vec2.cross(u.v3(),w,d.vec2.scale(u.v2(),y,1/A))[2];return L<0||L>1||D<0?void 0:[d.vec2.add(u.v2(),T,d.vec2.scale(u.v2(),y,L)),D]}function n(c,s,a=d.vec3.fromValues(0,0,0),h=d.vec3.fromValues(0,1,0)){const g=d.vec3.normalize(u.v3(),d.vec3.subtract(u.v3(),s,c)),_=d.vec3.dot(g,h);if(d.vec3.equals(g,[0,0,0])||_>=0)return;const T=d.vec3.dot(d.vec3.subtract(u.v3(),a,c),h)/_;return d.vec3.add(u.v3(),d.vec3.scale(u.v3(),g,T),c)}function i(c,s,a){const h=d.vec3.subtract(u.v3(),s,c),g=d.vec3.squaredLength(h);if(g===0)return 0;const _=d.vec3.subtract(u.v3(),a,c);return d.vec3.dot(_,h)/g}f.rayCircleIntersection=o,f.pointSquareIntersection=function(c,s=1){const a=u.abs2(u.v2(),c);return a[0]>=a[1]?d.vec2.fromValues(u.sign(c[0])*s,c[1]/a[0]*s):d.vec2.fromValues(c[0]/a[1]*s,u.sign(c[1])*s)},f.raySquareIntersection=function(c,s,a=1){const h=[d.vec2.fromValues(-a,+a),d.vec2.fromValues(-a,-a),d.vec2.fromValues(+a,-a),d.vec2.fromValues(+a,+a)],g=new Array;for(let _=0;_<4;++_){const T=r(c,s,h[_],h[(_+1)%4]);T&&g.push(T[1])}return g},f.rayLineIntersection=r,f.rayPlaneIntersection=n,f.raySphereIntersection=function(c,s,a=d.vec3.fromValues(0,0,0),h=1){const g=d.vec3.subtract(u.v3(),c,a),_=d.vec3.normalize(u.v3(),d.vec3.subtract(u.v3(),s,c)),T=d.vec3.dot(_,g),y=T*T-d.vec3.squaredLength(g)+h*h;if(!(y<=0))return d.vec3.add(u.v3(),c,d.vec3.scale(u.v3(),_,-T-Math.sqrt(y)))},f.rayPlaneIntersection_tube=function(c,s,a=1){const h=n(c,s);if(h!==void 0&&d.vec3.length(h)<a)return h;const g=o(d.vec2.fromValues(c[0],c[2]),d.vec2.fromValues(s[0],s[2]),a);return g?d.vec3.fromValues(g[0],0,g[1]):void 0},f.isPointWithinSquare=function(c,s=1){const a=u.abs2(u.v2(),c);return a[0]<=s&&a[1]<=s},f.isPointWithinNDC=function(c,s){const a=d.vec3.transformMat4(u.v3(),s,c),h=u.abs3(u.v3(),a);return h[0]<=1&&h[1]<=1&&a[2]>=0&&a[2]<=1},f.distancePointToRay=i,f.eyeWithPointInView=function(c,s){const a=d.vec3.subtract(u.v3(),c.center,c.eye),h=d.vec3.normalize(u.v3(),a),g=d.vec3.normalize(u.v3(),d.vec3.cross(u.v3(),h,c.up)),_=d.vec3.normalize(u.v3(),d.vec3.cross(u.v3(),g,h)),T=i(c.eye,c.center,s),y=d.vec3.add(u.v3(),c.eye,d.vec3.scale(u.v3(),a,T)),A=d.vec3.subtract(u.v3(),s,y),w=Math.abs(d.vec3.dot(A,g))/c.aspect,L=Math.abs(d.vec3.dot(A,_)),D=Math.max(w,L)/Math.tan(c.fovy*b.DEG2RAD*.5);return d.vec3.subtract(u.v3(),y,d.vec3.scale(u.v3(),h,D))}})(m||(m={})),F.exports=m},9314:function(F,p,v){var d=this&&this.__decorate||function(a,h,g,_){var T,y=arguments.length,A=y<3?h:_===null?_=Object.getOwnPropertyDescriptor(h,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(a,h,g,_);else for(var w=a.length-1;w>=0;w--)(T=a[w])&&(A=(y<3?T(A):y>3?T(h,g,A):T(h,g))||A);return y>3&&A&&Object.defineProperty(h,g,A),A};Object.defineProperty(p,"__esModule",{value:!0}),p.ReadbackPass=void 0;const u=v(3659),b=v(9696),m=v(2111),f=v(9564),o=v(1030),r=v(7570),n=v(4895),i=v(5263),c=v(6942);class s extends o.Initializable{constructor(h){super(),this._cache=!1,this._depthAttachment=0,this._cachedDepths=new Map,this._cachedIDs=new Map,this._buffer=new Uint8Array(4),this._ndcTriangleShared=!1,this._context=h}static maxClearDepth(){return m.decode_float24x1_from_uint8x3(u.vec3.fromValues(255,255,255))}onFrame(){this._cachedDepths.clear(),this._cachedIDs.clear()}hash(h,g){return 65535*g+h}directReadDepthAt(h,g){b.assert(this._depthFBO!==void 0&&this._depthFBO.valid,"valid depth FBO expected for reading back depth");const _=this._depthFBO.texture(this._depthAttachment),T=this._context.gl,y=_.size;this._depthFBO.bind();const A=this._referenceSize===void 0?[1,1]:[y[0]/this._referenceSize[0],y[1]/this._referenceSize[1]];return(this._context.isWebGL2||this._context.supportsDrawBuffers)&&T.readBuffer(this._depthAttachment),T.readPixels(h*A[0],y[1]-g*A[1],1,1,T.RGBA,T.UNSIGNED_BYTE,this._buffer),this._buffer}renderThenReadDepthAt(h,g){b.assert(this._depthFBO!==void 0&&this._depthFBO.valid,"valid depth FBO expected for reading back depth");const _=this._depthFBO.texture(this._depthAttachment),T=this._context.gl,y=_.size,A=this._referenceSize===void 0?[1,1]:[y[0]/this._referenceSize[0],y[1]/this._referenceSize[1]];return T.viewport(0,0,1,1),this._program.bind(),T.uniform2f(this._uOffset,h*A[0]/y[0],(y[1]-g*A[1])/y[1]),T.uniform2f(this._uScale,1/y[0],1/y[1]),_.bind(T.TEXTURE0),this._framebuffer.bind(),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),_.unbind(),(this._context.isWebGL2||this._context.supportsDrawBuffers)&&T.readBuffer&&T.readBuffer(T.COLOR_ATTACHMENT0),T.readPixels(0,0,1,1,T.RGBA,T.UNSIGNED_BYTE,this._buffer),this._framebuffer.unbind(),this._buffer}initialize(h,g){const _=this._context.gl,T=this._context.gl2facade;if(g)return this.readDepthAt=this.directReadDepthAt,!0;this.readDepthAt=this.renderThenReadDepthAt;const y=new i.Shader(this._context,_.VERTEX_SHADER,"ndcvertices.vert (readback)");y.initialize(v(3643));const A=new i.Shader(this._context,_.FRAGMENT_SHADER,"readbackdepth.frag");return A.initialize(v(5081)),this._program=new n.Program(this._context,"ReadbackDepthProgram"),this._program.initialize([y,A],!1),h===void 0?this._ndcTriangle=new r.NdcFillingTriangle(this._context):(this._ndcTriangle=h,this._ndcTriangleShared=!0),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uOffset=this._program.uniform("u_offset"),this._program.bind(),_.uniform1i(this._program.uniform("u_texture"),0),this._program.unbind(),this._texture=new c.Texture2D(this._context,"ReadbackRenderTexture"),this._texture.initialize(1,1,_.RGBA,_.RGBA,_.UNSIGNED_BYTE),this._framebuffer=new f.Framebuffer(this._context,"ReadbackFBO"),this._framebuffer.initialize([[T.COLOR_ATTACHMENT0,this._texture]]),!0}uninitialize(){this._context.isWebGL1&&!this._context.supportsDepthTexture||(!this._ndcTriangleShared&&this._ndcTriangle.initialized&&this._ndcTriangle.uninitialize(),this._program.uninitialize(),this._texture.uninitialize(),this._framebuffer.uninitialize())}depthAt(h,g){const _=this.hash(h,g);if(this._cache&&this._cachedDepths.has(_))return this._cachedDepths.get(_);const T=this.readDepthAt(h,g),y=T[0]===255&&T[1]===255&&T[2]===255?void 0:m.decode_float24x1_from_uint8x3(u.vec3.fromValues(T[0],T[1],T[2]));return this._cache&&this._cachedDepths.set(_,y),y}coordsAt(h,g,_,T){const y=this._depthFBO.texture(this._depthAttachment).size,A=_===void 0?this.depthAt(h,g):_;if(A===void 0)return;const w=this._referenceSize===void 0?[1,1]:[y[0]/this._referenceSize[0],y[1]/this._referenceSize[1]],L=u.vec3.fromValues(h*w[0]*2/y[0]-1,1-g*w[1]*2/y[1],2*A-1);return u.vec3.transformMat4(u.vec3.create(),L,T)}idAt(h,g){const _=this.hash(h,g);if(this._cache&&this._cachedIDs.has(_))return this._cachedIDs.get(_);const T=this._context.gl,y=this._idFBO.texture(this._idAttachment).size,A=this._referenceSize===void 0?[1,1]:[y[0]/this._referenceSize[0],y[1]/this._referenceSize[1]];this._idFBO.bind(),this._context.isWebGL2&&T.readBuffer(this._idAttachment),T.readPixels(h*A[0],y[1]-g*A[1],1,1,T.RGBA,T.UNSIGNED_BYTE,this._buffer);const w=m.decode_uint32_from_rgba8(u.vec4.fromValues(this._buffer[0],this._buffer[1],this._buffer[2],this._buffer[3]));return this._cache&&this._cachedIDs.set(_,w),w}frame(){this.onFrame()}set cache(h){this._cache=h}set depthFBO(h){this._depthFBO=h}set depthAttachment(h){this._depthAttachment=h}set idFBO(h){this._idFBO=h}set idAttachment(h){this._idAttachment=h}set coordinateReferenceSize(h){this._referenceSize=h}}d([o.Initializable.assert_initialized()],s.prototype,"directReadDepthAt",null),d([o.Initializable.assert_initialized()],s.prototype,"renderThenReadDepthAt",null),d([o.Initializable.initialize()],s.prototype,"initialize",null),d([o.Initializable.uninitialize()],s.prototype,"uninitialize",null),d([o.Initializable.assert_initialized()],s.prototype,"depthAt",null),d([o.Initializable.assert_initialized()],s.prototype,"coordsAt",null),d([o.Initializable.assert_initialized()],s.prototype,"idAt",null),p.ReadbackPass=s},7540:function(F,p,v){var d=this&&this.__decorate||function(r,n,i,c){var s,a=arguments.length,h=a<3?n:c===null?c=Object.getOwnPropertyDescriptor(n,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,n,i,c);else for(var g=r.length-1;g>=0;g--)(s=r[g])&&(h=(a<3?s(h):a>3?s(n,i,h):s(n,i))||h);return a>3&&h&&Object.defineProperty(n,i,h),h};Object.defineProperty(p,"__esModule",{value:!0}),p.Renderbuffer=void 0;const u=v(9696),b=v(423),m=v(1030),f=v(2281);class o extends f.AbstractObject{constructor(){super(...arguments),this._internalFormat=void 0}create(n,i,c,s=1){u.assert(n>0&&i>0,"renderbuffer object requires valid width and height greater than zero");const a=this.context.gl;this._object=a.createRenderbuffer(),this._width=n,this._height=i,this._internalFormat=c,this._samples=s,a.bindRenderbuffer(a.RENDERBUFFER,this._object),this._samples>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,this._samples,c,n,i):a.renderbufferStorage(a.RENDERBUFFER,c,n,i),this._valid=a.isRenderbuffer(this._object),a.bindRenderbuffer(a.RENDERBUFFER,o.DEFAULT_RENDER_BUFFER);const h=n*i*b.byteSizeOfFormat(this.context,c);return this.context.allocationRegister.reallocate(this._identifier,h),this._object}delete(){u.assert(this._object instanceof WebGLRenderbuffer,"expected WebGLRenderbuffer object"),this.context.gl.deleteRenderbuffer(this._object),this._object=void 0,this._valid=!1,this._internalFormat=void 0,this._width=0,this._height=0}bind(){this.context.gl.bindRenderbuffer(this.context.gl.RENDERBUFFER,this._object)}unbind(){this.context.gl.bindRenderbuffer(this.context.gl.RENDERBUFFER,o.DEFAULT_RENDER_BUFFER)}resize(n,i,c=!1,s=!1){if(n===this._width&&i===this._height)return;this._width=n,this._height=i;const a=this.context.gl;c&&this.bind(),this._samples>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,this._samples,this._internalFormat,n,i):a.renderbufferStorage(a.RENDERBUFFER,this._internalFormat,n,i),s&&this.unbind();const h=n*i*b.byteSizeOfFormat(this.context,this._internalFormat);this.context.allocationRegister.reallocate(this._identifier,h)}get bytes(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)}get internalFormat(){return this.assertInitialized(),this._internalFormat}get width(){return this.assertInitialized(),this._width}get height(){return this.assertInitialized(),this._height}get samples(){return this.assertInitialized(),this._samples}get multisampling(){return this.assertInitialized(),this._samples>1}get size(){return[this.width,this.height]}}o.DEFAULT_RENDER_BUFFER=void 0,d([m.Initializable.assert_initialized()],o.prototype,"bind",null),d([m.Initializable.assert_initialized()],o.prototype,"unbind",null),d([m.Initializable.assert_initialized()],o.prototype,"resize",null),p.Renderbuffer=o},3205:function(F,p,v){var d=this&&this.__decorate||function(a,h,g,_){var T,y=arguments.length,A=y<3?h:_===null?_=Object.getOwnPropertyDescriptor(h,g):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(a,h,g,_);else for(var w=a.length-1;w>=0;w--)(T=a[w])&&(A=(y<3?T(A):y>3?T(h,g,A):T(h,g))||A);return y>3&&A&&Object.defineProperty(h,g,A),A};Object.defineProperty(p,"__esModule",{value:!0}),p.Renderer=p.LoadingStatus=void 0;const u=v(7318),b=v(3659),m=v(9696),f=v(2111),o=v(4597),r=v(1030),n=v(4934),i=v(1284);var c;(function(a){a[a.Started=0]="Started",a[a.Finished=1]="Finished"})(c=p.LoadingStatus||(p.LoadingStatus={}));class s extends r.Initializable{constructor(){super(...arguments),this._altered=Object.assign(new o.ChangeLookup,{any:!1,multiFrameNumber:!1,frameSize:!1,canvasSize:!1,framePrecision:!1,clearColor:!1,debugTexture:!1}),this._frameSize=[0,0],this._canvasSize=[0,0],this._framePrecision=i.Wizard.Precision.half,this._clearColor=[0,0,0,1],this._debugTextures=new Array,this._debugTextureSubject=new u.ReplaySubject(1)}invalidate(h=!1){this._invalidate(h)}debugTextureNext(){this._debugTextureSubject.next(this._debugTexture)}get context(){return this.assertInitialized(),this._context}get canvasSize(){return this.assertInitialized(),this._canvasSize}get altered(){return this._altered.any}onSwap(){}startLoading(){this._isLoading=!0,this._loadingStatusSubscription.next(c.Started)}finishLoading(){this._isLoading=!1,this._loadingStatusSubscription.next(c.Finished)}initialize(h,g,_){return m.assert(h!==void 0,"valid webgl context required"),this._context=h,m.assert(g!==void 0,"valid multi-frame update callback required"),this._invalidate=g,this._isLoading=!0,this._loadingStatusSubscription=new u.ReplaySubject,this.onInitialize(h,g,_)}uninitialize(){this.onUninitialize()}discard(){this.onDiscarded()}update(h){return this._canvasSize[0]===this._context.gl.canvas.width&&this._canvasSize[1]===this._context.gl.canvas.height||(this._canvasSize[0]=this._context.gl.canvas.width,this._canvasSize[1]=this._context.gl.canvas.height,this._altered.alter("canvasSize")),this._multiFrameNumber!==h&&(this._multiFrameNumber=h,this._altered.alter("multiFrameNumber")),this.onUpdate()||this._altered.any}prepare(){this.onPrepare()}frame(h){this.onFrame(h)}swap(){this.onSwap()}frameCoords(h,g){const _=b.vec2.divide(f.v2(),this._frameSize,this.canvasSize);return b.vec2.floor(_,b.vec2.multiply(_,[h+.5,g+.5],_)),b.vec2.add(_,_,[.5,.5]),n.tuple2(_)}set frameSize(h){this.assertInitialized(),b.vec2.equals(this._frameSize,h)||(Object.assign(this._frameSize,h),this._altered.alter("frameSize"),this.invalidate())}set framePrecision(h){this.assertInitialized(),this._framePrecision!==h&&(this._framePrecision=h,this._altered.alter("framePrecision"),this.invalidate())}set clearColor(h){this.assertInitialized(),b.vec4.equals(this._clearColor,h)||(Object.assign(this._clearColor,h),this._altered.alter("clearColor"),this.invalidate())}get debugTextures(){return this.assertInitialized(),this._debugTextures}get debugTexture(){return this.assertInitialized(),this._debugTexture}set debugTexture(h){this.assertInitialized(),this._debugTexture!==h&&(m.logIf(h>=this._debugTextures.length,m.LogLevel.Error,`invalid texture index, debug texture disabled (index set to -1) | ${h} not in [-1,+${this._debugTextures.length-1}]`),this._debugTexture=h<this._debugTextures.length?f.clamp(h,-1,this._debugTextures.length-1):-1,this._altered.alter("debugTexture"),this.invalidate())}get debugTexture$(){return this._debugTextureSubject.asObservable()}get isLoading(){return this._isLoading}get loadingStatus$(){return this._loadingStatusSubscription.asObservable()}}d([r.Initializable.assert_initialized()],s.prototype,"invalidate",null),d([r.Initializable.initialize()],s.prototype,"initialize",null),d([r.Initializable.uninitialize()],s.prototype,"uninitialize",null),d([r.Initializable.discard()],s.prototype,"discard",null),d([r.Initializable.assert_initialized()],s.prototype,"update",null),d([r.Initializable.assert_initialized()],s.prototype,"prepare",null),d([r.Initializable.assert_initialized()],s.prototype,"frame",null),d([r.Initializable.assert_initialized()],s.prototype,"swap",null),p.Renderer=s},6346:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Resizable=void 0;const d=v(9696);class u{constructor(){if(this._resizeEventListener=()=>u.resize(),this._mutationEventListener=()=>{this._mutationObserver.takeRecords(),u.resize()},u.instances.length===0){const m=`on${u.EVENT_IDENTIFIER}`;u.eventSupported=document&&(m in document.documentElement||m in document.body),d.logIf(!u.eventSupported,d.LogLevel.Warning,"resize event not supported")}u.instances.length===0&&u.eventSupported&&window.addEventListener(u.EVENT_IDENTIFIER,this._resizeEventListener),u.instances.push(this)}static resize(){d.assert(u.instances.length>0,"resize event received without a single resizable registered"),u.instances.forEach(m=>m.onResize())}static elementSize(m){if(m===void 0||window===void 0||typeof window.devicePixelRatio!="number")return[0,0];const f=window.devicePixelRatio,o=getComputedStyle(m);if(o.width===null||!o.width.endsWith("px")||o.height===null||!o.height.endsWith("px"))return void d.log(d.LogLevel.Debug,`computed element size expected in 'px', given ${o.width} ${o.height}`);const r=[parseFloat(o.width),parseFloat(o.height)];return[Math.round(r[0]*f),Math.round(r[1]*f)]}observe(m){m!==void 0&&(this._mutationObserver=new MutationObserver(this._mutationEventListener)),this._mutationObserver.observe(m,u.MUTATION_OBSERVER_CONFIG)}dispose(){const m=u.instances.indexOf(this);d.assert(m!==-1,"invalid reference counting of resizable instances"),u.instances.splice(m,1),u.instances.length===0&&u.eventSupported&&window.removeEventListener(u.EVENT_IDENTIFIER,this._resizeEventListener),this._mutationObserver&&this._mutationObserver.disconnect()}}p.Resizable=u,u.EVENT_IDENTIFIER="resize",u.instances=[],u.eventSupported=!1,u.MUTATION_OBSERVER_CONFIG={attributes:!0,attributeFilter:["style","class"],childList:!0,subtree:!0}},9092:function(F,p,v){var d=this&&this.__decorate||function(n,i,c,s){var a,h=arguments.length,g=h<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,c):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(n,i,c,s);else for(var _=n.length-1;_>=0;_--)(a=n[_])&&(g=(h<3?a(g):h>3?a(i,c,g):a(i,c))||g);return h>3&&g&&Object.defineProperty(i,c,g),g};Object.defineProperty(p,"__esModule",{value:!0}),p.ForwardSceneRenderPass=void 0;const u=v(3659),b=v(9696),m=v(4597),f=v(1030),o=v(3946);class r extends o.SceneRenderPass{constructor(i){super(),this._altered=Object.assign(new m.ChangeLookup,{any:!1,camera:!1}),this._context=i,this._opaqueGeometryMap=new Map,this._transparentGeometryMap=new Map}preprocessScene(){b.assert(this._scene!==void 0,"Scene was undefined during preprocessing."),this._scene!==void 0&&(this._opaqueGeometryMap.clear(),this._transparentGeometryMap.clear(),this.preprocessNode(this._scene,u.mat4.create()))}preprocessNode(i,c){const s=u.mat4.clone(c),a=i.componentsOfType("TransformComponent");if(b.assert(a.length<=1,"SceneNode can not have more than one transform component"),a.length===1){const g=a[0];u.mat4.mul(s,s,g.transform)}const h=i.componentsOfType("GeometryComponent");for(const g of h){const _=g,T=_.material,y=_.geometry;if(T.isTransparent){let A=this._transparentGeometryMap.get(T);A===void 0&&(A=[]),A.push([y,s]),this._transparentGeometryMap.set(T,A)}else{let A=this._opaqueGeometryMap.get(T);A===void 0&&(A=[]),A.push([y,s]),this._opaqueGeometryMap.set(T,A)}}if(i.nodes!==void 0)for(const g of i.nodes)this.preprocessNode(g,s)}renderGeometryMap(i){for(const c of Array.from(i.keys())){this.bindMaterial(c);const s=i.get(c);for(const[a,h]of s)a.bind(),this.bindGeometry!==void 0&&this.bindGeometry(a),this.updateModelTransform(h),a.draw(),a.unbind()}}initialize(){return!0}uninitialize(){}prepare(){}update(i=!1){}frame(){if(b.assert(this._target&&this._target.valid,"valid target expected"),b.assert(this._program&&this._program.valid,"valid program expected"),b.assert(this.updateModelTransform!==void 0,"Model transform function needs to be initialized."),b.assert(this.updateViewProjectionTransform!==void 0,"View Projection transform function needs to be initialized."),b.assert(this.bindMaterial!==void 0,"Material binding function needs to be initialized."),this._scene===void 0)return;const i=this._context.gl;i.enable(i.DEPTH_TEST);const c=this._target.size;i.viewport(0,0,c[0],c[1]);const s=this._clearColor;i.clearColor(s[0],s[1],s[2],s[3]),this._target.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT,!0,!1),this._program.bind(),this.bindUniforms!==void 0&&this.bindUniforms(),this.updateViewProjectionTransform(this._camera.viewProjection),this.drawCalls(),this._program.unbind(),i.disable(i.BLEND)}drawCalls(i=!0){this._scene!==void 0&&(this.renderGeometryMap(this._opaqueGeometryMap),i&&this.renderGeometryMap(this._transparentGeometryMap))}set target(i){this.assertInitialized(),this._target=i}set ndcOffset(i){this.assertInitialized(),this._ndcOffset=i}set camera(i){this.assertInitialized(),this._camera!==i&&(this._camera=i,this._altered.alter("camera"))}set clearColor(i){this._clearColor=i}set program(i){this._program=i}}d([f.Initializable.initialize()],r.prototype,"initialize",null),d([f.Initializable.uninitialize()],r.prototype,"uninitialize",null),d([f.Initializable.assert_initialized()],r.prototype,"update",null),d([f.Initializable.assert_initialized()],r.prototype,"frame",null),d([f.Initializable.assert_initialized()],r.prototype,"drawCalls",null),p.ForwardSceneRenderPass=r},4614:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GeometryComponent=void 0;const d=v(922);class u extends d.SceneNodeComponent{constructor(){super("GeometryComponent")}set geometry(m){this._geometry=m}get geometry(){return this._geometry}set material(m){this._material=m}get material(){return this._material}}p.GeometryComponent=u},9922:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.SceneRenderPass=p.Material=p.GeometryComponent=p.TransformComponent=p.SceneNodeComponent=p.SceneNode=p.ForwardSceneRenderPass=void 0;var d=v(9092);Object.defineProperty(p,"ForwardSceneRenderPass",{enumerable:!0,get:function(){return d.ForwardSceneRenderPass}});var u=v(9981);Object.defineProperty(p,"SceneNode",{enumerable:!0,get:function(){return u.SceneNode}});var b=v(922);Object.defineProperty(p,"SceneNodeComponent",{enumerable:!0,get:function(){return b.SceneNodeComponent}});var m=v(8425);Object.defineProperty(p,"TransformComponent",{enumerable:!0,get:function(){return m.TransformComponent}});var f=v(4614);Object.defineProperty(p,"GeometryComponent",{enumerable:!0,get:function(){return f.GeometryComponent}});var o=v(9699);Object.defineProperty(p,"Material",{enumerable:!0,get:function(){return o.Material}});var r=v(3946);Object.defineProperty(p,"SceneRenderPass",{enumerable:!0,get:function(){return r.SceneRenderPass}})},9699:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Material=void 0,p.Material=class{constructor(v,d){this._context=v,this._name=d,this._isTransparent=!1}get name(){return this._name}get isTransparent(){return this._isTransparent}set isTransparent(v){this._isTransparent=v}}},9981:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.SceneNode=void 0,p.SceneNode=class{constructor(v){this._nodes=new Array,this._components=new Array,this._name=v,this._parent=void 0}traverse(v){v(this);for(const d of this._nodes)d.traverse(v)}addNode(v){return v._parent=this,this._nodes.push(v),v}addComponent(v){return this._components.push(v),v}componentsOfType(v){return this._components.filter(d=>v===d.type)}get name(){return this._name}get parent(){return this._parent}get nodes(){return this._nodes}get components(){return this._components}get isLeaf(){return this._nodes.length===0}get isRoot(){return this._parent===void 0}}},922:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.SceneNodeComponent=void 0,p.SceneNodeComponent=class{constructor(v){this._type=v}get type(){return this._type}}},3946:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.SceneRenderPass=void 0;const d=v(1030);class u extends d.Initializable{set scene(m){this._scene=m,this._scene!==void 0&&this.preprocessScene()}get scene(){return this._scene}}p.SceneRenderPass=u},8425:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.TransformComponent=void 0;const d=v(922);class u extends d.SceneNodeComponent{constructor(m){super("TransformComponent"),this._transform=m}get transform(){return this._transform}}p.TransformComponent=u},5263:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Shader=void 0;const d=v(9696),u=v(2281);class b extends u.AbstractObject{constructor(f,o,r){super(f,r),this._compiled=!1;const n=f.gl;if(r===void 0)switch(o){case f.gl.FRAGMENT_SHADER:r="FragmentShader";break;case f.gl.VERTEX_SHADER:r="VertexShader";break;default:d.assert(!1,`expected either a FRAGMENT_SHADER (${n.FRAGMENT_SHADER}) or a VERTEX_SHADER (${n.VERTEX_SHADER}), given ${o}`)}this._type=o}create(f,o=!0){const r=this._context.gl;return this._object=r.createShader(this._type),this._valid=r.isShader(this._object),this._compiled=!1,d.assert(this._object instanceof WebGLShader,"expected WebGLShader object to be created"),f&&(this.source=f),f&&o&&this.compile(),this._object}delete(){d.assert(this._object!==void 0,"expected WebGLShader object"),this._context.gl.deleteShader(this._object),this._object=void 0,this._valid=!1,this._compiled=!1}compile(){const f=this._context.gl;let o=this.sourceWithReplacements;if(this._context.isWebGL2&&(o=`#version 300 es
${o}`),f.shaderSource(this._object,o),f.compileShader(this._object),this._compiled=f.getShaderParameter(this._object,f.COMPILE_STATUS),!this._compiled){const r=f.getShaderInfoLog(this._object);d.log(d.LogLevel.Error,`compilation of shader '${this._identifier}' failed: ${r}`)}}replace(f,o){this._replacements===void 0&&(this._replacements=new Map),this._replacements.set(f,o)}get type(){return this.assertInitialized(),this._type}set source(f){this._source!==f&&(this._source=f)}get source(){return this.assertInitialized(),this._source}get sourceWithReplacements(){if(this._replacements===void 0)return this._source;let f=this._source;return this._replacements.forEach((o,r)=>{const n=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");f=f.replace(new RegExp(n,"g"),o)}),f}get compiled(){return this.assertInitialized(),this._compiled}}p.Shader=b},6210:function(F,p,v){var d=this&&this.__decorate||function(c,s,a,h){var g,_=arguments.length,T=_<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,a):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(c,s,a,h);else for(var y=c.length-1;y>=0;y--)(g=c[y])&&(T=(_<3?g(T):_>3?g(s,a,T):g(s,a))||T);return _>3&&T&&Object.defineProperty(s,a,T),T};Object.defineProperty(p,"__esModule",{value:!0}),p.ShadowPass=void 0;const u=v(9696),b=v(9564),m=v(5714),f=v(1030),o=v(7540),r=v(6942),n=v(1284);class i extends f.Initializable{constructor(s){super(),this._gaussFilterKernelSize=21,this._context=s}get shadowMapFBO(){return this._shadowMapFBO}get shadowMapTexture(){return this.hasBlur?this._blurTexture:this._shadowMapTexture}get hasBlur(){return this._shadowType!==i.ShadowMappingType.HardLinear}get blurSize(){return this._gaussFilterKernelSize}set blurSize(s){s!==this._gaussFilterKernelSize&&(this._gaussFilter!==void 0&&(this._gaussFilter.kernelSize=s,this._gaussFilter.standardDeviation=s/6),this._gaussFilterKernelSize=s)}resize(s,a=!0,h=!0){u.assert(s[0]>0&&s[1]>0,"Size has to be > 0."),this._shadowMapSize=s,this._shadowMapFBO.resize(this._shadowMapSize[0],this._shadowMapSize[1],a,h)}resizeBlurTexture(s,a=!0,h=!0){u.assert(s[0]>0&&s[1]>0,"Size has to be > 0."),this._blurredShadowMapSize=s,this._intermediateBlurFBO.resize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],a,h),this._blurFBO.resize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],a,h)}initialize(s,a,h){u.assert(a[0]>0&&a[1]>0,"Size has to be > 0."),this._shadowType=s,this._shadowMapSize=a,this._blurredShadowMapSize=h!==void 0?h:this._shadowMapSize;const g=this._context.gl,_=this._context.gl2facade;let T=g.RGBA;if(this._context.isWebGL2){const L=this._context.gl;switch(this._shadowType){case i.ShadowMappingType.HardLinear:case i.ShadowMappingType.HardExponential:T=L.RED;break;case i.ShadowMappingType.SoftLinear:T=L.RG;break;case i.ShadowMappingType.SoftExponential:T=L.RGBA;break;default:u.assert(!1,"Unexpected value for shadowType")}}const[y,A]=n.Wizard.queryInternalTextureFormat(this._context,T,n.Wizard.Precision.float);this._shadowType!==i.ShadowMappingType.HardLinear&&A!==g.FLOAT&&(u.log(u.LogLevel.Warning,"floating point textures are not supported, falling back to HardLinear"),this._shadowType=i.ShadowMappingType.HardLinear);let w=g.LINEAR;return A!==g.FLOAT||this._context.supportsTextureFloatLinear||(w=g.NEAREST),A!==_.HALF_FLOAT||this._context.supportsTextureHalfFloatLinear||(w=g.NEAREST),this._shadowMapTexture=new r.Texture2D(this._context),this._shadowMapTexture.initialize(this._shadowMapSize[0],this._shadowMapSize[1],y,T,g.FLOAT),this._shadowMapTexture.wrap(g.CLAMP_TO_EDGE,g.CLAMP_TO_EDGE),this._shadowMapTexture.filter(w,w),this._shadowMapRenderbuffer=new o.Renderbuffer(this._context),this._shadowMapRenderbuffer.initialize(this._shadowMapSize[0],this._shadowMapSize[1],g.DEPTH_COMPONENT16),this._shadowMapFBO=new b.Framebuffer(this._context),this._shadowMapFBO.initialize([[_.COLOR_ATTACHMENT0,this._shadowMapTexture],[g.DEPTH_ATTACHMENT,this._shadowMapRenderbuffer]]),this._shadowMapFBO.clearColor([1,1,1,1]),this._shadowMapFBO.clearDepth(1),this.hasBlur&&(this._gaussFilter=new m.GaussFilter(this._context),this._gaussFilter.kernelSize=this._gaussFilterKernelSize,this._gaussFilter.standardDeviation=this._gaussFilterKernelSize/6,this._gaussFilter.initialize(),this._intermediateBlurTexture=new r.Texture2D(this._context,"IntermediateBlurTexture"),this._intermediateBlurTexture.initialize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],y,T,g.FLOAT),this._intermediateBlurTexture.wrap(g.CLAMP_TO_EDGE,g.CLAMP_TO_EDGE),this._intermediateBlurTexture.filter(w,w),this._intermediateBlurFBO=new b.Framebuffer(this._context,"IntermediateBlurFramebuffer"),this._intermediateBlurFBO.initialize([[_.COLOR_ATTACHMENT0,this._intermediateBlurTexture]]),this._intermediateBlurFBO.clearColor([1,1,1,1]),this._intermediateBlurFBO.clearDepth(1),this._blurTexture=new r.Texture2D(this._context,"BlurTexture"),this._blurTexture.initialize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],y,T,g.FLOAT),this._blurTexture.wrap(g.CLAMP_TO_EDGE,g.CLAMP_TO_EDGE),this._blurTexture.filter(w,w),this._blurFBO=new b.Framebuffer(this._context,"BlurFramebuffer"),this._blurFBO.initialize([[_.COLOR_ATTACHMENT0,this._blurTexture]]),this._blurFBO.clearColor([1,1,1,1]),this._blurFBO.clearDepth(1)),!0}uninitialize(){this._shadowMapFBO.uninitialize(),this._shadowMapRenderbuffer.uninitialize(),this._shadowMapTexture.uninitialize(),this.hasBlur&&(this._intermediateBlurFBO.uninitialize(),this._intermediateBlurTexture.uninitialize(),this._blurFBO.uninitialize(),this._blurTexture.uninitialize(),this._gaussFilter.uninitialize())}frame(s){const a=this._context.gl;a.viewport(0,0,this._shadowMapSize[0],this._shadowMapSize[1]),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),this._shadowMapFBO.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,!0,!1),s(),a.disable(a.DEPTH_TEST),a.depthFunc(a.LESS),this.hasBlur&&(a.viewport(0,0,this._intermediateBlurFBO.width,this._intermediateBlurFBO.height),this._intermediateBlurFBO.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,!0,!1),this._gaussFilter.filter(this._shadowMapTexture,m.GaussFilter.Direction.Horizontal),a.viewport(0,0,this._blurFBO.width,this._blurFBO.height),this._blurFBO.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,!0,!1),this._gaussFilter.filter(this._intermediateBlurTexture,m.GaussFilter.Direction.Vertical))}}d([f.Initializable.assert_initialized()],i.prototype,"resize",null),d([f.Initializable.assert_initialized()],i.prototype,"resizeBlurTexture",null),d([f.Initializable.initialize()],i.prototype,"initialize",null),d([f.Initializable.uninitialize()],i.prototype,"uninitialize",null),d([f.Initializable.assert_initialized()],i.prototype,"frame",null),p.ShadowPass=i,function(c){(function(s){s[s.HardLinear=0]="HardLinear",s[s.SoftLinear=1]="SoftLinear",s[s.HardExponential=2]="HardExponential",s[s.SoftExponential=3]="SoftExponential"})(c.ShadowMappingType||(c.ShadowMappingType={}))}(i=p.ShadowPass||(p.ShadowPass={}))},6902:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.FontFace=void 0;const d=v(9696),u=v(6942),b=v(1284),m=v(6869),f=v(7115),o=v(6885);class r{constructor(i,c){this._ascent=0,this._descent=0,this._lineGap=0,this._glyphTextureExtent=[0,0],this._glyphTexturePadding=[0,0,0,0],this._glyphs=new Map,this._context=i;const s=i.gl;c=c!==void 0&&c!==""?c:this.constructor.name,this._glyphTexture=new u.Texture2D(i,`${c}GlyphAtlas`);const a=b.Wizard.queryInternalTextureFormat(i,s.RGBA,b.Wizard.Precision.byte);this._glyphTexture.initialize(1,1,a[0],s.RGBA,a[1]),this._glyphTexture.filter(s.LINEAR,s.LINEAR)}static fromFile(i,c,s=!1,a){return m.fetchAsync(i,"text").then(h=>{const g=new r(c,a);return f.FontFaceLoader.process(g,h,i,void 0,s).then(_=>_).catch(_=>Promise.reject(`processing font face data failed: ${_}`))})}static fromFiles(i,c,s,a=!1,h){return m.fetchAsync(i,"text").then(g=>{const _=new r(s,h);return f.FontFaceLoader.process(_,g,i,c,a).then(T=>T).catch(T=>Promise.reject(`processing font face data failed: ${T}`))})}hasGlyph(i){return!!this._glyphs.get(i)}glyph(i){const c=this._glyphs.get(i);if(c)return c;const s=new o.Glyph;return s.index=i,s}addGlyph(i){d.assert(!this._glyphs.get(i.index),"expected glyph to not already exist"),this._glyphs.set(i.index,i)}arrayOfGlyphIndices(){return Array.from(this._glyphs.keys())}depictable(i){return this.glyph(i).depictable()}kerning(i,c){const s=this._glyphs.get(i);return s?s.kerning(c):0}setKerning(i,c,s){const a=this._glyphs.get(i);a&&this.hasGlyph(c)?a.setKerning(c,s):d.assert(!1,`expected glyph or glyph of subsequent index to exist,                 given ${i} and ${c} respectively`)}set size(i){d.assert(i>0,`expected size to be greater than 0.0, given ${i}`),this._size=i}get size(){return this._size}set base(i){d.assert(i>0,`expected base to be greater than 0.0, given ${i}`),this._base=i}get base(){return this._base}set ascent(i){d.assert(i>0,`expected ascent to be greater than 0.0, given ${i}`),this._ascent=i}get ascent(){return this._ascent}set descent(i){this._descent=i}get descent(){return this._descent}set lineGap(i){this._lineGap=i}get lineGap(){return this._lineGap}set lineHeight(i){d.assert(this.size>0,"expected size to be greater than zero to derive line gap from line height"),this._lineGap=i-this.size}get lineHeight(){return this.size+this.lineGap}set lineSpace(i){this._lineGap=this.size*(i-1)}get lineSpace(){return this.lineHeight===0?this.lineHeight:this.size/this.lineHeight}set glyphTextureExtent(i){d.assert(i[0]>0,`expected extent.x to be greater than 0.0, given ${i[0]}`),d.assert(i[1]>0,`expected extent.y to be greater than 0.0, given ${i[1]}`),this._glyphTextureExtent=i}get glyphTextureExtent(){return this._glyphTextureExtent}set glyphTexturePadding(i){d.assert(i[0]>=0,`expected padding[0] to be greater than 0.0, given ${i[0]}`),d.assert(i[1]>=0,`expected padding[1] to be greater than 0.0, given ${i[1]}`),d.assert(i[2]>=0,`expected padding[2] to be greater than 0.0, given ${i[2]}`),d.assert(i[3]>=0,`expected padding[3] to be greater than 0.0, given ${i[3]}`),this._glyphTexturePadding=i}get glyphTexturePadding(){return this._glyphTexturePadding}set glyphTexture(i){this._glyphTexture=i}get glyphTexture(){return this._glyphTexture}}p.FontFace=r},7115:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.FontFaceLoader=void 0;const d=v(9696),u=v(6885);class b{static processInfo(f,o){const r=new Map;if(!this.readKeyValuePairs(f,["size","padding"],r))return!1;o.size=parseFloat(r.get("size"));const n=r.get("padding").split(",");if(n.length!==4)return d.log(d.LogLevel.Warning,`expected 4 values for padding, given ${n} (${n.length})`),!1;const i=[parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])];return o.glyphTexturePadding=i,!0}static processCommon(f,o){const r=new Map;return!!this.readKeyValuePairs(f,["lineHeight","base","scaleW","scaleH"],r)&&(o.base=parseFloat(r.get("base")),r.has("ascent")&&(o.ascent=parseFloat(r.get("ascent"))),r.has("descent")&&(o.descent=parseFloat(r.get("descent"))),o.lineHeight=parseFloat(r.get("lineHeight")),o.glyphTextureExtent=[parseFloat(r.get("scaleW")),parseFloat(r.get("scaleH"))],!0)}static processPage(f,o,r){const n=new Map;if(!this.readKeyValuePairs(f,["file"],n))return;const i=d.dirname(r);let c=n.get("file");return c=c.replace(/['"]+/g,""),o.glyphTexture.fetch(`${i}/${c}`,!0,!0).catch(()=>Promise.reject(`page '${c}' referenced in font file '${r}' was not found`))}static processPages(f,o){d.logIf(o.size!==1,d.LogLevel.Warning,"glyph atlas supports a single page only (impl. for multiple pages pending)"),d.assert(o.has(0),"page with page ID 0 expected for glyph atlas (impl. for multiple pages pending)");const r=o.get(0);if(r)return f.glyphTexture.fetch(`${r}`,!0,!0).catch(()=>Promise.reject(`fetching page '0' from '${r}' failed`))}static processChar(f,o){const r=new Map;if(!this.readKeyValuePairs(f,["id","x","y","width","height","xoffset","yoffset","xadvance"],r))return!1;const n=parseInt(r.get("id"),10);d.logIf(n<=0,d.LogLevel.Warning,`expected glyph index to be greater than 0, given ${n}`);const i=new u.Glyph;i.index=n;const c=[1/o.glyphTextureExtent[0],1/o.glyphTextureExtent[1]],s=[parseFloat(r.get("width")),parseFloat(r.get("height"))];return i.subTextureOrigin=[parseFloat(r.get("x"))*c[0],1-(parseFloat(r.get("y"))+s[1])*c[1]],i.extent=s,i.subTextureExtent[0]=s[0]*c[0],i.subTextureExtent[1]=s[1]*c[1],i.bearingFromFontBaseAndOffset(o.base,parseFloat(r.get("xoffset")),parseFloat(r.get("yoffset"))),i.advance=parseFloat(r.get("xadvance")),o.addGlyph(i),!0}static processKerning(f,o){const r=new Map;if(!this.readKeyValuePairs(f,["first","second","amount"],r))return!1;const n=parseInt(r.get("first"),10);if(n<=0)return d.log(d.LogLevel.Warning,`expected kerning's first to be greater than 0, given ${n}`),!1;const i=parseInt(r.get("second"),10);if(i<=0)return d.log(d.LogLevel.Warning,`expected kerning's second to be greater than 0, given ${i}`),!1;const c=parseFloat(r.get("amount"));return o.setKerning(n,i,c),!0}static readKeyValuePairs(f,o,r){let n,i;for(const s of f){const a=s.split("=");n=a[0],i=a[1],r.set(n,i)}let c=!0;return o.forEach(s=>c=c&&r.has(s)),c||d.log(d.LogLevel.Warning,`Not all required keys are provided! Mandatory keys: ${o}`),c}static findAscentAndDescentIfNoneProvided(f,o){if(f.ascent>0&&f.descent<0)return;f.ascent>0&&(f.descent=f.ascent-o),f.descent<0&&(f.ascent=f.descent-o);let r=Number.MIN_VALUE;for(const n of f.arrayOfGlyphIndices())f.glyph(n).extent[1]!==0&&(r=Math.max(f.glyph(n).bearing[1],r));f.ascent=r,f.descent=f.ascent-o,d.log(d.LogLevel.Debug,`ascent not specified, derived ${f.ascent} from maximum y-offset`)}static process(f,o,r,n,i=!1){const c=o.split(`
`),s=new Array;let a=!0;if(!i&&n){const h=this.processPages(f,n);h!==void 0&&s.push(h)}for(const h of c){let g=h.split(" ");const _=g[0];switch(g=g.slice(1),_){case"info":a=this.processInfo(g,f);break;case"common":a=this.processCommon(g,f);break;case"page":if(i||n)break;const T=this.processPage(g,f,r);T!==void 0&&s.push(T);break;case"char":a=this.processChar(g,f);break;case"kerning":this.processKerning(g,f)}if(a===!1)break}return b.findAscentAndDescentIfNoneProvided(f,f.size),f.size<=0&&d.log(d.LogLevel.Warning,`expected fontFace.size to be greater than 0, given ${f.size}`),Promise.all(s).then(()=>f)}}p.FontFaceLoader=b},6885:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Glyph=void 0;const d=v(4934);p.Glyph=class{constructor(u=0,b=0){this._bearing=[0,0],this._extent=[0,0],this._kernings=new Map,this._subTextureOrigin=[0,0],this._subTextureExtent=[0,0],this._index=u,this._advance=b}depictable(){return this._subTextureExtent[0]>0&&this._subTextureExtent[1]>0}kerning(u){const b=this._kernings.get(u);return b!==void 0?b:0}setKerning(u,b){this._kernings.set(u,b)}set index(u){this._index=u}get index(){return this._index}set subTextureOrigin(u){this._subTextureOrigin=d.clampf2(u,"texture origin")}get subTextureOrigin(){return this._subTextureOrigin}set subTextureExtent(u){this._subTextureExtent=d.clampf2(u,"texture extent")}get subTextureExtent(){return this._subTextureExtent}set bearing(u){this._bearing=u}get bearing(){return this._bearing}bearingFromFontBaseAndOffset(u,b,m){this._bearing[0]=b,this._bearing[1]=u-m}set extent(u){this._extent=u}get extent(){return this._extent}set advance(u){this._advance=u}get advance(){return this._advance}}},7326:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.GlyphVertices=void 0;class v{constructor(u){const b=Math.max(0,u);this._texCoords=new Float32Array(b*v.FLOATS_PER_TEXCOORD),this._origins=new Float32Array(b*v.FLOATS_PER_ORIGIN),this._tangents=new Float32Array(b*v.FLOATS_PER_TANGENT),this._ups=new Float32Array(b*v.FLOATS_PER_UP)}static concat(u){let b=0;u.forEach(o=>b+=o?o.length:0);const m=new v(b);let f=0;for(let o=0;o<u.length;++o){const r=u[o];r!==void 0&&r.length!==0&&(m._texCoords.set(r._texCoords,f*v.FLOATS_PER_TEXCOORD),m._origins.set(r._origins,f*v.FLOATS_PER_ORIGIN),m._tangents.set(r._tangents,f*v.FLOATS_PER_TANGENT),m._ups.set(r._ups,f*v.FLOATS_PER_UP),f+=r.length)}return m}shrink(u){const b=Math.max(0,u);if(this.length===b)return;const m=(f,o,r)=>new Float32Array(f.buffer.slice(0,o*f.BYTES_PER_ELEMENT*r),0,o*r);m(this._texCoords,b,v.FLOATS_PER_TEXCOORD),m(this._origins,b,v.FLOATS_PER_ORIGIN),m(this._ups,b,v.FLOATS_PER_TANGENT),m(this._tangents,b,v.FLOATS_PER_UP)}uvLowerLeft(u){const b=u*v.FLOATS_PER_TEXCOORD+0;return this._texCoords.subarray(b,b+2)}uvUpperRight(u){const b=u*v.FLOATS_PER_TEXCOORD+2;return this._texCoords.subarray(b,b+2)}origin(u){const b=u*v.FLOATS_PER_ORIGIN;return this._origins.subarray(b,b+v.FLOATS_PER_ORIGIN)}tangent(u){const b=u*v.FLOATS_PER_TANGENT;return this._tangents.subarray(b,b+v.FLOATS_PER_TANGENT)}up(u){const b=u*v.FLOATS_PER_UP;return this._ups.subarray(b,b+v.FLOATS_PER_UP)}get length(){return this._origins.length/v.FLOATS_PER_ORIGIN}get origins(){return this._origins}get tangents(){return this._tangents}get ups(){return this._ups}get texCoords(){return this._texCoords}}p.GlyphVertices=v,v.FLOATS_PER_TEXCOORD=4,v.FLOATS_PER_ORIGIN=3,v.FLOATS_PER_TANGENT=3,v.FLOATS_PER_UP=3},2709:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Typesetter=p.Text=p.Projected3DLabel=p.Position3DLabel=p.Position2DLabel=p.LabelRenderPass=p.LabelGeometry=p.Label=p.GlyphVertices=p.FontFace=void 0;var d=v(6902);Object.defineProperty(p,"FontFace",{enumerable:!0,get:function(){return d.FontFace}});var u=v(7326);Object.defineProperty(p,"GlyphVertices",{enumerable:!0,get:function(){return u.GlyphVertices}});var b=v(8733);Object.defineProperty(p,"Label",{enumerable:!0,get:function(){return b.Label}});var m=v(8852);Object.defineProperty(p,"LabelGeometry",{enumerable:!0,get:function(){return m.LabelGeometry}});var f=v(8597);Object.defineProperty(p,"LabelRenderPass",{enumerable:!0,get:function(){return f.LabelRenderPass}});var o=v(8254);Object.defineProperty(p,"Position2DLabel",{enumerable:!0,get:function(){return o.Position2DLabel}});var r=v(8115);Object.defineProperty(p,"Position3DLabel",{enumerable:!0,get:function(){return r.Position3DLabel}});var n=v(1648);Object.defineProperty(p,"Projected3DLabel",{enumerable:!0,get:function(){return n.Projected3DLabel}});var i=v(819);Object.defineProperty(p,"Text",{enumerable:!0,get:function(){return i.Text}});var c=v(3210);Object.defineProperty(p,"Typesetter",{enumerable:!0,get:function(){return c.Typesetter}})},8733:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Label=void 0;const d=v(3659),u=v(4597),b=v(7677),m=v(7326),f=v(819);class o{constructor(n,i,c){this._alignment=o.Alignment.Left,this._lineAnchor=o.LineAnchor.Baseline,this._lineWidth=NaN,this._fontSizeUnit=o.Unit.World,this._color=new b.Color(o.DEFAULT_COLOR),this._altered=Object.assign(new u.ChangeLookup,{any:!1,color:!1,resources:!1,text:!1,typesetting:!1,static:!1,dynamic:!1}),this._wrap=!1,this._elide=o.Elide.None,this._ellipsis=o.DEFAULT_ELLIPSIS,this._text=n,this._type=i,this._staticTransform=d.mat4.create(),this._dynamicTransform=d.mat4.create(),this._extent=[0,0],c&&(this._fontFace=c)}static devicePixelRatio(){return window===void 0||typeof window.devicePixelRatio!="number"?1:window.devicePixelRatio}vertices(){return new m.GlyphVertices(this.length+this.ellipsis.length)}charAt(n){return this._text.charAt(n)}charCodeAt(n){return this._text.charCodeAt(n)}lineFeedAt(n){return this.charAt(n)===this.lineFeed}kerningBefore(n){return n<1||n>this.length?NaN:this._fontFace.kerning(this.charCodeAt(n-1),this.charCodeAt(n))}kerningAfter(n){return n<0||n>this.length-1?NaN:this._fontFace.kerning(this.charCodeAt(n),this.charCodeAt(n+1))}advance(n){return n<0||n>this.length?NaN:this._fontFace.glyph(this.charCodeAt(n)).advance}toString(){return this._text instanceof f.Text?this._text.text:this._text}reset(){this._altered.reset()}set text(n){this._altered.alter("text"),this._text=n}get text(){return this._text}get type(){return this._type}get length(){return this._text.length}get lineFeed(){return this._text instanceof f.Text?this._text.lineFeed:f.Text.DEFAULT_LINE_FEED}set wrap(n){this._wrap=n}get wrap(){return this._wrap}set elide(n){this._elide=n}get elide(){return this._elide}set ellipsis(n){this._ellipsis!==n&&(this._ellipsis=n,this._elide!==o.Elide.None&&this._altered.alter("typesetting"))}get ellipsis(){return this._ellipsis}set lineWidth(n){this._lineWidth!==n&&(this._lineWidth=n,this._altered.alter("typesetting"))}get lineWidth(){return this._lineWidth*this._fontFace.size/this.fontSize}set alignment(n){this._alignment!==n&&(this._alignment=n,this._altered.alter("typesetting"))}get alignment(){return this._alignment}set lineAnchor(n){this._lineAnchor!==n&&(this._lineAnchor=n,this._altered.alter("typesetting"))}get lineAnchor(){return this._lineAnchor}set fontSize(n){this._fontSize!==n&&(this._fontSize=n,this._altered.alter("typesetting"))}get fontSize(){return this._fontSize}set fontSizeUnit(n){this._fontSizeUnit!==n&&(this._fontSizeUnit=n,this._altered.alter("typesetting"))}get fontSizeUnit(){return this._fontSizeUnit}set fontFace(n){this._fontFace!==n&&(this._fontFace=n,this._altered.alter("typesetting"),this._altered.alter("resources"))}get fontFace(){return this._fontFace}set color(n){this._color.equals(n)||(this._color=n,this._altered.alter("color"))}get color(){return this._color}set backgroundColor(n){this._backgroundColor.equals(n)||(this._backgroundColor=n,this._altered.alter("color"))}get backgroundColor(){return this._backgroundColor}set staticTransform(n){d.mat4.equals(this._staticTransform,n)||(this._staticTransform=n,this._altered.alter("static"))}get staticTransform(){const n=this.fontSize/this._fontFace.size,i=d.mat4.create();return d.mat4.scale(i,this._staticTransform,d.vec3.fromValues(n,n,n)),i}set dynamicTransform(n){this._altered.alter("dynamic"),this._dynamicTransform=n}get dynamicTransform(){return this._dynamicTransform}set extent(n){this._extent=n}get extent(){return this._extent}get altered(){return this._altered.any||this._text.altered||this._color.altered}get valid(){return this._fontFace!==void 0&&this._fontFace.glyphTexture.valid&&this._text.length>0}}p.Label=o,o.DEFAULT_COLOR=[.1098,.4588,.7373,1],o.DEFAULT_ELLIPSIS="...",function(r){(function(n){n.Static="static",n.Dynamic="dynamic"})(r.Type||(r.Type={})),function(n){n.None="none",n.Left="left",n.Middle="middle",n.Right="right"}(r.Elide||(r.Elide={})),function(n){n.Left="left",n.Center="center",n.Right="right"}(r.Alignment||(r.Alignment={})),function(n){n.Top="top",n.Ascent="ascent",n.Center="center",n.Baseline="baseline",n.Descent="descent",n.Bottom="bottom"}(r.LineAnchor||(r.LineAnchor={})),function(n){n.World="world",n.Pixel="pixel",n.Mixed="mixed"}(r.Unit||(r.Unit={}))}(o=p.Label||(p.Label={}))},8852:function(F,p,v){var d=this&&this.__decorate||function(r,n,i,c){var s,a=arguments.length,h=a<3?n:c===null?c=Object.getOwnPropertyDescriptor(n,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,n,i,c);else for(var g=r.length-1;g>=0;g--)(s=r[g])&&(h=(a<3?s(h):a>3?s(n,i,h):s(n,i))||h);return a>3&&h&&Object.defineProperty(n,i,h),h};Object.defineProperty(p,"__esModule",{value:!0}),p.LabelGeometry=void 0;const u=v(9696),b=v(6404),m=v(4894),f=v(1030);class o extends m.Geometry{constructor(n,i){super(n,i),this._numberOfGlyphs=0,u.assert(n.isWebGL2||n.supportsInstancedArrays,"expected extension 'ANGLE_instanced_arrays' to be supported"),i=i!==void 0&&i!==""?i:this.constructor.name,this._vertices=new b.Buffer(n,`${i}VBO`),this._buffers.push(this._vertices),this._texCoords=new b.Buffer(n,`${i}TexCoordVBO`),this._buffers.push(this._texCoords),this._origins=new b.Buffer(n,`${i}OriginVBO`),this._buffers.push(this._origins),this._tangents=new b.Buffer(n,`${i}TangentVBO`),this._buffers.push(this._tangents),this._ups=new b.Buffer(n,`${i}UpVBO`),this._buffers.push(this._ups)}bindBuffers(){const n=this.context.gl,i=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,n.FLOAT,!1,8,0,!0,!1),i.vertexAttribDivisor(this._vertexLocation,0),this._texCoords.attribEnable(this._texCoordLocation,4,n.FLOAT,!1,16,0,!0,!1),i.vertexAttribDivisor(this._texCoordLocation,1),this._origins.attribEnable(this._originLocation,3,n.FLOAT,!1,12,0,!0,!1),i.vertexAttribDivisor(this._originLocation,1),this._tangents.attribEnable(this._tangentLocation,3,n.FLOAT,!1,12,0,!0,!1),i.vertexAttribDivisor(this._tangentLocation,1),this._ups.attribEnable(this._upLocation,3,n.FLOAT,!1,12,0,!0,!1),i.vertexAttribDivisor(this._upLocation,1)}unbindBuffers(){this._vertices.attribDisable(this._vertexLocation,!1,!1),this._texCoords.attribDisable(this._texCoordLocation,!1,!1),this._origins.attribDisable(this._originLocation,!1,!1),this._tangents.attribDisable(this._tangentLocation,!1,!1),this._ups.attribDisable(this._upLocation,!1,!1)}initialize(n=0,i=1,c=2,s=3,a=4){this._vertexLocation=n,this._texCoordLocation=i,this._originLocation=c,this._tangentLocation=s,this._upLocation=a;const h=this.context.gl,g=super.initialize([h.ARRAY_BUFFER,h.ARRAY_BUFFER,h.ARRAY_BUFFER,h.ARRAY_BUFFER,h.ARRAY_BUFFER]);return this._vertices.data(o.VERTICES,h.STATIC_DRAW),g}update(n,i,c,s){this._numberOfGlyphs=n.length/3;const a=this.context.gl;this._texCoords.data(s,a.STATIC_DRAW),this._origins.data(n,a.STATIC_DRAW),this._tangents.data(i,a.STATIC_DRAW),this._ups.data(c,a.STATIC_DRAW)}draw(n=0,i=0){const c=this.context.gl,s=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,c.FLOAT,!1,8,0,!0,!1),this._texCoords.attribEnable(this._texCoordLocation,4,c.FLOAT,!1,16,16*n,!0,!1),this._origins.attribEnable(this._originLocation,3,c.FLOAT,!1,12,12*n,!0,!1),this._tangents.attribEnable(this._tangentLocation,3,c.FLOAT,!1,12,12*n,!0,!1),this._ups.attribEnable(this._upLocation,3,c.FLOAT,!1,12,12*n,!0,!1),s.drawArraysInstanced(c.TRIANGLE_STRIP,0,4,i)}get numGlyphs(){return this._numberOfGlyphs}get valid(){const n=this._vertices&&this._vertices.valid,i=this._texCoords&&this._texCoords.valid,c=this._origins&&this._origins.valid,s=this._tangents&&this._tangents.valid,a=this._ups&&this._ups.valid;return this.initialized&&n&&i&&c&&s&&a}get vertexLocation(){return this._vertexLocation}get texCoordLocation(){return this._texCoordLocation}get originLocation(){return this._originLocation}get tangentLocation(){return this._tangentLocation}get upLocation(){return this._upLocation}}o.VERTICES=new Float32Array([0,0,0,1,1,0,1,1]),d([f.Initializable.assert_initialized()],o.prototype,"draw",null),p.LabelGeometry=o},8597:function(F,p,v){var d=this&&this.__decorate||function(T,y,A,w){var L,D=arguments.length,j=D<3?y:w===null?w=Object.getOwnPropertyDescriptor(y,A):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(T,y,A,w);else for(var V=T.length-1;V>=0;V--)(L=T[V])&&(j=(D<3?L(j):D>3?L(y,A,j):L(y,A))||j);return D>3&&j&&Object.defineProperty(y,A,j),j};Object.defineProperty(p,"__esModule",{value:!0}),p.LabelRenderPass=void 0;const u=v(3659),b=v(9696),m=v(4597),f=v(1030),o=v(4895),r=v(5263),n=v(6942),i=v(7326),c=v(8733),s=v(8852),a=v(8254),h=v(8115),g=v(1648);class _ extends f.Initializable{constructor(y){super(),this._altered=Object.assign(new m.ChangeLookup,{any:!1,camera:!1,geometry:!1,labels:!1,aaStepScale:!1,aaSampling:!1}),this._ndcOffset=[0,0],this._depthMask=!1,this._aaSampling=_.Sampling.Smooth1,this._labels=new Array,this._ranges=new Array,this._verticesPerLabel=new Array,this._context=y,this._depthFunc=y.gl.LESS,this._program=new o.Program(y,"LabelRenderProgram"),this._geometry=new s.LabelGeometry(this._context,"LabelGeometry"),this._aaStepScale=_.DEFAULT_AA_STEP_SCALE}prepare(){const y=this._camera.viewport;for(let w=0;w<this._labels.length;++w){const L=this._labels[w];let D;const j=this._altered.labels&&this._verticesPerLabel[w]===void 0;L instanceof a.Position2DLabel?(L.frameSize=y,D=L.typeset(j)):L instanceof g.Projected3DLabel?(L.camera=this._camera,D=L.typeset(j)):L instanceof h.Position3DLabel&&(D=L.typeset(j)),D===void 0?D=this._verticesPerLabel[w]:this._verticesPerLabel[w]=D;const V=w>0?this._ranges[w-1][1]:0,G=V+(D===void 0?0:D.length);this._ranges[w]=[V,G]}const A=i.GlyphVertices.concat(this._verticesPerLabel);this._geometry.update(A.origins,A.tangents,A.ups,A.texCoords)}draw(){const y=this._context.gl,A=[0,0];let w,L;const D=u.mat4.create();for(let j=0;j<this._labels.length;++j){const V=this._labels[j];if(A[1]=this._ranges[j][1],A[0]===A[1]||j<this._labels.length-1&&!V.valid)continue;const G=j<this._labels.length-1?this._labels[j+1]:void 0,W=G&&V.type===c.Label.Type.Static&&G.type===c.Label.Type.Static,H=G&&V.color.equals(G.color),q=G&&V.fontFace===G.fontFace,Z=G&&V.fontSizeUnit===G.fontSizeUnit;if(G&&(this._ranges[j+1][0]===this._ranges[j+1][1]||W&&H&&q&&Z))continue;const $=V.type===c.Label.Type.Dynamic;switch(y.uniform1i(this._uDynamic,$),$&&y.uniformMatrix4fv(this._uTransform,!1,V.dynamicTransform),w!==void 0&&w.equals(V.color)||(y.uniform4fv(this._uColor,V.color.rgbaF32),w=V.color),L!==V.fontFace&&(V.fontFace.glyphTexture.bind(y.TEXTURE0),L=V.fontFace),V.fontSizeUnit){case c.Label.Unit.Pixel:y.uniformMatrix4fv(this._uViewProjection,!1,D);break;case c.Label.Unit.World:case c.Label.Unit.Mixed:default:y.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection)}this._geometry.draw(A[0],A[1]-A[0]),A[0]=A[1]}}initialize(){const y=this._context.gl;this._geometry.initialize(),this._context.enable(["OES_standard_derivatives"]);const A=new r.Shader(this._context,y.VERTEX_SHADER,"glyph.vert");A.initialize(v(1176));const w=new r.Shader(this._context,y.FRAGMENT_SHADER,"glyph.frag");return w.initialize(v(9761)),this._program.initialize([A,w],!1),this._program.attribute("a_vertex",this._geometry.vertexLocation),this._program.attribute("a_texCoord",this._geometry.texCoordLocation),this._program.attribute("a_origin",this._geometry.originLocation),this._program.attribute("a_tangent",this._geometry.tangentLocation),this._program.attribute("a_up",this._geometry.upLocation),this._program.link(),this._uViewProjection=this._program.uniform("u_viewProjection"),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uColor=this._program.uniform("u_color"),this._uAAStepScale=this._program.uniform("u_aaStepScale"),this._uAASampling=this._program.uniform("u_aaSampling"),this._uTransform=this._program.uniform("u_transform"),this._uDynamic=this._program.uniform("u_dynamic"),this._program.bind(),y.uniform1i(this._program.uniform("u_glyphs"),0),y.uniform1f(this._uAAStepScale,this._aaStepScale),y.uniform1i(this._uAASampling,this._aaSampling),this._program.unbind(),!0}uninitialize(){this._geometry.uninitialize(),this._program.uninitialize(),this._uViewProjection=void 0,this._uNdcOffset=void 0,this._uColor=void 0,this._uAAStepScale=void 0,this._uAASampling=void 0,this._uTransform=void 0,this._uDynamic=void 0}update(y=!1){const A=this._context.gl;this._program.bind(),(y||this._altered.camera||this._camera.altered)&&A.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),(y||this._altered.aaStepScale)&&A.uniform1f(this._uAAStepScale,this._aaStepScale),(y||this._altered.aaSampling)&&A.uniform1i(this._uAASampling,this._aaSampling);let w=y||this._altered.labels||this._altered.camera||this._camera.altered,L=0;for(;w===!1&&L<this._labels.length;)w=this._labels[L].altered,++L;w&&this.prepare(),this._altered.reset()}frame(){if(this._geometry.numGlyphs===0||this._labels.length===0)return;b.assert(this._target&&this._target.valid,"valid target expected");const y=this._context.gl,A=this._target.size;y.viewport(0,0,A[0],A[1]),y.enable(y.DEPTH_TEST),y.depthFunc(this._depthFunc),this._depthMask===!1&&y.depthMask(this._depthMask),y.enable(y.BLEND),y.blendFuncSeparate(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA),this._program.bind(),y.uniform2fv(this._uNdcOffset,this._ndcOffset),y.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),this._target.bind(),this._geometry.bind(),this.draw(),y.bindTexture(y.TEXTURE_2D,n.Texture2D.DEFAULT_TEXTURE),this._depthMask===!1&&y.depthMask(!0),y.depthFunc(y.LESS),y.disable(y.DEPTH_TEST),y.disable(y.BLEND)}unbind(){this._geometry.valid&&this._geometry.unbind(),this._program.valid&&this._program.unbind()}set target(y){this.assertInitialized(),this._target=y}set ndcOffset(y){this.assertInitialized(),this._ndcOffset=y}set camera(y){this.assertInitialized(),this._camera!==y&&(this._camera=y,this._altered.alter("camera"))}set depthMask(y){this._depthMask=y}get depthMask(){return this._depthMask}set depthFunc(y){this._depthFunc=y}get depthFunc(){return this._depthFunc}set labels(y){this._labels=y,this._ranges.length=this._labels.length,this._verticesPerLabel.length=this._labels.length,this._verticesPerLabel.fill(void 0),this._altered.alter("labels")}get labels(){return this._labels}set aaStepScale(y){this._aaStepScale!==y&&(this._aaStepScale=y,this._altered.alter("aaStepScale"))}get aaStepScale(){return this._aaStepScale}set aaSampling(y){this._aaSampling!==y&&(this._aaSampling=y,this._altered.alter("aaSampling"))}get aaSampling(){return this._aaSampling}get geometry(){return this._geometry}get program(){return this._program}}_.DEFAULT_AA_STEP_SCALE=.6666,d([f.Initializable.initialize()],_.prototype,"initialize",null),d([f.Initializable.uninitialize()],_.prototype,"uninitialize",null),d([f.Initializable.assert_initialized()],_.prototype,"update",null),d([f.Initializable.assert_initialized()],_.prototype,"frame",null),d([f.Initializable.assert_initialized()],_.prototype,"unbind",null),p.LabelRenderPass=_,function(T){(function(y){y[y.None=0]="None",y[y.Smooth1=1]="Smooth1",y[y.Horizontal3=2]="Horizontal3",y[y.Vertical3=3]="Vertical3",y[y.Grid3x3=4]="Grid3x3",y[y.Grid4x4=5]="Grid4x4"})(T.Sampling||(T.Sampling={}))}(_=p.LabelRenderPass||(p.LabelRenderPass={}))},8254:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Position2DLabel=void 0;const d=v(3659),u=v(9696),b=v(2111),m=v(7326),f=v(8733),o=v(3210);class r extends f.Label{constructor(i,c,s){super(i,c,s),this._position=d.vec2.fromValues(0,0),this._direction=d.vec2.fromValues(1,0),this._frameSize=d.vec2.create(),this._fontSize=r.DEFAULT_FONTSIZE_PX,this._fontSizeUnit=f.Label.Unit.Pixel}typeset(i=!1){const c=i||this._altered.typesetting||this._altered.static||this._altered.text||this.text.altered;if(!c&&!this._altered.dynamic&&!i)return;if(!this.valid)return new m.GlyphVertices(0);const s=d.vec4.create(),a=d.mat4.create();d.mat4.translate(a,b.m4(),d.vec3.fromValues(-1,-1,0)),d.mat4.scale(a,a,d.vec3.fromValues(2/this._frameSize[0],2/this._frameSize[1],1));const h=d.vec2.sub(b.v2(),d.vec2.fromValues(this._frameSize[0],this._frameSize[1]),d.vec2.fromValues(s[3]+s[1],s[2]+s[0])),g=d.vec3.fromValues(.5*h[0],.5*h[1],0);d.vec3.add(g,g,d.vec3.fromValues(s[3],s[2],0)),d.mat4.translate(a,a,g),d.mat4.translate(a,a,d.vec3.fromValues(this._position[0],this._position[1],0));const _=d.vec2.fromValues(1,0);let T=d.vec2.angle(_,this._direction);switch(_[0]*this._direction[1]-_[1]*this._direction[0]<0&&(T=-T),d.mat4.rotateZ(a,a,T),this._type){case f.Label.Type.Static:this.staticTransform=d.mat4.clone(a),this.dynamicTransform=b.m4();break;case f.Label.Type.Dynamic:this.staticTransform=b.m4(),this.dynamicTransform=d.mat4.clone(a)}if(this._altered.reset(),this._text.altered=!1,this._color.altered=!1,!c)return;const y=this.vertices();return o.Typesetter.typeset(this,y),y}set frameSize(i){d.vec2.equals(this._frameSize,i)||(d.vec2.max(this._frameSize,i,[1,1]),this._altered.alter(this._type))}get frameSize(){return this._frameSize}set position(i){d.vec2.equals(this._position,i)||(this._position=d.vec2.clone(i),this._altered.alter(this._type))}get position(){return this._position}set direction(i){d.vec2.normalize(this._direction,i),this._altered.alter(this._type)}get direction(){return this._direction}set fontSizeUnit(i){u.logIf(i!==f.Label.Unit.Pixel,u.LogLevel.Warning,`font size unit other than 'px' are not supported in position-2d-label, given ${i}`)}get fontSizeUnit(){return this._fontSizeUnit}}p.Position2DLabel=r,r.DEFAULT_FONTSIZE_PX=20},8115:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Position3DLabel=void 0;const d=v(3659),u=v(9696),b=v(2111),m=v(7326),f=v(8733),o=v(3210);class r extends f.Label{constructor(i,c,s){super(i,c,s),this._position=d.vec3.fromValues(0,0,0),this._direction=d.vec3.fromValues(1,0,0),this._up=d.vec3.fromValues(0,1,0),this._fontSize=r.DEFAULT_FONTSIZE_WORLD,this._fontSizeUnit=f.Label.Unit.World}typeset(i=!1){const c=i||this._altered.typesetting||this._altered.static||this._altered.text||this.text.altered;if(!c&&!this._altered.dynamic&&!i)return;if(!this.valid)return new m.GlyphVertices(0);const s=d.mat4.create();d.mat4.translate(s,b.m4(),this._position);const a=d.vec3.cross(b.v3(),this._direction,this._up),h=d.mat4.fromValues(this._direction[0],this._direction[1],this._direction[2],0,this._up[0],this._up[1],this._up[2],0,a[0],a[1],a[2],0,0,0,0,1);switch(d.mat4.mul(s,s,h),this._type){case f.Label.Type.Static:this.staticTransform=d.mat4.clone(s),this.dynamicTransform=b.m4();break;case f.Label.Type.Dynamic:this.staticTransform=b.m4(),this.dynamicTransform=d.mat4.clone(s)}if(this._altered.reset(),this._text.altered=!1,this._color.altered=!1,!c)return;const g=this.vertices();return o.Typesetter.typeset(this,g),g}set position(i){this._position=d.vec3.clone(i),this._altered.alter(this._type)}get position(){return this._position}set direction(i){d.vec3.normalize(this._direction,i),this._altered.alter(this._type)}get direction(){return this._direction}set up(i){this._up=d.vec3.normalize(this._up,i),this._altered.alter(this._type)}get up(){return this._up}set fontSizeUnit(i){u.logIf(i!==f.Label.Unit.World,u.LogLevel.Warning,`font size unit other than 'world' are not supported in position-3d-label, given ${i}`)}get fontSizeUnit(){return this._fontSizeUnit}}p.Position3DLabel=r,r.DEFAULT_FONTSIZE_WORLD=.05},1648:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Projected3DLabel=void 0;const d=v(3659),u=v(9696),b=v(2111),m=v(7326),f=v(8733),o=v(3210);class r extends f.Label{constructor(i,c,s){super(i,c,s),this._position=d.vec3.fromValues(0,0,0),this._direction=d.vec2.fromValues(1,0),this._fontSize=r.DEFAULT_FONTSIZE_PX,this._fontSizeUnit=f.Label.Unit.Mixed}typeset(i=!1){const c=i||this._altered.typesetting||this._altered.static||this._altered.text||this.text.altered;if(!c&&!this._altered.dynamic&&!i)return;if(!this.valid||this._camera===void 0)return new m.GlyphVertices(0);const s=d.vec4.create(),a=d.mat4.create();d.mat4.translate(a,a,d.vec3.fromValues(-1,-1,0)),d.mat4.scale(a,a,d.vec3.fromValues(2/this._camera.viewport[0],2/this._camera.viewport[1],1)),d.mat4.scale(a,a,d.vec3.fromValues(1,1,1));const h=d.vec2.create();d.vec2.sub(h,d.vec2.fromValues(this._camera.viewport[0]/1,this._camera.viewport[1]/1),d.vec2.fromValues(s[3]+s[1],s[2]+s[0]));const g=d.vec3.fromValues(.5*h[0],.5*h[1],0);d.vec3.add(g,g,d.vec3.fromValues(s[3],s[2],0)),d.mat4.translate(a,a,g);const _=d.vec4.fromValues(this._position[0],this._position[1],this._position[2],1);d.vec4.transformMat4(_,_,this._camera.viewProjection);const T=d.mat4.create(),y=_[3];d.mat4.translate(T,T,d.vec3.fromValues(_[0]/y,_[1]/y,_[2]/y)),d.mat4.mul(a,T,a);const A=d.vec2.fromValues(1,0);let w=d.vec2.angle(A,this._direction);switch(A[0]*this._direction[1]-A[1]*this._direction[0]<0&&(w=-w),d.mat4.rotateZ(a,a,w),this._camera.viewProjectionInverse?d.mat4.mul(a,this._camera.viewProjectionInverse,a):u.log(u.LogLevel.Warning,"camera.viewProjectionInverse is null"),this._type){case f.Label.Type.Static:this.staticTransform=d.mat4.clone(a),this.dynamicTransform=b.m4();break;case f.Label.Type.Dynamic:this.staticTransform=b.m4(),this.dynamicTransform=d.mat4.clone(a)}if(this._altered.reset(),this._text.altered=!1,this._color.altered=!1,!c)return;const L=this.vertices();return o.Typesetter.typeset(this,L),L}set camera(i){this._camera=i,this._altered.alter(this._type)}get camera(){return this._camera}set position(i){this._position=d.vec3.clone(i),this._altered.alter(this._type)}get position(){return this._position}set direction(i){d.vec2.normalize(this._direction,i),this._altered.alter(this._type)}get direction(){return this._direction}set fontSizeUnit(i){u.logIf(i!==f.Label.Unit.Mixed,u.LogLevel.Warning,`font size unit other than 'px' are not supported in projected-3d-label, given ${i}`)}get fontSizeUnit(){return this._fontSizeUnit}}p.Projected3DLabel=r,r.DEFAULT_FONTSIZE_PX=20},819:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Text=void 0;class v{constructor(u,b){this._lineFeed=v.DEFAULT_LINE_FEED,this._altered=!1,this._text=u||"",this._lineFeed=b!==void 0?b:this._lineFeed}get length(){return this._text.length}charAt(u){return this._text.charAt(u)}charCodeAt(u){return this._text.charCodeAt(u)}set text(u){this._text!==u&&(this._altered=!0,this._text=u)}get text(){return this._text}set lineFeed(u){this._lineFeed!==u&&(this._altered=!0,this._lineFeed=u)}get lineFeed(){return this._lineFeed}set altered(u){this._altered=u}get altered(){return this._altered}}p.Text=v,v.DEFAULT_LINE_FEED=`
`},3210:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Typesetter=void 0;const d=v(3659),u=v(9696),b=v(2111),m=v(8733);class f{static writeVertex(r,n,i,c,s){if(c===void 0||i.depictable()===!1)return;const a=r.glyphTexturePadding,h=c.origin(s);d.vec3.set(h,n[0],n[1],0),h[0]+=i.bearing[0]-a[3],h[1]+=i.bearing[1]-i.extent[1],d.vec3.set(c.tangent(s),i.extent[0],0,0),d.vec3.set(c.up(s),0,i.extent[1],0);const g=c.uvLowerLeft(s);d.vec2.copy(g,i.subTextureOrigin);const _=c.uvUpperRight(s);d.vec2.add(_,i.subTextureOrigin,i.subTextureExtent)}static lineAnchorOffset(r){let n=0;const i=r.fontFace.glyphTexturePadding,c=r.fontFace;switch(r.lineAnchor){case m.Label.LineAnchor.Ascent:n=c.ascent-i[0];break;case m.Label.LineAnchor.Descent:n=c.descent*(1+i[0]/c.ascent);break;case m.Label.LineAnchor.Center:n=c.ascent-i[0]-.5*c.size;break;case m.Label.LineAnchor.Top:n=c.ascent-i[0]+.5*c.lineGap;break;case m.Label.LineAnchor.Bottom:n=c.ascent-i[0]+.5*c.lineGap-c.lineHeight;break;case m.Label.LineAnchor.Baseline:default:n=-i[0]}return n}static advances(r,n){u.assert(r.fontFace!==void 0,"expected a font face for label in order to resolve advances"),n===void 0&&(n=r.text.text);const i=new Float32Array(n.length);for(let c=0;c<n.length;++c){const s=n.charCodeAt(c);i[c]=r.fontFace.glyph(s).advance}return i}static kernings(r,n){if(u.assert(r.fontFace!==void 0,"expected a font face for label in order to resolve kernings"),n===void 0){const s=new Float32Array(r.length);for(let a=0;a<r.length;++a){const h=r.kerningAfter(a);s[a]=isNaN(h)?0:h}return s}const i=new Float32Array(n.length);for(let s=0;s<n.length;++s){const a=(c=s)<0||c>n.length-1?NaN:r.fontFace.kerning(n.charCodeAt(c),n.charCodeAt(c+1));i[s]=isNaN(a)?0:a}var c;return i}static fragments(r){const n=new Array;let i,c=0;for(let s=0;s<r.length;++s){if(i=f.DELIMITERS.indexOf(r.charAt(s))>-1,!i)continue;c<s&&n.push([c,s,f.FragmentType.Word]);const a=r.lineFeedAt(s)?f.FragmentType.LineFeed:f.FragmentType.Delimiter;n.push([s,s+1,a]),c=s+1}return i||n.push([c,r.length,f.FragmentType.Word]),n}static fragmentWidths(r,n,i){const c=new Float32Array(r.length);for(let s=0;s<r.length;++s){const a=r[s];c[s]=n.subarray(a[0],a[1]).reduce((h,g,_)=>h+g+(_<a[1]?i[_+a[0]]:0),0)}return c}static elideThresholds(r,n){switch(r.elide){case m.Label.Elide.Right:return[r.lineWidth-n,0];case m.Label.Elide.Middle:const i=r.lineWidth/2-n/2;return[i,i];case m.Label.Elide.Left:return[0,r.lineWidth-n];default:return[0,0]}}static elideFragments(r,n,i,c,s,a){const h=new Array,g=new Array;let _=0,T=0;for(let y=a?n.length-1:0;a?y>-1:y<n.length;a?--y:++y){const A=n[y];if(A[2]!==f.FragmentType.LineFeed){if(!(_+i[y]<r)){if(A[2]===f.FragmentType.Delimiter||_+c[a?A[1]-1:A[0]]>r)break;for(let w=a?A[1]-1:A[0];a?w>=A[0]:w<A[1];a?--w:++w){if(!(_+T+c[w]+s[w]<r)){h.push([a?w+1:A[0],a?A[1]:w,A[2]]),g.push(T);break}T+=c[w]+s[w]}break}_+=i[y],h.push(A),g.push(i[y])}}return[h,g,_+T]}static transformVertices(r,n,i,c){if(n!==void 0&&!d.mat4.equals(r,d.mat4.create()))for(let s=i;s<c;++s){const a=n.origin(s),h=b.v3();d.vec3.transformMat4(h,a,r);const g=b.v3();d.vec3.transformMat4(g,d.vec3.add(g,a,n.tangent(s)),r);const _=b.v3();d.vec3.transformMat4(_,d.vec3.add(_,a,n.up(s)),r),d.vec3.copy(n.origin(s),h),d.vec3.sub(n.tangent(s),g,h),d.vec3.sub(n.up(s),_,h)}}static updateRectangleMinMax(r,n){u.assert(r.length===6&&n.length===6,"expected the rectangles to have 6 values!");let i=0;for(;i<3;i++)r[i]=Math.min(r[i],n[i]);for(;i<6;i++)r[i]=Math.max(r[i],n[i])}static minMax(r,n,i){const c=Math.min(r,...i),s=Math.max(n,...i);return d.vec2.fromValues(c,s)}static getMinMaxVertices(r,n,i){let c=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY;for(let T=n;T<i;++T){const y=f.minMax(c,s,[r.origin(T)[0],r.origin(T)[0]+r.up(T)[0],r.origin(T)[0]+r.tangent(T)[0]]);c=y[0],s=y[1];const A=f.minMax(a,h,[r.origin(T)[1],r.origin(T)[1]+r.up(T)[1],r.origin(T)[1]+r.tangent(T)[1]]);a=A[0],h=A[1];const w=f.minMax(g,_,[r.origin(T)[2],r.origin(T)[2]+r.up(T)[2],r.origin(T)[2]+r.tangent(T)[2]]);g=w[0],_=w[1]}return[c,a,g,s,h,_]}static transformAlignment(r,n,i,c,s){if(i===void 0||n===m.Label.Alignment.Left)return;let a=-r;n===m.Label.Alignment.Center&&(a*=.5);for(let h=c;h<s;++h)i.origin(h)[0]+=a}static transform(r,n,i){const c=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const y of i)f.transformAlignment(y[2],r.alignment,n,y[0],y[1]),f.updateRectangleMinMax(c,f.getMinMaxVertices(n,y[0],y[1])),f.transformVertices(r.staticTransform,n,y[0],y[1]);const s=c[3]-c[0],a=c[4]-c[1],h=d.vec4.transformMat4(d.vec4.create(),d.vec4.fromValues(0,0,0,1),r.staticTransform),g=d.vec4.transformMat4(d.vec4.create(),d.vec4.fromValues(s,0,0,1),r.staticTransform),_=d.vec4.transformMat4(d.vec4.create(),d.vec4.fromValues(0,a,0,1),r.staticTransform),T=d.vec2.fromValues(d.vec4.distance(g,h),d.vec4.distance(_,h));r.extent=[T[0],T[1]]}static typeset(r,n){if(r.length===0)return 0;u.assert(r.fontFace!==void 0,"expected a font face for label before typesetting");const i=r.fontFace,c=D=>D<r.length?i.glyph(r.charCodeAt(D)):i.glyph(r.ellipsis.charCodeAt(D-r.length)),s=f.advances(r),a=f.kernings(r),h=f.fragments(r),g=f.fragmentWidths(h,s,a),_=d.vec2.fromValues(0,-f.lineAnchorOffset(r)),T=new Array;let y=0;const A=r.elide!==m.Label.Elide.None,w=(D,j,V=NaN,G=s,W=a,H=0)=>{let q=y;for(let Z=0;Z<D.length;++Z){const $=D[Z];if($[0]>=$[1])continue;const J=!A&&$[2]===f.FragmentType.LineFeed;let se=!1;if(!A&&!J&&r.wrap){const Q=$[2]!==f.FragmentType.Delimiter||c($[0]).depictable(),ae=$[2]===f.FragmentType.Word&&Z<D.length-1&&D[Z+1][2]===f.FragmentType.Delimiter&&c(D[Z+1][0]).depictable();se=_[0]+(Q?j[Z]:0)+(ae?j[Z+1]:0)>r.lineWidth}if(!J&&!se||(T.push([q,y,_[0]]),q=y,_[0]=0,_[1]-=i.lineHeight,!J))for(let Q=$[0];Q<$[1];++Q)c(Q).depictable()&&(f.writeVertex(i,_,c(Q),n,y),++y),_[0]+=G[Q-H]+W[Q-H]}q<y&&T.push([q,y,_[0]])},L=g.reduce((D,j)=>D+j,0);if(A&&L>r.lineWidth){const D=[[r.length,r.length+r.ellipsis.length,f.FragmentType.Word]],j=f.advances(r,r.ellipsis),V=f.kernings(r,r.ellipsis),G=f.fragmentWidths([[0,r.ellipsis.length,f.FragmentType.Word]],j,V),W=G[0];if(r.lineWidth<W)return 0;const H=f.elideThresholds(r,W),[q,Z,$]=f.elideFragments(H[0],h,g,s,a,!1);r.elide===m.Label.Elide.Middle&&(H[1]+=H[0]-$);const[J,se]=f.elideFragments(H[1],h,g,s,a,!0);w(q,new Float32Array(Z)),w(D,G,NaN,j,V,r.length),w(J.reverse(),new Float32Array(se.reverse())),u.assert(T.length<4,`expected at most 3-line-yield from advance, given ${T}`),T[0][1]=T[T.length-1][1],T[0][2]=_[0],T.length=1}else w(h,g,r.lineWidth);return f.transform(r,n,T),n.shrink(y),y}}p.Typesetter=f,f.DELIMITERS=`
 ,.-/()[]<>`,function(o){(function(r){r[r.Word=0]="Word",r[r.Delimiter=1]="Delimiter",r[r.LineFeed=2]="LineFeed"})(o.FragmentType||(o.FragmentType={}))}(f=p.Typesetter||(p.Typesetter={}))},6942:function(F,p,v){var d=this&&this.__decorate||function(r,n,i,c){var s,a=arguments.length,h=a<3?n:c===null?c=Object.getOwnPropertyDescriptor(n,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,n,i,c);else for(var g=r.length-1;g>=0;g--)(s=r[g])&&(h=(a<3?s(h):a>3?s(n,i,h):s(n,i))||h);return a>3&&h&&Object.defineProperty(n,i,h),h};Object.defineProperty(p,"__esModule",{value:!0}),p.Texture2D=void 0;const u=v(9696),b=v(423),m=v(1030),f=v(2281);class o extends f.AbstractObject{constructor(){super(...arguments),this._width=0,this._height=0,this._internalFormat=0,this._format=0,this._type=0,this._mipmap=!1,this._anisotropy=void 0}create(n,i,c,s,a){u.assert(n>0&&i>0,"texture requires valid width and height of greater than zero");const h=this._context.gl,g=this._context.gl2facade;if(this._object=h.createTexture(),this._width=n,this._height=i,this._internalFormat=c,this._format=s,this._type=a,h.bindTexture(h.TEXTURE_2D,this._object),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),o.MAX_ANISOTROPY===void 0)if(this._context.supportsTextureFilterAnisotropic){const _=this._context.textureFilterAnisotropic;o.MAX_ANISOTROPY=h.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else o.MAX_ANISOTROPY=0;return g.texImage2D(h.TEXTURE_2D,0,this._internalFormat,this._width,this._height,0,this._format,this._type),h.bindTexture(h.TEXTURE_2D,o.DEFAULT_TEXTURE),this._valid=h.isTexture(this._object),this.reallocate(),this._object}delete(){u.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._width=0,this._height=0}reallocate(){const n=this.context.gl,i=this._context.gl2facade;let c=this._width*this._height*b.byteSizeOfFormat(this.context,this._internalFormat);this._type===i.HALF_FLOAT&&this._internalFormat!==n.RGBA16F?c*=2:this._type===n.FLOAT&&this._internalFormat!==n.RGBA16F&&(c*=4),this.context.allocationRegister.reallocate(this._identifier,c)}bind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_2D,this._object)}unbind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_2D,o.DEFAULT_TEXTURE)}fetch(n,i=!1,c=!1){const s=this.context.gl;return new Promise((a,h)=>{const g=new Image;g.onerror=()=>{u.log(u.LogLevel.Error,`loading image from '${g.src}' failed`),h()},g.onload=()=>{this.resize(g.width,g.height),c||s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),this.data(g),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),a()},i&&(g.crossOrigin="anonymous"),g.src=n})}data(n,i=!0,c=!0){const s=this.context.gl,a=this._context.gl2facade;i&&this.bind(),a.texImage2D(s.TEXTURE_2D,0,this._internalFormat,this._width,this._height,0,this._format,this._type,n),this._anisotropy!==void 0&&this._anisotropy>0?this.maxAnisotropy(this._anisotropy,!1,!1):this._mipmap&&this.generateMipMap(!1,!1),c&&this.unbind(),this.reallocate()}filter(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),u.logIf(n===a.LINEAR_MIPMAP_LINEAR||n===a.LINEAR_MIPMAP_NEAREST,u.LogLevel.Debug,"magnification does not utilize a MipMap (refer to LINEAR and NEAREST only)"),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,i),this._mipmap=i===a.LINEAR_MIPMAP_LINEAR||i===a.LINEAR_MIPMAP_NEAREST,this._mipmap&&a.generateMipmap(a.TEXTURE_2D),s&&this.unbind()}wrap(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),s&&this.unbind()}reformat(n,i,c,s=!0,a=!0){(n!==this._internalFormat||i!==void 0&&i!==this._format||c!==void 0&&c!==this._type)&&(u.assert(n!==void 0,"valid internal format expected"),this._internalFormat=n,i&&(this._format=i),c&&(this._type=c),this.data(void 0,s,a))}resize(n,i,c=!0,s=!0){n===this._width&&i===this._height||(this._width=n,this._height=i,this.data(void 0,c,s))}generateMipMap(n=!0,i=!0){const c=this.context.gl;n&&this.bind(),c.generateMipmap(c.TEXTURE_2D),i&&this.unbind(),this._mipmap=!0}maxAnisotropy(n,i=!0,c=!0){if(this._context.supportsTextureFilterAnisotropic===!1)return void u.log(u.LogLevel.Debug,"setting anisotropy not supported (EXT_texture_filter_anisotropic missing)");const s=this.context.gl,a=this._context.textureFilterAnisotropic;return this._anisotropy=n===void 0?void 0:Math.max(0,Math.min(o.MAX_ANISOTROPY,n)),u.logIf(n!==this._anisotropy,u.LogLevel.Debug,`value clamped to max supported anisotropy of ${o.MAX_ANISOTROPY}, given ${n}`),i&&this.bind(),s.texParameterf(s.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy===void 0?0:this._anisotropy),this.generateMipMap(!1,c),this._anisotropy}get bytes(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)}get internalFormat(){return this.assertInitialized(),this._internalFormat}get format(){return this.assertInitialized(),this._format}get type(){return this.assertInitialized(),this._type}get width(){return this.assertInitialized(),this._width}get height(){return this.assertInitialized(),this._height}get size(){return this.assertInitialized(),[this._width,this._height]}}o.DEFAULT_TEXTURE=void 0,o.MAX_ANISOTROPY=void 0,d([m.Initializable.assert_initialized()],o.prototype,"bind",null),d([m.Initializable.assert_initialized()],o.prototype,"unbind",null),d([m.Initializable.assert_initialized()],o.prototype,"fetch",null),d([m.Initializable.assert_initialized()],o.prototype,"data",null),d([m.Initializable.assert_initialized()],o.prototype,"filter",null),d([m.Initializable.assert_initialized()],o.prototype,"wrap",null),d([m.Initializable.assert_initialized()],o.prototype,"reformat",null),d([m.Initializable.assert_initialized()],o.prototype,"resize",null),p.Texture2D=o},4850:function(F,p,v){var d=this&&this.__decorate||function(r,n,i,c){var s,a=arguments.length,h=a<3?n:c===null?c=Object.getOwnPropertyDescriptor(n,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,n,i,c);else for(var g=r.length-1;g>=0;g--)(s=r[g])&&(h=(a<3?s(h):a>3?s(n,i,h):s(n,i))||h);return a>3&&h&&Object.defineProperty(n,i,h),h};Object.defineProperty(p,"__esModule",{value:!0}),p.Texture2DArray=void 0;const u=v(9696),b=v(423),m=v(1030),f=v(2281);class o extends f.AbstractObject{constructor(){super(...arguments),this._width=0,this._height=0,this._depth=0,this._internalFormat=0,this._format=0,this._type=0}create(n,i,c,s,a,h){u.assert(this._context.supportsTexImage3D,"expected texImage3D to be supported"),u.assert(n>0&&i>0&&c>0,"texture requires valid width, height, and depth of greater than zero");const g=this._context.gl,_=this._context.gl2facade;return this._object=g.createTexture(),this._width=n,this._height=i,this._depth=c,this._internalFormat=s,this._format=a,this._type=h,g.bindTexture(g.TEXTURE_2D_ARRAY,this._object),g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_WRAP_R,g.CLAMP_TO_EDGE),_.texImage3D(g.TEXTURE_2D_ARRAY,0,this._internalFormat,this._width,this._height,this._depth,0,this._format,this._type),g.bindTexture(g.TEXTURE_2D_ARRAY,o.DEFAULT_TEXTURE),this._valid=g.isTexture(this._object),this.reallocate(),this._object}delete(){u.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._width=0,this._height=0,this._depth=0}reallocate(){const n=this.context.gl,i=this._context.gl2facade;let c=this._width*this._height*this._depth*b.byteSizeOfFormat(this.context,this._internalFormat);this._type===i.HALF_FLOAT&&this._internalFormat!==n.RGBA16F?c*=2:this._type===n.FLOAT&&this._internalFormat!==n.RGBA16F&&(c*=4),this.context.allocationRegister.reallocate(this._identifier,c)}bind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_2D_ARRAY,this._object)}unbind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_2D_ARRAY,o.DEFAULT_TEXTURE)}fetch(n,i,c=!1){return new Promise((s,a)=>{const h=new Image;h.onerror=()=>{u.log(u.LogLevel.Error,`loading image from '${h.src}' failed`),a()},h.onload=()=>{this.resize(h.width,h.height/i,i),this.data(h),s()},c&&(h.crossOrigin="anonymous"),h.src=n})}data(n,i=!0,c=!0){const s=this.context.gl,a=this._context.gl2facade;i&&this.bind(),a.texImage3D(s.TEXTURE_2D_ARRAY,0,this._internalFormat,this._width,this._height,this._depth,0,this._format,this._type,n),c&&this.unbind(),this.reallocate()}filter(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),a.texParameteri(a.TEXTURE_2D_ARRAY,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_2D_ARRAY,a.TEXTURE_MIN_FILTER,i),s&&this.unbind()}wrap(n,i,c,s=!0,a=!0){const h=this.context.gl;s&&this.bind(),h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_WRAP_T,i),h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_WRAP_R,c),a&&this.unbind()}reformat(n,i,c,s=!0,a=!0){(n!==this._internalFormat||i!==void 0&&i!==this._format||c!==void 0&&c!==this._type)&&(u.assert(n!==void 0,"valid internal format expected"),this._internalFormat=n,i&&(this._format=i),c&&(this._type=c),this.data(void 0,s,a))}resize(n,i,c,s=!0,a=!0){n===this._width&&i===this._height&&c===this._depth||(this._width=n,this._height=i,this._depth=c,this.data(void 0,s,a))}get bytes(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)}get internalFormat(){return this.assertInitialized(),this._internalFormat}get format(){return this.assertInitialized(),this._format}get type(){return this.assertInitialized(),this._type}get width(){return this.assertInitialized(),this._width}get height(){return this.assertInitialized(),this._height}get depth(){return this.assertInitialized(),this._depth}get size(){return this.assertInitialized(),[this._width,this._height,this._depth]}}o.DEFAULT_TEXTURE=void 0,d([m.Initializable.assert_initialized()],o.prototype,"bind",null),d([m.Initializable.assert_initialized()],o.prototype,"unbind",null),d([m.Initializable.assert_initialized()],o.prototype,"fetch",null),d([m.Initializable.assert_initialized()],o.prototype,"data",null),d([m.Initializable.assert_initialized()],o.prototype,"filter",null),d([m.Initializable.assert_initialized()],o.prototype,"wrap",null),d([m.Initializable.assert_initialized()],o.prototype,"reformat",null),d([m.Initializable.assert_initialized()],o.prototype,"resize",null),p.Texture2DArray=o},7344:function(F,p,v){var d=this&&this.__decorate||function(r,n,i,c){var s,a=arguments.length,h=a<3?n:c===null?c=Object.getOwnPropertyDescriptor(n,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,n,i,c);else for(var g=r.length-1;g>=0;g--)(s=r[g])&&(h=(a<3?s(h):a>3?s(n,i,h):s(n,i))||h);return a>3&&h&&Object.defineProperty(n,i,h),h};Object.defineProperty(p,"__esModule",{value:!0}),p.Texture3D=void 0;const u=v(9696),b=v(423),m=v(1030),f=v(2281);class o extends f.AbstractObject{constructor(){super(...arguments),this._width=0,this._height=0,this._depth=0,this._internalFormat=0,this._format=0,this._type=0}create(n,i,c,s,a,h){u.assert(this._context.supportsTexImage3D,"expected texImage3D to be supported"),u.assert(n>0&&i>0&&c>0,"texture requires valid width, height, and depth of greater than zero");const g=this._context.gl,_=this._context.gl2facade;return this._object=g.createTexture(),this._width=n,this._height=i,this._depth=c,this._internalFormat=s,this._format=a,this._type=h,g.bindTexture(g.TEXTURE_3D,this._object),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_3D,g.TEXTURE_WRAP_R,g.CLAMP_TO_EDGE),_.texImage3D(g.TEXTURE_3D,0,this._internalFormat,this._width,this._height,this._depth,0,this._format,this._type),g.bindTexture(g.TEXTURE_3D,o.DEFAULT_TEXTURE),this._valid=g.isTexture(this._object),this.reallocate(),this._object}delete(){u.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._width=0,this._height=0,this._depth=0}reallocate(){const n=this.context.gl,i=this._context.gl2facade;let c=this._width*this._height*this._depth*b.byteSizeOfFormat(this.context,this._internalFormat);this._type===i.HALF_FLOAT&&this._internalFormat!==n.RGBA16F?c*=2:this._type===n.FLOAT&&this._internalFormat!==n.RGBA16F&&(c*=4),this.context.allocationRegister.reallocate(this._identifier,c)}bind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_3D,this._object)}unbind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_3D,o.DEFAULT_TEXTURE)}load(n,i,c=!1,s=!1){return new Promise((a,h)=>{const g=new Image;g.onerror=()=>h(),g.onload=()=>{const _=document.createElement("canvas"),T=_.getContext("2d");let y,A,w,L;if(u.assert(T!==void 0,"expected auxiliary 2D context for temporary slicing"),s===!1){u.assert(g.height%i==0&&g.height/i>=1,"expected height to be a multitude of number of slices"),y=g.width,A=Math.floor(g.height/i),w=i,_.width=y,_.height=A,L=new Uint8Array(y*A*w);const D=y*A;for(let j=0;j<i;++j){T.drawImage(g,0,A*j,y,A,0,0,y,A);const V=T.getImageData(0,0,y,A).data;for(let G=0;G<D;++G)L[D*j+G]=V[4*G]}}else{u.assert(g.width%i==0&&g.width/i>=1,"expected width to be a multitude of number of slices"),y=Math.floor(g.width/i),A=g.height,w=i,_.width=y,_.height=A,L=new Uint8Array(y*A*w);const D=y*A;for(let j=0;j<i;++j){T.drawImage(g,y*j,0,y,A,0,0,y,A);const V=T.getImageData(0,0,y,A).data;for(let G=0;G<D;++G)L[D*j+G]=V[4*G]}}this.resize(y,A,w),this.data(L),a()},c&&(g.crossOrigin="anonymous"),g.src=n})}loadFromSingleImages(n,i,c=!1,s=!1){return new Promise((a,h)=>{const g=document.createElement("canvas"),_=g.getContext("2d"),T=[];let y,A;for(let w=0;w<n.length;w++){const L=new Image;L.onerror=()=>h();const D=new Promise((j,V)=>{try{L.onload=()=>{const G=L.width,W=L.height;s===!1?(y===void 0?(y=G*n.length,g.width=y):u.assert(G*n.length===y,"The single images do not have the same width"),A===void 0?(A=W,g.height=A):u.assert(W===A,"The single images do not have the same height"),_.drawImage(L,G*w,0)):(y===void 0?(y=G,g.width=y):u.assert(G===y,"The single images do not have the same width"),A===void 0?(A=W*n.length,g.height=A):u.assert(W*n.length===A,"The single images do not have the same height"),_.drawImage(L,0,W*w)),j()}}catch(G){V(G)}});T.push(D),c&&(L.crossOrigin="anonymous"),L.src=n[w]}Promise.all(T).then(()=>{const w=g.toDataURL("image/png",1);return this.load(w,i,c,s).then(()=>{a()})})})}data(n,i=!0,c=!0){const s=this.context.gl,a=this._context.gl2facade;i&&this.bind(),a.texImage3D(s.TEXTURE_3D,0,this._internalFormat,this._width,this._height,this._depth,0,this._format,this._type,n),c&&this.unbind(),this.reallocate()}filter(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,i),s&&this.unbind()}wrap(n,i,c,s=!0,a=!0){const h=this.context.gl;s&&this.bind(),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,i),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_R,c),a&&this.unbind()}reformat(n,i,c,s=!0,a=!0){(n!==this._internalFormat||i!==void 0&&i!==this._format||c!==void 0&&c!==this._type)&&(u.assert(n!==void 0,"valid internal format expected"),this._internalFormat=n,i&&(this._format=i),c&&(this._type=c),this.data(void 0,s,a))}resize(n,i,c,s=!0,a=!0){n===this._width&&i===this._height&&c===this._depth||(this._width=n,this._height=i,this._depth=c,this.data(void 0,s,a))}get bytes(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)}get internalFormat(){return this.assertInitialized(),this._internalFormat}get format(){return this.assertInitialized(),this._format}get type(){return this.assertInitialized(),this._type}get width(){return this.assertInitialized(),this._width}get height(){return this.assertInitialized(),this._height}get depth(){return this.assertInitialized(),this._depth}get size(){return this.assertInitialized(),[this._width,this._height,this._depth]}}o.DEFAULT_TEXTURE=void 0,d([m.Initializable.assert_initialized()],o.prototype,"bind",null),d([m.Initializable.assert_initialized()],o.prototype,"unbind",null),d([m.Initializable.assert_initialized()],o.prototype,"load",null),d([m.Initializable.assert_initialized()],o.prototype,"loadFromSingleImages",null),d([m.Initializable.assert_initialized()],o.prototype,"data",null),d([m.Initializable.assert_initialized()],o.prototype,"filter",null),d([m.Initializable.assert_initialized()],o.prototype,"wrap",null),d([m.Initializable.assert_initialized()],o.prototype,"reformat",null),d([m.Initializable.assert_initialized()],o.prototype,"resize",null),p.Texture3D=o},945:function(F,p,v){var d=this&&this.__decorate||function(r,n,i,c){var s,a=arguments.length,h=a<3?n:c===null?c=Object.getOwnPropertyDescriptor(n,i):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,n,i,c);else for(var g=r.length-1;g>=0;g--)(s=r[g])&&(h=(a<3?s(h):a>3?s(n,i,h):s(n,i))||h);return a>3&&h&&Object.defineProperty(n,i,h),h};Object.defineProperty(p,"__esModule",{value:!0}),p.TextureCube=void 0;const u=v(9696),b=v(423),m=v(1030),f=v(2281);class o extends f.AbstractObject{constructor(){super(...arguments),this._size=0,this._internalFormat=0,this._format=0,this._type=0,this._bytes=[0,0,0,0,0,0]}faceID(n){const i=this._context.gl;switch(n){case i.TEXTURE_CUBE_MAP_POSITIVE_X:return 0;case i.TEXTURE_CUBE_MAP_NEGATIVE_X:return 1;case i.TEXTURE_CUBE_MAP_POSITIVE_Y:return 2;case i.TEXTURE_CUBE_MAP_NEGATIVE_Y:return 3;case i.TEXTURE_CUBE_MAP_POSITIVE_Z:return 4;case i.TEXTURE_CUBE_MAP_NEGATIVE_Z:return 5;default:return u.assert(!1,`expected texture cube map identifier (${i.TEXTURE_CUBE_MAP_POSITIVE_X}, ${i.TEXTURE_CUBE_MAP_NEGATIVE_X}, ${i.TEXTURE_CUBE_MAP_POSITIVE_Y}, ${i.TEXTURE_CUBE_MAP_NEGATIVE_Y}, ${i.TEXTURE_CUBE_MAP_POSITIVE_Z}, or${i.TEXTURE_CUBE_MAP_NEGATIVE_Z}), given ${n}`),-1}}create(n,i,c,s){u.assert(n>0,"texture cube requires valid size (width/height) of greater than zero");const a=this._context.gl,h=this._context.gl2facade;return this._object=a.createTexture(),this._size=n,this._internalFormat=i,this._format=c,this._type=s,a.bindTexture(a.TEXTURE_CUBE_MAP,this._object),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),h.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,this._internalFormat,this._size,this._size,0,this._format,this._type),h.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this._internalFormat,this._size,this._size,0,this._format,this._type),h.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this._internalFormat,this._size,this._size,0,this._format,this._type),h.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this._internalFormat,this._size,this._size,0,this._format,this._type),h.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this._internalFormat,this._size,this._size,0,this._format,this._type),h.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this._internalFormat,this._size,this._size,0,this._format,this._type),a.bindTexture(a.TEXTURE_CUBE_MAP,o.DEFAULT_TEXTURE),this._valid=a.isTexture(this._object),this.context.allocationRegister.reallocate(this._identifier,0),this._object}delete(){u.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._size=0}cropImage(n,i,c,s,a){const h=document.createElement("canvas");h.width=s,h.height=a;const g=h.getContext("2d");return g?(g.drawImage(n,i,c,s,a,0,0,s,a),g.getImageData(0,0,s,a)):(console.log(u.LogLevel.Warning,"2D context creation failed when cropping image."),new ImageData(0,0))}extractMipLevelFromAtlas(n,i){const c=this.context.gl,s=n.height/2*Math.pow(.5,i),a=[0,0],h=[n.width,n.height];for(let L=0;L<i;++L)h[0]/=2,h[1]/=2,a[0]+=h[0],a[1]+=h[1];c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0);const g=this.cropImage(n,a[0],a[1],s,s);this.data([c.TEXTURE_CUBE_MAP_NEGATIVE_X,g],i);const _=this.cropImage(n,a[0]+s,a[1],s,s);this.data([c.TEXTURE_CUBE_MAP_POSITIVE_Z,_],i);const T=this.cropImage(n,a[0]+2*s,a[1],s,s);this.data([c.TEXTURE_CUBE_MAP_POSITIVE_X,T],i);const y=this.cropImage(n,a[0]+3*s,a[1],s,s);this.data([c.TEXTURE_CUBE_MAP_NEGATIVE_Z,y],i);const A=this.cropImage(n,a[0],a[1]+s,s,s);this.data([c.TEXTURE_CUBE_MAP_POSITIVE_Y,A],i);const w=this.cropImage(n,a[0]+s,a[1]+s,s,s);this.data([c.TEXTURE_CUBE_MAP_NEGATIVE_Y,w],i),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1)}bind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_CUBE_MAP,this._object)}unbind(n){const i=this.context.gl;n&&i.activeTexture(n),i.bindTexture(i.TEXTURE_CUBE_MAP,o.DEFAULT_TEXTURE)}fetch(n,i=!1,c=0){const s=this.context.gl;return new Promise((a,h)=>{const g=new Array;n.positiveX&&g.push([s.TEXTURE_CUBE_MAP_POSITIVE_X,n.positiveX]),n.negativeX&&g.push([s.TEXTURE_CUBE_MAP_NEGATIVE_X,n.negativeX]),n.positiveY&&g.push([s.TEXTURE_CUBE_MAP_POSITIVE_Y,n.positiveY]),n.negativeY&&g.push([s.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.negativeY]),n.positiveZ&&g.push([s.TEXTURE_CUBE_MAP_POSITIVE_Z,n.positiveZ]),n.negativeZ&&g.push([s.TEXTURE_CUBE_MAP_NEGATIVE_Z,n.negativeZ]);let _=g.length;for(const T of g){const y=new Image;y.crossOrigin="anonymous",y.onerror=()=>h(),y.onload=()=>{const A=this.calculateMipLevelSize(c);y.width===y.height?y.width===A?(s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),this.data([T[0],y],c),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),_-=1,_===0&&a()):u.log(u.LogLevel.Warning,`image ignored, width and height expected to match this texture's size ${A}, given ${y.width}`):u.log(u.LogLevel.Warning,"image ignored, width and height expected to be equal (square image)")},i&&(y.crossOrigin="anonymous"),y.src=T[1]}})}fetchMipmapAtlas(n,i=!1){return new Promise((c,s)=>{const a=new Image;a.onerror=()=>s(),a.onload=()=>{if(a.width!==2*a.height)return void u.log(u.LogLevel.Warning,"Mipmap atlas expected to have dimensions of 2x1.");const h=a.height/2,g=Math.log2(h);for(let _=0;_<g;++_)this.extractMipLevelFromAtlas(a,_);c()},i&&(a.crossOrigin="anonymous"),a.src=n})}calculateMipLevelSize(n){return this._size*Math.pow(.5,n)}data(n,i=0,c=!0,s=!0){const a=this.context.gl,h=this.context.gl2facade,g=this.calculateMipLevelSize(i);let _=g*g*b.byteSizeOfFormat(this.context,this._internalFormat);if(this._type===this.context.gl2facade.HALF_FLOAT&&this._internalFormat!==this.context.gl.RGBA16F?_*=2:this._type===this.context.gl.FLOAT&&this._internalFormat!==this.context.gl.RGBA16F&&(_*=4),c&&this.bind(),n instanceof Array&&n.length===2){h.texImage2D(n[0],i,this._internalFormat,g,g,0,this._format,this._type,n[1]);const T=this.faceID(n[0]);this.context.allocationRegister.deallocate(this._identifier,this._bytes[T]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[T]=_}else{const T=n;T.positiveX!==void 0&&(h.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,i,this._internalFormat,g,g,0,this._format,this._type,T.positiveX),this.context.allocationRegister.deallocate(this._identifier,this._bytes[0]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[0]=_),T.negativeX!==void 0&&(h.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,i,this._internalFormat,g,g,0,this._format,this._type,T.negativeX),this.context.allocationRegister.deallocate(this._identifier,this._bytes[1]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[1]=_),T.positiveY!==void 0&&(h.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,i,this._internalFormat,g,g,0,this._format,this._type,T.positiveY),this.context.allocationRegister.deallocate(this._identifier,this._bytes[2]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[2]=_),T.negativeY!==void 0&&(h.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,i,this._internalFormat,g,g,0,this._format,this._type,T.negativeY),this.context.allocationRegister.deallocate(this._identifier,this._bytes[3]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[3]=_),T.positiveZ!==void 0&&(h.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,i,this._internalFormat,g,g,0,this._format,this._type,T.positiveZ),this.context.allocationRegister.deallocate(this._identifier,this._bytes[4]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[4]=_),T.negativeZ!==void 0&&(h.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,i,this._internalFormat,g,g,0,this._format,this._type,T.negativeZ),this.context.allocationRegister.deallocate(this._identifier,this._bytes[5]),this.context.allocationRegister.allocate(this._identifier,_),this._bytes[5]=_)}s&&this.unbind()}filter(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,i),s&&this.unbind()}wrap(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,i),s&&this.unbind()}levels(n,i,c=!0,s=!0){const a=this.context.gl;c&&this.bind(),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_BASE_LEVEL,n),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAX_LEVEL,i),s&&this.unbind()}reformat(n,i,c,s=!0,a=!0){(n!==this._internalFormat||i!==void 0&&i!==this._format||c!==void 0&&c!==this._type)&&(u.assert(n!==void 0,"valid internal format expected"),this._internalFormat=n,i&&(this._format=i),c&&(this._type=c),this.data({clearOnUndefined:!0},0,s,a))}resize(n,i=!0,c=!0){n!==this._size&&(this._size=n,this.data({clearOnUndefined:!0},0,i,c))}get bytes(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)}get internalFormat(){return this.assertInitialized(),this._internalFormat}get format(){return this.assertInitialized(),this._format}get type(){return this.assertInitialized(),this._type}get size(){return this.assertInitialized(),this._size}}o.DEFAULT_TEXTURE=void 0,d([m.Initializable.assert_initialized()],o.prototype,"bind",null),d([m.Initializable.assert_initialized()],o.prototype,"unbind",null),d([m.Initializable.assert_initialized()],o.prototype,"fetch",null),d([m.Initializable.assert_initialized()],o.prototype,"fetchMipmapAtlas",null),d([m.Initializable.assert_initialized()],o.prototype,"data",null),d([m.Initializable.assert_initialized()],o.prototype,"filter",null),d([m.Initializable.assert_initialized()],o.prototype,"wrap",null),d([m.Initializable.assert_initialized()],o.prototype,"levels",null),d([m.Initializable.assert_initialized()],o.prototype,"reformat",null),d([m.Initializable.assert_initialized()],o.prototype,"resize",null),p.TextureCube=o},339:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.TileCameraGenerator=void 0;const d=v(3659),u=v(2111),b=v(9696);class m{constructor(){this._tileSize=[0,0],this._padding=d.vec4.fromValues(0,0,0,0),this._tile=-1,this._algorithm=m.Algorithm.ScanLine,this._offset=[0,0]}static hilbertIndices(o,r,n,i,c,s,a,h,g,_,T){if(_>0)return T=this.hilbertIndices(o,r,n,i,c,h/2,g/2,s/2,a/2,_-1,T),T=this.hilbertIndices(o,r,n,i+s/2,c+a/2,s/2,a/2,h/2,g/2,_-1,T),T=this.hilbertIndices(o,r,n,i+s/2+h/2,c+a/2+g/2,s/2,a/2,h/2,g/2,_-1,T),this.hilbertIndices(o,r,n,i+s/2+h,c+a/2+g,-h/2,-g/2,-s/2,-a/2,_-1,T);if(c+=(a+g-1)/2,(i+=(s+h-1)/2)<r&&c<n){const y=2*T;o[y+0]=i,o[y+1]=c,++T}return T}static generateHilbertIndices(o,r,n){b.assert(o.length===2*r*n,`expected interleaved indices-array of length ${2*r*n}, given ${o.length}`);const i=Math.max(r,n),c=Math.ceil(Math.log2(i)),s=b.upperPowerOfTwo(i);this.hilbertIndices(o,r,n,0,0,s,0,0,s,c,0)}static generateScanLineIndices(o,r,n){b.assert(o.length===2*r*n,`expected interleaved indices-array of length ${2*r*n}, given ${o.length}`);for(let i=0;i<n;++i)for(let c=0;c<r;++c){const s=2*(c+i*r);o[s+0]=c,o[s+1]=i}}static generateZCurveIndices(o,r,n){b.assert(o.length===2*r*n,`expected interleaved indices-array of length ${2*r*n}, given ${o.length}`);const i=Math.max(r,n),c=2*Math.floor(Math.log2(i));let s=0;for(let a=0;a<r*n;++s){let h=0,g=0;for(let _=0;_<c;++_)h+=(s>>2*_&1)<<_,g+=(s>>2*_+1&1)<<_;if(h<r&&g<n){const _=2*a;o[_+0]=h,o[_+1]=g,++a}}}invalidate(o){o&&(this._indices=new Uint16Array(0)),this._valid=!1}ensureValidIterationIndices(){if(!(this._indices.length>0))switch(this._indices=new Uint16Array(2*this.numTiles),this._algorithm){case m.Algorithm.ScanLine:m.generateScanLineIndices(this._indices,this.numXTiles,this.numYTiles);break;case m.Algorithm.HilbertCurve:m.generateHilbertIndices(this._indices,this.numXTiles,this.numYTiles);break;case m.Algorithm.ZCurve:m.generateZCurveIndices(this._indices,this.numXTiles,this.numYTiles);break;default:m.generateScanLineIndices(this._indices,this.numXTiles,this.numYTiles)}}tableIndices(){this.ensureValidIterationIndices();const o=2*this.tile;return[this._indices[o+0],this._indices[o+1]]}getPaddedTileSize(){return[this.padding[1]+this.padding[3]+this.tileSize[0],this.padding[0]+this.padding[2]+this.tileSize[1]]}nextTile(){return!(this.tile>=this.numTiles-1||(this.tile<0&&(this.tile=-1),++this.tile,this.update(),0))}hasNextTile(){return this.tile<=this.numTiles-1&&this.tile>=0}reset(){this.tile=-1,this._offset[0]=0,this._offset[1]=0}sourceCameraChanged(){b.assert(this._sourceCamera!==void 0,"expected the unput/source camera to be defined"),this._camera=Object.create(this._sourceCamera)}update(){if(this._valid)return this._offset;if(this.numTiles<=this.tile||0>this.tile)return b.log(b.LogLevel.Warning,`index ${this.tile} is out of bounds ${this.numTiles}, returning first tile`),this._offset;b.assert(this._sourceViewport!==void 0&&this._sourceCamera!==void 0,"expected source camera and source viewport to be defined before updating"),this._valid=!0;const o=this.tableIndices(),r=this.sourceViewport,n=this.getPaddedTileSize(),i=[0,0];i[0]=o[0]*this.tileSize[0]+n[0]/2,i[1]=o[1]*this.tileSize[1]+n[1]/2;const c=[0,0];c[0]=o[0]*this.tileSize[0],c[1]=o[1]*this.tileSize[1];const s=[2*i[0]/r[0]-1,2*i[1]/r[1]-1],a=d.vec3.fromValues(r[0]/n[0],r[1]/n[1],1),h=d.vec3.fromValues(-s[0],-s[1],0),g=d.mat4.scale(u.m4(),d.mat4.identity(u.m4()),a),_=d.mat4.translate(u.m4(),g,h);return this._camera.postViewProjection=_,this._offset=c,c}get valid(){return this._camera!==void 0&&this._sourceCamera!==void 0&&this._valid}get numXTiles(){return b.assert(this._sourceViewport!==void 0,"expected the source viewport to be defined"),Math.ceil(this.sourceViewport[0]/this.tileSize[0])}get numYTiles(){return b.assert(this._sourceViewport!==void 0,"expected the source viewport to be defined"),Math.ceil(this.sourceViewport[1]/this.tileSize[1])}get numTiles(){return this.numXTiles*this.numYTiles}get offset(){return this._offset}get camera(){return this._camera}get viewport(){return[this.offset[0],this.offset[1],this.tileSize[0],this.tileSize[1]]}get sourceCamera(){return this._sourceCamera}set sourceCamera(o){o!==void 0?(this._sourceCamera=o,this._camera=Object.create(o),this.invalidate(!1)):this._sourceCamera=this._camera=void 0}get tile(){return this._tile}set tile(o){this._tile!==o&&(this._tile=o,this.invalidate(!1))}get sourceViewport(){return this._sourceViewport}set sourceViewport(o){this._sourceViewport!==void 0&&o!==void 0&&this._sourceViewport[0]===o[0]&&this._sourceViewport[1]===o[1]||(this._sourceViewport=o,this.invalidate(!0))}get tileSize(){return this._tileSize}set tileSize(o){this._tileSize[0]===o[0]&&this._tileSize[1]===o[1]||(this._tileSize=o,this.invalidate(!0))}get padding(){return this._padding}set padding(o){d.vec4.equals(this._padding,o)||(this._padding=d.vec4.clone(o),this.invalidate(!1))}get algorithm(){return this._algorithm}set algorithm(o){this._algorithm!==o&&(this._algorithm=o,this.invalidate(!0))}}p.TileCameraGenerator=m,function(f){(function(o){o.ScanLine="scanline",o.HilbertCurve="hilbertcurve",o.ZCurve="zcurve"})(f.Algorithm||(f.Algorithm={}))}(m=p.TileCameraGenerator||(p.TileCameraGenerator={}))},4052:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.TouchEventProvider=void 0;const d=v(7318),u=v(9696);class b{constructor(f,o){u.assert(f!==void 0,`expected valid canvas element on initialization, given ${f}`),this._element=f,this._timeframe=o}preventDefaultOnEvent(f,o){u.bitInBitfield(this._preventDefaultMask,f)&&o.preventDefault()}preventDefault(...f){for(const o of f)u.bitInBitfield(this._preventDefaultMask,o)||(this._preventDefaultMask|=o)}allowDefault(...f){for(const o of f)u.bitInBitfield(this._preventDefaultMask,o)&&(this._preventDefaultMask&=~o)}observable(f){switch(f){case b.Type.Start:return this.start$;case b.Type.End:return this.end$;case b.Type.Move:return this.move$;case b.Type.Cancel:return this.cancel$}return u.assert(!1,"Encountered unknown touch event."),new d.Observable}get start$(){return this._startSubject===void 0&&(this._startSubject=new d.ReplaySubject(void 0,this._timeframe),this._startListener=f=>{this.preventDefaultOnEvent(b.Type.Start,f),this._startSubject.next(f)},this._element.addEventListener("touchstart",this._startListener)),this._startSubject.asObservable()}get end$(){return this._endSubject===void 0&&(this._endSubject=new d.ReplaySubject(void 0,this._timeframe),this._endListener=f=>{this.preventDefaultOnEvent(b.Type.End,f),this._endSubject.next(f)},this._element.addEventListener("touchend",this._endListener)),this._endSubject.asObservable()}get move$(){return this._moveSubject===void 0&&(this._moveSubject=new d.ReplaySubject(void 0,this._timeframe),this._moveListener=f=>{this.preventDefaultOnEvent(b.Type.Move,f),this._moveSubject.next(f)},this._element.addEventListener("touchmove",this._moveListener)),this._moveSubject.asObservable()}get cancel$(){return this._cancelSubject===void 0&&(this._cancelSubject=new d.ReplaySubject(void 0,this._timeframe),this._cancelListener=f=>{this.preventDefaultOnEvent(b.Type.Cancel,f),this._cancelSubject.next(f)},this._element.addEventListener("touchcancel",this._cancelListener)),this._cancelSubject.asObservable()}}p.TouchEventProvider=b,function(m){(function(f){f[f.Start=1]="Start",f[f.End=2]="End",f[f.Move=4]="Move",f[f.Cancel=8]="Cancel"})(m.Type||(m.Type={}))}(b=p.TouchEventProvider||(p.TouchEventProvider={}))},2763:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.TrackballModifier=void 0;const d=v(3659),u=v(2111),b=v(6491);class m extends b.CameraModifier{constructor(){super(...arguments),this._rotation=d.mat4.create(),this._sensitivity=m.DEFAULT_SENSITIVITY}initiate(o){this._initialPoint=o}process(o){this._currentPoint=o;const r=d.vec2.subtract(u.v2(),this._initialPoint,this._currentPoint);d.vec2.scale(r,r,window.devicePixelRatio*this._sensitivity),d.vec2.copy(this._initialPoint,this._currentPoint);const n=d.vec3.sub(u.v3(),this._reference.eye,this._reference.center);d.vec3.normalize(n,n);const i=d.vec3.normalize(u.v3(),this._reference.up),c=d.vec3.cross(u.v3(),n,i);d.vec3.scale(i,i,r[1]),d.vec3.scale(c,c,r[0]);const s=d.vec3.cross(u.v3(),d.vec3.add(u.v3(),i,c),n);d.vec3.normalize(s,s);const a=d.quat.setAxisAngle(d.quat.create(),s,d.vec2.len(r));d.mat4.multiply(this._rotation,this._rotation,d.mat4.fromQuat(u.m4(),a)),this.update()}update(){if(this._camera===void 0)return;const o=d.mat4.fromTranslation(u.m4(),this._reference.center);d.mat4.multiply(o,o,this._rotation),d.mat4.translate(o,o,d.vec3.negate(u.v3(),this._reference.center));const r=d.vec3.transformMat4(u.v3(),[0,1,0],this._rotation),n=d.vec3.transformMat4(u.v3(),this._reference.eye,o);this._camera.up=r,this._camera.eye=n}set sensitivity(o){this._sensitivity=o}get sensitivity(){return this._sensitivity}}p.TrackballModifier=m,m.DEFAULT_SENSITIVITY=.002},4934:(F,p,v)=>{const d=v(3659),u=v(2111),b=v(9696);var m;(function(f){function o(i){return b.assert(i.length===2,`expected length of buffer to be 2, given ${i.length}`),[i[0],i[1]]}function r(i){return b.assert(i.length===3,`expected length of buffer to be 3, given ${i.length}`),[i[0],i[1],i[2]]}function n(i){return b.assert(i.length===4,`expected length of buffer to be 4, given ${i.length}`),[i[0],i[1],i[2],i[3]]}f.tuple2=o,f.tuple3=r,f.tuple4=n,f.clampf=function(i,c){const s=u.clamp(i,0,1);return b.logIf(c!==void 0&&i<0||i>1,b.LogLevel.Info,`${c} clamped to [${s}], given [${i}]`),s},f.clampf2=function(i,c){const s=d.vec2.fromValues(i[0],i[1]);return(i[0]<0||i[0]>1||i[1]<0||i[1]>1)&&(u.clamp2(s,s,d.vec2.fromValues(0,0),d.vec2.fromValues(1,1)),b.logIf(c!==void 0,b.LogLevel.Info,`${c} clamped to [${s}], given [${i}]`)),o(s)},f.clampf3=function(i,c){const s=d.vec3.fromValues(i[0],i[1],i[2]);return(i[0]<0||i[0]>1||i[1]<0||i[1]>1||i[2]<0||i[2]>1)&&(u.clamp3(s,s,d.vec3.fromValues(0,0,0),d.vec3.fromValues(1,1,1)),b.logIf(c!==void 0,b.LogLevel.Info,`${c} clamped to [${s}], given [${i}]`)),r(s)},f.clampf4=function(i,c){const s=d.vec4.fromValues(i[0],i[1],i[2],i[3]);return(i[0]<0||i[0]>1||i[1]<0||i[1]>1||i[2]<0||i[2]>1||i[3]<0||i[3]>1)&&(u.clamp4(s,s,d.vec4.fromValues(0,0,0,0),d.vec4.fromValues(1,1,1,1)),b.logIf(c!==void 0,b.LogLevel.Info,`${c} clamped to [${s}], given [${i}]`)),n(s)},f.duplicate2=function(i){return[i[0],i[1]]},f.duplicate3=function(i){return[i[0],i[1],i[2]]},f.duplicate4=function(i){return[i[0],i[1],i[2],i[3]]},f.equals2=function(i,c){return i[0]===c[0]&&i[1]===c[1]},f.equals3=function(i,c){return i[0]===c[0]&&i[1]===c[1]&&i[2]===c[2]},f.equals4=function(i,c){return i[0]===c[0]&&i[1]===c[1]&&i[2]===c[2]&&i[3]===c[3]}})(m||(m={})),F.exports=m},2783:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.TurntableModifier=void 0;const d=v(3659),u=v(2111),b=v(6491);class m extends b.CameraModifier{constructor(){super(...arguments),this._rotation=u.m4(),this._maxAzimuth=.5*+Math.PI-1e-4,this._minAzimuth=.5*-Math.PI+1e-4,this._xAxisScreenSpace=u.v3(),this._sensitivity=m.DEFAULT_SENSITIVITY}initiate(o){Object.assign(this._reference,this._camera),this._initialPoint=o;const r=d.vec3.sub(u.v3(),this._reference.eye,this._reference.center);d.vec3.normalize(r,r),this._xAxisScreenSpace=d.vec3.cross(u.v3(),[0,1,0],r),this._azimuth=Math.acos(d.vec3.dot(r,[0,1,0])),this._azimuth=.5*Math.PI-this._azimuth}process(o){this._currentPoint=o;const r=d.vec2.subtract(u.v2(),this._initialPoint,this._currentPoint);d.vec2.scale(r,r,window.devicePixelRatio*this._sensitivity),this._minAzimuth&&(r[1]=Math.min(this._azimuth-this._minAzimuth,r[1])),this._maxAzimuth&&(r[1]=Math.max(this._azimuth-this._maxAzimuth,r[1])),d.mat4.rotateY(this._rotation,u.m4(),r[0]),d.mat4.rotate(this._rotation,this._rotation,r[1],this._xAxisScreenSpace),this.update()}update(){if(this._camera===void 0)return;const o=d.mat4.fromTranslation(u.m4(),this._reference.center);d.mat4.multiply(o,o,this._rotation),d.mat4.translate(o,o,d.vec3.negate(u.v3(),this._reference.center));const r=d.vec3.transformMat4(u.v3(),[0,1,0],this._rotation),n=d.vec3.transformMat4(u.v3(),this._reference.eye,o);this._camera.up=r,this._camera.eye=n}set sensitivity(o){this._sensitivity=o}get sensitivity(){return this._sensitivity}}p.TurntableModifier=m,m.DEFAULT_SENSITIVITY=.002},1732:function(F,p,v){var d=this&&this.__decorate||function(f,o,r,n){var i,c=arguments.length,s=c<3?o:n===null?n=Object.getOwnPropertyDescriptor(o,r):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(f,o,r,n);else for(var a=f.length-1;a>=0;a--)(i=f[a])&&(s=(c<3?i(s):c>3?i(o,r,s):i(o,r))||s);return c>3&&s&&Object.defineProperty(o,r,s),s};Object.defineProperty(p,"__esModule",{value:!0}),p.UnifiedBuffer=void 0;const u=v(6404),b=v(1030);class m extends b.Initializable{constructor(o,r,n,i=0,c){super(),this._updates=new Array,this._cpuBuffer=new ArrayBuffer(r),this._gpuBuffer=new u.Buffer(o,c),this._usage=n,this._mergeThreshold=i}static updatesNeedMerge(o,r,n){return r.begin-o.end<n||n===-1}mergeUpdatesLeft(o){let r=0;const n=this._updates[o];for(let i=o-1;i>=0;i--){const c=this._updates[i];if(!m.updatesNeedMerge(c,n,this._mergeThreshold))break;n.begin=Math.min(n.begin,c.begin),n.end=Math.max(n.end,c.end),r++}return this._updates.splice(o-r,r),r+1}mergeUpdatesRight(o){let r=0;const n=this._updates[o];for(let i=o+1;i<this._updates.length;i++){const c=this._updates[i];if(!m.updatesNeedMerge(n,c,this._mergeThreshold))break;n.begin=Math.min(n.begin,c.begin),n.end=Math.max(n.end,c.end),r++}return this._updates.splice(o+1,r),r+1}addUpdate(o){const r=this._updates.findIndex(n=>o.begin<n.begin);r===-1?(this._updates.push(o),this.mergeUpdatesLeft(this._updates.length-1)):(this._updates.splice(r,0,o),this.mergeUpdatesRight(r),this.mergeUpdatesLeft(r))}initialize(o){return this._gpuBuffer.initialize(o)}uninitialize(){this._gpuBuffer.uninitialize()}bind(){this._gpuBuffer.bind()}unbind(){this._gpuBuffer.unbind()}attribEnable(o,r,n,i=!1,c=0,s=0,a=!0,h=!0){this._gpuBuffer.attribEnable(o,r,n,i,c,s,a,h)}attribDisable(o,r=!0,n=!0){this._gpuBuffer.attribDisable(o,r,n)}mergeSubDataRanges(){let o=0;for(;o<this._updates.length;)o+=this.mergeUpdatesRight(o)}subData(o,r){let n;n=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer).subarray(r.byteOffset,r.byteOffset+r.byteLength),new Uint8Array(this._cpuBuffer).set(n,o),this.addUpdate({begin:o,end:o+n.byteLength})}update(o=!1,r=!1){if(o&&this._gpuBuffer.bind(),this._gpuBuffer.bytes!==this._cpuBuffer.byteLength)this._gpuBuffer.data(this._cpuBuffer,this._usage);else{const n=new Uint8Array(this._cpuBuffer);for(const i of this._updates){const c=n.subarray(i.begin,i.end);this._gpuBuffer.subData(i.begin,c)}}r&&this._gpuBuffer.unbind(),this._updates.length=0}get size(){return this._cpuBuffer.byteLength}set size(o){const r=this._cpuBuffer;this._cpuBuffer=new ArrayBuffer(o);const n=new Uint8Array(r).slice(0,o);new Uint8Array(this._cpuBuffer).set(n)}get target(){return this.assertInitialized(),this._gpuBuffer.target}get usage(){return this._usage}set usage(o){this._usage=o}get mergeThreshold(){return this._mergeThreshold}set mergeThreshold(o){this._mergeThreshold=o}}d([b.Initializable.initialize()],m.prototype,"initialize",null),d([b.Initializable.uninitialize()],m.prototype,"uninitialize",null),d([b.Initializable.assert_initialized()],m.prototype,"bind",null),d([b.Initializable.assert_initialized()],m.prototype,"unbind",null),d([b.Initializable.assert_initialized()],m.prototype,"attribEnable",null),d([b.Initializable.assert_initialized()],m.prototype,"attribDisable",null),d([b.Initializable.assert_initialized()],m.prototype,"update",null),p.UnifiedBuffer=m},1271:(F,p)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.version=p.commit=p.branch=void 0,p.branch="master",p.commit="06087080e1bd757761ae46df4e64dbcead16d6a8",p.version="v0.7.5"},5590:function(F,p,v){var d=this&&this.__decorate||function(o,r,n,i){var c,s=arguments.length,a=s<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,r,n,i);else for(var h=o.length-1;h>=0;h--)(c=o[h])&&(a=(s<3?c(a):s>3?c(r,n,a):c(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a};Object.defineProperty(p,"__esModule",{value:!0}),p.VertexArray=void 0;const u=v(9696),b=v(1030),m=v(2281);class f extends m.AbstractObject{constructor(){super(...arguments),this._buffersBound=!1}create(r,n){if(this.context.isWebGL2||this.context.supportsVertexArrayObject){const i=this.context.gl2facade;this._object=i.createVertexArray(),this._valid=this._object!==void 0,this._bind=()=>{i.bindVertexArray(this.object),this._buffersBound||(r(),this._buffersBound=!0)},this._unbind=()=>i.bindVertexArray(f.DEFAULT_VERTEX_ARRAY)}else this._bind=()=>r(),this._unbind=()=>n(),this._valid=!0;return this._object}delete(){this.context.isWebGL2||this.context.supportsVertexArrayObject?(u.assert(this._object!==void 0,"expected WebGLVertexArrayObject object"),this._context.gl2facade.deleteVertexArray(this._object),this._object=void 0,this._valid=!1,this._buffersBound=!1):this._valid=!1}bind(){this._bind()}unbind(){this._unbind()}invalidate(){this._buffersBound=!1}}f.DEFAULT_VERTEX_ARRAY=void 0,d([b.Initializable.assert_initialized()],f.prototype,"bind",null),d([b.Initializable.assert_initialized()],f.prototype,"unbind",null),p.VertexArray=f},4333:F=>{var p;(function(v){v.EventBlocker=class{constructor(d,u){if(this._blockListenerByEvent=new Map,this._element=d,u!==void 0)for(const b of u)this.block(b)}block(d){this._blockListenerByEvent.has(d)||(this._blockListenerByEvent.set(d,u=>(u.preventDefault(),u.stopPropagation(),!1)),this._element.addEventListener(d,this._blockListenerByEvent.get(d)))}unblock(d){this._blockListenerByEvent.has(d)&&(this._element.removeEventListener(d,this._blockListenerByEvent.get(d)),this._blockListenerByEvent.delete(d))}}})(p||(p={})),F.exports=p},104:(F,p,v)=>{const d=v(9696);var u;(function(b){class m{static queryAndCacheAPI(){if(m._exit!==void 0)return;const o=window.document,r=[o.exitFullScreen,o.msExitFullscreen,o.mozCancelFullScreen,o.webkitExitFullscreen,void 0];let n=0;for(;n<r.length&&r[n]===void 0;++n);switch(n){case 0:m._exit=()=>o.exitFullScreen(),m._request=i=>i.requestFullscreen(),m._element=()=>o.fullscreenElement,m._event="fullscreenchange";break;case 1:m._exit=()=>o.msExitFullscreen(),m._request=i=>i.msRequestFullscreen(),m._element=()=>o.msFullscreenElement,m._event="msfullscreenchange";break;case 2:m._exit=()=>o.mozCancelFullScreen(),m._request=i=>i.mozRequestFullScreen(),m._element=()=>o.mozFullScreenElement,m._event="mozfullscreenchange";break;case 3:m._exit=()=>o.webkitExitFullscreen(),m._request=i=>i.webkitRequestFullscreen(),m._element=()=>o.webkitFullscreenElement,m._event="webkitfullscreenchange";break;default:d.assert(!1,"none of the following fullscreen apis was found: native, ms, moz, or webkit")}}static active(){return m._element()!==void 0&&m._element()!==null}static toggle(o,r){if(o===void 0)return;m.queryAndCacheAPI();const n=m.active();if(!n){const i=getComputedStyle(o);m._size[0]=i.width,m._size[1]=i.height}r&&r(),n?(m._callback=void 0,window.removeEventListener(m._event,m.removeEventListener),o.style.width=m._size[0],o.style.height=m._size[1]):(m._callback=r,window.addEventListener(m._event,m.addEventListener)),n?m._exit():m._request(o)}}m._size=["0","0"],m.addEventListener=()=>{window.removeEventListener(m._event,m.addEventListener),window.addEventListener(m._event,m.removeEventListener)},m.removeEventListener=()=>{m._callback&&(m._callback(),m._callback=void 0),window.removeEventListener(m._event,m.removeEventListener)},b.Fullscreen=m})(u||(u={})),F.exports=u},3613:function(F,p,v){var d=this&&this.__createBinding||(Object.create?function(_e,ge,Ee,we){we===void 0&&(we=Ee),Object.defineProperty(_e,we,{enumerable:!0,get:function(){return ge[Ee]}})}:function(_e,ge,Ee,we){we===void 0&&(we=Ee),_e[we]=ge[Ee]}),u=this&&this.__setModuleDefault||(Object.create?function(_e,ge){Object.defineProperty(_e,"default",{enumerable:!0,value:ge})}:function(_e,ge){_e.default=ge}),b=this&&this.__exportStar||function(_e,ge){for(var Ee in _e)Ee==="default"||Object.prototype.hasOwnProperty.call(ge,Ee)||d(ge,_e,Ee)},m=this&&this.__importStar||function(_e){if(_e&&_e.__esModule)return _e;var ge={};if(_e!=null)for(var Ee in _e)Ee!=="default"&&Object.prototype.hasOwnProperty.call(_e,Ee)&&d(ge,_e,Ee);return u(ge,_e),ge};Object.defineProperty(p,"__esModule",{value:!0}),p.KernelF32=p.RandomSquareKernel=p.AntiAliasingKernel=p.AbstractKernel=p.NdcFillingTriangle=p.NdcFillingRectangle=p.CanvasRecorder=p.WheelZoomModifier=p.PinchZoomModifier=p.TurntableModifier=p.TrackballModifier=p.PointerLock=p.PanModifier=p.FirstPersonModifier=p.Navigation=p.CameraModifier=p.TileCameraGenerator=p.Camera=p.Wizard=p.VertexArray=p.UnifiedBuffer=p.TextureCube=p.Texture2DArray=p.Texture3D=p.Texture2D=p.Shader=p.LoadingStatus=p.Renderer=p.Renderbuffer=p.Program=p.Geometry=p.Framebuffer=p.DefaultFramebuffer=p.ColorScale=p.Color=p.Buffer=p.EventHandler=p.PointerEventProvider=p.TouchEventProvider=p.MouseEventProvider=p.ChangeLookup=p.ExtensionsHash=p.ContextMasquerade=p.Initializable=p.Controller=p.Canvas=p.Context=p.version=p.commit=p.branch=void 0,p.tuples=p.gl_matrix_extensions=p.quat=p.mat4=p.mat3=p.mat2d=p.mat2=p.vec4=p.vec3=p.vec2=p.auxiliaries=p.FrameCapture=p.EyeGazeData=p.EyeGazeEventProvider=p.EyeGazeDataStreams=p.EyeGazeDataStream=p.ShadowPass=p.GaussFilter=p.ReadbackPass=p.EnvironmentTextureType=p.EnvironmentRenderingPass=p.DebugPass=p.BlitPass=p.AccumulatePass=p.KernelUI8=p.KernelUI32=p.KernelI8=p.KernelI32=void 0;var f=v(1271);Object.defineProperty(p,"branch",{enumerable:!0,get:function(){return f.branch}}),Object.defineProperty(p,"commit",{enumerable:!0,get:function(){return f.commit}}),Object.defineProperty(p,"version",{enumerable:!0,get:function(){return f.version}});var o=v(4518);Object.defineProperty(p,"Context",{enumerable:!0,get:function(){return o.Context}});var r=v(7063);Object.defineProperty(p,"Canvas",{enumerable:!0,get:function(){return r.Canvas}});var n=v(3863);Object.defineProperty(p,"Controller",{enumerable:!0,get:function(){return n.Controller}});var i=v(1030);Object.defineProperty(p,"Initializable",{enumerable:!0,get:function(){return i.Initializable}});var c=v(1985);Object.defineProperty(p,"ContextMasquerade",{enumerable:!0,get:function(){return c.ContextMasquerade}});var s=v(9568);Object.defineProperty(p,"ExtensionsHash",{enumerable:!0,get:function(){return s.ExtensionsHash}});var a=v(4597);Object.defineProperty(p,"ChangeLookup",{enumerable:!0,get:function(){return a.ChangeLookup}});var h=v(4841);Object.defineProperty(p,"MouseEventProvider",{enumerable:!0,get:function(){return h.MouseEventProvider}});var g=v(4052);Object.defineProperty(p,"TouchEventProvider",{enumerable:!0,get:function(){return g.TouchEventProvider}});var _=v(8319);Object.defineProperty(p,"PointerEventProvider",{enumerable:!0,get:function(){return _.PointerEventProvider}});var T=v(7595);Object.defineProperty(p,"EventHandler",{enumerable:!0,get:function(){return T.EventHandler}});var y=v(6404);Object.defineProperty(p,"Buffer",{enumerable:!0,get:function(){return y.Buffer}});var A=v(7677);Object.defineProperty(p,"Color",{enumerable:!0,get:function(){return A.Color}});var w=v(5252);Object.defineProperty(p,"ColorScale",{enumerable:!0,get:function(){return w.ColorScale}});var L=v(6786);Object.defineProperty(p,"DefaultFramebuffer",{enumerable:!0,get:function(){return L.DefaultFramebuffer}});var D=v(9564);Object.defineProperty(p,"Framebuffer",{enumerable:!0,get:function(){return D.Framebuffer}});var j=v(4894);Object.defineProperty(p,"Geometry",{enumerable:!0,get:function(){return j.Geometry}});var V=v(4895);Object.defineProperty(p,"Program",{enumerable:!0,get:function(){return V.Program}});var G=v(7540);Object.defineProperty(p,"Renderbuffer",{enumerable:!0,get:function(){return G.Renderbuffer}});var W=v(3205);Object.defineProperty(p,"Renderer",{enumerable:!0,get:function(){return W.Renderer}}),Object.defineProperty(p,"LoadingStatus",{enumerable:!0,get:function(){return W.LoadingStatus}});var H=v(5263);Object.defineProperty(p,"Shader",{enumerable:!0,get:function(){return H.Shader}});var q=v(6942);Object.defineProperty(p,"Texture2D",{enumerable:!0,get:function(){return q.Texture2D}});var Z=v(7344);Object.defineProperty(p,"Texture3D",{enumerable:!0,get:function(){return Z.Texture3D}});var $=v(4850);Object.defineProperty(p,"Texture2DArray",{enumerable:!0,get:function(){return $.Texture2DArray}});var J=v(945);Object.defineProperty(p,"TextureCube",{enumerable:!0,get:function(){return J.TextureCube}});var se=v(1732);Object.defineProperty(p,"UnifiedBuffer",{enumerable:!0,get:function(){return se.UnifiedBuffer}});var Q=v(5590);Object.defineProperty(p,"VertexArray",{enumerable:!0,get:function(){return Q.VertexArray}});var ae=v(1284);Object.defineProperty(p,"Wizard",{enumerable:!0,get:function(){return ae.Wizard}});var me=v(4082);Object.defineProperty(p,"Camera",{enumerable:!0,get:function(){return me.Camera}});var he=v(339);Object.defineProperty(p,"TileCameraGenerator",{enumerable:!0,get:function(){return he.TileCameraGenerator}});var xe=v(6491);Object.defineProperty(p,"CameraModifier",{enumerable:!0,get:function(){return xe.CameraModifier}});var Y=v(8652);Object.defineProperty(p,"Navigation",{enumerable:!0,get:function(){return Y.Navigation}});var be=v(9870);Object.defineProperty(p,"FirstPersonModifier",{enumerable:!0,get:function(){return be.FirstPersonModifier}});var ve=v(8287);Object.defineProperty(p,"PanModifier",{enumerable:!0,get:function(){return ve.PanModifier}});var ze=v(9258);Object.defineProperty(p,"PointerLock",{enumerable:!0,get:function(){return ze.PointerLock}});var Ae=v(2763);Object.defineProperty(p,"TrackballModifier",{enumerable:!0,get:function(){return Ae.TrackballModifier}});var ye=v(2783);Object.defineProperty(p,"TurntableModifier",{enumerable:!0,get:function(){return ye.TurntableModifier}});var Te=v(8357);Object.defineProperty(p,"PinchZoomModifier",{enumerable:!0,get:function(){return Te.PinchZoomModifier}});var Le=v(9817);Object.defineProperty(p,"WheelZoomModifier",{enumerable:!0,get:function(){return Le.WheelZoomModifier}});var Ge=v(6233);Object.defineProperty(p,"CanvasRecorder",{enumerable:!0,get:function(){return Ge.CanvasRecorder}});var Pe=v(7429);Object.defineProperty(p,"NdcFillingRectangle",{enumerable:!0,get:function(){return Pe.NdcFillingRectangle}});var Ne=v(7570);Object.defineProperty(p,"NdcFillingTriangle",{enumerable:!0,get:function(){return Ne.NdcFillingTriangle}});var Be=v(4563);Object.defineProperty(p,"AbstractKernel",{enumerable:!0,get:function(){return Be.AbstractKernel}});var Ie=v(3411);Object.defineProperty(p,"AntiAliasingKernel",{enumerable:!0,get:function(){return Ie.AntiAliasingKernel}});var je=v(5785);Object.defineProperty(p,"RandomSquareKernel",{enumerable:!0,get:function(){return je.RandomSquareKernel}});var Ce=v(4563);Object.defineProperty(p,"KernelF32",{enumerable:!0,get:function(){return Ce.KernelF32}}),Object.defineProperty(p,"KernelI32",{enumerable:!0,get:function(){return Ce.KernelI32}}),Object.defineProperty(p,"KernelI8",{enumerable:!0,get:function(){return Ce.KernelI8}}),Object.defineProperty(p,"KernelUI32",{enumerable:!0,get:function(){return Ce.KernelUI32}}),Object.defineProperty(p,"KernelUI8",{enumerable:!0,get:function(){return Ce.KernelUI8}});var Xe=v(3666);Object.defineProperty(p,"AccumulatePass",{enumerable:!0,get:function(){return Xe.AccumulatePass}});var Je=v(4073);Object.defineProperty(p,"BlitPass",{enumerable:!0,get:function(){return Je.BlitPass}});var Qe=v(26);Object.defineProperty(p,"DebugPass",{enumerable:!0,get:function(){return Qe.DebugPass}});var We=v(172);Object.defineProperty(p,"EnvironmentRenderingPass",{enumerable:!0,get:function(){return We.EnvironmentRenderingPass}}),Object.defineProperty(p,"EnvironmentTextureType",{enumerable:!0,get:function(){return We.EnvironmentTextureType}});var et=v(9314);Object.defineProperty(p,"ReadbackPass",{enumerable:!0,get:function(){return et.ReadbackPass}});var tt=v(5714);Object.defineProperty(p,"GaussFilter",{enumerable:!0,get:function(){return tt.GaussFilter}});var rt=v(6210);Object.defineProperty(p,"ShadowPass",{enumerable:!0,get:function(){return rt.ShadowPass}});var He=v(378);Object.defineProperty(p,"EyeGazeDataStream",{enumerable:!0,get:function(){return He.EyeGazeDataStream}}),Object.defineProperty(p,"EyeGazeDataStreams",{enumerable:!0,get:function(){return He.EyeGazeDataStreams}});var it=v(5838);Object.defineProperty(p,"EyeGazeEventProvider",{enumerable:!0,get:function(){return it.EyeGazeEventProvider}});var nt=v(2497);Object.defineProperty(p,"EyeGazeData",{enumerable:!0,get:function(){return nt.EyeGazeData}});var $e=v(9544);Object.defineProperty(p,"FrameCapture",{enumerable:!0,get:function(){return $e.FrameCapture}}),b(v(2194),p),b(v(9922),p),b(v(2709),p);const st=m(v(9696));p.auxiliaries=st;var Ue=v(3659);Object.defineProperty(p,"vec2",{enumerable:!0,get:function(){return Ue.vec2}}),Object.defineProperty(p,"vec3",{enumerable:!0,get:function(){return Ue.vec3}}),Object.defineProperty(p,"vec4",{enumerable:!0,get:function(){return Ue.vec4}});var De=v(3659);Object.defineProperty(p,"mat2",{enumerable:!0,get:function(){return De.mat2}}),Object.defineProperty(p,"mat2d",{enumerable:!0,get:function(){return De.mat2d}}),Object.defineProperty(p,"mat3",{enumerable:!0,get:function(){return De.mat3}}),Object.defineProperty(p,"mat4",{enumerable:!0,get:function(){return De.mat4}});var at=v(3659);Object.defineProperty(p,"quat",{enumerable:!0,get:function(){return at.quat}});const ot=m(v(2111));p.gl_matrix_extensions=ot;const ct=m(v(4934));p.tuples=ct},9515:function(F,p,v){var d=this&&this.__createBinding||(Object.create?function(s,a,h,g){g===void 0&&(g=h),Object.defineProperty(s,g,{enumerable:!0,get:function(){return a[h]}})}:function(s,a,h,g){g===void 0&&(g=h),s[g]=a[h]}),u=this&&this.__setModuleDefault||(Object.create?function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}:function(s,a){s.default=a}),b=this&&this.__exportStar||function(s,a){for(var h in s)h==="default"||Object.prototype.hasOwnProperty.call(a,h)||d(a,s,h)},m=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var a={};if(s!=null)for(var h in s)h!=="default"&&Object.prototype.hasOwnProperty.call(s,h)&&d(a,s,h);return u(a,s),a};Object.defineProperty(p,"__esModule",{value:!0}),p.viewer=p.ray_math=p.fetch=p.properties=void 0,b(v(3613),p),b(v(3733),p);const f=m(v(3607));p.properties=f;const o=m(v(6869));p.fetch=o;const r=m(v(3942));p.ray_math=r,b(v(7491),p);const n=m(v(4333)),i=m(v(104));var c;(c=p.viewer||(p.viewer={})).EventBlocker=n.EventBlocker,c.Fullscreen=i.Fullscreen},9817:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.WheelZoomModifier=void 0;const d=v(3659),u=v(2111),b=v(6491);class m extends b.CameraModifier{constructor(){super(...arguments),this._sensitivity=m.DEFAULT_SENSITIVITY,this._translation=u.v3()}process(o){Object.assign(this._reference,this._camera);const r=o*this._sensitivity,n=d.vec3.sub(u.v3(),this._reference.center,this._reference.eye);d.vec3.normalize(n,n),this._translation=d.vec3.scale(u.v3(),n,r),this.update()}update(){if(this._camera===void 0)return;const o=d.mat4.fromTranslation(u.m4(),this._translation),r=d.vec3.transformMat4(u.v3(),this._reference.eye,o);this._camera.eye=r}}p.WheelZoomModifier=m,m.DEFAULT_SENSITIVITY=.2},1284:(F,p,v)=>{Object.defineProperty(p,"__esModule",{value:!0}),p.Wizard=void 0;const d=v(9696);class u{static queryPrecisionSupport(m,f){const o=m.gl,r=m.gl2facade,n=m.isWebGL1&&m.supportsTextureFloat||m.isWebGL2&&m.supportsColorBufferFloat,i=m.isWebGL1&&m.supportsTextureHalfFloat||m.isWebGL2&&m.supportsColorBufferFloat;let c=f;return f in u.Precision||(d.log(d.LogLevel.Warning,`unknown precision '${c}' changed to '${u.Precision.auto}'`),f=u.Precision.auto),f===u.Precision.auto&&(c=n?u.Precision.float:i?u.Precision.half:u.Precision.byte),c===u.Precision.half&&i?(m.isWebGL2?m.colorBufferFloat:m.textureHalfFloat,[c,r.HALF_FLOAT,1]):c!==u.Precision.float&&c!==u.Precision.half||!n?[c,o.UNSIGNED_BYTE,2]:(m.isWebGL2?m.colorBufferFloat:m.textureFloat,[c,o.FLOAT,0])}static queryInternalTextureFormat(m,f,o=u.Precision.auto){const[r,n,i]=this.queryPrecisionSupport(m,o),c=m.gl;if(m.isWebGL1)return d.assert([c.RGB,c.RGBA].includes(f),"target must be gl.RGB or gl.RGBA in WebGL 1"),[f,n,r];switch(f){case c.RGBA:return[[c.RGBA32F,c.RGBA16F,c.RGBA8][i],n,r];case c.RGB:return[[c.RGB32F,c.RGB16F,c.RGB8][i],n,r];case c.RG:return[[c.RG32F,c.RG16F,c.RG8][i],n,r];case c.RED:return[[c.R32F,c.R16F,c.R8][i],n,r];default:d.assert(!1,"internal format querying is not yet supported for formats other than RGBA, RGB")}return[c.NONE,c.NONE,r]}}p.Wizard=u,function(b){(function(m){m.float="float",m.half="half",m.byte="byte",m.auto="auto"})(b.Precision||(b.Precision={}))}(u=p.Wizard||(p.Wizard={}))},4760:(F,p,v)=>{var d=v(8770),u=v(569);function b(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}p.parse=y,p.resolve=function(A,w){return y(A,!1,!0).resolve(w)},p.resolveObject=function(A,w){return A?y(A,!1,!0).resolveObject(w):w},p.format=function(A){return u.isString(A)&&(A=y(A)),A instanceof b?A.format():b.prototype.format.call(A)},p.Url=b;var m=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),n=["'"].concat(r),i=["%","/","?",";","#"].concat(n),c=["/","?","#"],s=/^[+a-z0-9A-Z_-]{0,63}$/,a=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,h={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},_={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},T=v(8966);function y(A,w,L){if(A&&u.isObject(A)&&A instanceof b)return A;var D=new b;return D.parse(A,w,L),D}b.prototype.parse=function(A,w,L){if(!u.isString(A))throw new TypeError("Parameter 'url' must be a string, not "+typeof A);var D=A.indexOf("?"),j=D!==-1&&D<A.indexOf("#")?"?":"#",V=A.split(j);V[0]=V[0].replace(/\\/g,"/");var G=A=V.join(j);if(G=G.trim(),!L&&A.split("#").length===1){var W=o.exec(G);if(W)return this.path=G,this.href=G,this.pathname=W[1],W[2]?(this.search=W[2],this.query=w?T.parse(this.search.substr(1)):this.search.substr(1)):w&&(this.search="",this.query={}),this}var H=m.exec(G);if(H){var q=(H=H[0]).toLowerCase();this.protocol=q,G=G.substr(H.length)}if(L||H||G.match(/^\/\/[^@\/]+@[^@\/]+/)){var Z=G.substr(0,2)==="//";!Z||H&&g[H]||(G=G.substr(2),this.slashes=!0)}if(!g[H]&&(Z||H&&!_[H])){for(var $,J,se=-1,Q=0;Q<c.length;Q++)(ae=G.indexOf(c[Q]))!==-1&&(se===-1||ae<se)&&(se=ae);for((J=se===-1?G.lastIndexOf("@"):G.lastIndexOf("@",se))!==-1&&($=G.slice(0,J),G=G.slice(J+1),this.auth=decodeURIComponent($)),se=-1,Q=0;Q<i.length;Q++){var ae;(ae=G.indexOf(i[Q]))!==-1&&(se===-1||ae<se)&&(se=ae)}se===-1&&(se=G.length),this.host=G.slice(0,se),G=G.slice(se),this.parseHost(),this.hostname=this.hostname||"";var me=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!me)for(var he=this.hostname.split(/\./),xe=(Q=0,he.length);Q<xe;Q++){var Y=he[Q];if(Y&&!Y.match(s)){for(var be="",ve=0,ze=Y.length;ve<ze;ve++)Y.charCodeAt(ve)>127?be+="x":be+=Y[ve];if(!be.match(s)){var Ae=he.slice(0,Q),ye=he.slice(Q+1),Te=Y.match(a);Te&&(Ae.push(Te[1]),ye.unshift(Te[2])),ye.length&&(G="/"+ye.join(".")+G),this.hostname=Ae.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),me||(this.hostname=d.toASCII(this.hostname));var Le=this.port?":"+this.port:"",Ge=this.hostname||"";this.host=Ge+Le,this.href+=this.host,me&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),G[0]!=="/"&&(G="/"+G))}if(!h[q])for(Q=0,xe=n.length;Q<xe;Q++){var Pe=n[Q];if(G.indexOf(Pe)!==-1){var Ne=encodeURIComponent(Pe);Ne===Pe&&(Ne=escape(Pe)),G=G.split(Pe).join(Ne)}}var Be=G.indexOf("#");Be!==-1&&(this.hash=G.substr(Be),G=G.slice(0,Be));var Ie=G.indexOf("?");if(Ie!==-1?(this.search=G.substr(Ie),this.query=G.substr(Ie+1),w&&(this.query=T.parse(this.query)),G=G.slice(0,Ie)):w&&(this.search="",this.query={}),G&&(this.pathname=G),_[q]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){Le=this.pathname||"";var je=this.search||"";this.path=Le+je}return this.href=this.format(),this},b.prototype.format=function(){var A=this.auth||"";A&&(A=(A=encodeURIComponent(A)).replace(/%3A/i,":"),A+="@");var w=this.protocol||"",L=this.pathname||"",D=this.hash||"",j=!1,V="";this.host?j=A+this.host:this.hostname&&(j=A+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(j+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(V=T.stringify(this.query));var G=this.search||V&&"?"+V||"";return w&&w.substr(-1)!==":"&&(w+=":"),this.slashes||(!w||_[w])&&j!==!1?(j="//"+(j||""),L&&L.charAt(0)!=="/"&&(L="/"+L)):j||(j=""),D&&D.charAt(0)!=="#"&&(D="#"+D),G&&G.charAt(0)!=="?"&&(G="?"+G),w+j+(L=L.replace(/[?#]/g,function(W){return encodeURIComponent(W)}))+(G=G.replace("#","%23"))+D},b.prototype.resolve=function(A){return this.resolveObject(y(A,!1,!0)).format()},b.prototype.resolveObject=function(A){if(u.isString(A)){var w=new b;w.parse(A,!1,!0),A=w}for(var L=new b,D=Object.keys(this),j=0;j<D.length;j++){var V=D[j];L[V]=this[V]}if(L.hash=A.hash,A.href==="")return L.href=L.format(),L;if(A.slashes&&!A.protocol){for(var G=Object.keys(A),W=0;W<G.length;W++){var H=G[W];H!=="protocol"&&(L[H]=A[H])}return _[L.protocol]&&L.hostname&&!L.pathname&&(L.path=L.pathname="/"),L.href=L.format(),L}if(A.protocol&&A.protocol!==L.protocol){if(!_[A.protocol]){for(var q=Object.keys(A),Z=0;Z<q.length;Z++){var $=q[Z];L[$]=A[$]}return L.href=L.format(),L}if(L.protocol=A.protocol,A.host||g[A.protocol])L.pathname=A.pathname;else{for(var J=(A.pathname||"").split("/");J.length&&!(A.host=J.shift()););A.host||(A.host=""),A.hostname||(A.hostname=""),J[0]!==""&&J.unshift(""),J.length<2&&J.unshift(""),L.pathname=J.join("/")}if(L.search=A.search,L.query=A.query,L.host=A.host||"",L.auth=A.auth,L.hostname=A.hostname||A.host,L.port=A.port,L.pathname||L.search){var se=L.pathname||"",Q=L.search||"";L.path=se+Q}return L.slashes=L.slashes||A.slashes,L.href=L.format(),L}var ae=L.pathname&&L.pathname.charAt(0)==="/",me=A.host||A.pathname&&A.pathname.charAt(0)==="/",he=me||ae||L.host&&A.pathname,xe=he,Y=L.pathname&&L.pathname.split("/")||[],be=(J=A.pathname&&A.pathname.split("/")||[],L.protocol&&!_[L.protocol]);if(be&&(L.hostname="",L.port=null,L.host&&(Y[0]===""?Y[0]=L.host:Y.unshift(L.host)),L.host="",A.protocol&&(A.hostname=null,A.port=null,A.host&&(J[0]===""?J[0]=A.host:J.unshift(A.host)),A.host=null),he=he&&(J[0]===""||Y[0]==="")),me)L.host=A.host||A.host===""?A.host:L.host,L.hostname=A.hostname||A.hostname===""?A.hostname:L.hostname,L.search=A.search,L.query=A.query,Y=J;else if(J.length)Y||(Y=[]),Y.pop(),Y=Y.concat(J),L.search=A.search,L.query=A.query;else if(!u.isNullOrUndefined(A.search))return be&&(L.hostname=L.host=Y.shift(),(Te=!!(L.host&&L.host.indexOf("@")>0)&&L.host.split("@"))&&(L.auth=Te.shift(),L.host=L.hostname=Te.shift())),L.search=A.search,L.query=A.query,u.isNull(L.pathname)&&u.isNull(L.search)||(L.path=(L.pathname?L.pathname:"")+(L.search?L.search:"")),L.href=L.format(),L;if(!Y.length)return L.pathname=null,L.search?L.path="/"+L.search:L.path=null,L.href=L.format(),L;for(var ve=Y.slice(-1)[0],ze=(L.host||A.host||Y.length>1)&&(ve==="."||ve==="..")||ve==="",Ae=0,ye=Y.length;ye>=0;ye--)(ve=Y[ye])==="."?Y.splice(ye,1):ve===".."?(Y.splice(ye,1),Ae++):Ae&&(Y.splice(ye,1),Ae--);if(!he&&!xe)for(;Ae--;Ae)Y.unshift("..");!he||Y[0]===""||Y[0]&&Y[0].charAt(0)==="/"||Y.unshift(""),ze&&Y.join("/").substr(-1)!=="/"&&Y.push("");var Te,Le=Y[0]===""||Y[0]&&Y[0].charAt(0)==="/";return be&&(L.hostname=L.host=Le?"":Y.length?Y.shift():"",(Te=!!(L.host&&L.host.indexOf("@")>0)&&L.host.split("@"))&&(L.auth=Te.shift(),L.host=L.hostname=Te.shift())),(he=he||L.host&&Y.length)&&!Le&&Y.unshift(""),Y.length?L.pathname=Y.join("/"):(L.pathname=null,L.path=null),u.isNull(L.pathname)&&u.isNull(L.search)||(L.path=(L.pathname?L.pathname:"")+(L.search?L.search:"")),L.auth=A.auth||L.auth,L.slashes=L.slashes||A.slashes,L.href=L.format(),L},b.prototype.parseHost=function(){var A=this.host,w=f.exec(A);w&&((w=w[0])!==":"&&(this.port=w.substr(1)),A=A.substr(0,A.length-w.length)),A&&(this.hostname=A)}},569:F=>{F.exports={isString:function(p){return typeof p=="string"},isObject:function(p){return typeof p=="object"&&p!==null},isNull:function(p){return p===null},isNullOrUndefined:function(p){return p==null}}},9587:F=>{F.exports=`\r
precision lowp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
    #extension GL_OES_standard_derivatives : enable\r
#else \r
    layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
uniform int u_frameNumber;\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    vec3 color = vec3(28.0 / 255.0, 117.0 / 255.0, 188.0 / 255.0);\r
    color += (vec3(0.0, v_uv) - 0.5) * 0.125;\r
\r
    vec2 awidth = fwidth(v_uv) * (sin(float(u_frameNumber) * 0.1) * 7.0 + 8.0);\r
    vec2 cstep = abs(step(awidth, v_uv) - step(awidth, 1.0 - v_uv));\r
    if(!any(bvec2(cstep))) {\r
        discard;\r
    }\r
    fragColor = vec4(color, 1.0); \r
}\r
`},354:F=>{F.exports=`\r
precision lowp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
void ndcOffset(inout vec4 vertex, in vec2 offset) {\r
    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r
}\r
\r
\r
\r
#if __VERSION__ == 100\r
    attribute vec2 a_vertex;\r
#else \r
    layout(location = 0) in vec2 a_vertex;\r
#endif\r
\r
uniform vec2 u_ndcOffset;\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    v_uv = a_vertex.xy * 0.5 + 0.5;\r
\r
    vec4 vertex = vec4(a_vertex, 0.0, 1.0);\r
    ndcOffset(vertex, u_ndcOffset);\r
\r
    gl_Position = vertex;\r
}\r
`},6277:F=>{F.exports=`precision highp float;\r
\r
// Adapted from https://github.com/KhronosGroup/glTF-WebGL-PBR\r
// References:\r
// [1] Real Shading in Unreal Engine 4\r
//     http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\r
// [2] Physically Based Shading at Disney\r
//     http://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_notes_v3.pdf\r
// [3] README.md - Environment Maps\r
//     https://github.com/KhronosGroup/glTF-WebGL-PBR/#environment-maps\r
// [4] "An Inexpensive BRDF Model for Physically based Rendering" by Christophe Schlick\r
//     https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
#else\r
    layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
const int HAS_NORMALS           = 1;\r
const int HAS_TANGENTS          = 1 << 1;\r
const int HAS_UV                = 1 << 2;\r
const int HAS_COLORS            = 1 << 3;\r
const int USE_IBL               = 1 << 4;\r
const int HAS_BASECOLORMAP      = 1 << 5;\r
const int HAS_NORMALMAP         = 1 << 6;\r
const int HAS_EMISSIVEMAP       = 1 << 7;\r
const int HAS_METALROUGHNESSMAP = 1 << 8;\r
const int HAS_OCCLUSIONMAP      = 1 << 9;\r
const int USE_TEX_LOD           = 1 << 10;\r
\r
const vec3 u_LightDirection = vec3(0.2, 1.0, 0.2);\r
const vec3 u_LightColor = vec3(1, 1, 1);\r
\r
const float M_PI = 3.141592653589793;\r
const float c_MinRoughness = 0.04;\r
\r
uniform sampler2D u_baseColor;\r
uniform sampler2D u_metallicRoughness;\r
uniform sampler2D u_normal;\r
uniform sampler2D u_emissive;\r
uniform sampler2D u_occlusion;\r
\r
uniform samplerCube u_specularEnvironment;\r
uniform sampler2D u_brdfLUT;\r
\r
uniform int u_baseColorTexCoord;\r
uniform int u_normalTexCoord;\r
uniform int u_metallicRoughnessTexCoord;\r
uniform int u_occlusionTexCoord;\r
uniform int u_emissiveTexCoord;\r
\r
uniform vec4 u_baseColorFactor;\r
uniform float u_metallicFactor;\r
uniform float u_roughnessFactor;\r
uniform vec3 u_emissiveFactor;\r
uniform float u_normalScale;\r
uniform int u_blendMode;\r
uniform float u_blendCutoff;\r
\r
uniform mediump int u_geometryFlags;\r
uniform mediump int u_pbrFlags;\r
uniform vec3 u_eye;\r
\r
varying vec2 v_uv[3];\r
varying vec4 v_color;\r
varying vec3 v_position;\r
\r
varying mat3 v_TBN;\r
varying vec3 v_normal;\r
\r
// Encapsulate the various inputs used by the various functions in the shading equation\r
// We store values in this struct to simplify the integration of alternative implementations\r
// of the shading terms, outlined in the Readme.MD Appendix.\r
struct PBRInfo\r
{\r
    float NdotL;                  // cos angle between normal and light direction\r
    float NdotV;                  // cos angle between normal and view direction\r
    float NdotH;                  // cos angle between normal and half vector\r
    float LdotH;                  // cos angle between light direction and half vector\r
    float VdotH;                  // cos angle between view direction and half vector\r
    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\r
    float metalness;              // metallic value at the surface\r
    vec3 reflectance0;            // full reflectance color (normal incidence angle)\r
    vec3 reflectance90;           // reflectance color at grazing angle\r
    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\r
    vec3 diffuseColor;            // color contribution from diffuse lighting\r
    vec3 specularColor;           // color contribution from specular lighting\r
};\r
\r
bool checkGeometryFlag(int flag) {\r
    return (u_geometryFlags & flag) == flag;\r
}\r
\r
bool checkFlag(int flag) {\r
    return (u_pbrFlags & flag) == flag;\r
}\r
\r
vec4 SRGBtoLINEAR(vec4 srgbIn)\r
{\r
    #ifdef MANUAL_SRGB\r
    #ifdef SRGB_FAST_APPROXIMATION\r
    vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\r
    #else //SRGB_FAST_APPROXIMATION\r
    vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\r
    vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\r
    #endif //SRGB_FAST_APPROXIMATION\r
    return vec4(linOut,srgbIn.w);;\r
    #else //MANUAL_SRGB\r
    return srgbIn;\r
    #endif //MANUAL_SRGB\r
}\r
\r
// Find the normal for this fragment, pulling either from a predefined normal map\r
// or from the interpolated mesh normal and tangent attributes.\r
vec3 getNormal()\r
{\r
    // Retrieve the tangent space matrix\r
    mat3 tbn;\r
    if (!checkGeometryFlag(HAS_TANGENTS)) {\r
        vec3 pos_dx = dFdx(v_position);\r
        vec3 pos_dy = dFdy(v_position);\r
        vec3 tex_dx = dFdx(vec3(v_uv[0], 0.0));\r
        vec3 tex_dy = dFdy(vec3(v_uv[0], 0.0));\r
        vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\r
\r
        vec3 ng;\r
        if (checkGeometryFlag(HAS_NORMALS))\r
            ng = normalize(v_normal);\r
        else\r
            ng = cross(pos_dx, pos_dy);\r
\r
            t = normalize(t - ng * dot(ng, t));\r
            vec3 b = normalize(cross(ng, t));\r
            tbn = mat3(t, b, ng);\r
        }\r
    else { // HAS_TANGENTS\r
        tbn = v_TBN;\r
    }\r
\r
    vec3 n;\r
    if (checkFlag(HAS_NORMALMAP)) {\r
        n = texture(u_normal, v_uv[u_normalTexCoord]).rgb;\r
        n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_normalScale, u_normalScale, 1.0)));\r
    } else {\r
        // The tbn matrix is linearly interpolated, so we need to re-normalize\r
        n = normalize(tbn[2].xyz);\r
    }\r
\r
    // reverse backface normals\r
    n *= (2.0 * float(gl_FrontFacing) - 1.0);\r
\r
    return n;\r
}\r
\r
// Basic Lambertian diffuse\r
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog\r
// See also [1], Equation 1\r
vec3 diffuse(PBRInfo pbrInputs)\r
{\r
    return pbrInputs.diffuseColor / M_PI;\r
}\r
\r
 // The following equation models the Fresnel reflectance term of the spec equation (aka F())\r
// Implementation of fresnel from [4], Equation 15\r
vec3 specularReflection(PBRInfo pbrInputs)\r
{\r
    return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\r
}\r
\r
 // This calculates the specular geometric attenuation (aka G()),\r
// where rougher material will reflect less light back to the viewer.\r
// This implementation is based on [1] Equation 4, and we adopt their modifications to\r
// alphaRoughness as input as originally proposed in [2].\r
float geometricOcclusion(PBRInfo pbrInputs)\r
{\r
    float NdotL = pbrInputs.NdotL;\r
    float NdotV = pbrInputs.NdotV;\r
    float r = pbrInputs.alphaRoughness;\r
\r
    float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\r
    float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\r
    return attenuationL * attenuationV;\r
}\r
\r
 // The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\r
// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\r
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\r
float microfacetDistribution(PBRInfo pbrInputs)\r
{\r
    float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\r
    float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\r
    return roughnessSq / (M_PI * f * f);\r
}\r
\r
vec3 getIBLContribution(vec3 n, vec3 v, PBRInfo pbrInfo)\r
{\r
    float NdotV = clamp(dot(n, v), 0.0, 1.0);\r
\r
    // TODO: pass uniform for mip count\r
    const float MIP_COUNT = 8.0;\r
    float lod = clamp(pbrInfo.perceptualRoughness * MIP_COUNT, 0.0, MIP_COUNT);\r
    vec3 reflection = normalize(reflect(-v, n));\r
\r
    vec2 brdfSamplePoint = vec2(NdotV, pbrInfo.perceptualRoughness);\r
    vec2 brdf = texture(u_brdfLUT, brdfSamplePoint).rg;\r
\r
    // vec4 diffuseSample = textureCube(u_DiffuseEnvSampler, n);\r
    vec4 specularSample = textureLod(u_specularEnvironment, reflection, lod);\r
\r
    // vec3 diffuseLight = SRGBtoLINEAR(diffuseSample).rgb;\r
    vec3 specularLight = SRGBtoLINEAR(specularSample).rgb;\r
\r
    // vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;\r
    vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);\r
\r
    return specular;\r
    // return diffuse + specular;\r
}\r
\r
void main(void)\r
{\r
    float perceptualRoughness = u_roughnessFactor;\r
    float metallic = u_metallicFactor;\r
    if (checkFlag(HAS_METALROUGHNESSMAP)) {\r
        // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\r
        // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\r
        vec4 mrSample = texture(u_metallicRoughness, v_uv[u_metallicRoughnessTexCoord]);\r
        perceptualRoughness = mrSample.g * perceptualRoughness;\r
        metallic = mrSample.b * metallic;\r
    }\r
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\r
    metallic = clamp(metallic, 0.0, 1.0);\r
    // Roughness is authored as perceptual roughness; as is convention,\r
    // convert to material roughness by squaring the perceptual roughness [2].\r
    float alphaRoughness = perceptualRoughness * perceptualRoughness;\r
\r
     // The albedo may be defined from a base texture or a flat color\r
    vec4 baseColor;\r
    if (checkFlag(HAS_BASECOLORMAP)) {\r
        baseColor = SRGBtoLINEAR(texture(u_baseColor, v_uv[u_baseColorTexCoord])) * u_baseColorFactor;\r
    } else {\r
        baseColor = u_baseColorFactor;\r
    }\r
\r
    // spec: COLOR_0 ... acts as an additional linear multiplier to baseColor\r
    // TODO!: distinguish vec3/vec4 colors...\r
    baseColor *= vec4(v_color.rgb, 1.0);\r
\r
    vec3 f0 = vec3(0.04);\r
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\r
    diffuseColor *= 1.0 - metallic;\r
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\r
\r
    // Compute reflectance.\r
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\r
\r
    // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\r
    // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\r
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\r
    vec3 specularEnvironmentR0 = specularColor.rgb;\r
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\r
\r
    vec3 n = getNormal();                         // normal at surface point\r
    vec3 v = normalize(u_eye - v_position);        // Vector from surface point to camera\r
    vec3 l = normalize(u_LightDirection);          // Vector from surface point to light\r
    vec3 h = normalize(l+v);                       // Half vector between both l and v\r
    vec3 reflection = -normalize(reflect(v, n));\r
\r
    float NdotL = clamp(dot(n, l), 0.001, 1.0);\r
    float NdotV = abs(dot(n, v)) + 0.001;\r
    float NdotH = clamp(dot(n, h), 0.0, 1.0);\r
    float LdotH = clamp(dot(l, h), 0.0, 1.0);\r
    float VdotH = clamp(dot(v, h), 0.0, 1.0);\r
\r
    PBRInfo pbrInputs = PBRInfo(\r
        NdotL,\r
        NdotV,\r
        NdotH,\r
        LdotH,\r
        VdotH,\r
        perceptualRoughness,\r
        metallic,\r
        specularEnvironmentR0,\r
        specularEnvironmentR90,\r
        alphaRoughness,\r
        diffuseColor,\r
        specularColor\r
    );\r
\r
     // Calculate the shading terms for the microfacet specular shading model\r
    vec3 F = specularReflection(pbrInputs);\r
    float G = geometricOcclusion(pbrInputs);\r
    float D = microfacetDistribution(pbrInputs);\r
\r
     // Calculation of analytical lighting contribution\r
    vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\r
    vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);\r
    // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\r
    vec3 color = NdotL * u_LightColor * (diffuseContrib + specContrib);\r
\r
    vec3 environmentLight = getIBLContribution(n, v, pbrInputs);\r
    color += environmentLight;\r
\r
    if (checkFlag(HAS_EMISSIVEMAP)) {\r
        vec3 emissive = SRGBtoLINEAR(texture(u_emissive, v_uv[u_emissiveTexCoord])).rgb * u_emissiveFactor;\r
        color += emissive;\r
    }\r
\r
    // NOTE: the spec mandates to ignore any alpha value in 'OPAQUE' mode\r
    float alpha = 1.0;\r
    if (u_blendMode == 1) {\r
        if (baseColor.a < u_blendCutoff) {\r
            discard;\r
        }\r
    }\r
    else if (u_blendMode == 2) {\r
        alpha = baseColor.a;\r
    }\r
\r
    fragColor = vec4(pow(color, vec3(1.0/2.2)), alpha);\r
}\r
`},6263:F=>{F.exports=`precision highp float;\r
\r
// Adapted from https://github.com/KhronosGroup/glTF-WebGL-PBR\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
const int HAS_NORMALS           = 1;\r
const int HAS_TANGENTS          = 1 << 1;\r
const int HAS_UV                = 1 << 2;\r
const int HAS_COLORS            = 1 << 3;\r
\r
#if __VERSION__ == 100\r
    attribute vec4 a_position;\r
    attribute vec4 a_normal;\r
    attribute vec4 a_tangent;\r
    attribute vec2 a_texcoord_0;\r
    attribute vec2 a_texcoord_1;\r
    attribute vec2 a_texcoord_2;\r
    attribute vec4 a_joints;\r
    attribute vec4 a_weights;\r
    attribute vec4 a_color;\r
#else\r
    layout (location = 0) in vec4 a_position;\r
    layout (location = 1) in vec3 a_normal;\r
    layout (location = 2) in vec4 a_tangent;\r
    layout (location = 3) in vec2 a_texcoord_0;\r
    layout (location = 4) in vec2 a_texcoord_1;\r
    layout (location = 5) in vec2 a_texcoord_2;\r
    layout (location = 6) in vec4 a_joints;\r
    layout (location = 7) in vec4 a_weights;\r
    layout (location = 8) in vec4 a_color;\r
#endif\r
\r
uniform mat4 u_model;\r
uniform mat4 u_viewProjection;\r
uniform mat3 u_normalMatrix;\r
\r
uniform mediump int u_geometryFlags;\r
\r
varying vec2 v_uv[3];\r
varying vec4 v_color;\r
varying vec3 v_position;\r
\r
varying mat3 v_TBN;\r
varying vec3 v_normal;\r
\r
bool checkFlag(int flag) {\r
    return (u_geometryFlags & flag) == flag;\r
}\r
\r
void main(void)\r
{\r
    vec4 pos = u_model * a_position;\r
    v_position = vec3(pos.xyz) / pos.w;\r
\r
    if (checkFlag(HAS_NORMALS)) {\r
        if (checkFlag(HAS_TANGENTS)) {\r
            vec3 normalW = normalize(vec3(u_normalMatrix * a_normal));\r
            vec3 tangentW = normalize(vec3(u_model * vec4(a_tangent.xyz, 0.0)));\r
            vec3 bitangentW = cross(normalW, tangentW) * a_tangent.w;\r
            v_TBN = mat3(tangentW, bitangentW, normalW);\r
        } else { // HAS_TANGENTS != 1\r
            v_normal = normalize(vec3(u_model * vec4(a_normal.xyz, 0.0)));\r
        }\r
    }\r
\r
    if (checkFlag(HAS_UV)) {\r
        v_uv[0] = a_texcoord_0;\r
        v_uv[1] = a_texcoord_1;\r
        v_uv[2] = a_texcoord_2;\r
    } else {\r
        v_uv[0] = vec2(0., 0.);\r
        v_uv[1] = vec2(0., 0.);\r
        v_uv[2] = vec2(0., 0.);\r
    }\r
\r
    if (checkFlag(HAS_COLORS)) {\r
        v_color = a_color;\r
    } else {\r
        v_color = vec4(1.0);\r
    }\r
\r
    gl_Position = u_viewProjection * u_model * a_position;\r
}\r
`},3170:F=>{F.exports=`\r
precision lowp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
#else\r
    layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
\r
uniform float u_weight;\r
uniform sampler2D u_accumulationTexture;\r
uniform sampler2D u_currentFrameTexture;\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    vec4 accumulationColor = texture(u_accumulationTexture, v_uv);\r
    vec4 currentFrameColor = texture(u_currentFrameTexture, v_uv);\r
    fragColor = mix(accumulationColor, currentFrameColor, u_weight);\r
}\r
`},3717:F=>{F.exports=`\r
precision highp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
#else\r
    layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
\r
uniform sampler2D u_source;\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    fragColor = texture(u_source, v_uv);\r
}\r
`},985:F=>{F.exports=`\r
precision lowp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    attribute vec2 a_vertex;\r
#else\r
    layout(location = 0) in vec2 a_vertex;\r
#endif\r
\r
uniform vec4 u_srcBounds; // normalized\r
uniform vec4 u_dstBounds; // normalized\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    vec2 uv = a_vertex * 0.5 + 0.5;\r
\r
    v_uv = mix(u_srcBounds.xy, u_srcBounds.zw, uv);\r
    gl_Position = vec4(a_vertex.xy, 0.0, 1.0);\r
}\r
`},8356:F=>{F.exports=`\r
precision highp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
\r
const float one255ths = 1.0 / 255.0;\r
\r
vec3 float24x1_to_uint8x3(const in float f) {\r
    vec3 uint8x3 = vec3(f, fract(f * 256.0), fract(f * 65536.0));\r
    return floor(uint8x3 * 256.0) * one255ths;\r
}\r
\r
vec4 float24x1_to_uint8x4(const in float f) {\r
    vec4 uint8x4 = vec4(f, fract(f * 256.0), fract(f * 65536.0), fract(f * 16777216.0));\r
    return floor(uint8x4 * 256.0) * one255ths;\r
}\r
\r
const vec3 premultUint8x3 = vec3(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0);\r
float uint8x3_to_float24x1(const in vec3 v) {\r
    return dot(v, premultUint8x3); // a1 * b1 + a2 * b2 + a3 * b3  ;)\r
}\r
\r
const vec4 premultUint8x4 = vec4(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0, 255.0 / 4294967296.0);\r
float uint8x4_to_float32x1(const in vec4 v) {\r
    return dot(v, premultUint8x4); // a1 * b1 + a2 * b2 + a3 * b3 + a4 * b4  ;)\r
}\r
\r
\r
float linearizeDepth(float zInNDC, float near, float far) {\r
    float zLinear = 2.0 * near;\r
    zLinear /= far + near - zInNDC * (far - near);\r
    return zLinear;\r
}\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
#else\r
    layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
\r
uniform sampler2D u_source;\r
\r
uniform int u_mode; /* Debug mode. */\r
uniform vec2 u_linearize; /* [ zNear, zFar ] */\r
\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    vec4 source = texture(u_source, v_uv);\r
\r
    /* u_mode == 0                 None */\r
\r
    if(u_mode == 1) {           /* Depth */\r
        source.rgb = vec3(source[0]);\r
\r
    } else if (u_mode == 2) {   /* DepthLinear */\r
        float zLinear = linearizeDepth(source[0], u_linearize[0], u_linearize[1]);\r
        source.rgb = vec3(zLinear);\r
\r
    } else if(u_mode == 3) {    /* DepthPacked */\r
        source.rgb = float24x1_to_uint8x3(source[0]);\r
\r
    } else if (u_mode == 4) {   /* DepthLinearPacked */\r
        float zLinear = linearizeDepth(source[0], u_linearize[0], u_linearize[1]);\r
        source.rgb = float24x1_to_uint8x3(zLinear);\r
    }\r
\r
    fragColor = source;\r
}\r
`},4965:F=>{F.exports=`precision highp float;\r
precision highp int;\r
\r
/**\r
  To be replaced via Shader.replace();\r
 */\r
#define PROJECTION_TYPE\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
#else\r
    layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
\r
uniform int u_mode;\r
uniform bool u_skipLod;\r
\r
#if defined(CUBE_MAP)\r
    uniform samplerCube u_cubemap;\r
#elif defined(EQUI_MAP)\r
    uniform sampler2D u_equirectmap;\r
#elif defined(SPHERE_MAP)\r
    uniform sampler2D u_spheremap;\r
#elif defined(POLAR_MAP)\r
    uniform sampler2D u_polarmap[2];\r
#endif\r
\r
varying vec2 v_uv;\r
varying vec4 v_ray;\r
\r
\r
const float PI = 3.141592653589793;\r
const float OneOver2PI = 0.1591549430918953357688837633725;\r
const float OneOverPI  = 0.3183098861837906715377675267450;\r
\r
\r
void main(void)\r
{\r
    vec2 uv = v_uv;\r
    vec3 ray = normalize(v_ray.xyz);\r
\r
    #if defined(CUBE_MAP)\r
        #if __VERSION__ == 100\r
            fragColor = u_skipLod ? textureCubeLod(u_cubemap, vec3(ray), 0.0) : textureCube(u_cubemap, vec3(ray));\r
        #else\r
            fragColor = u_skipLod ? textureLod(u_cubemap, vec3(ray), 0.0) : texture(u_cubemap, vec3(ray));\r
        #endif\r
    #endif\r
\r
    #if defined(EQUI_MAP)\r
        float v = acos(-ray.y) * OneOverPI;\r
        float m = atan(-ray.x, ray.z);\r
        uv = vec2(m * OneOver2PI + 0.5, v);\r
\r
        fragColor = texture(u_equirectmap, uv);\r
    #endif\r
\r
    #if defined(SPHERE_MAP)\r
        ray = -ray.xzy;\r
        ray.y *= -1.0;\r
        ray.z += +1.0;\r
        uv = 0.5 + 0.5 * ray.xy / length(ray);\r
\r
        fragColor = texture(u_spheremap, uv);\r
    #endif\r
\r
    #if defined(POLAR_MAP)\r
        ray.xz /= abs(ray.y) + 1.0;\r
        ray.xz = ray.xz * 0.5 + 0.5;\r
        ray.x *= -1.0;\r
\r
        fragColor = mix(texture(u_polarmap[1], ray.xz),\r
                        texture(u_polarmap[0], vec2(1.0, -1.0) * ray.xz),\r
                        step(0.0, ray.y));\r
    #endif\r
}\r
`},8170:F=>{F.exports=`precision highp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    attribute vec2 a_vertex;\r
#else\r
    in vec2 a_vertex;\r
#endif\r
\r
\r
uniform mat4 u_viewProjectionInverse;\r
\r
\r
varying vec2 v_uv;\r
varying vec4 v_ray;\r
\r
\r
void main(void)\r
{\r
    v_uv = a_vertex * 0.5 + 0.5;\r
    v_ray = u_viewProjectionInverse * vec4(a_vertex, 1.0, 1.0);\r
\r
    gl_Position = vec4(a_vertex.xy, 1.0 - 1e-6, 1.0);\r
}\r
`},4472:F=>{F.exports=`\r
precision lowp float;\r
precision lowp int;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
#if __VERSION__ == 100\r
  #define fragColor gl_FragColor\r
#else\r
  layout(location = 0) out vec4 fragColor;\r
#endif\r
\r
\r
uniform float u_weights[32];\r
uniform vec2 u_delta;\r
\r
uniform sampler2D u_texture;\r
\r
varying vec2 v_texCoords;\r
\r
\r
void main()\r
{\r
    vec4 result = u_weights[0] * texture(u_texture, v_texCoords);\r
    for (int i = 1; i <= $KERNEL_HALF_SIZE; i++)\r
    {\r
        result += u_weights[i] * texture(u_texture, v_texCoords + float(i) * u_delta);\r
        result += u_weights[i] * texture(u_texture, v_texCoords - float(i) * u_delta);\r
    }\r
\r
    fragColor = result;\r
}\r
`},1622:F=>{F.exports=`\r
precision lowp float;\r
precision lowp int;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
#if __VERSION__ == 100\r
  attribute vec2 a_vertex;\r
#else\r
  layout(location = 0) in vec2 a_vertex;\r
#endif\r
\r
\r
varying vec2 v_texCoords;\r
\r
\r
void main()\r
{\r
    v_texCoords = a_vertex * 0.5 + 0.5;\r
    gl_Position = vec4(a_vertex, 0.0, 1.0);\r
}\r
`},3643:F=>{F.exports=`\r
precision lowp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    attribute vec2 a_vertex;\r
#else\r
    layout(location = 0) in vec2 a_vertex;\r
#endif\r
\r
\r
varying vec2 v_uv;\r
\r
\r
void main(void)\r
{\r
    v_uv = a_vertex * 0.5 + 0.5;\r
\r
    gl_Position = vec4(a_vertex, 0.0, 1.0);\r
}\r
`},5081:F=>{F.exports=`\r
precision highp float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
const float one255ths = 1.0 / 255.0;\r
\r
vec3 float24x1_to_uint8x3(const in float f) {\r
    vec3 uint8x3 = vec3(f, fract(f * 256.0), fract(f * 65536.0));\r
    return floor(uint8x3 * 256.0) * one255ths;\r
}\r
\r
vec4 float24x1_to_uint8x4(const in float f) {\r
    vec4 uint8x4 = vec4(f, fract(f * 256.0), fract(f * 65536.0), fract(f * 16777216.0));\r
    return floor(uint8x4 * 256.0) * one255ths;\r
}\r
\r
const vec3 premultUint8x3 = vec3(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0);\r
float uint8x3_to_float24x1(const in vec3 v) {\r
    return dot(v, premultUint8x3); // a1 * b1 + a2 * b2 + a3 * b3  ;)\r
}\r
\r
const vec4 premultUint8x4 = vec4(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0, 255.0 / 4294967296.0);\r
float uint8x4_to_float32x1(const in vec4 v) {\r
    return dot(v, premultUint8x4); // a1 * b1 + a2 * b2 + a3 * b3 + a4 * b4  ;)\r
}\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragDepth gl_FragColor\r
#else \r
    layout(location = 0) out vec4 fragDepth;\r
#endif\r
\r
\r
uniform sampler2D u_texture;\r
uniform vec2 u_offset;\r
uniform vec2 u_scale;\r
\r
varying vec2 v_uv;\r
\r
\r
\r
void main(void)\r
{\r
    vec2 uv = vec2(v_uv.x, 1.0 - v_uv.y) * u_scale + u_offset;\r
    float depth = texture(u_texture, uv).r;\r
\r
    fragDepth = vec4(float24x1_to_uint8x3(depth), 1.0);\r
}\r
`},9761:F=>{F.exports=`precision mediump float;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else \r
    #define varying in\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
    #define fragColor gl_FragColor\r
\r
    #ifdef GL_OES_standard_derivatives\r
        #extension GL_OES_standard_derivatives : enable\r
        #define AASTEP\r
    #endif\r
\r
#else\r
    layout(location = 0) out vec4 fragColor;\r
\r
    #define AASTEP\r
\r
#endif\r
\r
\r
uniform sampler2D u_glyphs;\r
uniform vec4 u_color;\r
uniform float u_aaStepScale;\r
uniform int u_aaSampling;\r
\r
varying vec2 v_uv;\r
\r
const int channel = 0;\r
\r
\r
float aastep(float t, float value)\r
{\r
#ifdef AASTEP\r
    /* float afwidth = length(vec2(dFdx(value), dFdy(value))) * u_aaStepScale; */\r
    float afwidth = fwidth(value) * u_aaStepScale;\r
    /* The aa step scale is more of a hack to provide seemingly smoother (e.g., >= 1.0) or crisper (e.g., between 0.0\r
     * and 1.0) contours without specific sampling. It's just scaling the outcome of the derivatives.\r
     */\r
\r
    return smoothstep(t - afwidth, t + afwidth, value);\r
#else\r
    return step(t, value);\r
#endif\r
}\r
\r
float texStep(float t, vec2 uv)\r
{\r
    /*\r
     * This is a workaround for a known bug in Chrome software rendering (SwiftShader), for updates follow\r
     * https://issuetracker.google.com/u/1/issues/146041290\r
     * Workaround: Storing the result of the texture access into another variable that then is passed as parameter.\r
     */\r
    float distanceValue = texture(u_glyphs, uv)[channel];\r
    return step(t, distanceValue);\r
}\r
\r
float texSmooth(float t, vec2 uv)\r
{\r
    /*\r
     * This is a workaround for a known bug in Chrome software rendering (SwiftShader), for updates follow\r
     * https://issuetracker.google.com/u/1/issues/146041290\r
     * Workaround: Storing the result of the texture access into another variable that then is passed as parameter.\r
     */\r
    float distanceValue = texture(u_glyphs, uv)[channel];\r
    return aastep(t, distanceValue);\r
}\r
\r
#ifdef AASTEP\r
\r
float aastep3h(float t, vec2 uv)\r
{\r
    float x = dFdy(uv.x) * 1.0 / 3.0;\r
\r
    float v = texSmooth(t, uv + vec2( -x, 0.0))\r
            + texSmooth(t, uv + vec2(0.0, 0.0))\r
            + texSmooth(t, uv + vec2( +x, 0.0));\r
\r
    return v / 3.0;\r
}\r
\r
float aastep3v(float t, vec2 uv)\r
{\r
    float y = dFdy(uv.y) * 1.0 / 3.0;\r
\r
    float v = texSmooth(t, uv + vec2( 0.0,  -y))\r
            + texSmooth(t, uv + vec2( 0.0, 0.0))\r
            + texSmooth(t, uv + vec2( 0.0,  +y));\r
\r
    return v / 3.0;\r
}\r
\r
float aastep3x3(float t, vec2 uv)\r
{\r
    float x = dFdx(uv.x) * 1.0 / 3.0;\r
    float y = dFdy(uv.y) * 1.0 / 3.0;\r
\r
    float v = texSmooth(t, uv + vec2(  -x, -y)) + texSmooth(t, uv + vec2(  -x, 0.0)) + texSmooth(t, uv + vec2(  -x, +y))\r
            + texSmooth(t, uv + vec2( 0.0, -y)) + texSmooth(t, uv + vec2( 0.0, 0.0)) + texSmooth(t, uv + vec2( 0.0, +y))\r
            + texSmooth(t, uv + vec2(  +x, -y)) + texSmooth(t, uv + vec2(  +x, 0.0)) + texSmooth(t, uv + vec2(  +x, +y));\r
\r
    return v / 9.0;\r
}\r
\r
float aastep4x4(float t, vec2 uv)\r
{\r
    float x0 = dFdx(uv.x);\r
    float y0 = dFdx(uv.y);\r
    float x1 = x0 * 1.0 / 8.0;\r
    float y1 = y0 * 1.0 / 8.0;\r
    float x2 = x0 * 3.0 / 8.0;\r
    float y2 = y0 * 3.0 / 8.0;\r
\r
    float v = texSmooth(t, uv + vec2(-x2,-y2)) + texSmooth(t, uv + vec2(-x2,-y1))\r
            + texSmooth(t, uv + vec2(-x2,+y1)) + texSmooth(t, uv + vec2(-x2,+y2))\r
\r
            + texSmooth(t, uv + vec2(-x1,-y2)) + texSmooth(t, uv + vec2(-x1,-y1))\r
            + texSmooth(t, uv + vec2(-x1,+y1)) + texSmooth(t, uv + vec2(-x1,+y2))\r
\r
            + texSmooth(t, uv + vec2(+x1,-y2)) + texSmooth(t, uv + vec2(+x1,-y1))\r
            + texSmooth(t, uv + vec2(+x1,+y1)) + texSmooth(t, uv + vec2(+x1,+y2))\r
\r
            + texSmooth(t, uv + vec2(+x2,-y2)) + texSmooth(t, uv + vec2(+x2,-y1))\r
            + texSmooth(t, uv + vec2(+x2,+y1)) + texSmooth(t, uv + vec2(+x2,+y2));\r
\r
    return v / 16.0;\r
}\r
\r
// vec4 subpix(float r, float g, float b, vec4 fore, vec4 back)\r
// {\r
//     return vec4(mix(back.rgb, fore.rgb, vec3(r, g, b)), mix(back.a, fore.a, (r + b + g) / 3.0));\r
// }\r
\r
#endif\r
\r
void main(void)\r
{\r
    /** @todo mipmap access? */\r
\r
    float a = 0.0;\r
    /* When using multiframe sampling, might not be necessary and even tends to add more blur */\r
#ifdef AASTEP\r
    if(u_aaSampling == 0) {         // LabelRenderPass.Sampling.None\r
#endif\r
\r
        a = texStep(0.5, v_uv);\r
\r
#ifdef AASTEP\r
    } else if(u_aaSampling == 1) {  // LabelRenderPass.Sampling.Smooth\r
        a = texSmooth(0.5, v_uv);\r
    } else if(u_aaSampling == 2) {  // LabelRenderPass.Sampling.Horizontal3\r
        a = aastep3h(0.5, v_uv);\r
    } else if(u_aaSampling == 3) {  // LabelRenderPass.Sampling.Vertical3\r
        a = aastep3v(0.5, v_uv);\r
    } else if(u_aaSampling == 4) {  // LabelRenderPass.Sampling.Grid3x3\r
        a = aastep3x3(0.5, v_uv);\r
    } else if(u_aaSampling == 5) {  // LabelRenderPass.Sampling.Grid4x4\r
        a = aastep4x4(0.5, v_uv);\r
    }\r
#endif\r
\r
    /**\r
     * @todo - design decision: Don't discard fragments?, as we might need them for an id-buffer for\r
     * clicking-interaction. Furthermore, using if-statement and discard can slow down performance:\r
     * it's bad for IMR, TBR, TBDR and early-Z optimization\r
     * https://stackoverflow.com/questions/8509051/is-discard-bad-for-program-performance-in-opengl\r
     */\r
    if(a <= 0.0) {\r
        discard;\r
    }\r
    fragColor = vec4(u_color.rgb, u_color.a * a);\r
\r
    /* use when pre-multiplied color is required. */\r
    /* fragColor = vec4(u_color.rgb * u_color.a * a, u_color.a * a); */\r
}\r
`},1176:F=>{F.exports=`precision mediump float;\r
precision lowp int;\r
\r
\r
#if __VERSION__ == 100\r
    #define texture(sampler, coord) texture2D(sampler, coord)\r
#else\r
    #define varying out\r
#endif\r
\r
\r
\r
#if __VERSION__ == 100\r
\r
#extension GL_EXT_draw_buffers : enable\r
attribute vec2 a_vertex;\r
/* [ texture ll: vec2, ur: vec2 ] */\r
attribute vec4 a_texCoord;\r
attribute vec3 a_origin;\r
attribute vec3 a_tangent;\r
attribute vec3 a_up;\r
\r
#else\r
\r
in vec2 a_vertex;\r
/* [ texture ll: vec2, ur: vec2 ]*/\r
in vec4 a_texCoord;\r
in vec3 a_origin;\r
in vec3 a_tangent;\r
in vec3 a_up;\r
\r
#endif\r
\r
\r
uniform mat4 u_viewProjection;\r
uniform vec2 u_ndcOffset;\r
uniform mat4 u_transform;\r
uniform bool u_dynamic;\r
\r
varying vec2 v_uv;\r
\r
\r
void ndcOffset(inout vec4 vertex, in vec2 offset) {\r
    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r
}\r
\r
\r
\r
void main(void)\r
{\r
    /* TEXTURE COORDS */\r
\r
    /* flip y-coordinates */\r
    vec2 texExt = vec2(a_texCoord[2] - a_texCoord[0], a_texCoord[1] - a_texCoord[3]);\r
\r
    v_uv = a_vertex * texExt + vec2(a_texCoord[0], 1.0 - a_texCoord[1]);\r
\r
    /* POSITIONING */\r
    /* quad data as flat array: [0, 0,  0, 1,  1, 0,  1, 1] (a_vertex), which translates to ll, lr, ul, ur corners.\r
     * 2-------4\r
     * |  \\    |\r
     * |    \\  |\r
     * 1-------3\r
     * The current vertex is calculated based on the current quad corners and the tangent attributes.\r
     * The following lines are optimized for MAD optimization.\r
     */\r
    vec3 tangentDirection = a_origin + a_vertex.x * a_tangent;\r
    vec4 vertex = vec4(tangentDirection + a_vertex.y * a_up, 1.0);\r
\r
    if(u_dynamic) {\r
        vertex = u_transform * vertex;\r
    }\r
    vertex = u_viewProjection * vertex;\r
\r
    ndcOffset(vertex, u_ndcOffset);\r
    gl_Position = vertex;\r
}\r
`},8632:F=>{F.exports=JSON.parse('{"id":"/ColorScalePresets","title":"Color Scale Presets Schema","description":"JSON schema for a color scale presets data, used in the webgl-operate module for validation.","type":"array","items":{"type":"object","properties":{"identifier":{"type":"string"},"type":{"type":"string","enum":["sequential","diverging","qualitative"]},"format":{"type":"string","enum":["rgb","rgbf"]},"colors":{"type":"array","items":{"type":"array","items":{"type":["integer","number"]}}},"positions":{"type":"array","items":{"type":"array","items":{"type":["integer","number"]}}}},"required":["identifier","format","colors"],"additionalProperties":false}}')},1037:F=>{F.exports=JSON.parse('{"kernel":[[[[0.201114,0.016597],[-0.090682,-0.219471],[-0.180852,0.162495],[0.055216,0.398563],[-0.41692,-0.073573],[0.291284,-0.365369],[0.437182,0.252665],[-0.32675,-0.455539]]]],"size":{"depth":1,"height":1,"width":8}}')},6412:F=>{F.exports=JSON.parse('{"kernel":[[[[-0.992216,-0.610879],[-0.975957,0.625189],[-0.965904,-0.138743],[-0.949645,-0.902675],[-0.933385,0.333393],[-0.923332,-0.430539],[-0.907073,0.805529],[-0.89702,0.0415974],[-0.88076,-0.722335],[-0.864501,0.513733],[-0.854448,-0.250199],[-0.838189,0.985869],[-0.811876,0.221937],[-0.795617,-0.541995],[-0.785564,0.694073],[-0.769305,-0.0698586],[-0.753045,-0.833791],[-0.742992,0.402277],[-0.726733,-0.361655],[-0.70042,0.874413],[-0.684161,0.110482],[-0.674108,-0.65345],[-0.657849,0.582618],[-0.631536,-0.181314],[-0.615277,-0.945246],[-0.605224,0.290822],[-0.588964,-0.47311],[-0.572705,0.762958],[-0.562652,-0.000974417],[-0.546393,-0.764906],[-0.52008,0.471162],[-0.503821,-0.29277],[-0.493768,0.943298],[-0.477509,0.179366],[-0.461249,-0.584566],[-0.451196,0.651502],[-0.434937,-0.11243],[-0.424884,-0.876362],[-0.408624,0.359706],[-0.392365,-0.404226],[-0.382312,0.831842],[-0.366053,0.0679097],[-0.33974,-0.696022],[-0.323481,0.540046],[-0.313428,-0.223886],[-0.297168,-0.987818],[-0.280909,0.24825],[-0.270856,-0.515682],[-0.254597,0.720386],[-0.228284,-0.0435462],[-0.212025,-0.807478],[-0.201972,0.42859],[-0.185713,-0.335342],[-0.169453,0.900726],[-0.1594,0.136794],[-0.143141,-0.627138],[-0.133088,0.60893],[-0.116828,-0.155002],[-0.100569,-0.918934],[-0.0905161,0.317134],[-0.0742567,-0.446798],[-0.0479443,0.78927],[-0.0316849,0.0253379],[-0.021632,-0.738594],[-0.00537252,0.497474],[0.0108869,-0.266458],[0.0209398,0.96961],[0.0371993,0.205678],[0.0635116,-0.558254],[0.079771,0.677814],[0.089824,-0.086118],[0.106083,-0.85005],[0.132396,0.386018],[0.148655,-0.377914],[0.158708,0.858154],[0.174968,0.0942221],[0.191227,-0.66971],[0.20128,0.566358],[0.217539,-0.197574],[0.243852,-0.961506],[0.260111,0.274562],[0.270164,-0.48937],[0.286423,0.746698],[0.302683,-0.0172338],[0.312736,-0.781166],[0.328995,0.454902],[0.339048,-0.30903],[0.355308,0.927038],[0.371567,0.163106],[0.38162,-0.600826],[0.397879,0.635242],[0.424192,-0.12869],[0.440451,-0.892622],[0.450504,0.343446],[0.466763,-0.420486],[0.483023,0.815582],[0.493076,0.0516503],[0.509335,-0.712282],[0.535648,0.523786],[0.551907,-0.240146],[0.56196,0.995922],[0.578219,0.23199],[0.604532,-0.531942],[0.620791,0.704126],[0.630844,-0.0598056],[0.647104,-0.823738],[0.663363,0.41233],[0.673416,-0.351602],[0.689675,0.884466],[0.715988,0.120534],[0.732247,-0.643398],[0.7423,0.59267],[0.758559,-0.171262],[0.774819,-0.935194],[0.784872,0.300874],[0.801131,-0.463058],[0.811184,0.77301],[0.827444,0.0090785],[0.843703,-0.754853],[0.853756,0.481215],[0.870015,-0.282717],[0.896328,0.953351],[0.912587,0.189419],[0.92264,-0.574513],[0.9389,0.661555],[0.955159,-0.102377],[0.965212,-0.866309],[0.981471,0.369759]]]],"size":{"depth":1,"height":1,"width":128}}')},9655:F=>{F.exports=JSON.parse('{"kernel":[[[[-0.058976,0.021042],[0.065636,-0.034686],[0.023064,0.111212],[-0.011378,-0.124856],[-0.122834,-0.069128],[0.155806,0.055484],[-0.170432,0.07677],[-0.101548,0.16694],[0.190248,-0.090414],[0.121364,-0.180584],[0.100078,0.201382],[-0.080262,-0.215026],[-0.247446,-0.0134],[-0.024534,0.25711],[-0.204874,-0.159298],[0.267262,-0.000244],[0.22469,0.145654],[0.031194,-0.270754],[-0.213004,0.222668],[-0.303174,0.132498],[0.245976,-0.236312],[-0.13599,0.312838],[0.177092,0.291552],[-0.157276,-0.305196],[0.31486,-0.146142],[0.04435,0.34728],[-0.337616,-0.10357],[-0.04582,-0.360924],[0.168962,-0.326482],[0.357432,0.089926],[-0.372058,0.042328],[-0.281888,-0.249468],[0.301704,0.235824],[-0.067106,0.403008],[0.40503,-0.055972],[0.078792,-0.416652],[-0.350772,0.278396],[-0.4065,-0.19374],[-0.260602,0.368566],[-0.449072,-0.047842],[-0.22616,-0.395366],[0.13452,0.43745],[0.259132,0.381722],[0.426316,0.180096],[-0.114704,-0.451094],[-0.427786,0.188226],[0.370588,-0.29204],[0.280418,-0.38221],[0.482044,0.034198],[0.447602,-0.20187],[0.009908,0.493178],[-0.358902,-0.339638],[-0.191718,0.458736],[-0.49667,0.098056],[0.391874,0.325994],[0.211534,-0.47238],[-0.483514,-0.28391],[-0.462228,0.334124],[-0.393344,0.424294],[0.336146,0.471892],[-0.31633,-0.485536],[0.41316,-0.437938],[-0.440942,-0.429808],[0.460758,0.416164]]]],"size":{"depth":1,"height":1,"width":64}}')},7456:F=>{F.exports=JSON.parse('[{"identifier":"chrome-63","backend":"webgl2","extensions_strive":["EXT_color_buffer_float","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context"]},{"identifier":"edge-41","backend":"webgl1","extensions_strive":["ANGLE_instanced_arrays","EXT_frag_depth","EXT_texture_filter_anisotropic","OES_texture_float","OES_texture_float_linear","OES_standard_derivatives","OES_element_index_uint","OES_texture_half_float","OES_texture_half_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info","WEBGL_depth_texture"]},{"identifier":"ie-11","backend":"webgl1","extensions_strive":["ANGLE_instanced_arrays","EXT_texture_filter_anisotropic","OES_texture_float","OES_texture_float_linear","OES_standard_derivatives","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info"]},{"identifier":"firefox-57","backend":"webgl2","extensions_strive":["EXT_color_buffer_float","EXT_texture_filter_anisotropic","EXT_disjoint_timer_query","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","MOZ_WEBGL_lose_context","MOZ_WEBGL_compressed_texture_s3tc"]},{"identifier":"safari-10.1","backend":"webgl1","extensions_strive":["compressed_texture_pvrtc","compressed_texture_s3tc","debug_renderer_info","disjoint_timer_query","draw_buffers","element_index_uint","frag_depth","instanced_arrays","lose_context","sRGB","shader_texture_lod","standard_derivatives","texture_filter_anisotropic","texture_float","texture_float_linear","texture_half_float","texture_half_float_linear","vertex_array_object"],"functions_undefine":["readBuffer"]},{"identifier":"no-WEBGL_draw_buffers","backend":"webgl1","extensions_conceal":["WEBGL_draw_buffers"]},{"identifier":"no-readBuffer","extensions_hash":"100000","functions_undefine":["readBuffer"]},{"identifier":"webgl1","extensions_hash":"1+++++"},{"identifier":"webgl2","extensions_hash":"2+++++"}]')},7318:F=>{F.exports=Fa}},yt={};function Fe(F){var p=yt[F];if(p!==void 0)return p.exports;var v=yt[F]={exports:{}};return Pr[F].call(v.exports,v,v.exports,Fe),v.exports}Fe.d=(F,p)=>{for(var v in p)Fe.o(p,v)&&!Fe.o(F,v)&&Object.defineProperty(F,v,{enumerable:!0,get:p[v]})},Fe.o=(F,p)=>Object.prototype.hasOwnProperty.call(F,p),Fe.r=F=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},Fe(5254);var wr=Fe(9515);Ia.exports=wr})();export{Ia as w};
//# sourceMappingURL=vendor.9ee87579.js.map
