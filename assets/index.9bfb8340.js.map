{"version":3,"file":"index.9bfb8340.js","sources":["../../vite/modulepreload-polyfill","../../source/example.ts","../../source/CanvasSize/canvassize-example.ts","../../source/index.ts"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","\n/* spellchecker: disable */\n\nimport {\n    Canvas,\n    Context,\n    Controller,\n    Initializable,\n    LoadingStatus,\n    Renderer,\n    viewer,\n} from 'webgl-operate';\n\n/* spellchecker: enable */\n\ndeclare global {\n    interface Window { \n        canvas: Canvas; \n        context: Context; \n        controller: \n        Controller; \n        renderer: Renderer \n    }\n}\n\n\nexport abstract class Example extends Initializable {\n\n    protected _spinnerElement: HTMLDivElement | undefined;\n\n    /**\n     * Hide the loading spinner.\n     */\n    protected showSpinner(): void {\n        const spinnerElement = this._spinnerElement;\n        if (spinnerElement) {\n            (spinnerElement as HTMLElement).style.display = 'inline';\n        }\n    }\n\n    /**\n     * Hide the loading spinner.\n     */\n    protected hideSpinner(): void {\n        const spinnerElement = this._spinnerElement;\n        if (spinnerElement) {\n            (spinnerElement as HTMLElement).style.display = 'none';\n        }\n    }\n\n    protected expose(): void {\n\n        window['canvas'] = this.canvas;\n        window['context'] = this.canvas.context;\n        window['controller'] = this.canvas.controller;\n\n        window['renderer'] = this.renderer;\n    }\n\n    initialize(element: HTMLCanvasElement | string, spinnerElement?: HTMLDivElement): boolean {\n        this._spinnerElement = spinnerElement;\n        const result = this.onInitialize(element);\n\n        this.renderer.loadingStatus$.subscribe((status: LoadingStatus) => {\n            if (status === LoadingStatus.Finished) {\n                this.hideSpinner();\n            } else if (status === LoadingStatus.Started) {\n                this.showSpinner();\n            }\n        });\n\n        this.expose();\n\n        return result;\n    }\n\n    uninitialize(): void {\n        this.onUninitialize();\n    }\n\n    abstract onInitialize(element: HTMLCanvasElement | string): boolean;\n\n    abstract onUninitialize(): void;\n\n    abstract get renderer(): Renderer;\n\n    abstract get canvas(): Canvas;\n\n    enableFullscreenOnCtrlClick(): void {\n\n        const e = this.canvas.element;\n        e.addEventListener('click', (event) => {\n            if (event.ctrlKey) { viewer.Fullscreen.toggle(e); }\n        });\n    }\n}\n","\n/* spellchecker: disable */\n\nimport {\n    Canvas,\n    DefaultFramebuffer,\n    NdcFillingTriangle,\n    Program,\n    Shader,\n    Renderer,\n    Wizard,\n} from 'webgl-operate';\n\nimport { Example } from '../example';\n\n/* spellchecker: enable */\n\n// tslint:disable:max-classes-per-file\n\n\nclass CanvasSizeRenderer extends Renderer {\n\n    protected static readonly SHADER_SOURCE_VERT: string =\n        `precision lowp float;\n\n#if __VERSION__ == 100\n    attribute vec2 a_vertex;\n#else\n    in vec2 a_vertex;\n    #define varying out\n#endif\n\nvarying vec2 v_uv;\n\nvoid main(void)\n{\n    v_uv = a_vertex * 0.5 + 0.5;\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\n}\n`;\n\n    protected static readonly SHADER_SOURCE_FRAG: string =\n        `precision highp float;\n\n#if __VERSION__ == 100\n    #define fragColor gl_FragColor\n#else\n    layout(location = 0) out vec4 fragColor;\n    #define varying in\n#endif\n\nvarying vec2 v_uv;\n\nuniform float u_cellWidth;\n\nvoid main(void)\n{\n    vec3 x3 = vec3(gl_FragCoord.x) + vec3(0.0, 1.0, 2.0);\n    vec3 y3 = vec3(gl_FragCoord.y) + vec3(0.0, 1.0, 2.0);\n\n    vec3 x = step(mod(x3, vec3(3.0)), vec3(1.0));\n    vec3 y = step(mod(y3, vec3(3.0)), vec3(1.0));\n\n    float cell = step(mod(gl_FragCoord.x * u_cellWidth + floor(gl_FragCoord.y * u_cellWidth), 2.0), 1.0);\n    fragColor = vec4(mix(x, y, cell), 1.0);\n}\n`;\n\n\n    protected _extensions = false;\n\n    protected _defaultFBO: DefaultFramebuffer;\n\n    protected _ndcTriangle: NdcFillingTriangle;\n\n    protected _program: Program;\n\n    protected _cellWidth: number;\n    protected _uCellWidth: WebGLUniformLocation;\n\n\n    /**\n     * Initializes and sets up rendering passes, navigation, loads a font face and links shaders with program.\n     * @param context - valid context to create the object for.\n     * @param identifier - meaningful name for identification of this instance.\n     * @param mouseEventProvider - required for mouse interaction\n     * @returns - whether initialization was successful\n     */\n    protected onInitialize(\n        // context: Context, \n        // callback: Invalidate,\n        // eventProvider: EventProvider\n    ): boolean {\n\n        /* Create framebuffers, textures, and render buffers. */\n\n        this._defaultFBO = new DefaultFramebuffer(this._context, 'DefaultFBO');\n        this._defaultFBO.initialize();\n        this._defaultFBO.bind();\n\n        /* Create and configure canvas-size test pattern pass. */\n\n        const gl = this._context.gl;\n\n        this._ndcTriangle = new NdcFillingTriangle(this._context, 'NdcFillingTriangle');\n        this._ndcTriangle.initialize();\n\n        const vert = new Shader(this._context, gl.VERTEX_SHADER, 'ndcvertices (in-line)');\n        vert.initialize(CanvasSizeRenderer.SHADER_SOURCE_VERT);\n        const frag = new Shader(this._context, gl.FRAGMENT_SHADER, 'pattern (in-line)');\n        frag.initialize(CanvasSizeRenderer.SHADER_SOURCE_FRAG);\n\n        this._program = new Program(this._context, 'CanvasSizeProgram');\n        this._program.initialize([vert, frag], false);\n\n        this._program.attribute('a_vertex', this._ndcTriangle.vertexLocation);\n        this._program.link();\n\n        this._cellWidth = 1.0 / 64.0;\n        this._uCellWidth = this._program.uniform('u_cellWidth');\n\n        this.finishLoading();\n\n        return true;\n    }\n\n    /**\n     * Uninitializes Buffers, Textures, and Program.\n     */\n    protected onUninitialize(): void {\n        super.uninitialize();\n\n        this._ndcTriangle.uninitialize();\n        this._program.uninitialize();\n\n        this._defaultFBO.uninitialize();\n    }\n\n    protected onDiscarded(): void {\n        this._altered.alter('canvasSize');\n        this._altered.alter('clearColor');\n        this._altered.alter('frameSize');\n    }\n\n    /**\n     * This is invoked in order to check if rendering of a frame is required by means of implementation specific\n     * evaluation (e.g., lazy non continuous rendering). Regardless of the return value a new frame (preparation,\n     * frame, swap) might be invoked anyway, e.g., when update is forced or canvas or context properties have\n     * changed or the renderer was invalidated @see{@link invalidate}.\n     * @returns whether to redraw\n     */\n    protected onUpdate(): boolean {\n\n        return this._altered.any;\n    }\n\n    /**\n     * This is invoked in order to prepare rendering of one or more frames, regarding multi-frame rendering and\n     * camera-updates.\n     */\n    protected onPrepare(): void {\n\n        // if (this._altered.canvasSize) {\n        //     this._camera.aspect = this._canvasSize[0] / this._canvasSize[1];\n        //     this._camera.viewport = this._canvasSize;\n        // }\n\n        if (this._altered.clearColor) {\n            this._defaultFBO.clearColor(this._clearColor);\n        }\n\n        this._altered.reset();\n    }\n\n    /**\n     * After (1) update and (2) preparation are invoked, a frame is invoked. Renders both 2D and 3D labels.\n     * @param frameNumber - for intermediate frames in accumulation rendering\n     */\n    protected onFrame(/*frameNumber: number*/): void {\n        const gl = this._context.gl;\n\n        gl.viewport(0, 0, this._canvasSize[0], this._canvasSize[1]);\n\n        this._defaultFBO.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT, false, false);\n\n        this._program.bind();\n\n        gl.uniform1f(this._uCellWidth, this.cellWidth);\n\n        this._ndcTriangle.bind();\n        this._ndcTriangle.draw();\n        this._ndcTriangle.unbind();\n\n    }\n\n    get cellWidth(): number {\n        return this._cellWidth;\n    }\n\n    set cellWidth(cellWidth: number) {\n        this._cellWidth = cellWidth;\n        this.invalidate(true);\n    }\n\n}\n\n\nexport class CanvasSizeExample extends Example {\n\n    private _canvas: Canvas;\n    private _renderer: CanvasSizeRenderer;\n\n    onInitialize(element: HTMLCanvasElement | string): boolean {\n\n        this._canvas = new Canvas(element, { antialias: false });\n        this._canvas.controller.multiFrameNumber = 1;\n        this._canvas.framePrecision = Wizard.Precision.byte;\n        this._canvas.frameScale = [1.0, 1.0];\n\n        this._renderer = new CanvasSizeRenderer();\n        this._canvas.renderer = this._renderer;\n\n        return true;\n    }\n\n    onUninitialize(): void {\n        this._canvas.dispose();\n        (this._renderer as Renderer).uninitialize();\n    }\n\n    get canvas(): Canvas {\n        return this._canvas;\n    }\n\n    get renderer(): CanvasSizeRenderer {\n        return this._renderer;\n    }\n\n    set cellWidth(cellWidth: number) {\n        this._renderer.cellWidth = cellWidth;\n    }\n\n}\n","// import \"./styles.css\"\n\nimport { CanvasSizeExample } from \"./CanvasSize/canvassize-example\";\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\ndocument.getElementById(\"app\")!.innerHTML = `\n<canvas id=\"example-canvas\" style=\"width: 100%; height: 100%;\" />\n<div class=\"spinner\" id=\"spinner\">\n  <div></div>\n  <div></div>\n  <div></div>\n  <div></div>\n</div>`;\n\nconst canvas = document.getElementById(\"example-canvas\") as HTMLCanvasElement;\n\nconst example = new CanvasSizeExample();\nexample.initialize(\n  canvas,\n  document.getElementById(\"spinner\") as HTMLDivElement\n);\nexample.enableFullscreenOnCtrlClick();\n"],"names":["Initializable","LoadingStatus","Renderer","DefaultFramebuffer","NdcFillingTriangle","Shader","Program","Canvas","Wizard"],"mappings":"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"}